<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Introduction to DBMS queries | Exploring Enterprise Databases with R: A Tidyverse Approach</title>
  <meta name="description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Introduction to DBMS queries | Exploring Enterprise Databases with R: A Tidyverse Approach" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Introduction to DBMS queries | Exploring Enterprise Databases with R: A Tidyverse Approach" />
  
  <meta name="twitter:description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  

<meta name="author" content="John David Smith, Sophie Yang, M. Edward (Ed) Borasky, Jim Tyhurst, Scott Came, Mary Anne Thygesen, and Ian Frantz" />


<meta name="date" content="2020-01-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-connect-to-db-with-r-code.html"/>
<link rel="next" href="chapter-exploring-a-single-table.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.11/datatables.js"></script>
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.19/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R, Databases and Docker</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#using-r-to-query-a-dbms-in-your-organization"><i class="fa fa-check"></i><b>1.1</b> Using R to query a DBMS in your organization</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#docker-as-a-tool-for-users"><i class="fa fa-check"></i><b>1.2</b> Docker as a tool for UseRs</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#alternatives-to-docker"><i class="fa fa-check"></i><b>1.3</b> Alternatives to Docker</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#packages-used-in-this-book"><i class="fa fa-check"></i><b>1.4</b> Packages used in this book</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#who-are-we"><i class="fa fa-check"></i><b>1.5</b> Who are we?</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#how-did-this-project-come-about"><i class="fa fa-check"></i><b>1.6</b> How did this project come about?</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#navigation"><i class="fa fa-check"></i><b>1.7</b> Navigation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html"><i class="fa fa-check"></i><b>2</b> How to use this book</a><ul>
<li class="chapter" data-level="2.1" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#retrieve-the-code-from-github"><i class="fa fa-check"></i><b>2.1</b> Retrieve the code from GitHub</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#read-along-experiment-as-you-go"><i class="fa fa-check"></i><b>2.2</b> Read along, experiment as you go</a></li>
<li class="chapter" data-level="2.3" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#participating"><i class="fa fa-check"></i><b>2.3</b> Participating</a><ul>
<li class="chapter" data-level="2.3.1" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#browsing-the-book"><i class="fa fa-check"></i><b>2.3.1</b> Browsing the book</a></li>
<li class="chapter" data-level="2.3.2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#diving-in"><i class="fa fa-check"></i><b>2.3.2</b> Diving in</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html"><i class="fa fa-check"></i><b>3</b> Chapter Learning Goals and Use Cases</a><ul>
<li class="chapter" data-level="3.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#the-books-challenge-goals-context-and-expectations"><i class="fa fa-check"></i><b>3.1</b> The Book’s Challenge: goals, context and expectations</a><ul>
<li class="chapter" data-level="3.1.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#the-challenge-investigating-a-question-using-an-organizations-database"><i class="fa fa-check"></i><b>3.1.1</b> The Challenge: Investigating a question using an organization’s database</a></li>
<li class="chapter" data-level="3.1.2" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#strategies"><i class="fa fa-check"></i><b>3.1.2</b> Strategies</a></li>
<li class="chapter" data-level="3.1.3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#problems-that-we-address-in-the-book"><i class="fa fa-check"></i><b>3.1.3</b> Problems that we address in the book</a></li>
<li class="chapter" data-level="3.1.4" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#signposts"><i class="fa fa-check"></i><b>3.1.4</b> Signposts</a></li>
<li class="chapter" data-level="3.1.5" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#book-structure"><i class="fa fa-check"></i><b>3.1.5</b> Book structure</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#making-your-way-through-the-book"><i class="fa fa-check"></i><b>3.2</b> Making your way through the book</a><ul>
<li class="chapter" data-level="3.2.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#r-packages"><i class="fa fa-check"></i><b>3.2.1</b> R Packages</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#adventure-works"><i class="fa fa-check"></i><b>3.3</b> Adventure Works</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html"><i class="fa fa-check"></i><b>4</b> Create and connect to the adventureworks database in PostgreSQL</a><ul>
<li class="chapter" data-level="4.1" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#verify-that-docker-is-up-running-and-clean-up-if-necessary"><i class="fa fa-check"></i><b>4.2</b> Verify that Docker is up, running, and clean up if necessary</a></li>
<li class="chapter" data-level="4.3" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#clean-up-if-appropriate"><i class="fa fa-check"></i><b>4.3</b> Clean up if appropriate</a></li>
<li class="chapter" data-level="4.4" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#build-the-adventureworks-docker-image"><i class="fa fa-check"></i><b>4.4</b> Build the adventureworks Docker image</a></li>
<li class="chapter" data-level="4.5" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#run-the-adventureworks-docker-image"><i class="fa fa-check"></i><b>4.5</b> Run the adventureworks Docker Image</a></li>
<li class="chapter" data-level="4.6" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#connect-to-postgresql"><i class="fa fa-check"></i><b>4.6</b> Connect to PostgreSQL</a></li>
<li class="chapter" data-level="4.7" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#adventureworks-schemas"><i class="fa fa-check"></i><b>4.7</b> Adventureworks Schemas</a></li>
<li class="chapter" data-level="4.8" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#investigate-the-database-using-rstudio"><i class="fa fa-check"></i><b>4.8</b> Investigate the database using Rstudio</a></li>
<li class="chapter" data-level="4.9" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#cleaning-up-diconnect-from-the-database-and-stop-docker"><i class="fa fa-check"></i><b>4.9</b> Cleaning up: diconnect from the database and stop Docker</a></li>
<li class="chapter" data-level="4.10" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#using-the-adventureworks-container-in-the-rest-of-the-book"><i class="fa fa-check"></i><b>4.10</b> Using the <code>adventureworks</code> container in the rest of the book</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html"><i class="fa fa-check"></i><b>5</b> Securing and using your dbms log-in credentials</a><ul>
<li class="chapter" data-level="5.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#set-up-the-adventureworks-docker-container"><i class="fa fa-check"></i><b>5.1</b> Set up the adventureworks Docker container</a><ul>
<li class="chapter" data-level="5.1.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#verify-that-docker-is-running"><i class="fa fa-check"></i><b>5.1.1</b> Verify that Docker is running</a></li>
<li class="chapter" data-level="5.1.2" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#start-the-docker-container"><i class="fa fa-check"></i><b>5.1.2</b> Start the Docker container:</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#storing-your-dbms-credentials"><i class="fa fa-check"></i><b>5.2</b> Storing your dbms credentials</a><ul>
<li class="chapter" data-level="5.2.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#connect-with-postgres-using-the-sys.getenv-function"><i class="fa fa-check"></i><b>5.2.1</b> Connect with Postgres using the Sys.getenv function</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#disconnect-from-the-database-and-stop-docker"><i class="fa fa-check"></i><b>5.3</b> Disconnect from the database and stop Docker</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html"><i class="fa fa-check"></i><b>6</b> Connecting to the database with R code</a><ul>
<li class="chapter" data-level="6.1" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#verify-that-docker-is-up-and-running-and-start-the-database"><i class="fa fa-check"></i><b>6.1</b> Verify that Docker is up and running, and start the database</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#connect-to-postgresql-1"><i class="fa fa-check"></i><b>6.2</b> Connect to PostgreSQL</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#set-schema-search-path-and-list-its-contents"><i class="fa fa-check"></i><b>6.3</b> Set schema search path and list its contents</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#anatomy-of-a-dplyr-connection-object"><i class="fa fa-check"></i><b>6.4</b> Anatomy of a <code>dplyr</code> connection object</a></li>
<li class="chapter" data-level="6.5" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#disconnect-from-the-database-and-stop-docker-1"><i class="fa fa-check"></i><b>6.5</b> Disconnect from the database and stop Docker</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html"><i class="fa fa-check"></i><b>7</b> Introduction to DBMS queries</a><ul>
<li class="chapter" data-level="7.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#setup"><i class="fa fa-check"></i><b>7.1</b> Setup</a></li>
<li class="chapter" data-level="7.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#methods-for-downloading-a-single-table"><i class="fa fa-check"></i><b>7.2</b> Methods for downloading a single table</a><ul>
<li class="chapter" data-level="7.2.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#read-the-entire-table"><i class="fa fa-check"></i><b>7.2.1</b> Read the entire table</a></li>
<li class="chapter" data-level="7.2.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#create-a-pointer-to-a-table-that-can-be-reused"><i class="fa fa-check"></i><b>7.2.2</b> Create a pointer to a table that can be reused</a></li>
<li class="chapter" data-level="7.2.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#controlling-the-number-of-rows-returned-with-collect"><i class="fa fa-check"></i><b>7.2.3</b> Controlling the number of rows returned with <code>collect()</code></a></li>
<li class="chapter" data-level="7.2.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#retrieving-random-rows-from-the-dbms"><i class="fa fa-check"></i><b>7.2.4</b> Retrieving random rows from the DBMS</a></li>
<li class="chapter" data-level="7.2.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#sub-setting-variables"><i class="fa fa-check"></i><b>7.2.5</b> Sub-setting variables</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#translating-dplyr-code-to-sql-queries"><i class="fa fa-check"></i><b>7.3</b> Translating <code>dplyr</code> code to <code>SQL</code> queries</a></li>
<li class="chapter" data-level="7.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#mixing-dplyr-and-sql"><i class="fa fa-check"></i><b>7.4</b> Mixing dplyr and SQL</a></li>
<li class="chapter" data-level="7.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#examining-a-single-table-with-r"><i class="fa fa-check"></i><b>7.5</b> Examining a single table with R</a><ul>
<li class="chapter" data-level="7.5.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#str---a-base-package-workhorse"><i class="fa fa-check"></i><b>7.5.1</b> <code>str</code> - a base package workhorse</a></li>
<li class="chapter" data-level="7.5.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#always-look-at-your-data-with-head-view-or-kable"><i class="fa fa-check"></i><b>7.5.2</b> Always <strong>look</strong> at your data with <code>head</code>, <code>View</code>, or <code>kable</code></a></li>
<li class="chapter" data-level="7.5.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-summary-function-in-base"><i class="fa fa-check"></i><b>7.5.3</b> The <code>summary</code> function in <code>base</code></a></li>
<li class="chapter" data-level="7.5.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-glimpse-function-in-the-tibble-package"><i class="fa fa-check"></i><b>7.5.4</b> The <code>glimpse</code> function in the <code>tibble</code> package</a></li>
<li class="chapter" data-level="7.5.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-skim-function-in-the-skimr-package"><i class="fa fa-check"></i><b>7.5.5</b> The <code>skim</code> function in the <code>skimr</code> package</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#disconnect-from-the-database-and-stop-docker-2"><i class="fa fa-check"></i><b>7.6</b> Disconnect from the database and stop Docker</a></li>
<li class="chapter" data-level="7.7" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#additional-reading"><i class="fa fa-check"></i><b>7.7</b> Additional reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html"><i class="fa fa-check"></i><b>8</b> Asking Business Questions From a Single Table</a><ul>
<li class="chapter" data-level="8.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#setup-our-standard-working-environment"><i class="fa fa-check"></i><b>8.1</b> Setup our standard working environment</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#a-word-on-naming"><i class="fa fa-check"></i><b>8.2</b> A word on naming</a></li>
<li class="chapter" data-level="8.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#the-overall-adventureworks-sales-picture"><i class="fa fa-check"></i><b>8.3</b> The overall AdventureWorks sales picture</a></li>
<li class="chapter" data-level="8.4" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#annual-sales"><i class="fa fa-check"></i><b>8.4</b> Annual sales</a><ul>
<li class="chapter" data-level="8.4.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#total-sales-by-year"><i class="fa fa-check"></i><b>8.4.1</b> Total sales by year</a></li>
<li class="chapter" data-level="8.4.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#total-order-volume"><i class="fa fa-check"></i><b>8.4.2</b> Total order volume</a></li>
<li class="chapter" data-level="8.4.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#average-dollars-per-sale"><i class="fa fa-check"></i><b>8.4.3</b> Average dollars per sale</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#monthly-sales"><i class="fa fa-check"></i><b>8.5</b> Monthly Sales</a><ul>
<li class="chapter" data-level="8.5.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#check-lagged-monthly-data"><i class="fa fa-check"></i><b>8.5.1</b> Check lagged monthly data</a></li>
<li class="chapter" data-level="8.5.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#comparing-dollars-and-orders-to-a-base-year"><i class="fa fa-check"></i><b>8.5.2</b> Comparing dollars and orders to a base year</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#the-effect-of-online-sales"><i class="fa fa-check"></i><b>8.6</b> The effect of online sales</a><ul>
<li class="chapter" data-level="8.6.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#add-onlineorderflag-to-our-annual-sales-query"><i class="fa fa-check"></i><b>8.6.1</b> Add <code>onlineorderflag</code> to our annual sales query</a></li>
<li class="chapter" data-level="8.6.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#annual-sales-comparison"><i class="fa fa-check"></i><b>8.6.2</b> Annual Sales comparison</a></li>
<li class="chapter" data-level="8.6.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#order-volume-comparison"><i class="fa fa-check"></i><b>8.6.3</b> Order volume comparison</a></li>
<li class="chapter" data-level="8.6.4" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#comparing-sales-rep-sales-to-online-orders"><i class="fa fa-check"></i><b>8.6.4</b> Comparing <strong>Sales Rep</strong> sales to <strong>Online</strong> Orders</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#impact-of-order-type-on-monthly-sales"><i class="fa fa-check"></i><b>8.7</b> Impact of order type on monthly sales</a><ul>
<li class="chapter" data-level="8.7.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#retrieve-monthly-sales-with-the-onlineorderflag"><i class="fa fa-check"></i><b>8.7.1</b> Retrieve monthly sales with the <code>onlineorderflag</code></a></li>
<li class="chapter" data-level="8.7.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#monthly-variation-compared-to-a-trend-line"><i class="fa fa-check"></i><b>8.7.2</b> Monthly variation compared to a trend line</a></li>
<li class="chapter" data-level="8.7.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#compare-monthly-lagged-data-by-order-type"><i class="fa fa-check"></i><b>8.7.3</b> Compare monthly lagged data by order type</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#detect-and-diagnose-the-day-of-the-month-problem"><i class="fa fa-check"></i><b>8.8</b> Detect and diagnose the day of the month problem</a><ul>
<li class="chapter" data-level="8.8.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#sales-rep-orderdate-distribution"><i class="fa fa-check"></i><b>8.8.1</b> Sales Rep Orderdate Distribution</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#correcting-the-order-date-for-sales-reps"><i class="fa fa-check"></i><b>8.9</b> Correcting the order date for <strong>Sales Reps</strong></a><ul>
<li class="chapter" data-level="8.9.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#define-a-date-correction-function-in-r"><i class="fa fa-check"></i><b>8.9.1</b> Define a date correction function in R</a></li>
<li class="chapter" data-level="8.9.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#define-postgres-date-function"><i class="fa fa-check"></i><b>8.9.2</b> Define and store a PostgreSQL function to correct the date</a></li>
<li class="chapter" data-level="8.9.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#use-the-postgresql-function"><i class="fa fa-check"></i><b>8.9.3</b> Use the PostgreSQL function</a></li>
<li class="chapter" data-level="8.9.4" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#monthly-sales-by-order-type-with-corrected-dates-relative-to-a-trend-line"><i class="fa fa-check"></i><b>8.9.4</b> Monthly Sales by Order Type with corrected dates – relative to a trend line</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#disconnect-from-the-database-and-stop-docker-3"><i class="fa fa-check"></i><b>8.10</b> Disconnect from the database and stop Docker</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html"><i class="fa fa-check"></i><b>9</b> Sales Forecasting</a><ul>
<li class="chapter" data-level="9.1" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#setup-1"><i class="fa fa-check"></i><b>9.1</b> Setup</a></li>
<li class="chapter" data-level="9.2" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#exploring-the-sales-data"><i class="fa fa-check"></i><b>9.2</b> Exploring the sales data</a><ul>
<li class="chapter" data-level="9.2.1" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#creating-a-tsibble"><i class="fa fa-check"></i><b>9.2.1</b> Creating a tsibble</a></li>
<li class="chapter" data-level="9.2.2" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#exploring-the-data"><i class="fa fa-check"></i><b>9.2.2</b> Exploring the data</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#cleaning-up"><i class="fa fa-check"></i><b>9.3</b> Cleaning up</a></li>
<li class="chapter" data-level="9.4" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#disconnect-from-the-database-and-stop-docker-4"><i class="fa fa-check"></i><b>9.4</b> Disconnect from the database and stop Docker</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html"><i class="fa fa-check"></i><b>10</b> Lazy Evaluation and Lazy Queries</a><ul>
<li class="chapter" data-level="10.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#setup-2"><i class="fa fa-check"></i><b>10.1</b> Setup</a></li>
<li class="chapter" data-level="10.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#r-is-lazy-and-comes-with-guardrails"><i class="fa fa-check"></i><b>10.2</b> R is lazy and comes with guardrails</a><ul>
<li class="chapter" data-level="10.2.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-loading"><i class="fa fa-check"></i><b>10.2.1</b> Lazy loading</a></li>
<li class="chapter" data-level="10.2.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-evaluation"><i class="fa fa-check"></i><b>10.2.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="10.2.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-queries"><i class="fa fa-check"></i><b>10.2.3</b> Lazy Queries</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-evaluation-and-lazy-queries"><i class="fa fa-check"></i><b>10.3</b> Lazy evaluation and lazy queries</a><ul>
<li class="chapter" data-level="10.3.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#create-a-black-box-query-for-experimentation"><i class="fa fa-check"></i><b>10.3.1</b> Create a black box query for experimentation</a></li>
<li class="chapter" data-level="10.3.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#experiment-overview"><i class="fa fa-check"></i><b>10.3.2</b> Experiment overview</a></li>
<li class="chapter" data-level="10.3.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_print"><i class="fa fa-check"></i><b>10.3.3</b> Q %&gt;% print()</a></li>
<li class="chapter" data-level="10.3.4" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_as-tibble"><i class="fa fa-check"></i><b>10.3.4</b> Q %&gt;% dplyr::as_tibble()</a></li>
<li class="chapter" data-level="10.3.5" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_head"><i class="fa fa-check"></i><b>10.3.5</b> Q %&gt;% head()</a></li>
<li class="chapter" data-level="10.3.6" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_tail"><i class="fa fa-check"></i><b>10.3.6</b> Q %&gt;% tail()</a></li>
<li class="chapter" data-level="10.3.7" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_length"><i class="fa fa-check"></i><b>10.3.7</b> Q %&gt;% length()</a></li>
<li class="chapter" data-level="10.3.8" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_str"><i class="fa fa-check"></i><b>10.3.8</b> Q %&gt;% str()</a></li>
<li class="chapter" data-level="10.3.9" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_nrow"><i class="fa fa-check"></i><b>10.3.9</b> Q %&gt;% nrow()</a></li>
<li class="chapter" data-level="10.3.10" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_tally"><i class="fa fa-check"></i><b>10.3.10</b> Q %&gt;% dplyr::tally()</a></li>
<li class="chapter" data-level="10.3.11" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_collect"><i class="fa fa-check"></i><b>10.3.11</b> Q %&gt;% dplyr::collect()</a></li>
<li class="chapter" data-level="10.3.12" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_plot-categories"><i class="fa fa-check"></i><b>10.3.12</b> Q %&gt;% ggplot</a></li>
<li class="chapter" data-level="10.3.13" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_show-query"><i class="fa fa-check"></i><b>10.3.13</b> Q %&gt;% dplyr::show_query()</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#other-resources"><i class="fa fa-check"></i><b>10.4</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html"><i class="fa fa-check"></i><b>11</b> Lazy Evaluation and Execution Environment</a><ul>
<li class="chapter" data-level="11.1" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#setup-3"><i class="fa fa-check"></i><b>11.1</b> Setup</a><ul>
<li class="chapter" data-level="11.1.1" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#experiment-overview-1"><i class="fa fa-check"></i><b>11.1.1</b> Experiment overview</a></li>
<li class="chapter" data-level="11.1.2" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#time-based-execution-environment-issues"><i class="fa fa-check"></i><b>11.1.2</b> Time-based, execution environment issues</a></li>
<li class="chapter" data-level="11.1.3" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#lazy_q_build"><i class="fa fa-check"></i><b>11.1.3</b> Q %&gt;% <code>more dplyr</code></a></li>
<li class="chapter" data-level="11.1.4" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#many-handy-r-functions-cant-be-translated-to-sql"><i class="fa fa-check"></i><b>11.1.4</b> Many handy R functions can’t be translated to SQL</a></li>
<li class="chapter" data-level="11.1.5" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#further-lazy-execution-examples"><i class="fa fa-check"></i><b>11.1.5</b> Further lazy execution examples</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#disconnect-from-the-database-and-stop-docker-5"><i class="fa fa-check"></i><b>11.2</b> Disconnect from the database and stop Docker</a></li>
<li class="chapter" data-level="11.3" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#other-resources-1"><i class="fa fa-check"></i><b>11.3</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html"><i class="fa fa-check"></i><b>12</b> Leveraging Database Views</a><ul>
<li class="chapter" data-level="12.1" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#setup-our-standard-working-environment-1"><i class="fa fa-check"></i><b>12.1</b> Setup our standard working environment</a></li>
<li class="chapter" data-level="12.2" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#the-role-of-database-views"><i class="fa fa-check"></i><b>12.2</b> The role of database <code>views</code></a><ul>
<li class="chapter" data-level="12.2.1" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#why-database-views-are-useful"><i class="fa fa-check"></i><b>12.2.1</b> Why database <code>views</code> are useful</a></li>
<li class="chapter" data-level="12.2.2" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#rely-on-and-be-critical-of-views"><i class="fa fa-check"></i><b>12.2.2</b> Rely on <strong>and</strong> be critical of <code>views</code></a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#unpacking-the-elements-of-a-view-tidyverse"><i class="fa fa-check"></i><b>12.3</b> Unpacking the elements of a <code>view</code> Tidyverse</a><ul>
<li class="chapter" data-level="12.3.1" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#use-a-view-just-like-any-other-table"><i class="fa fa-check"></i><b>12.3.1</b> Use a <code>view</code> just like any other table</a></li>
<li class="chapter" data-level="12.3.2" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#sql-source-code"><i class="fa fa-check"></i><b>12.3.2</b> SQL source code</a></li>
<li class="chapter" data-level="12.3.3" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#the-erd-as-context-for-sql-code"><i class="fa fa-check"></i><b>12.3.3</b> The ERD as context for SQL code</a></li>
<li class="chapter" data-level="12.3.4" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#tables-and-columns"><i class="fa fa-check"></i><b>12.3.4</b> Tables and columns</a></li>
<li class="chapter" data-level="12.3.5" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#join-the-tables-together"><i class="fa fa-check"></i><b>12.3.5</b> Join the tables together</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#compare-the-official-from-a-view-and-the-dplyr-output"><i class="fa fa-check"></i><b>12.4</b> Compare the official from a view and the dplyr output</a></li>
<li class="chapter" data-level="12.5" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#revise-the-view"><i class="fa fa-check"></i><b>12.5</b> Revise the view</a></li>
<li class="chapter" data-level="12.6" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#save-a-view-in-the-database"><i class="fa fa-check"></i><b>12.6</b> Save a <code>view</code> in the database</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html"><i class="fa fa-check"></i><b>13</b> Getting metadata about and from PostgreSQL</a><ul>
<li class="chapter" data-level="13.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#views-trick-parked-here-for-the-time-being"><i class="fa fa-check"></i><b>13.1</b> Views trick parked here for the time being</a><ul>
<li class="chapter" data-level="13.1.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#explore-the-vsalelsperson-and-vsalespersonsalesbyfiscalyearsdata-views"><i class="fa fa-check"></i><b>13.1.1</b> Explore the vsalelsperson and vsalespersonsalesbyfiscalyearsdata views</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-contents-and-structure"><i class="fa fa-check"></i><b>13.2</b> Database contents and structure</a><ul>
<li class="chapter" data-level="13.2.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-structure"><i class="fa fa-check"></i><b>13.2.1</b> Database structure</a></li>
<li class="chapter" data-level="13.2.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#contents-of-the-information_schema"><i class="fa fa-check"></i><b>13.2.2</b> Contents of the <code>information_schema</code></a></li>
<li class="chapter" data-level="13.2.3" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-tables-are-in-the-database"><i class="fa fa-check"></i><b>13.2.3</b> What tables are in the database?</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-columns-do-those-tables-contain"><i class="fa fa-check"></i><b>13.3</b> What columns do those tables contain?</a><ul>
<li class="chapter" data-level="13.3.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-is-the-difference-between-a-view-and-a-base-table"><i class="fa fa-check"></i><b>13.3.1</b> What is the difference between a <code>VIEW</code> and a <code>BASE TABLE</code>?</a></li>
<li class="chapter" data-level="13.3.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-data-types-are-found-in-the-database"><i class="fa fa-check"></i><b>13.3.2</b> What data types are found in the database?</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#characterizing-how-things-are-named"><i class="fa fa-check"></i><b>13.4</b> Characterizing how things are named</a><ul>
<li class="chapter" data-level="13.4.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#counting-columns-and-name-reuse"><i class="fa fa-check"></i><b>13.4.1</b> Counting columns and name reuse</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-keys"><i class="fa fa-check"></i><b>13.5</b> Database keys</a><ul>
<li class="chapter" data-level="13.5.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#direct-sql"><i class="fa fa-check"></i><b>13.5.1</b> Direct SQL</a></li>
<li class="chapter" data-level="13.5.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-keys-with-dplyr"><i class="fa fa-check"></i><b>13.5.2</b> Database keys with dplyr</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#creating-your-own-data-dictionary"><i class="fa fa-check"></i><b>13.6</b> Creating your own data dictionary</a></li>
<li class="chapter" data-level="13.7" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#save-your-work"><i class="fa fa-check"></i><b>13.7</b> Save your work!</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html"><i class="fa fa-check"></i><b>A</b> Background and Basic Concepts</a><ul>
<li class="chapter" data-level="A.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#the-big-picture-r-and-the-docker-postgresql-playground-on-your-machine"><i class="fa fa-check"></i><b>A.1</b> The big picture: R and the Docker / PostgreSQL playground on your machine</a></li>
<li class="chapter" data-level="A.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#your-computer-and-its-operating-system"><i class="fa fa-check"></i><b>A.2</b> Your computer and its operating system</a></li>
<li class="chapter" data-level="A.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#r"><i class="fa fa-check"></i><b>A.3</b> R</a></li>
<li class="chapter" data-level="A.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#our-sqlpetr-package"><i class="fa fa-check"></i><b>A.4</b> Our <code>sqlpetr</code> package</a></li>
<li class="chapter" data-level="A.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker"><i class="fa fa-check"></i><b>A.5</b> Docker</a><ul>
<li class="chapter" data-level="A.5.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#virtual-machines-and-hypervisors"><i class="fa fa-check"></i><b>A.5.1</b> Virtual machines and hypervisors</a></li>
<li class="chapter" data-level="A.5.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#containers"><i class="fa fa-check"></i><b>A.5.2</b> Containers</a></li>
<li class="chapter" data-level="A.5.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker-itself"><i class="fa fa-check"></i><b>A.5.3</b> Docker itself</a></li>
<li class="chapter" data-level="A.5.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker-objects"><i class="fa fa-check"></i><b>A.5.4</b> Docker objects</a></li>
<li class="chapter" data-level="A.5.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-windows-machines"><i class="fa fa-check"></i><b>A.5.5</b> Hosting Docker on Windows machines</a></li>
<li class="chapter" data-level="A.5.6" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-macos-machines"><i class="fa fa-check"></i><b>A.5.6</b> Hosting Docker on macOS machines</a></li>
<li class="chapter" data-level="A.5.7" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-unix-machines"><i class="fa fa-check"></i><b>A.5.7</b> Hosting Docker on UNIX machines</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#normal-and-normalized-data"><i class="fa fa-check"></i><b>A.6</b> ‘Normal’ and ‘normalized’ data</a><ul>
<li class="chapter" data-level="A.6.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#tidy-data"><i class="fa fa-check"></i><b>A.6.1</b> Tidy data</a></li>
<li class="chapter" data-level="A.6.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#design-of-normal-data"><i class="fa fa-check"></i><b>A.6.2</b> Design of “normal data”</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#sql-language"><i class="fa fa-check"></i><b>A.7</b> SQL Language</a><ul>
<li class="chapter" data-level="A.7.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-manipulation-langauge-dml"><i class="fa fa-check"></i><b>A.7.1</b> Data Manipulation Langauge (DML)</a></li>
<li class="chapter" data-level="A.7.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-definition-langauge-ddl"><i class="fa fa-check"></i><b>A.7.2</b> Data Definition Langauge (DDL)</a></li>
<li class="chapter" data-level="A.7.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-control-language-dcl"><i class="fa fa-check"></i><b>A.7.3</b> Data Control Language (DCL)</a></li>
<li class="chapter" data-level="A.7.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#transaction-control-language-tcl"><i class="fa fa-check"></i><b>A.7.4</b> Transaction Control Language (TCL)</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#enterprise-dbms"><i class="fa fa-check"></i><b>A.8</b> Enterprise DBMS</a><ul>
<li class="chapter" data-level="A.8.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#sql-databases"><i class="fa fa-check"></i><b>A.8.1</b> SQL databases</a></li>
<li class="chapter" data-level="A.8.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-mapping-between-r-vs-sql-data-types"><i class="fa fa-check"></i><b>A.8.2</b> Data mapping between R vs SQL data types</a></li>
<li class="chapter" data-level="A.8.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#postgresql-and-connection-parameters"><i class="fa fa-check"></i><b>A.8.3</b> PostgreSQL and connection parameters</a></li>
<li class="chapter" data-level="A.8.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#connecting-the-r-and-dbms-environments"><i class="fa fa-check"></i><b>A.8.4</b> Connecting the R and DBMS environments</a></li>
<li class="chapter" data-level="A.8.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#using-sqlite-to-simulate-an-enterprise-dbms"><i class="fa fa-check"></i><b>A.8.5</b> Using SQLite to simulate an enterprise DBMS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html"><i class="fa fa-check"></i><b>B</b> - Setup instructions</a><ul>
<li class="chapter" data-level="B.1" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#sandbox-prerequisites"><i class="fa fa-check"></i><b>B.1</b> Sandbox prerequisites</a></li>
<li class="chapter" data-level="B.2" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#r-rstudio-and-git"><i class="fa fa-check"></i><b>B.2</b> R, RStudio and Git</a></li>
<li class="chapter" data-level="B.3" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#install-docker"><i class="fa fa-check"></i><b>B.3</b> Install Docker</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html"><i class="fa fa-check"></i><b>C</b> Appendix E - Install <code>adventureworks</code> on your own machine</a><ul>
<li class="chapter" data-level="C.1" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#overview-1"><i class="fa fa-check"></i><b>C.1</b> Overview</a><ul>
<li class="chapter" data-level="C.1.1" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#download-the-adventureworks-database"><i class="fa fa-check"></i><b>C.1.1</b> Download the <code>adventureworks</code> database</a></li>
<li class="chapter" data-level="C.1.2" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#restore-the-dvdrental-database-at-the-command-line"><i class="fa fa-check"></i><b>C.1.2</b> Restore the <code>dvdrental</code> database at the command line</a></li>
<li class="chapter" data-level="C.1.3" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#restore-the-adventureworks-database-using-pgadmin"><i class="fa fa-check"></i><b>C.1.3</b> Restore the <code>adventureworks</code> database using pgAdmin</a></li>
</ul></li>
<li class="chapter" data-level="C.2" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#resources"><i class="fa fa-check"></i><b>C.2</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html"><i class="fa fa-check"></i><b>D</b> Appendix B - Additional technical details for Windows users</a><ul>
<li class="chapter" data-level="D.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#hardware-requirements"><i class="fa fa-check"></i><b>D.1</b> Hardware requirements</a></li>
<li class="chapter" data-level="D.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#software-requirements"><i class="fa fa-check"></i><b>D.2</b> Software requirements</a><ul>
<li class="chapter" data-level="D.2.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#windows-7-8-8.1-and-windows-10-home-64-bit"><i class="fa fa-check"></i><b>D.2.1</b> Windows 7, 8, 8.1 and Windows 10 Home (64 bit)</a></li>
<li class="chapter" data-level="D.2.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#windows-10-pro"><i class="fa fa-check"></i><b>D.2.2</b> Windows 10 Pro</a></li>
</ul></li>
<li class="chapter" data-level="D.3" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#docker-for-windows-settings"><i class="fa fa-check"></i><b>D.3</b> Docker for Windows settings</a><ul>
<li class="chapter" data-level="D.3.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#shared-drives"><i class="fa fa-check"></i><b>D.3.1</b> Shared drives</a></li>
<li class="chapter" data-level="D.3.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#kubernetes"><i class="fa fa-check"></i><b>D.3.2</b> Kubernetes</a></li>
</ul></li>
<li class="chapter" data-level="D.4" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#git-github-and-line-endings"><i class="fa fa-check"></i><b>D.4</b> Git, GitHub and line endings</a></li>
</ul></li>
<li class="chapter" data-level="E" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html"><i class="fa fa-check"></i><b>E</b> Appendix C - PostgreSQL Authentication</a><ul>
<li class="chapter" data-level="E.1" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#introduction"><i class="fa fa-check"></i><b>E.1</b> Introduction</a></li>
<li class="chapter" data-level="E.2" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#password-authentication-on-the-postgresql-docker-image"><i class="fa fa-check"></i><b>E.2</b> Password authentication on the PostgreSQL Docker image</a></li>
<li class="chapter" data-level="E.3" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#adding-roles"><i class="fa fa-check"></i><b>E.3</b> Adding roles</a><ul>
<li class="chapter" data-level="E.3.1" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#setting-up-docker"><i class="fa fa-check"></i><b>E.3.1</b> Setting up Docker</a></li>
<li class="chapter" data-level="E.3.2" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#creating-a-new-container"><i class="fa fa-check"></i><b>E.3.2</b> Creating a new container</a></li>
<li class="chapter" data-level="E.3.3" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#adding-a-role"><i class="fa fa-check"></i><b>E.3.3</b> Adding a role</a></li>
<li class="chapter" data-level="E.3.4" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#did-it-work"><i class="fa fa-check"></i><b>E.3.4</b> Did it work?</a></li>
<li class="chapter" data-level="E.3.5" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#disconnect-and-remove-the-container"><i class="fa fa-check"></i><b>E.3.5</b> Disconnect and remove the container</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="F" data-path="chapter-appendix-dbi-index.html"><a href="chapter-appendix-dbi-index.html"><i class="fa fa-check"></i><b>F</b> DBI package functions - INDEX</a></li>
<li class="chapter" data-level="G" data-path="chapter-appendix-dplyr-to-postres-translation.html"><a href="chapter-appendix-dplyr-to-postres-translation.html"><i class="fa fa-check"></i><b>G</b> Appendix _ Dplyr to SQL translations</a><ul>
<li class="chapter" data-level="G.1" data-path="chapter-appendix-dplyr-to-postres-translation.html"><a href="chapter-appendix-dplyr-to-postres-translation.html#overview-2"><i class="fa fa-check"></i><b>G.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="H" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html"><i class="fa fa-check"></i><b>H</b> Appendix Additional resources</a><ul>
<li class="chapter" data-level="H.1" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#editing-this-book"><i class="fa fa-check"></i><b>H.1</b> Editing this book</a></li>
<li class="chapter" data-level="H.2" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#docker-alternatives"><i class="fa fa-check"></i><b>H.2</b> Docker alternatives</a></li>
<li class="chapter" data-level="H.3" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#docker-and-r"><i class="fa fa-check"></i><b>H.3</b> Docker and R</a></li>
<li class="chapter" data-level="H.4" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#documentation-for-docker-and-postgresql"><i class="fa fa-check"></i><b>H.4</b> Documentation for Docker and PostgreSQL</a></li>
<li class="chapter" data-level="H.5" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#sql-and-dplyr"><i class="fa fa-check"></i><b>H.5</b> SQL and dplyr</a></li>
<li class="chapter" data-level="H.6" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#more-resources"><i class="fa fa-check"></i><b>H.6</b> More Resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Exploring Enterprise Databases with R: A Tidyverse Approach</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter_dbms-queries-intro" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Introduction to DBMS queries</h1>
<blockquote>
<p>This chapter demonstrates how to:</p>
<ul>
<li>Download all or part of a table from the DBMS, including different kinds of subsets</li>
<li>See how <code>dplyr</code> code is translated into <code>SQL</code> commands and how they can be mixed</li>
<li>Get acquainted with some useful functions and packages for investigating a single table</li>
<li>Begin thinking about how to divide the work between your local R session and the DBMS</li>
</ul>
</blockquote>
<div id="setup" class="section level2">
<h2><span class="header-section-number">7.1</span> Setup</h2>
<p>The following packages are used in this chapter:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb57-2" data-line-number="2"><span class="kw">library</span>(DBI)</a>
<a class="sourceLine" id="cb57-3" data-line-number="3"><span class="kw">library</span>(RPostgres)</a>
<a class="sourceLine" id="cb57-4" data-line-number="4"><span class="kw">library</span>(dbplyr)</a>
<a class="sourceLine" id="cb57-5" data-line-number="5"><span class="kw">require</span>(knitr)</a>
<a class="sourceLine" id="cb57-6" data-line-number="6"><span class="kw">library</span>(bookdown)</a>
<a class="sourceLine" id="cb57-7" data-line-number="7"><span class="kw">library</span>(sqlpetr)</a>
<a class="sourceLine" id="cb57-8" data-line-number="8"><span class="kw">library</span>(skimr)</a></code></pre></div>
<p>Assume that the Docker container with PostgreSQL and the adventureworks database are ready to go. If not go back to [Chapter 6][#chapter_setup-adventureworks-db]</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1">sqlpetr<span class="op">::</span><span class="kw">sp_docker_start</span>(<span class="st">&quot;adventureworks&quot;</span>)</a></code></pre></div>
<p>Connect to the database:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1">con &lt;-<span class="st"> </span>sqlpetr<span class="op">::</span><span class="kw">sp_get_postgres_connection</span>(</a>
<a class="sourceLine" id="cb59-2" data-line-number="2">  <span class="dt">user =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;DEFAULT_POSTGRES_USER_NAME&quot;</span>),</a>
<a class="sourceLine" id="cb59-3" data-line-number="3">  <span class="dt">password =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;DEFAULT_POSTGRES_PASSWORD&quot;</span>),</a>
<a class="sourceLine" id="cb59-4" data-line-number="4">  <span class="dt">dbname =</span> <span class="st">&quot;adventureworks&quot;</span>,</a>
<a class="sourceLine" id="cb59-5" data-line-number="5">  <span class="dt">port =</span> <span class="dv">5432</span>, </a>
<a class="sourceLine" id="cb59-6" data-line-number="6">  <span class="dt">seconds_to_test =</span> <span class="dv">20</span>, </a>
<a class="sourceLine" id="cb59-7" data-line-number="7">  <span class="dt">connection_tab =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb59-8" data-line-number="8">)</a></code></pre></div>
</div>
<div id="methods-for-downloading-a-single-table" class="section level2">
<h2><span class="header-section-number">7.2</span> Methods for downloading a single table</h2>
<p>For the moment, assume you know something about the database and specifically what table you need to retrieve. We return to the topic of investigating the whole database later on.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw">dbExecute</span>(con, <span class="st">&quot;set search_path to sales, humanresources;&quot;</span>) </a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div id="read-the-entire-table" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Read the entire table</h3>
<p>There are a few different methods of getting data from a DBMS, and we’ll explore the different ways of controlling each one of them.</p>
<p><code>DBI::dbReadTable</code> will download an entire table into an R <a href="https://tibble.tidyverse.org/">tibble</a>.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">salesorderheader_tibble &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbReadTable</span>(con, <span class="st">&quot;salesorderheader&quot;</span>)</a>
<a class="sourceLine" id="cb62-2" data-line-number="2"></a>
<a class="sourceLine" id="cb62-3" data-line-number="3"><span class="kw">str</span>(salesorderheader_tibble)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    31465 obs. of  25 variables:
##  $ salesorderid          : int  43659 43660 43661 43662 43663 43664 43665 43666 43667 43668 ...
##  $ revisionnumber        : int  8 8 8 8 8 8 8 8 8 8 ...
##  $ orderdate             : POSIXct, format: &quot;2011-05-31&quot; &quot;2011-05-31&quot; ...
##  $ duedate               : POSIXct, format: &quot;2011-06-12&quot; &quot;2011-06-12&quot; ...
##  $ shipdate              : POSIXct, format: &quot;2011-06-07&quot; &quot;2011-06-07&quot; ...
##  $ status                : int  5 5 5 5 5 5 5 5 5 5 ...
##  $ onlineorderflag       : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
##  $ purchaseordernumber   : chr  &quot;PO522145787&quot; &quot;PO18850127500&quot; &quot;PO18473189620&quot; &quot;PO18444174044&quot; ...
##  $ accountnumber         : chr  &quot;10-4020-000676&quot; &quot;10-4020-000117&quot; &quot;10-4020-000442&quot; &quot;10-4020-000227&quot; ...
##  $ customerid            : int  29825 29672 29734 29994 29565 29898 29580 30052 29974 29614 ...
##  $ salespersonid         : int  279 279 282 282 276 280 283 276 277 282 ...
##  $ territoryid           : int  5 5 6 6 4 1 1 4 3 6 ...
##  $ billtoaddressid       : int  985 921 517 482 1073 876 849 1074 629 529 ...
##  $ shiptoaddressid       : int  985 921 517 482 1073 876 849 1074 629 529 ...
##  $ shipmethodid          : int  5 5 5 5 5 5 5 5 5 5 ...
##  $ creditcardid          : int  16281 5618 1346 10456 4322 806 15232 13349 10370 1566 ...
##  $ creditcardapprovalcode: chr  &quot;105041Vi84182&quot; &quot;115213Vi29411&quot; &quot;85274Vi6854&quot; &quot;125295Vi53935&quot; ...
##  $ currencyrateid        : int  NA NA 4 4 NA NA NA NA NA 4 ...
##  $ subtotal              : num  20566 1294 32726 28833 419 ...
##  $ taxamt                : num  1971.5 124.2 3153.8 2775.2 40.3 ...
##  $ freight               : num  616.1 38.8 985.6 867.2 12.6 ...
##  $ totaldue              : num  23153 1457 36866 32475 472 ...
##  $ comment               : chr  NA NA NA NA ...
##  $ rowguid               : chr  &quot;79b65321-39ca-4115-9cba-8fe0903e12e6&quot; &quot;738dc42d-d03b-48a1-9822-f95a67ea7389&quot; &quot;d91b9131-18a4-4a11-bc3a-90b6f53e9d74&quot; &quot;4a1ecfc0-cc3a-4740-b028-1c50bb48711c&quot; ...
##  $ modifieddate          : POSIXct, format: &quot;2011-06-07&quot; &quot;2011-06-07&quot; ...</code></pre>
<p>That’s very simple, but if the table is very large it may not be a problem, since R is designed to keep the entire table in memory. The tables that are found in an enterprise database such as <code>adventureworks</code> may be large, they are most often records kept by people. That somewhat limits their size (relative to data generated by machines) and expands the possibilities for human error.</p>
<p>Note that the first line of the str() output reports the total number of observations.</p>
<p>Later on we’ll use this tibble to demonstrate several packages and functions, but use only the first 13 columns for simplicity.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1">salesorderheader_tibble &lt;-<span class="st"> </span>salesorderheader_tibble[,<span class="dv">1</span><span class="op">:</span><span class="dv">13</span>]</a></code></pre></div>
</div>
<div id="create-a-pointer-to-a-table-that-can-be-reused" class="section level3">
<h3><span class="header-section-number">7.2.2</span> Create a pointer to a table that can be reused</h3>
<p>The <code>dplyr::tbl</code> function gives us more control over access to a table by enabling control over which columns and rows to download. It creates an object that might <strong>look</strong> like a data frame, but it’s actually a list object that <code>dplyr</code> uses for constructing queries and retrieving data from the DBMS.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1">salesorderheader_table &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">tbl</span>(con, <span class="st">&quot;salesorderheader&quot;</span>)</a>
<a class="sourceLine" id="cb65-2" data-line-number="2"><span class="kw">class</span>(salesorderheader_table)</a></code></pre></div>
<pre><code>## [1] &quot;tbl_PqConnection&quot; &quot;tbl_dbi&quot;          &quot;tbl_sql&quot;          &quot;tbl_lazy&quot;        
## [5] &quot;tbl&quot;</code></pre>
</div>
<div id="controlling-the-number-of-rows-returned-with-collect" class="section level3">
<h3><span class="header-section-number">7.2.3</span> Controlling the number of rows returned with <code>collect()</code></h3>
<p>The <code>collect</code> function triggers the creation of a tibble and controls the number of rows that the DBMS sends to R. For more complex queries, the <code>dplyr::collect()</code> function provides a mechanism to indicate what’s processed on on the DBMS server and what’s processed by R on the local machine. The chapter on <a href="chapter-lazy-evaluation-and-timing.html#chapter_lazy-evaluation-and-timing">Lazy Evaluation and Execution Environment</a> discusses this issue in detail.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">salesorderheader_table <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">collect</span>(<span class="dt">n =</span> <span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dim</span>()</a></code></pre></div>
<pre><code>## [1]  3 25</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1">salesorderheader_table <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">collect</span>(<span class="dt">n =</span> <span class="dv">500</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">dim</span>()</a></code></pre></div>
<pre><code>## [1] 500  25</code></pre>
</div>
<div id="retrieving-random-rows-from-the-dbms" class="section level3">
<h3><span class="header-section-number">7.2.4</span> Retrieving random rows from the DBMS</h3>
<p>When the DBMS contains many rows, a sample of the data may be plenty for your purposes. Although <code>dplyr</code> has nice functions to sample a data frame that’s already in R (e.g., the <code>sample_n</code> and <code>sample_frac</code> functions), to get a sample from the DBMS we have to use <code>dbGetQuery</code> to send native SQL to the database. To peek ahead, here is one example of a query that retrieves 20 rows from a 1% sample:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1">one_percent_sample &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb71-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb71-3" data-line-number="3">  <span class="st">&quot;SELECT orderdate, subtotal, taxamt, freight, totaldue</span></a>
<a class="sourceLine" id="cb71-4" data-line-number="4"><span class="st">  FROM salesorderheader TABLESAMPLE BERNOULLI(3) LIMIT 20;</span></a>
<a class="sourceLine" id="cb71-5" data-line-number="5"><span class="st">  &quot;</span></a>
<a class="sourceLine" id="cb71-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb71-7" data-line-number="7"></a>
<a class="sourceLine" id="cb71-8" data-line-number="8">one_percent_sample</a></code></pre></div>
<pre><code>##     orderdate   subtotal    taxamt   freight   totaldue
## 1  2011-05-31  3746.2015  357.9614  111.8629  4216.0258
## 2  2011-05-31  9799.9243  942.0740  294.3981 11036.3964
## 3  2011-06-07   699.0982   55.9279   17.4775   772.5036
## 4  2011-06-16  3399.9900  271.9992   84.9998  3756.9890
## 5  2011-06-19  3578.2700  286.2616   89.4568  3953.9884
## 6  2011-06-27  3374.9900  269.9992   84.3748  3729.3640
## 7  2011-07-01 20544.7015 1969.9765  615.6177 23130.2957
## 8  2011-07-01  1718.8983  164.9658   51.5518  1935.4159
## 9  2011-07-01   419.4589   40.2681   12.5838   472.3108
## 10 2011-07-10  3399.9900  271.9992   84.9998  3756.9890
## 11 2011-08-01   844.1043   80.9856   25.3080   950.3979
## 12 2011-08-01 40510.3042 3894.0507 1216.8909 45621.2458
## 13 2011-08-05  3578.2700  286.2616   89.4568  3953.9884
## 14 2011-08-05  3578.2700  286.2616   89.4568  3953.9884
## 15 2011-08-12  3399.9900  271.9992   84.9998  3756.9890
## 16 2011-08-22  3578.2700  286.2616   89.4568  3953.9884
## 17 2011-08-24  3578.2700  286.2616   89.4568  3953.9884
## 18 2011-08-31 18648.6070 1788.0473  558.7648 20995.4191
## 19 2011-09-01  3578.2700  286.2616   89.4568  3953.9884
## 20 2011-09-02  3578.2700  286.2616   89.4568  3953.9884</code></pre>
<p><strong>Exact sample of 100 records</strong></p>
<p>This technique depends on knowing the range of a record index, such as the <code>businessentityid</code> in the <code>salesorderheader</code> table of our <code>adventureworks</code> database.</p>
<p>Start by finding the min and max values.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1">DBI<span class="op">::</span><span class="kw">dbListFields</span>(con, <span class="st">&quot;salesorderheader&quot;</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;salesorderid&quot;           &quot;revisionnumber&quot;         &quot;orderdate&quot;             
##  [4] &quot;duedate&quot;                &quot;shipdate&quot;               &quot;status&quot;                
##  [7] &quot;onlineorderflag&quot;        &quot;purchaseordernumber&quot;    &quot;accountnumber&quot;         
## [10] &quot;customerid&quot;             &quot;salespersonid&quot;          &quot;territoryid&quot;           
## [13] &quot;billtoaddressid&quot;        &quot;shiptoaddressid&quot;        &quot;shipmethodid&quot;          
## [16] &quot;creditcardid&quot;           &quot;creditcardapprovalcode&quot; &quot;currencyrateid&quot;        
## [19] &quot;subtotal&quot;               &quot;taxamt&quot;                 &quot;freight&quot;               
## [22] &quot;totaldue&quot;               &quot;comment&quot;                &quot;rowguid&quot;               
## [25] &quot;modifieddate&quot;</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1">salesorderheader_df &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbReadTable</span>(con, <span class="st">&quot;salesorderheader&quot;</span>)</a>
<a class="sourceLine" id="cb75-2" data-line-number="2"></a>
<a class="sourceLine" id="cb75-3" data-line-number="3">(max_id &lt;-<span class="st"> </span><span class="kw">max</span>(salesorderheader_df<span class="op">$</span>salesorderid))</a></code></pre></div>
<pre><code>## [1] 75123</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1">(min_id &lt;-<span class="st"> </span><span class="kw">min</span>(salesorderheader_df<span class="op">$</span>salesorderid))</a></code></pre></div>
<pre><code>## [1] 43659</code></pre>
<p>Set the random number seed and draw the sample.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb79-2" data-line-number="2">sample_rows &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">max</span>(salesorderheader_df<span class="op">$</span>salesorderid), <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb79-3" data-line-number="3">salesorderheader_table &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">tbl</span>(con, <span class="st">&quot;salesorderheader&quot;</span>)</a></code></pre></div>
<p>Run query with the filter verb listing the randomly sampled rows to be retrieved:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1">salesorderheader_sample &lt;-<span class="st"> </span>salesorderheader_table <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb80-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(salesorderid <span class="op">%in%</span><span class="st"> </span>sample_rows) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb80-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">collect</span>()</a>
<a class="sourceLine" id="cb80-4" data-line-number="4"></a>
<a class="sourceLine" id="cb80-5" data-line-number="5"><span class="kw">str</span>(salesorderheader_sample)</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    7 obs. of  25 variables:
##  $ salesorderid          : int  45404 46435 51663 57870 62555 65161 68293
##  $ revisionnumber        : int  8 8 8 8 8 8 8
##  $ orderdate             : POSIXct, format: &quot;2012-01-10&quot; &quot;2012-05-06&quot; ...
##  $ duedate               : POSIXct, format: &quot;2012-01-22&quot; &quot;2012-05-18&quot; ...
##  $ shipdate              : POSIXct, format: &quot;2012-01-17&quot; &quot;2012-05-13&quot; ...
##  $ status                : int  5 5 5 5 5 5 5
##  $ onlineorderflag       : logi  TRUE TRUE TRUE TRUE TRUE FALSE ...
##  $ purchaseordernumber   : chr  NA NA NA NA ...
##  $ accountnumber         : chr  &quot;10-4030-011217&quot; &quot;10-4030-012251&quot; &quot;10-4030-016327&quot; &quot;10-4030-018572&quot; ...
##  $ customerid            : int  11217 12251 16327 18572 13483 29799 13239
##  $ salespersonid         : int  NA NA NA NA NA 281 NA
##  $ territoryid           : int  1 9 8 4 1 4 6
##  $ billtoaddressid       : int  19321 24859 19265 16902 15267 997 27923
##  $ shiptoaddressid       : int  19321 24859 19265 16902 15267 997 27923
##  $ shipmethodid          : int  1 1 1 1 1 5 1
##  $ creditcardid          : int  8241 13188 16357 1884 4409 12582 1529
##  $ creditcardapprovalcode: chr  &quot;332581Vi42712&quot; &quot;635144Vi68383&quot; &quot;420152Vi84562&quot; &quot;1224478Vi9772&quot; ...
##  $ currencyrateid        : int  NA 4121 NA NA NA NA 11581
##  $ subtotal              : num  3578 3375 2466 14 57 ...
##  $ taxamt                : num  286.26 270 197.31 1.12 4.56 ...
##  $ freight               : num  89.457 84.375 61.658 0.349 1.424 ...
##  $ totaldue              : num  3954 3729.4 2725.3 15.4 63 ...
##  $ comment               : chr  NA NA NA NA ...
##  $ rowguid               : chr  &quot;358f91b2-dadd-4014-8d4f-7f9736cb664e&quot; &quot;eb312409-fcd5-4bac-bd3b-16d4bd7889db&quot; &quot;ddc60552-af98-4166-9249-d09d424d8430&quot; &quot;fe46e631-47b9-4e14-9da5-1e4a4a135364&quot; ...
##  $ modifieddate          : POSIXct, format: &quot;2012-01-17&quot; &quot;2012-05-13&quot; ...</code></pre>
</div>
<div id="sub-setting-variables" class="section level3">
<h3><span class="header-section-number">7.2.5</span> Sub-setting variables</h3>
<p>A table in the DBMS may not only have many more rows than you want, but also many more columns. The <code>select</code> command controls which columns are retrieved.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1">salesorderheader_table <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(orderdate, subtotal, taxamt, freight, totaldue) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb82-2" data-line-number="2"><span class="st">  </span><span class="kw">head</span>() </a></code></pre></div>
<pre><code>## # Source:   lazy query [?? x 5]
## # Database: postgres [postgres@localhost:5432/adventureworks]
##   orderdate           subtotal taxamt freight totaldue
##   &lt;dttm&gt;                 &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
## 1 2011-05-31 00:00:00   20566. 1972.    616.    23153.
## 2 2011-05-31 00:00:00    1294.  124.     38.8    1457.
## 3 2011-05-31 00:00:00   32726. 3154.    986.    36866.
## 4 2011-05-31 00:00:00   28833. 2775.    867.    32475.
## 5 2011-05-31 00:00:00     419.   40.3    12.6     472.
## 6 2011-05-31 00:00:00   24433. 2345.    733.    27510.</code></pre>
<p>That’s exactly equivalent to submitting the following SQL commands directly:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1">DBI<span class="op">::</span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb84-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb84-3" data-line-number="3">  <span class="st">&#39;SELECT &quot;orderdate&quot;, &quot;subtotal&quot;, &quot;taxamt&quot;, &quot;freight&quot;, &quot;totaldue&quot;</span></a>
<a class="sourceLine" id="cb84-4" data-line-number="4"><span class="st">    FROM &quot;salesorderheader&quot;</span></a>
<a class="sourceLine" id="cb84-5" data-line-number="5"><span class="st">    LIMIT 6&#39;</span>) </a></code></pre></div>
<pre><code>##    orderdate   subtotal    taxamt  freight   totaldue
## 1 2011-05-31 20565.6206 1971.5149 616.0984 23153.2339
## 2 2011-05-31  1294.2529  124.2483  38.8276  1457.3288
## 3 2011-05-31 32726.4786 3153.7696 985.5530 36865.8012
## 4 2011-05-31 28832.5289 2775.1646 867.2389 32474.9324
## 5 2011-05-31   419.4589   40.2681  12.5838   472.3108
## 6 2011-05-31 24432.6088 2344.9921 732.8100 27510.4109</code></pre>
<p>We won’t discuss <code>dplyr</code> methods for sub-setting variables, deriving new ones, or sub-setting rows based on the values found in the table, because they are covered well in other places, including:</p>
<ul>
<li>Comprehensive reference: <a href="https://dplyr.tidyverse.org/">https://dplyr.tidyverse.org/</a></li>
<li>Good tutorial: <a href="https://suzan.rbind.io/tags/dplyr/">https://suzan.rbind.io/tags/dplyr/</a></li>
</ul>
<p>In practice we find that, <strong>renaming variables</strong> is often quite important because the names in an SQL database might not meet your needs as an analyst. In “the wild”, you will find names that are ambiguous or overly specified, with spaces in them, and other problems that will make them difficult to use in R. It is good practice to do whatever renaming you are going to do in a predictable place like at the top of your code. The names in the <code>adventureworks</code> database are simple and clear, but if they were not, you might rename them for subsequent use in this way:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="kw">tbl</span>(con, <span class="st">&quot;salesorderheader&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb86-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">order_date =</span> orderdate, <span class="dt">sub_total_amount =</span> subtotal,</a>
<a class="sourceLine" id="cb86-3" data-line-number="3">              <span class="dt">tax_amount =</span> taxamt, <span class="dt">freight_amount =</span> freight, <span class="dt">total_due_amount =</span> totaldue) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb86-4" data-line-number="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(order_date, sub_total_amount, tax_amount, freight_amount, total_due_amount ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb86-5" data-line-number="5"><span class="st">  </span><span class="co"># head()</span></a>
<a class="sourceLine" id="cb86-6" data-line-number="6"><span class="kw">show_query</span>()</a></code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT &quot;orderdate&quot; AS &quot;order_date&quot;, &quot;subtotal&quot; AS &quot;sub_total_amount&quot;, &quot;taxamt&quot; AS &quot;tax_amount&quot;, &quot;freight&quot; AS &quot;freight_amount&quot;, &quot;totaldue&quot; AS &quot;total_due_amount&quot;
## FROM &quot;salesorderheader&quot;</code></pre>
<p>That’s equivalent to the following SQL code:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1">DBI<span class="op">::</span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb88-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb88-3" data-line-number="3">    <span class="st">&#39;SELECT &quot;orderdate&quot; AS &quot;order_date&quot;, </span></a>
<a class="sourceLine" id="cb88-4" data-line-number="4"><span class="st">    &quot;subtotal&quot; AS &quot;sub_total_amount&quot;, </span></a>
<a class="sourceLine" id="cb88-5" data-line-number="5"><span class="st">    &quot;taxamt&quot; AS &quot;tax_amount&quot;, </span></a>
<a class="sourceLine" id="cb88-6" data-line-number="6"><span class="st">    &quot;freight&quot; AS &quot;freight_amount&quot;, </span></a>
<a class="sourceLine" id="cb88-7" data-line-number="7"><span class="st">    &quot;totaldue&quot; AS &quot;total_due_amount&quot;</span></a>
<a class="sourceLine" id="cb88-8" data-line-number="8"><span class="st">    FROM &quot;salesorderheader&quot;&#39;</span> ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>##   order_date sub_total_amount tax_amount freight_amount total_due_amount
## 1 2011-05-31       20565.6206  1971.5149       616.0984       23153.2339
## 2 2011-05-31        1294.2529   124.2483        38.8276        1457.3288
## 3 2011-05-31       32726.4786  3153.7696       985.5530       36865.8012
## 4 2011-05-31       28832.5289  2775.1646       867.2389       32474.9324
## 5 2011-05-31         419.4589    40.2681        12.5838         472.3108
## 6 2011-05-31       24432.6088  2344.9921       732.8100       27510.4109</code></pre>
<p>The one difference is that the <code>SQL</code> code returns a regular data frame and the <code>dplyr</code> code returns a <code>tibble</code>. Notice that the seconds are grayed out in the <code>tibble</code> display.</p>
</div>
</div>
<div id="translating-dplyr-code-to-sql-queries" class="section level2">
<h2><span class="header-section-number">7.3</span> Translating <code>dplyr</code> code to <code>SQL</code> queries</h2>
<p>Where did the translations we’ve shown above come from? The <code>show_query</code> function shows how <code>dplyr</code> is translating your query to the dialect of the target DBMS:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1">salesorderheader_table <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb90-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">tally</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb90-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">show_query</span>()</a></code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT COUNT(*) AS &quot;n&quot;
## FROM &quot;salesorderheader&quot;</code></pre>
<p>Here is an extensive discussion of how <code>dplyr</code> code is translated into SQL:</p>
<ul>
<li><a href="https://dbplyr.tidyverse.org/articles/sql-translation.html">https://dbplyr.tidyverse.org/articles/sql-translation.html</a></li>
</ul>
<p>If you prefer to use SQL directly, rather than <code>dplyr</code>, you can submit SQL code to the DBMS through the <code>DBI::dbGetQuery</code> function:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1">DBI<span class="op">::</span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb92-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb92-3" data-line-number="3">  <span class="st">&#39;SELECT COUNT(*) AS &quot;n&quot;</span></a>
<a class="sourceLine" id="cb92-4" data-line-number="4"><span class="st">     FROM &quot;salesorderheader&quot;   &#39;</span></a>
<a class="sourceLine" id="cb92-5" data-line-number="5">)</a></code></pre></div>
<pre><code>##       n
## 1 31465</code></pre>
<p>When you create a report to run repeatedly, you might want to put that query into R markdown. That way you can also execute that SQL code in a chunk with the following header:</p>
<p>{<code>sql, connection=con, output.var = &quot;query_results&quot;</code>}</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="kw">SELECT</span> <span class="fu">COUNT</span>(*) <span class="kw">AS</span> <span class="ot">&quot;n&quot;</span></a>
<a class="sourceLine" id="cb94-2" data-line-number="2">     <span class="kw">FROM</span> <span class="ot">&quot;salesorderheader&quot;</span>;</a></code></pre></div>
<p>R markdown stores that query result in a tibble which can be printed by referring to it:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1">query_results</a></code></pre></div>
<pre><code>##       n
## 1 31465</code></pre>
</div>
<div id="mixing-dplyr-and-sql" class="section level2">
<h2><span class="header-section-number">7.4</span> Mixing dplyr and SQL</h2>
<p>When dplyr finds code that it does not know how to translate into SQL, it will simply pass it along to the DBMS. Therefore you can interleave native commands that your DBMS will understand in the middle of dplyr code. Consider this example that’s derived from <span class="citation">(Ruiz <a href="#ref-Ruiz2019">2019</a>)</span>:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1">salesorderheader_table <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb97-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select_at</span>(<span class="kw">vars</span>(subtotal, <span class="kw">contains</span>(<span class="st">&quot;date&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb97-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">today =</span> <span class="kw">now</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb97-4" data-line-number="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">show_query</span>()</a></code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT &quot;subtotal&quot;, &quot;orderdate&quot;, &quot;duedate&quot;, &quot;shipdate&quot;, &quot;modifieddate&quot;, CURRENT_TIMESTAMP AS &quot;today&quot;
## FROM &quot;salesorderheader&quot;</code></pre>
<p>That is native to PostgreSQL, not <a href="https://en.wikipedia.org/wiki/SQL#Interoperability_and_standardization">ANSI standard</a> SQL.</p>
<p>Verify that it works:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1">salesorderheader_table <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb99-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select_at</span>(<span class="kw">vars</span>(subtotal, <span class="kw">contains</span>(<span class="st">&quot;date&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb99-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb99-4" data-line-number="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">today =</span> <span class="kw">now</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb99-5" data-line-number="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">collect</span>()</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   subtotal orderdate           duedate             shipdate           
##      &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;              &lt;dttm&gt;             
## 1   20566. 2011-05-31 00:00:00 2011-06-12 00:00:00 2011-06-07 00:00:00
## 2    1294. 2011-05-31 00:00:00 2011-06-12 00:00:00 2011-06-07 00:00:00
## 3   32726. 2011-05-31 00:00:00 2011-06-12 00:00:00 2011-06-07 00:00:00
## 4   28833. 2011-05-31 00:00:00 2011-06-12 00:00:00 2011-06-07 00:00:00
## 5     419. 2011-05-31 00:00:00 2011-06-12 00:00:00 2011-06-07 00:00:00
## 6   24433. 2011-05-31 00:00:00 2011-06-12 00:00:00 2011-06-07 00:00:00
## # … with 2 more variables: modifieddate &lt;dttm&gt;, today &lt;dttm&gt;</code></pre>
</div>
<div id="examining-a-single-table-with-r" class="section level2">
<h2><span class="header-section-number">7.5</span> Examining a single table with R</h2>
<p>Dealing with a large, complex database highlights the utility of specific tools in R. We include brief examples that we find to be handy:</p>
<ul>
<li>Base R structure: <code>str</code></li>
<li>Printing out some of the data: <code>datatable</code>, <code>kable</code>, and <code>View</code></li>
<li>Summary statistics: <code>summary</code></li>
<li><code>glimpse</code> in the <code>tibble</code> package, which is included in the <code>tidyverse</code></li>
<li><code>skim</code> in the <code>skimr</code> package</li>
</ul>
<div id="str---a-base-package-workhorse" class="section level3">
<h3><span class="header-section-number">7.5.1</span> <code>str</code> - a base package workhorse</h3>
<p><code>str</code> is a workhorse function that lists variables, their type and a sample of the first few variable values.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="kw">str</span>(salesorderheader_tibble)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    31465 obs. of  13 variables:
##  $ salesorderid       : int  43659 43660 43661 43662 43663 43664 43665 43666 43667 43668 ...
##  $ revisionnumber     : int  8 8 8 8 8 8 8 8 8 8 ...
##  $ orderdate          : POSIXct, format: &quot;2011-05-31&quot; &quot;2011-05-31&quot; ...
##  $ duedate            : POSIXct, format: &quot;2011-06-12&quot; &quot;2011-06-12&quot; ...
##  $ shipdate           : POSIXct, format: &quot;2011-06-07&quot; &quot;2011-06-07&quot; ...
##  $ status             : int  5 5 5 5 5 5 5 5 5 5 ...
##  $ onlineorderflag    : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
##  $ purchaseordernumber: chr  &quot;PO522145787&quot; &quot;PO18850127500&quot; &quot;PO18473189620&quot; &quot;PO18444174044&quot; ...
##  $ accountnumber      : chr  &quot;10-4020-000676&quot; &quot;10-4020-000117&quot; &quot;10-4020-000442&quot; &quot;10-4020-000227&quot; ...
##  $ customerid         : int  29825 29672 29734 29994 29565 29898 29580 30052 29974 29614 ...
##  $ salespersonid      : int  279 279 282 282 276 280 283 276 277 282 ...
##  $ territoryid        : int  5 5 6 6 4 1 1 4 3 6 ...
##  $ billtoaddressid    : int  985 921 517 482 1073 876 849 1074 629 529 ...</code></pre>
</div>
<div id="always-look-at-your-data-with-head-view-or-kable" class="section level3">
<h3><span class="header-section-number">7.5.2</span> Always <strong>look</strong> at your data with <code>head</code>, <code>View</code>, or <code>kable</code></h3>
<p>There is no substitute for looking at your data and R provides several ways to just browse it. The <code>head</code> function controls the number of rows that are displayed. Note that tail does not work against a database object. In every-day practice you would look at more than the default 6 rows, but here we wrap <code>head</code> around the data frame:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1">sqlpetr<span class="op">::</span><span class="kw">sp_print_df</span>(<span class="kw">head</span>(salesorderheader_tibble))</a></code></pre></div>
<div id="htmlwidget-88fdd2a34d502a66744b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-88fdd2a34d502a66744b">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],[43659,43660,43661,43662,43663,43664],[8,8,8,8,8,8],["2011-05-31T07:00:00Z","2011-05-31T07:00:00Z","2011-05-31T07:00:00Z","2011-05-31T07:00:00Z","2011-05-31T07:00:00Z","2011-05-31T07:00:00Z"],["2011-06-12T07:00:00Z","2011-06-12T07:00:00Z","2011-06-12T07:00:00Z","2011-06-12T07:00:00Z","2011-06-12T07:00:00Z","2011-06-12T07:00:00Z"],["2011-06-07T07:00:00Z","2011-06-07T07:00:00Z","2011-06-07T07:00:00Z","2011-06-07T07:00:00Z","2011-06-07T07:00:00Z","2011-06-07T07:00:00Z"],[5,5,5,5,5,5],[false,false,false,false,false,false],["PO522145787","PO18850127500","PO18473189620","PO18444174044","PO18009186470","PO16617121983"],["10-4020-000676","10-4020-000117","10-4020-000442","10-4020-000227","10-4020-000510","10-4020-000397"],[29825,29672,29734,29994,29565,29898],[279,279,282,282,276,280],[5,5,6,6,4,1],[985,921,517,482,1073,876]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>salesorderid<\/th>\n      <th>revisionnumber<\/th>\n      <th>orderdate<\/th>\n      <th>duedate<\/th>\n      <th>shipdate<\/th>\n      <th>status<\/th>\n      <th>onlineorderflag<\/th>\n      <th>purchaseordernumber<\/th>\n      <th>accountnumber<\/th>\n      <th>customerid<\/th>\n      <th>salespersonid<\/th>\n      <th>territoryid<\/th>\n      <th>billtoaddressid<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,6,10,11,12,13]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="the-summary-function-in-base" class="section level3">
<h3><span class="header-section-number">7.5.3</span> The <code>summary</code> function in <code>base</code></h3>
<p>The <code>base</code> package’s <code>summary</code> function provides basic statistics that serve a unique diagnostic purpose in this context. For example, the following output shows that:</p>
<pre><code>* `businessentityid` is a number from 1 to 16,049. In a previous section, we ran the `str` function and saw that there are 16,044 observations in this table. Therefore, the `businessentityid` seems to be sequential from 1:16049, but there are 5 values missing from that sequence. _Exercise for the Reader_: Which 5 values from 1:16049 are missing from `businessentityid` values in the `salesorderheader` table? (_Hint_: In the chapter on SQL Joins, you will learn the functions needed to answer this question.)
* The number of NA&#39;s in the `return_date` column is a good first guess as to the number of DVDs rented out or lost as of 2005-09-02 02:35:22.</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1"><span class="kw">summary</span>(salesorderheader_tibble)</a></code></pre></div>
<pre><code>##   salesorderid   revisionnumber    orderdate                  
##  Min.   :43659   Min.   :8.000   Min.   :2011-05-31 00:00:00  
##  1st Qu.:51525   1st Qu.:8.000   1st Qu.:2013-06-20 00:00:00  
##  Median :59391   Median :8.000   Median :2013-11-03 00:00:00  
##  Mean   :59391   Mean   :8.001   Mean   :2013-08-21 12:05:04  
##  3rd Qu.:67257   3rd Qu.:8.000   3rd Qu.:2014-02-28 00:00:00  
##  Max.   :75123   Max.   :9.000   Max.   :2014-06-30 00:00:00  
##                                                               
##     duedate                       shipdate                       status 
##  Min.   :2011-06-12 00:00:00   Min.   :2011-06-07 00:00:00   Min.   :5  
##  1st Qu.:2013-07-02 00:00:00   1st Qu.:2013-06-27 00:00:00   1st Qu.:5  
##  Median :2013-11-15 00:00:00   Median :2013-11-10 00:00:00   Median :5  
##  Mean   :2013-09-02 12:05:41   Mean   :2013-08-28 12:06:06   Mean   :5  
##  3rd Qu.:2014-03-13 00:00:00   3rd Qu.:2014-03-08 00:00:00   3rd Qu.:5  
##  Max.   :2014-07-12 00:00:00   Max.   :2014-07-07 00:00:00   Max.   :5  
##                                                                         
##  onlineorderflag purchaseordernumber accountnumber        customerid   
##  Mode :logical   Length:31465        Length:31465       Min.   :11000  
##  FALSE:3806      Class :character    Class :character   1st Qu.:14432  
##  TRUE :27659     Mode  :character    Mode  :character   Median :19452  
##                                                         Mean   :20170  
##                                                         3rd Qu.:25994  
##                                                         Max.   :30118  
##                                                                        
##  salespersonid    territoryid     billtoaddressid
##  Min.   :274.0   Min.   : 1.000   Min.   :  405  
##  1st Qu.:277.0   1st Qu.: 4.000   1st Qu.:14080  
##  Median :279.0   Median : 6.000   Median :19449  
##  Mean   :280.6   Mean   : 6.091   Mean   :18263  
##  3rd Qu.:284.0   3rd Qu.: 9.000   3rd Qu.:24678  
##  Max.   :290.0   Max.   :10.000   Max.   :29883  
##  NA&#39;s   :27659</code></pre>
<p>So the <code>summary</code> function is surprisingly useful as we first start to look at the table contents.</p>
</div>
<div id="the-glimpse-function-in-the-tibble-package" class="section level3">
<h3><span class="header-section-number">7.5.4</span> The <code>glimpse</code> function in the <code>tibble</code> package</h3>
<p>The <code>tibble</code> package’s <code>glimpse</code> function is a more compact version of <code>str</code>:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1">tibble<span class="op">::</span><span class="kw">glimpse</span>(salesorderheader_tibble)</a></code></pre></div>
<pre><code>## Observations: 31,465
## Variables: 13
## $ salesorderid        &lt;int&gt; 43659, 43660, 43661, 43662, 43663, 43664, 43665, …
## $ revisionnumber      &lt;int&gt; 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8…
## $ orderdate           &lt;dttm&gt; 2011-05-31, 2011-05-31, 2011-05-31, 2011-05-31, …
## $ duedate             &lt;dttm&gt; 2011-06-12, 2011-06-12, 2011-06-12, 2011-06-12, …
## $ shipdate            &lt;dttm&gt; 2011-06-07, 2011-06-07, 2011-06-07, 2011-06-07, …
## $ status              &lt;int&gt; 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5…
## $ onlineorderflag     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, …
## $ purchaseordernumber &lt;chr&gt; &quot;PO522145787&quot;, &quot;PO18850127500&quot;, &quot;PO18473189620&quot;, …
## $ accountnumber       &lt;chr&gt; &quot;10-4020-000676&quot;, &quot;10-4020-000117&quot;, &quot;10-4020-0004…
## $ customerid          &lt;int&gt; 29825, 29672, 29734, 29994, 29565, 29898, 29580, …
## $ salespersonid       &lt;int&gt; 279, 279, 282, 282, 276, 280, 283, 276, 277, 282,…
## $ territoryid         &lt;int&gt; 5, 5, 6, 6, 4, 1, 1, 4, 3, 6, 1, 3, 1, 6, 2, 6, 3…
## $ billtoaddressid     &lt;int&gt; 985, 921, 517, 482, 1073, 876, 849, 1074, 629, 52…</code></pre>
</div>
<div id="the-skim-function-in-the-skimr-package" class="section level3">
<h3><span class="header-section-number">7.5.5</span> The <code>skim</code> function in the <code>skimr</code> package</h3>
<p>The <code>skimr</code> package has several functions that make it easy to examine an unknown data frame and assess what it contains. It is also extensible.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1">skimr<span class="op">::</span><span class="kw">skim</span>(salesorderheader_tibble)</a></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-24">Table 7.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">salesorderheader_tibble</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">31465</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">13</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">logical</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">7</td>
</tr>
<tr class="odd">
<td align="left">POSIXct</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">purchaseordernumber</td>
<td align="right">27659</td>
<td align="right">0.12</td>
<td align="right">10</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">3806</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">accountnumber</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">14</td>
<td align="right">14</td>
<td align="right">0</td>
<td align="right">19119</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: logical</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="left">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">onlineorderflag</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.88</td>
<td align="left">TRU: 27659, FAL: 3806</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">salesorderid</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">59391.00</td>
<td align="right">9083.31</td>
<td align="right">43659</td>
<td align="right">51525</td>
<td align="right">59391</td>
<td align="right">67257</td>
<td align="right">75123</td>
<td align="left">▇▇▇▇▇</td>
</tr>
<tr class="even">
<td align="left">revisionnumber</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">8.00</td>
<td align="right">0.03</td>
<td align="right">8</td>
<td align="right">8</td>
<td align="right">8</td>
<td align="right">8</td>
<td align="right">9</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">status</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">5.00</td>
<td align="right">0.00</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="left">▁▁▇▁▁</td>
</tr>
<tr class="even">
<td align="left">customerid</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">20170.18</td>
<td align="right">6261.73</td>
<td align="right">11000</td>
<td align="right">14432</td>
<td align="right">19452</td>
<td align="right">25994</td>
<td align="right">30118</td>
<td align="left">▇▆▅▅▇</td>
</tr>
<tr class="odd">
<td align="left">salespersonid</td>
<td align="right">27659</td>
<td align="right">0.12</td>
<td align="right">280.61</td>
<td align="right">4.85</td>
<td align="right">274</td>
<td align="right">277</td>
<td align="right">279</td>
<td align="right">284</td>
<td align="right">290</td>
<td align="left">▇▅▅▂▃</td>
</tr>
<tr class="even">
<td align="left">territoryid</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">6.09</td>
<td align="right">2.96</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">9</td>
<td align="right">10</td>
<td align="left">▃▅▃▅▇</td>
</tr>
<tr class="odd">
<td align="left">billtoaddressid</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">18263.15</td>
<td align="right">8210.07</td>
<td align="right">405</td>
<td align="right">14080</td>
<td align="right">19449</td>
<td align="right">24678</td>
<td align="right">29883</td>
<td align="left">▃▁▇▇▇</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: POSIXct</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">orderdate</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">2011-05-31</td>
<td align="left">2014-06-30</td>
<td align="left">2013-11-03</td>
<td align="right">1124</td>
</tr>
<tr class="even">
<td align="left">duedate</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">2011-06-12</td>
<td align="left">2014-07-12</td>
<td align="left">2013-11-15</td>
<td align="right">1124</td>
</tr>
<tr class="odd">
<td align="left">shipdate</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">2011-06-07</td>
<td align="left">2014-07-07</td>
<td align="left">2013-11-10</td>
<td align="right">1124</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1">skimr<span class="op">::</span><span class="kw">skim_to_wide</span>(salesorderheader_tibble) <span class="co">#skimr doesn&#39;t like certain kinds of columns</span></a></code></pre></div>
<pre><code>## Warning: &#39;skimr::skim_to_wide&#39; is deprecated.
## Use &#39;skim()&#39; instead.
## See help(&quot;Deprecated&quot;)</code></pre>
<table>
<caption><span id="tab:unnamed-chunk-24">Table 7.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">.data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">31465</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">13</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">logical</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">7</td>
</tr>
<tr class="odd">
<td align="left">POSIXct</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">purchaseordernumber</td>
<td align="right">27659</td>
<td align="right">0.12</td>
<td align="right">10</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">3806</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">accountnumber</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">14</td>
<td align="right">14</td>
<td align="right">0</td>
<td align="right">19119</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: logical</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="left">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">onlineorderflag</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.88</td>
<td align="left">TRU: 27659, FAL: 3806</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">salesorderid</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">59391.00</td>
<td align="right">9083.31</td>
<td align="right">43659</td>
<td align="right">51525</td>
<td align="right">59391</td>
<td align="right">67257</td>
<td align="right">75123</td>
<td align="left">▇▇▇▇▇</td>
</tr>
<tr class="even">
<td align="left">revisionnumber</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">8.00</td>
<td align="right">0.03</td>
<td align="right">8</td>
<td align="right">8</td>
<td align="right">8</td>
<td align="right">8</td>
<td align="right">9</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">status</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">5.00</td>
<td align="right">0.00</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="left">▁▁▇▁▁</td>
</tr>
<tr class="even">
<td align="left">customerid</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">20170.18</td>
<td align="right">6261.73</td>
<td align="right">11000</td>
<td align="right">14432</td>
<td align="right">19452</td>
<td align="right">25994</td>
<td align="right">30118</td>
<td align="left">▇▆▅▅▇</td>
</tr>
<tr class="odd">
<td align="left">salespersonid</td>
<td align="right">27659</td>
<td align="right">0.12</td>
<td align="right">280.61</td>
<td align="right">4.85</td>
<td align="right">274</td>
<td align="right">277</td>
<td align="right">279</td>
<td align="right">284</td>
<td align="right">290</td>
<td align="left">▇▅▅▂▃</td>
</tr>
<tr class="even">
<td align="left">territoryid</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">6.09</td>
<td align="right">2.96</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">9</td>
<td align="right">10</td>
<td align="left">▃▅▃▅▇</td>
</tr>
<tr class="odd">
<td align="left">billtoaddressid</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">18263.15</td>
<td align="right">8210.07</td>
<td align="right">405</td>
<td align="right">14080</td>
<td align="right">19449</td>
<td align="right">24678</td>
<td align="right">29883</td>
<td align="left">▃▁▇▇▇</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: POSIXct</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">orderdate</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">2011-05-31</td>
<td align="left">2014-06-30</td>
<td align="left">2013-11-03</td>
<td align="right">1124</td>
</tr>
<tr class="even">
<td align="left">duedate</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">2011-06-12</td>
<td align="left">2014-07-12</td>
<td align="left">2013-11-15</td>
<td align="right">1124</td>
</tr>
<tr class="odd">
<td align="left">shipdate</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">2011-06-07</td>
<td align="left">2014-07-07</td>
<td align="left">2013-11-10</td>
<td align="right">1124</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="disconnect-from-the-database-and-stop-docker-2" class="section level2">
<h2><span class="header-section-number">7.6</span> Disconnect from the database and stop Docker</h2>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1"><span class="kw">dbDisconnect</span>(con)</a>
<a class="sourceLine" id="cb112-2" data-line-number="2"><span class="kw">sp_docker_stop</span>(<span class="st">&quot;adventureworks&quot;</span>)</a></code></pre></div>
</div>
<div id="additional-reading" class="section level2">
<h2><span class="header-section-number">7.7</span> Additional reading</h2>
<ul>
<li><span class="citation">(Wickham <a href="#ref-Wickham2018">2018</a>)</span></li>
<li><span class="citation">(Baumer <a href="#ref-Baumer2018">2018</a>)</span></li>
</ul>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Baumer2018">
<p>Baumer, Benjamin S. 2018. “A Grammar for Reproducible and Painless Extract-Transform-Load Operations on Medium Data.” <em>Journal of Computational and Graphical Statistics</em>, August. Informa UK Limited, 1–9. <a href="https://doi.org/10.1080/10618600.2018.1512867">https://doi.org/10.1080/10618600.2018.1512867</a>.</p>
</div>
<div id="ref-Ruiz2019">
<p>Ruiz, Edgar. 2019. “Big Data with R: RStudio 2019 Workshop.” RStudio. January 16, 2019. <a href="https://github.com/rstudio/bigdataclass">https://github.com/rstudio/bigdataclass</a>.</p>
</div>
<div id="ref-Wickham2018">
<p>Wickham, Hadley. 2018. “A Grammar of Data Manipulation * Dplyr.” <a href=""></a>. <a href="https://dplyr.tidyverse.org/">https://dplyr.tidyverse.org/</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-connect-to-db-with-r-code.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-exploring-a-single-table.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/smithjd/sql-pet/edit/master/080-elementary-queries.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
