<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Leveraging Database Views | Exploring Enterprise Databases with R: A Tidyverse Approach</title>
  <meta name="description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Leveraging Database Views | Exploring Enterprise Databases with R: A Tidyverse Approach" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Leveraging Database Views | Exploring Enterprise Databases with R: A Tidyverse Approach" />
  
  <meta name="twitter:description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  

<meta name="author" content="John David Smith, Sophie Yang, M. Edward (Ed) Borasky, Jim Tyhurst, Scott Came, Mary Anne Thygesen, and Ian Frantz" />


<meta name="date" content="2020-01-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-lazy-evaluation-and-timing.html"/>
<link rel="next" href="chapter-postgresql-metadata.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.11/datatables.js"></script>
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.19/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R, Databases and Docker</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#using-r-to-query-a-dbms-in-your-organization"><i class="fa fa-check"></i><b>1.1</b> Using R to query a DBMS in your organization</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#docker-as-a-tool-for-users"><i class="fa fa-check"></i><b>1.2</b> Docker as a tool for UseRs</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#alternatives-to-docker"><i class="fa fa-check"></i><b>1.3</b> Alternatives to Docker</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#packages-used-in-this-book"><i class="fa fa-check"></i><b>1.4</b> Packages used in this book</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#who-are-we"><i class="fa fa-check"></i><b>1.5</b> Who are we?</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#how-did-this-project-come-about"><i class="fa fa-check"></i><b>1.6</b> How did this project come about?</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#navigation"><i class="fa fa-check"></i><b>1.7</b> Navigation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html"><i class="fa fa-check"></i><b>2</b> How to use this book</a><ul>
<li class="chapter" data-level="2.1" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#retrieve-the-code-from-github"><i class="fa fa-check"></i><b>2.1</b> Retrieve the code from GitHub</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#read-along-experiment-as-you-go"><i class="fa fa-check"></i><b>2.2</b> Read along, experiment as you go</a></li>
<li class="chapter" data-level="2.3" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#participating"><i class="fa fa-check"></i><b>2.3</b> Participating</a><ul>
<li class="chapter" data-level="2.3.1" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#browsing-the-book"><i class="fa fa-check"></i><b>2.3.1</b> Browsing the book</a></li>
<li class="chapter" data-level="2.3.2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#diving-in"><i class="fa fa-check"></i><b>2.3.2</b> Diving in</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html"><i class="fa fa-check"></i><b>3</b> Chapter Learning Goals and Use Cases</a><ul>
<li class="chapter" data-level="3.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#the-books-challenge-goals-context-and-expectations"><i class="fa fa-check"></i><b>3.1</b> The Book’s Challenge: goals, context and expectations</a><ul>
<li class="chapter" data-level="3.1.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#the-challenge-investigating-a-question-using-an-organizations-database"><i class="fa fa-check"></i><b>3.1.1</b> The Challenge: Investigating a question using an organization’s database</a></li>
<li class="chapter" data-level="3.1.2" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#strategies"><i class="fa fa-check"></i><b>3.1.2</b> Strategies</a></li>
<li class="chapter" data-level="3.1.3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#problems-that-we-address-in-the-book"><i class="fa fa-check"></i><b>3.1.3</b> Problems that we address in the book</a></li>
<li class="chapter" data-level="3.1.4" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#signposts"><i class="fa fa-check"></i><b>3.1.4</b> Signposts</a></li>
<li class="chapter" data-level="3.1.5" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#book-structure"><i class="fa fa-check"></i><b>3.1.5</b> Book structure</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#making-your-way-through-the-book"><i class="fa fa-check"></i><b>3.2</b> Making your way through the book</a><ul>
<li class="chapter" data-level="3.2.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#r-packages"><i class="fa fa-check"></i><b>3.2.1</b> R Packages</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#adventure-works"><i class="fa fa-check"></i><b>3.3</b> Adventure Works</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html"><i class="fa fa-check"></i><b>4</b> Create and connect to the adventureworks database in PostgreSQL</a><ul>
<li class="chapter" data-level="4.1" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#verify-that-docker-is-up-running-and-clean-up-if-necessary"><i class="fa fa-check"></i><b>4.2</b> Verify that Docker is up, running, and clean up if necessary</a></li>
<li class="chapter" data-level="4.3" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#clean-up-if-appropriate"><i class="fa fa-check"></i><b>4.3</b> Clean up if appropriate</a></li>
<li class="chapter" data-level="4.4" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#build-the-adventureworks-docker-image"><i class="fa fa-check"></i><b>4.4</b> Build the adventureworks Docker image</a></li>
<li class="chapter" data-level="4.5" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#run-the-adventureworks-docker-image"><i class="fa fa-check"></i><b>4.5</b> Run the adventureworks Docker Image</a></li>
<li class="chapter" data-level="4.6" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#connect-to-postgresql"><i class="fa fa-check"></i><b>4.6</b> Connect to PostgreSQL</a></li>
<li class="chapter" data-level="4.7" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#adventureworks-schemas"><i class="fa fa-check"></i><b>4.7</b> Adventureworks Schemas</a></li>
<li class="chapter" data-level="4.8" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#investigate-the-database-using-rstudio"><i class="fa fa-check"></i><b>4.8</b> Investigate the database using Rstudio</a></li>
<li class="chapter" data-level="4.9" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#cleaning-up-diconnect-from-the-database-and-stop-docker"><i class="fa fa-check"></i><b>4.9</b> Cleaning up: diconnect from the database and stop Docker</a></li>
<li class="chapter" data-level="4.10" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#using-the-adventureworks-container-in-the-rest-of-the-book"><i class="fa fa-check"></i><b>4.10</b> Using the <code>adventureworks</code> container in the rest of the book</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html"><i class="fa fa-check"></i><b>5</b> Securing and using your dbms log-in credentials</a><ul>
<li class="chapter" data-level="5.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#set-up-the-adventureworks-docker-container"><i class="fa fa-check"></i><b>5.1</b> Set up the adventureworks Docker container</a><ul>
<li class="chapter" data-level="5.1.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#verify-that-docker-is-running"><i class="fa fa-check"></i><b>5.1.1</b> Verify that Docker is running</a></li>
<li class="chapter" data-level="5.1.2" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#start-the-docker-container"><i class="fa fa-check"></i><b>5.1.2</b> Start the Docker container:</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#storing-your-dbms-credentials"><i class="fa fa-check"></i><b>5.2</b> Storing your dbms credentials</a><ul>
<li class="chapter" data-level="5.2.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#connect-with-postgres-using-the-sys.getenv-function"><i class="fa fa-check"></i><b>5.2.1</b> Connect with Postgres using the Sys.getenv function</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#disconnect-from-the-database-and-stop-docker"><i class="fa fa-check"></i><b>5.3</b> Disconnect from the database and stop Docker</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html"><i class="fa fa-check"></i><b>6</b> Connecting to the database with R code</a><ul>
<li class="chapter" data-level="6.1" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#verify-that-docker-is-up-and-running-and-start-the-database"><i class="fa fa-check"></i><b>6.1</b> Verify that Docker is up and running, and start the database</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#connect-to-postgresql-1"><i class="fa fa-check"></i><b>6.2</b> Connect to PostgreSQL</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#set-schema-search-path-and-list-its-contents"><i class="fa fa-check"></i><b>6.3</b> Set schema search path and list its contents</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#anatomy-of-a-dplyr-connection-object"><i class="fa fa-check"></i><b>6.4</b> Anatomy of a <code>dplyr</code> connection object</a></li>
<li class="chapter" data-level="6.5" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#disconnect-from-the-database-and-stop-docker-1"><i class="fa fa-check"></i><b>6.5</b> Disconnect from the database and stop Docker</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html"><i class="fa fa-check"></i><b>7</b> Introduction to DBMS queries</a><ul>
<li class="chapter" data-level="7.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#setup"><i class="fa fa-check"></i><b>7.1</b> Setup</a></li>
<li class="chapter" data-level="7.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#methods-for-downloading-a-single-table"><i class="fa fa-check"></i><b>7.2</b> Methods for downloading a single table</a><ul>
<li class="chapter" data-level="7.2.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#read-the-entire-table"><i class="fa fa-check"></i><b>7.2.1</b> Read the entire table</a></li>
<li class="chapter" data-level="7.2.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#create-a-pointer-to-a-table-that-can-be-reused"><i class="fa fa-check"></i><b>7.2.2</b> Create a pointer to a table that can be reused</a></li>
<li class="chapter" data-level="7.2.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#controlling-the-number-of-rows-returned-with-collect"><i class="fa fa-check"></i><b>7.2.3</b> Controlling the number of rows returned with <code>collect()</code></a></li>
<li class="chapter" data-level="7.2.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#retrieving-random-rows-from-the-dbms"><i class="fa fa-check"></i><b>7.2.4</b> Retrieving random rows from the DBMS</a></li>
<li class="chapter" data-level="7.2.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#sub-setting-variables"><i class="fa fa-check"></i><b>7.2.5</b> Sub-setting variables</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#translating-dplyr-code-to-sql-queries"><i class="fa fa-check"></i><b>7.3</b> Translating <code>dplyr</code> code to <code>SQL</code> queries</a></li>
<li class="chapter" data-level="7.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#mixing-dplyr-and-sql"><i class="fa fa-check"></i><b>7.4</b> Mixing dplyr and SQL</a></li>
<li class="chapter" data-level="7.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#examining-a-single-table-with-r"><i class="fa fa-check"></i><b>7.5</b> Examining a single table with R</a><ul>
<li class="chapter" data-level="7.5.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#str---a-base-package-workhorse"><i class="fa fa-check"></i><b>7.5.1</b> <code>str</code> - a base package workhorse</a></li>
<li class="chapter" data-level="7.5.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#always-look-at-your-data-with-head-view-or-kable"><i class="fa fa-check"></i><b>7.5.2</b> Always <strong>look</strong> at your data with <code>head</code>, <code>View</code>, or <code>kable</code></a></li>
<li class="chapter" data-level="7.5.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-summary-function-in-base"><i class="fa fa-check"></i><b>7.5.3</b> The <code>summary</code> function in <code>base</code></a></li>
<li class="chapter" data-level="7.5.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-glimpse-function-in-the-tibble-package"><i class="fa fa-check"></i><b>7.5.4</b> The <code>glimpse</code> function in the <code>tibble</code> package</a></li>
<li class="chapter" data-level="7.5.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-skim-function-in-the-skimr-package"><i class="fa fa-check"></i><b>7.5.5</b> The <code>skim</code> function in the <code>skimr</code> package</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#disconnect-from-the-database-and-stop-docker-2"><i class="fa fa-check"></i><b>7.6</b> Disconnect from the database and stop Docker</a></li>
<li class="chapter" data-level="7.7" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#additional-reading"><i class="fa fa-check"></i><b>7.7</b> Additional reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html"><i class="fa fa-check"></i><b>8</b> Asking Business Questions From a Single Table</a><ul>
<li class="chapter" data-level="8.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#setup-our-standard-working-environment"><i class="fa fa-check"></i><b>8.1</b> Setup our standard working environment</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#a-word-on-naming"><i class="fa fa-check"></i><b>8.2</b> A word on naming</a></li>
<li class="chapter" data-level="8.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#the-overall-adventureworks-sales-picture"><i class="fa fa-check"></i><b>8.3</b> The overall AdventureWorks sales picture</a></li>
<li class="chapter" data-level="8.4" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#annual-sales"><i class="fa fa-check"></i><b>8.4</b> Annual sales</a><ul>
<li class="chapter" data-level="8.4.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#annual-summary-of-sales-number-of-transactions-and-average-sale"><i class="fa fa-check"></i><b>8.4.1</b> Annual summary of sales, number of transactions and average sale</a></li>
<li class="chapter" data-level="8.4.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#average-dollars-per-sale"><i class="fa fa-check"></i><b>8.4.2</b> Average dollars per sale</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#monthly-sales"><i class="fa fa-check"></i><b>8.5</b> Monthly Sales</a><ul>
<li class="chapter" data-level="8.5.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#check-lagged-monthly-data"><i class="fa fa-check"></i><b>8.5.1</b> Check lagged monthly data</a></li>
<li class="chapter" data-level="8.5.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#comparing-dollars-and-orders-to-a-base-year"><i class="fa fa-check"></i><b>8.5.2</b> Comparing dollars and orders to a base year</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#the-effect-of-online-sales"><i class="fa fa-check"></i><b>8.6</b> The effect of online sales</a><ul>
<li class="chapter" data-level="8.6.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#add-onlineorderflag-to-our-annual-sales-query"><i class="fa fa-check"></i><b>8.6.1</b> Add <code>onlineorderflag</code> to our annual sales query</a></li>
<li class="chapter" data-level="8.6.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#annual-sales-comparison"><i class="fa fa-check"></i><b>8.6.2</b> Annual Sales comparison</a></li>
<li class="chapter" data-level="8.6.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#order-volume-comparison"><i class="fa fa-check"></i><b>8.6.3</b> Order volume comparison</a></li>
<li class="chapter" data-level="8.6.4" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#comparing-average-order-size-sales-reps-to-online-orders"><i class="fa fa-check"></i><b>8.6.4</b> Comparing average order size: <strong>Sales Reps</strong> to <strong>Online</strong> orders</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#impact-of-order-type-on-monthly-sales"><i class="fa fa-check"></i><b>8.7</b> Impact of order type on monthly sales</a><ul>
<li class="chapter" data-level="8.7.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#retrieve-monthly-sales-with-the-onlineorderflag"><i class="fa fa-check"></i><b>8.7.1</b> Retrieve monthly sales with the <code>onlineorderflag</code></a></li>
<li class="chapter" data-level="8.7.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#monthly-variation-compared-to-a-trend-line"><i class="fa fa-check"></i><b>8.7.2</b> Monthly variation compared to a trend line</a></li>
<li class="chapter" data-level="8.7.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#compare-monthly-lagged-data-by-sales-channel"><i class="fa fa-check"></i><b>8.7.3</b> Compare monthly lagged data by Sales Channel</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#detect-and-diagnose-the-day-of-the-month-problem"><i class="fa fa-check"></i><b>8.8</b> Detect and diagnose the day of the month problem</a><ul>
<li class="chapter" data-level="8.8.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#sales-rep-orderdate-distribution"><i class="fa fa-check"></i><b>8.8.1</b> Sales Rep Orderdate Distribution</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#correcting-the-order-date-for-sales-reps"><i class="fa fa-check"></i><b>8.9</b> Correcting the order date for <strong>Sales Reps</strong></a><ul>
<li class="chapter" data-level="8.9.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#define-a-date-correction-function-in-r"><i class="fa fa-check"></i><b>8.9.1</b> Define a date correction function in R</a></li>
<li class="chapter" data-level="8.9.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#define-postgres-date-function"><i class="fa fa-check"></i><b>8.9.2</b> Define and store a PostgreSQL function to correct the date</a></li>
<li class="chapter" data-level="8.9.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#use-the-postgresql-function"><i class="fa fa-check"></i><b>8.9.3</b> Use the PostgreSQL function</a></li>
<li class="chapter" data-level="8.9.4" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#monthly-sales-by-order-type-with-corrected-dates-relative-to-a-trend-line"><i class="fa fa-check"></i><b>8.9.4</b> Monthly Sales by Order Type with corrected dates – relative to a trend line</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#disconnect-from-the-database-and-stop-docker-3"><i class="fa fa-check"></i><b>8.10</b> Disconnect from the database and stop Docker</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html"><i class="fa fa-check"></i><b>9</b> Lazy Evaluation and Lazy Queries</a><ul>
<li class="chapter" data-level="9.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#setup-1"><i class="fa fa-check"></i><b>9.1</b> Setup</a></li>
<li class="chapter" data-level="9.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#r-is-lazy-and-comes-with-guardrails"><i class="fa fa-check"></i><b>9.2</b> R is lazy and comes with guardrails</a><ul>
<li class="chapter" data-level="9.2.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-loading"><i class="fa fa-check"></i><b>9.2.1</b> Lazy loading</a></li>
<li class="chapter" data-level="9.2.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-evaluation"><i class="fa fa-check"></i><b>9.2.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="9.2.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-queries"><i class="fa fa-check"></i><b>9.2.3</b> Lazy Queries</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-evaluation-and-lazy-queries"><i class="fa fa-check"></i><b>9.3</b> Lazy evaluation and lazy queries</a><ul>
<li class="chapter" data-level="9.3.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#create-a-black-box-query-for-experimentation"><i class="fa fa-check"></i><b>9.3.1</b> Create a black box query for experimentation</a></li>
<li class="chapter" data-level="9.3.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#experiment-overview"><i class="fa fa-check"></i><b>9.3.2</b> Experiment overview</a></li>
<li class="chapter" data-level="9.3.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_print"><i class="fa fa-check"></i><b>9.3.3</b> Q %&gt;% print()</a></li>
<li class="chapter" data-level="9.3.4" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_as-tibble"><i class="fa fa-check"></i><b>9.3.4</b> Q %&gt;% dplyr::as_tibble()</a></li>
<li class="chapter" data-level="9.3.5" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_head"><i class="fa fa-check"></i><b>9.3.5</b> Q %&gt;% head()</a></li>
<li class="chapter" data-level="9.3.6" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_tail"><i class="fa fa-check"></i><b>9.3.6</b> Q %&gt;% tail()</a></li>
<li class="chapter" data-level="9.3.7" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_length"><i class="fa fa-check"></i><b>9.3.7</b> Q %&gt;% length()</a></li>
<li class="chapter" data-level="9.3.8" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_str"><i class="fa fa-check"></i><b>9.3.8</b> Q %&gt;% str()</a></li>
<li class="chapter" data-level="9.3.9" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_nrow"><i class="fa fa-check"></i><b>9.3.9</b> Q %&gt;% nrow()</a></li>
<li class="chapter" data-level="9.3.10" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_tally"><i class="fa fa-check"></i><b>9.3.10</b> Q %&gt;% dplyr::tally()</a></li>
<li class="chapter" data-level="9.3.11" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_collect"><i class="fa fa-check"></i><b>9.3.11</b> Q %&gt;% dplyr::collect()</a></li>
<li class="chapter" data-level="9.3.12" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_plot-categories"><i class="fa fa-check"></i><b>9.3.12</b> Q %&gt;% ggplot</a></li>
<li class="chapter" data-level="9.3.13" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_show-query"><i class="fa fa-check"></i><b>9.3.13</b> Q %&gt;% dplyr::show_query()</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#other-resources"><i class="fa fa-check"></i><b>9.4</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html"><i class="fa fa-check"></i><b>10</b> Lazy Evaluation and Execution Environment</a><ul>
<li class="chapter" data-level="10.1" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#setup-2"><i class="fa fa-check"></i><b>10.1</b> Setup</a><ul>
<li class="chapter" data-level="10.1.1" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#experiment-overview-1"><i class="fa fa-check"></i><b>10.1.1</b> Experiment overview</a></li>
<li class="chapter" data-level="10.1.2" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#time-based-execution-environment-issues"><i class="fa fa-check"></i><b>10.1.2</b> Time-based, execution environment issues</a></li>
<li class="chapter" data-level="10.1.3" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#lazy_q_build"><i class="fa fa-check"></i><b>10.1.3</b> Q %&gt;% <code>more dplyr</code></a></li>
<li class="chapter" data-level="10.1.4" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#many-handy-r-functions-cant-be-translated-to-sql"><i class="fa fa-check"></i><b>10.1.4</b> Many handy R functions can’t be translated to SQL</a></li>
<li class="chapter" data-level="10.1.5" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#further-lazy-execution-examples"><i class="fa fa-check"></i><b>10.1.5</b> Further lazy execution examples</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#disconnect-from-the-database-and-stop-docker-4"><i class="fa fa-check"></i><b>10.2</b> Disconnect from the database and stop Docker</a></li>
<li class="chapter" data-level="10.3" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#other-resources-1"><i class="fa fa-check"></i><b>10.3</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html"><i class="fa fa-check"></i><b>11</b> Leveraging Database Views</a><ul>
<li class="chapter" data-level="11.1" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#setup-our-standard-working-environment-1"><i class="fa fa-check"></i><b>11.1</b> Setup our standard working environment</a></li>
<li class="chapter" data-level="11.2" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#the-role-of-database-views"><i class="fa fa-check"></i><b>11.2</b> The role of database <code>views</code></a><ul>
<li class="chapter" data-level="11.2.1" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#why-database-views-are-useful"><i class="fa fa-check"></i><b>11.2.1</b> Why database <code>views</code> are useful</a></li>
<li class="chapter" data-level="11.2.2" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#rely-on-and-be-critical-of-views"><i class="fa fa-check"></i><b>11.2.2</b> Rely on – <strong>and</strong> be critical of – <code>views</code></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#unpacking-the-elements-of-a-view-in-the-tidyverse"><i class="fa fa-check"></i><b>11.3</b> Unpacking the elements of a <code>view</code> in the Tidyverse</a><ul>
<li class="chapter" data-level="11.3.1" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#use-a-view-just-like-any-other-table"><i class="fa fa-check"></i><b>11.3.1</b> Use a <code>view</code> just like any other table</a></li>
<li class="chapter" data-level="11.3.2" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#sql-source-code"><i class="fa fa-check"></i><b>11.3.2</b> SQL source code</a></li>
<li class="chapter" data-level="11.3.3" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#the-erd-as-context-for-sql-code"><i class="fa fa-check"></i><b>11.3.3</b> The ERD as context for SQL code</a></li>
<li class="chapter" data-level="11.3.4" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#selecting-relevant-tables-and-columns"><i class="fa fa-check"></i><b>11.3.4</b> Selecting relevant tables and columns</a></li>
<li class="chapter" data-level="11.3.5" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#join-the-tables-together"><i class="fa fa-check"></i><b>11.3.5</b> Join the tables together</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#compare-the-official-view-and-the-dplyr-output"><i class="fa fa-check"></i><b>11.4</b> Compare the official view and the dplyr output</a></li>
<li class="chapter" data-level="11.5" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#revise-the-view-to-summarize-by-quarter-not-fiscal-year"><i class="fa fa-check"></i><b>11.5</b> Revise the view to summarize by quarter not fiscal year</a></li>
<li class="chapter" data-level="11.6" data-path="chapter-leveraging-database-views.html"><a href="chapter-leveraging-database-views.html#clean-up-and-close-down"><i class="fa fa-check"></i><b>11.6</b> Clean up and close down</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html"><i class="fa fa-check"></i><b>12</b> Getting metadata about and from PostgreSQL</a><ul>
<li class="chapter" data-level="12.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#views-trick-parked-here-for-the-time-being"><i class="fa fa-check"></i><b>12.1</b> Views trick parked here for the time being</a><ul>
<li class="chapter" data-level="12.1.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#explore-the-vsalelsperson-and-vsalespersonsalesbyfiscalyearsdata-views"><i class="fa fa-check"></i><b>12.1.1</b> Explore the vsalelsperson and vsalespersonsalesbyfiscalyearsdata views</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-contents-and-structure"><i class="fa fa-check"></i><b>12.2</b> Database contents and structure</a><ul>
<li class="chapter" data-level="12.2.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-structure"><i class="fa fa-check"></i><b>12.2.1</b> Database structure</a></li>
<li class="chapter" data-level="12.2.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#contents-of-the-information_schema"><i class="fa fa-check"></i><b>12.2.2</b> Contents of the <code>information_schema</code></a></li>
<li class="chapter" data-level="12.2.3" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-tables-are-in-the-database"><i class="fa fa-check"></i><b>12.2.3</b> What tables are in the database?</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-columns-do-those-tables-contain"><i class="fa fa-check"></i><b>12.3</b> What columns do those tables contain?</a><ul>
<li class="chapter" data-level="12.3.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-is-the-difference-between-a-view-and-a-base-table"><i class="fa fa-check"></i><b>12.3.1</b> What is the difference between a <code>VIEW</code> and a <code>BASE TABLE</code>?</a></li>
<li class="chapter" data-level="12.3.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-data-types-are-found-in-the-database"><i class="fa fa-check"></i><b>12.3.2</b> What data types are found in the database?</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#characterizing-how-things-are-named"><i class="fa fa-check"></i><b>12.4</b> Characterizing how things are named</a><ul>
<li class="chapter" data-level="12.4.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#counting-columns-and-name-reuse"><i class="fa fa-check"></i><b>12.4.1</b> Counting columns and name reuse</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-keys"><i class="fa fa-check"></i><b>12.5</b> Database keys</a><ul>
<li class="chapter" data-level="12.5.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#direct-sql"><i class="fa fa-check"></i><b>12.5.1</b> Direct SQL</a></li>
<li class="chapter" data-level="12.5.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-keys-with-dplyr"><i class="fa fa-check"></i><b>12.5.2</b> Database keys with dplyr</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#creating-your-own-data-dictionary"><i class="fa fa-check"></i><b>12.6</b> Creating your own data dictionary</a></li>
<li class="chapter" data-level="12.7" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#save-your-work"><i class="fa fa-check"></i><b>12.7</b> Save your work!</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html"><i class="fa fa-check"></i><b>A</b> Background and Basic Concepts</a><ul>
<li class="chapter" data-level="A.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#the-big-picture-r-and-the-docker-postgresql-playground-on-your-machine"><i class="fa fa-check"></i><b>A.1</b> The big picture: R and the Docker / PostgreSQL playground on your machine</a></li>
<li class="chapter" data-level="A.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#your-computer-and-its-operating-system"><i class="fa fa-check"></i><b>A.2</b> Your computer and its operating system</a></li>
<li class="chapter" data-level="A.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#r"><i class="fa fa-check"></i><b>A.3</b> R</a></li>
<li class="chapter" data-level="A.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#our-sqlpetr-package"><i class="fa fa-check"></i><b>A.4</b> Our <code>sqlpetr</code> package</a></li>
<li class="chapter" data-level="A.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker"><i class="fa fa-check"></i><b>A.5</b> Docker</a><ul>
<li class="chapter" data-level="A.5.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#virtual-machines-and-hypervisors"><i class="fa fa-check"></i><b>A.5.1</b> Virtual machines and hypervisors</a></li>
<li class="chapter" data-level="A.5.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#containers"><i class="fa fa-check"></i><b>A.5.2</b> Containers</a></li>
<li class="chapter" data-level="A.5.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker-itself"><i class="fa fa-check"></i><b>A.5.3</b> Docker itself</a></li>
<li class="chapter" data-level="A.5.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker-objects"><i class="fa fa-check"></i><b>A.5.4</b> Docker objects</a></li>
<li class="chapter" data-level="A.5.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-windows-machines"><i class="fa fa-check"></i><b>A.5.5</b> Hosting Docker on Windows machines</a></li>
<li class="chapter" data-level="A.5.6" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-macos-machines"><i class="fa fa-check"></i><b>A.5.6</b> Hosting Docker on macOS machines</a></li>
<li class="chapter" data-level="A.5.7" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-unix-machines"><i class="fa fa-check"></i><b>A.5.7</b> Hosting Docker on UNIX machines</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#normal-and-normalized-data"><i class="fa fa-check"></i><b>A.6</b> ‘Normal’ and ‘normalized’ data</a><ul>
<li class="chapter" data-level="A.6.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#tidy-data"><i class="fa fa-check"></i><b>A.6.1</b> Tidy data</a></li>
<li class="chapter" data-level="A.6.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#design-of-normal-data"><i class="fa fa-check"></i><b>A.6.2</b> Design of “normal data”</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#sql-language"><i class="fa fa-check"></i><b>A.7</b> SQL Language</a><ul>
<li class="chapter" data-level="A.7.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-manipulation-langauge-dml"><i class="fa fa-check"></i><b>A.7.1</b> Data Manipulation Langauge (DML)</a></li>
<li class="chapter" data-level="A.7.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-definition-langauge-ddl"><i class="fa fa-check"></i><b>A.7.2</b> Data Definition Langauge (DDL)</a></li>
<li class="chapter" data-level="A.7.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-control-language-dcl"><i class="fa fa-check"></i><b>A.7.3</b> Data Control Language (DCL)</a></li>
<li class="chapter" data-level="A.7.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#transaction-control-language-tcl"><i class="fa fa-check"></i><b>A.7.4</b> Transaction Control Language (TCL)</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#enterprise-dbms"><i class="fa fa-check"></i><b>A.8</b> Enterprise DBMS</a><ul>
<li class="chapter" data-level="A.8.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#sql-databases"><i class="fa fa-check"></i><b>A.8.1</b> SQL databases</a></li>
<li class="chapter" data-level="A.8.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-mapping-between-r-vs-sql-data-types"><i class="fa fa-check"></i><b>A.8.2</b> Data mapping between R vs SQL data types</a></li>
<li class="chapter" data-level="A.8.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#postgresql-and-connection-parameters"><i class="fa fa-check"></i><b>A.8.3</b> PostgreSQL and connection parameters</a></li>
<li class="chapter" data-level="A.8.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#connecting-the-r-and-dbms-environments"><i class="fa fa-check"></i><b>A.8.4</b> Connecting the R and DBMS environments</a></li>
<li class="chapter" data-level="A.8.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#using-sqlite-to-simulate-an-enterprise-dbms"><i class="fa fa-check"></i><b>A.8.5</b> Using SQLite to simulate an enterprise DBMS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html"><i class="fa fa-check"></i><b>B</b> - Setup instructions</a><ul>
<li class="chapter" data-level="B.1" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#sandbox-prerequisites"><i class="fa fa-check"></i><b>B.1</b> Sandbox prerequisites</a></li>
<li class="chapter" data-level="B.2" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#r-rstudio-and-git"><i class="fa fa-check"></i><b>B.2</b> R, RStudio and Git</a></li>
<li class="chapter" data-level="B.3" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#install-docker"><i class="fa fa-check"></i><b>B.3</b> Install Docker</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html"><i class="fa fa-check"></i><b>C</b> Appendix E - Install <code>adventureworks</code> on your own machine</a><ul>
<li class="chapter" data-level="C.1" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#overview-1"><i class="fa fa-check"></i><b>C.1</b> Overview</a><ul>
<li class="chapter" data-level="C.1.1" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#download-the-adventureworks-database"><i class="fa fa-check"></i><b>C.1.1</b> Download the <code>adventureworks</code> database</a></li>
<li class="chapter" data-level="C.1.2" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#restore-the-dvdrental-database-at-the-command-line"><i class="fa fa-check"></i><b>C.1.2</b> Restore the <code>dvdrental</code> database at the command line</a></li>
<li class="chapter" data-level="C.1.3" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#restore-the-adventureworks-database-using-pgadmin"><i class="fa fa-check"></i><b>C.1.3</b> Restore the <code>adventureworks</code> database using pgAdmin</a></li>
</ul></li>
<li class="chapter" data-level="C.2" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#resources"><i class="fa fa-check"></i><b>C.2</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html"><i class="fa fa-check"></i><b>D</b> Appendix B - Additional technical details for Windows users</a><ul>
<li class="chapter" data-level="D.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#hardware-requirements"><i class="fa fa-check"></i><b>D.1</b> Hardware requirements</a></li>
<li class="chapter" data-level="D.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#software-requirements"><i class="fa fa-check"></i><b>D.2</b> Software requirements</a><ul>
<li class="chapter" data-level="D.2.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#windows-7-8-8.1-and-windows-10-home-64-bit"><i class="fa fa-check"></i><b>D.2.1</b> Windows 7, 8, 8.1 and Windows 10 Home (64 bit)</a></li>
<li class="chapter" data-level="D.2.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#windows-10-pro"><i class="fa fa-check"></i><b>D.2.2</b> Windows 10 Pro</a></li>
</ul></li>
<li class="chapter" data-level="D.3" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#docker-for-windows-settings"><i class="fa fa-check"></i><b>D.3</b> Docker for Windows settings</a><ul>
<li class="chapter" data-level="D.3.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#shared-drives"><i class="fa fa-check"></i><b>D.3.1</b> Shared drives</a></li>
<li class="chapter" data-level="D.3.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#kubernetes"><i class="fa fa-check"></i><b>D.3.2</b> Kubernetes</a></li>
</ul></li>
<li class="chapter" data-level="D.4" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#git-github-and-line-endings"><i class="fa fa-check"></i><b>D.4</b> Git, GitHub and line endings</a></li>
</ul></li>
<li class="chapter" data-level="E" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html"><i class="fa fa-check"></i><b>E</b> Appendix C - PostgreSQL Authentication</a><ul>
<li class="chapter" data-level="E.1" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#introduction"><i class="fa fa-check"></i><b>E.1</b> Introduction</a></li>
<li class="chapter" data-level="E.2" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#password-authentication-on-the-postgresql-docker-image"><i class="fa fa-check"></i><b>E.2</b> Password authentication on the PostgreSQL Docker image</a></li>
<li class="chapter" data-level="E.3" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#adding-roles"><i class="fa fa-check"></i><b>E.3</b> Adding roles</a><ul>
<li class="chapter" data-level="E.3.1" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#setting-up-docker"><i class="fa fa-check"></i><b>E.3.1</b> Setting up Docker</a></li>
<li class="chapter" data-level="E.3.2" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#creating-a-new-container"><i class="fa fa-check"></i><b>E.3.2</b> Creating a new container</a></li>
<li class="chapter" data-level="E.3.3" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#adding-a-role"><i class="fa fa-check"></i><b>E.3.3</b> Adding a role</a></li>
<li class="chapter" data-level="E.3.4" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#did-it-work"><i class="fa fa-check"></i><b>E.3.4</b> Did it work?</a></li>
<li class="chapter" data-level="E.3.5" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#disconnect-and-remove-the-container"><i class="fa fa-check"></i><b>E.3.5</b> Disconnect and remove the container</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="F" data-path="chapter-appendix-dbi-index.html"><a href="chapter-appendix-dbi-index.html"><i class="fa fa-check"></i><b>F</b> DBI package functions - INDEX</a></li>
<li class="chapter" data-level="G" data-path="chapter-appendix-dplyr-to-postres-translation.html"><a href="chapter-appendix-dplyr-to-postres-translation.html"><i class="fa fa-check"></i><b>G</b> Appendix _ Dplyr to SQL translations</a><ul>
<li class="chapter" data-level="G.1" data-path="chapter-appendix-dplyr-to-postres-translation.html"><a href="chapter-appendix-dplyr-to-postres-translation.html#overview-2"><i class="fa fa-check"></i><b>G.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="H" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html"><i class="fa fa-check"></i><b>H</b> Appendix Additional resources</a><ul>
<li class="chapter" data-level="H.1" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#editing-this-book"><i class="fa fa-check"></i><b>H.1</b> Editing this book</a></li>
<li class="chapter" data-level="H.2" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#docker-alternatives"><i class="fa fa-check"></i><b>H.2</b> Docker alternatives</a></li>
<li class="chapter" data-level="H.3" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#docker-and-r"><i class="fa fa-check"></i><b>H.3</b> Docker and R</a></li>
<li class="chapter" data-level="H.4" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#documentation-for-docker-and-postgresql"><i class="fa fa-check"></i><b>H.4</b> Documentation for Docker and PostgreSQL</a></li>
<li class="chapter" data-level="H.5" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#sql-and-dplyr"><i class="fa fa-check"></i><b>H.5</b> SQL and dplyr</a></li>
<li class="chapter" data-level="H.6" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#more-resources"><i class="fa fa-check"></i><b>H.6</b> More Resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Exploring Enterprise Databases with R: A Tidyverse Approach</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter_leveraging-database-views" class="section level1">
<h1><span class="header-section-number">Chapter 11</span> Leveraging Database Views</h1>
<blockquote>
<p>This chapter demonstrates how to:</p>
<ul>
<li>Understand database views and their uses</li>
<li>Unpack a database view to see what it’s doing</li>
<li>Reproduce a database view with dplyr code</li>
<li>Write an alternative to a view that provides more details</li>
<li>Create a database view either for personal use or for submittal to your enterprise DBA</li>
</ul>
</blockquote>
<div id="setup-our-standard-working-environment-1" class="section level2">
<h2><span class="header-section-number">11.1</span> Setup our standard working environment</h2>
<p>Use these libraries:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb228-2" data-line-number="2"><span class="kw">library</span>(DBI)</a>
<a class="sourceLine" id="cb228-3" data-line-number="3"><span class="kw">library</span>(RPostgres)</a>
<a class="sourceLine" id="cb228-4" data-line-number="4"><span class="kw">library</span>(connections)</a>
<a class="sourceLine" id="cb228-5" data-line-number="5"><span class="kw">library</span>(glue)</a>
<a class="sourceLine" id="cb228-6" data-line-number="6"><span class="kw">require</span>(knitr)</a>
<a class="sourceLine" id="cb228-7" data-line-number="7"><span class="kw">library</span>(dbplyr)</a>
<a class="sourceLine" id="cb228-8" data-line-number="8"><span class="kw">library</span>(sqlpetr)</a>
<a class="sourceLine" id="cb228-9" data-line-number="9"><span class="kw">library</span>(bookdown)</a>
<a class="sourceLine" id="cb228-10" data-line-number="10"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb228-11" data-line-number="11"><span class="kw">library</span>(gt)</a></code></pre></div>
<p>Connect to <code>adventureworks</code>:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" data-line-number="1"><span class="kw">sp_docker_start</span>(<span class="st">&quot;adventureworks&quot;</span>)</a>
<a class="sourceLine" id="cb229-2" data-line-number="2"><span class="kw">Sys.sleep</span>(sleep_default)</a></code></pre></div>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" data-line-number="1"><span class="co"># con &lt;- connection_open(  # use in an interactive session</span></a>
<a class="sourceLine" id="cb230-2" data-line-number="2">con &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(          <span class="co"># use in other settings</span></a>
<a class="sourceLine" id="cb230-3" data-line-number="3">  RPostgres<span class="op">::</span><span class="kw">Postgres</span>(),</a>
<a class="sourceLine" id="cb230-4" data-line-number="4">  <span class="co"># without the previous and next lines, some functions fail with bigint data </span></a>
<a class="sourceLine" id="cb230-5" data-line-number="5">  <span class="co">#   so change int64 to integer</span></a>
<a class="sourceLine" id="cb230-6" data-line-number="6">  <span class="dt">bigint =</span> <span class="st">&quot;integer&quot;</span>,  </a>
<a class="sourceLine" id="cb230-7" data-line-number="7">  <span class="dt">host =</span> <span class="st">&quot;localhost&quot;</span>,</a>
<a class="sourceLine" id="cb230-8" data-line-number="8">  <span class="dt">port =</span> <span class="dv">5432</span>,</a>
<a class="sourceLine" id="cb230-9" data-line-number="9">  <span class="dt">user =</span> <span class="st">&quot;postgres&quot;</span>,</a>
<a class="sourceLine" id="cb230-10" data-line-number="10">  <span class="dt">password =</span> <span class="st">&quot;postgres&quot;</span>,</a>
<a class="sourceLine" id="cb230-11" data-line-number="11">  <span class="dt">dbname =</span> <span class="st">&quot;adventureworks&quot;</span></a>
<a class="sourceLine" id="cb230-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb230-13" data-line-number="13"></a>
<a class="sourceLine" id="cb230-14" data-line-number="14"><span class="kw">dbExecute</span>(con, <span class="st">&quot;set search_path to sales;&quot;</span>) <span class="co"># so that `dbListFields()` works</span></a></code></pre></div>
<pre><code>## [1] 0</code></pre>
</div>
<div id="the-role-of-database-views" class="section level2">
<h2><span class="header-section-number">11.2</span> The role of database <code>views</code></h2>
<p>A database <code>view</code> is an SQL query that is stored in the database. Most <code>views</code> are used for data retrieval, since they usually denormalize the tables involved. Because they are standardized and well-understood, they can save you a lot of work and document a query that can serve as a model to build on.</p>
<div id="why-database-views-are-useful" class="section level3">
<h3><span class="header-section-number">11.2.1</span> Why database <code>views</code> are useful</h3>
<p>Database <code>views</code> are useful for many reasons.</p>
<ul>
<li><strong>Authoritative</strong>: database <code>views</code> are typically written by the business application vendor or DBA, so they contain authoritative knowledge about the structure and intended use of the database.</li>
<li><strong>Performance</strong>: <code>views</code> are designed to gather data in an efficient way, using all the indexes in an efficient sequence and doing as much work on the database server as possible.</li>
<li><strong>Abstraction</strong>: <code>views</code> are abstractions or simplifications of complex queries that provide customary (useful) aggregations. Common examples would be monthly totals or aggregation of activity tied to one individual.</li>
<li><strong>Reuse</strong>: a <code>view</code> puts commonly used code in one place where it can be used for many purposes by many people. If there is a change or a problem found in a <code>view</code>, it only needs to be fixed in one place, rather than having to change many places downstream.</li>
<li><strong>Security</strong>: a view can give selective access to someone who does not have access to underlying tables or columns.</li>
<li><strong>Provenance</strong>: <code>views</code> standardize data provenance. For example, the <code>AdventureWorks</code> database all of them are named in a consistent way that suggests the underlying tables that they query. And they all start with a <strong>v</strong>.</li>
</ul>
<p>The bottom line is that <code>views</code> can save you a lot of work.</p>
</div>
<div id="rely-on-and-be-critical-of-views" class="section level3">
<h3><span class="header-section-number">11.2.2</span> Rely on – <strong>and</strong> be critical of – <code>views</code></h3>
<p>Because they represent a commonly used view of the database, it might seem like a <code>view</code> is always right. Even though they are conventional and authorized, they may still need verification or auditing, especially when used for a purpose other than the original intent. They can guide you toward what you need from the database but they could also mislead because they are easy to use and available. People may forget why a specific view exists and who is using it. Therefore any given view might be a forgotten vestige. part of a production data pipeline or a priceless nugget of insight. Who knows? Consider the <code>view</code>’s owner, schema, whether it’s a materialized index view or not, if it has a trigger and what the likely intention was behind the view.</p>
</div>
</div>
<div id="unpacking-the-elements-of-a-view-in-the-tidyverse" class="section level2">
<h2><span class="header-section-number">11.3</span> Unpacking the elements of a <code>view</code> in the Tidyverse</h2>
<p>Since a view is in some ways just like an ordinary table, we can use familiar tools in the same way as they are used on a database table. For example, the simplest way of getting a list of columns in a <code>view</code> is the same as it is for a regular table:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" data-line-number="1"><span class="kw">dbListFields</span>(con, <span class="st">&quot;vsalespersonsalesbyfiscalyearsdata&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;salespersonid&quot;  &quot;fullname&quot;       &quot;jobtitle&quot;       &quot;salesterritory&quot;
## [5] &quot;salestotal&quot;     &quot;fiscalyear&quot;</code></pre>
<div id="use-a-view-just-like-any-other-table" class="section level3">
<h3><span class="header-section-number">11.3.1</span> Use a <code>view</code> just like any other table</h3>
<p>From a retrieval perspective a database <code>view</code> is just like any other table. Using a view to retrieve data from the database will be completely standard across all flavors of SQL.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" data-line-number="1">v_salesperson_sales_by_fiscal_years_data &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb234-2" data-line-number="2"><span class="st">  </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>,<span class="st">&quot;vsalespersonsalesbyfiscalyearsdata&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb234-3" data-line-number="3"><span class="st">  </span><span class="kw">collect</span>()</a>
<a class="sourceLine" id="cb234-4" data-line-number="4"></a>
<a class="sourceLine" id="cb234-5" data-line-number="5"><span class="kw">str</span>(v_salesperson_sales_by_fiscal_years_data)</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    48 obs. of  6 variables:
##  $ salespersonid : int  275 275 275 275 276 276 276 276 277 277 ...
##  $ fullname      : chr  &quot;Michael G Blythe&quot; &quot;Michael G Blythe&quot; &quot;Michael G Blythe&quot; &quot;Michael G Blythe&quot; ...
##  $ jobtitle      : chr  &quot;Sales Representative&quot; &quot;Sales Representative&quot; &quot;Sales Representative&quot; &quot;Sales Representative&quot; ...
##  $ salesterritory: chr  &quot;Northeast&quot; &quot;Northeast&quot; &quot;Northeast&quot; &quot;Northeast&quot; ...
##  $ salestotal    : num  63763 2399593 3765459 3065088 5476 ...
##  $ fiscalyear    : num  2011 2012 2013 2014 2011 ...</code></pre>
<p>As we will see, our sample <code>view</code>, <code>vsalespersonsalesbyfiscalyearsdata</code> joins 5 different tables. We can assume that subsetting or calculation on any of the columns in the component tables will happen behind the scenes, on the database side, and done correctly. For example, the following query filters on a column that exists in only one of the <code>view</code>’s component tables.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" data-line-number="1"><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>,<span class="st">&quot;vsalespersonsalesbyfiscalyearsdata&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb236-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(salesterritory, fiscalyear) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb236-3" data-line-number="3"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># ---- pull data here ---- # </span></a>
<a class="sourceLine" id="cb236-4" data-line-number="4"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> fiscalyear, <span class="dt">values_from =</span> n, <span class="dt">names_prefix =</span> <span class="st">&quot;FY_&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 5
## # Groups:   salesterritory [10]
##    salesterritory FY_2014 FY_2011 FY_2013 FY_2012
##    &lt;chr&gt;            &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
##  1 Southwest            2       2       2       2
##  2 Northeast            1       1       1       1
##  3 Southeast            1       1       1       1
##  4 France               1      NA       1       1
##  5 Canada               2       2       2       2
##  6 United Kingdom       1      NA       1       1
##  7 Northwest            3       2       3       2
##  8 Central              1       1       1       1
##  9 Australia            1      NA       1      NA
## 10 Germany              1      NA       1      NA</code></pre>
<p>Although finding out what a view does behind the scenes requires that you use functions that are <strong>not</strong> standard, doing so has several general purposes:</p>
<ul>
<li>It is satisfying to know what’s going on behind the scenes.</li>
<li>Specific elements or components of a <code>view</code> might be worth plagiarizing or incorporating in our queries.</li>
<li>It is necessary to understand the mechanics of a <code>view</code> if we are going to build on what it does or intend to extend or modify it.</li>
</ul>
</div>
<div id="sql-source-code" class="section level3">
<h3><span class="header-section-number">11.3.2</span> SQL source code</h3>
<p>Functions for inspecting a view itself are not part of the ANSI standard, so they will be <a href="https://www.postgresql.org/docs/9.5/functions-info.html">database-specific</a>. Here is the code to retrieve a PostgreSQL view (using the <code>pg_get_viewdef</code> function):</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" data-line-number="1">view_definition &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con, <span class="st">&quot;select </span></a>
<a class="sourceLine" id="cb238-2" data-line-number="2"><span class="st">                   pg_get_viewdef(&#39;sales.vsalespersonsalesbyfiscalyearsdata&#39;, </span></a>
<a class="sourceLine" id="cb238-3" data-line-number="3"><span class="st">                   true)&quot;</span>)</a></code></pre></div>
<p>The PostgreSQL <code>pg_get_viewdef</code> function returns a data frame with one column named <code>pg_get_viewdef</code> and one row. To properly view its contents, the <code>\n</code> character strings need to be turned into new-lines.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">unlist</span>(view_definition<span class="op">$</span>pg_get_viewdef))</a></code></pre></div>
<pre><code>##  SELECT granular.salespersonid,
##     granular.fullname,
##     granular.jobtitle,
##     granular.salesterritory,
##     sum(granular.subtotal) AS salestotal,
##     granular.fiscalyear
##    FROM ( SELECT soh.salespersonid,
##             ((p.firstname::text || &#39; &#39;::text) || COALESCE(p.middlename::text || &#39; &#39;::text, &#39;&#39;::text)) || p.lastname::text AS fullname,
##             e.jobtitle,
##             st.name AS salesterritory,
##             soh.subtotal,
##             date_part(&#39;year&#39;::text, soh.orderdate + &#39;6 mons&#39;::interval) AS fiscalyear
##            FROM salesperson sp
##              JOIN salesorderheader soh ON sp.businessentityid = soh.salespersonid
##              JOIN salesterritory st ON sp.territoryid = st.territoryid
##              JOIN humanresources.employee e ON soh.salespersonid = e.businessentityid
##              JOIN person.person p ON p.businessentityid = sp.businessentityid) granular
##   GROUP BY granular.salespersonid, granular.fullname, granular.jobtitle, granular.salesterritory, granular.fiscalyear;</code></pre>
<p>Even if you don’t intend to become completely fluent in SQL, it’s useful to study as much of it as possible. Studying the SQL in a view is particularly useful to:</p>
<ul>
<li>Test your understanding of the database structure, elements, and usage</li>
<li>Extend what’s already been done to extract useful data from the database</li>
</ul>
</div>
<div id="the-erd-as-context-for-sql-code" class="section level3">
<h3><span class="header-section-number">11.3.3</span> The ERD as context for SQL code</h3>
<p>A database Entity Relationship Diagram (ERD) is very helpful in making sense of the SQL in a <code>view</code>. The ERD for <code>AdventureWorks</code> is <a href="https://i.stack.imgur.com/LMu4W.gif">here</a>. If a published ERD is not available, a tool like the PostgreSQL <em>pg_modeler</em> is capable of generating an ERD (or at least describing the portion of the database that is visible to you).</p>
</div>
<div id="selecting-relevant-tables-and-columns" class="section level3">
<h3><span class="header-section-number">11.3.4</span> Selecting relevant tables and columns</h3>
<p>Before bginning to write code, it can be helpful to actually mark up the ERD to identify the specific tables that are involved in the view you are going to reproduce.
<img src="screenshots/AW-2008-OLTP-ERD.gif" /></p>
<p>Define each table that is involved and identify the columns that will be needed from that table. The <code>sales.vsalespersonsalesbyfiscalyearsdata</code> view joins data from five different tables:</p>
<ol style="list-style-type: decimal">
<li>sales_order_header</li>
<li>sales_territory</li>
<li>sales_person</li>
<li>employee</li>
<li>person</li>
</ol>
<p>For each of the tables in the <code>view</code>, we select the columns that appear in the <code>sales.vsalespersonsalesbyfiscalyearsdata</code>. Selecting columns in this way prevents joins that <code>dbplyr</code> would make automatically based on common column names, such as <code>rowguid</code> and <code>ModifiedDate</code> columns, which appear in almost all <code>AdventureWorks</code> tables. In the following code we follow the convention that any column that we change or create on the fly uses a snake case naming convention.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb241-1" data-line-number="1">sales_order_header &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb241-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(orderdate, salespersonid, subtotal)</a>
<a class="sourceLine" id="cb241-3" data-line-number="3"></a>
<a class="sourceLine" id="cb241-4" data-line-number="4">sales_territory &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesterritory&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb241-5" data-line-number="5"><span class="st">    </span><span class="kw">select</span>(territoryid, <span class="dt">territory_name =</span> name) </a>
<a class="sourceLine" id="cb241-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb241-7" data-line-number="7">sales_person &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesperson&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb241-8" data-line-number="8"><span class="st">  </span><span class="kw">select</span>(businessentityid, territoryid) </a>
<a class="sourceLine" id="cb241-9" data-line-number="9"></a>
<a class="sourceLine" id="cb241-10" data-line-number="10">employee &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;humanresources&quot;</span>, <span class="st">&quot;employee&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb241-11" data-line-number="11"><span class="st">  </span><span class="kw">select</span>(businessentityid, jobtitle)</a></code></pre></div>
<p>In addition to selecting rows as shown in the previous statements, <code>mutate</code> and other functions help us replicate code in the <code>view</code> such as:</p>
<pre><code>((p.firstname::text || &#39; &#39;::text) ||
COALESCE(p.middlename::text || &#39; &#39;::text,
&#39;&#39;::text)) || p.lastname::text AS fullname</code></pre>
<p>The following dplyr code pastes the first, middle and last names together to make <code>full_name</code>:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb243-1" data-line-number="1">person &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;person&quot;</span>, <span class="st">&quot;person&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb243-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">full_name =</span> <span class="kw">paste</span>(firstname, middlename, lastname)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb243-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(businessentityid, full_name)</a></code></pre></div>
<p>Double-check on the names that are defined in each <code>tbl</code> object. The following function will show the names of columns in the tables we’ve defined:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" data-line-number="1">getnames &lt;-<span class="st"> </span><span class="cf">function</span>(table) {</a>
<a class="sourceLine" id="cb244-2" data-line-number="2">  {table} <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb244-3" data-line-number="3"><span class="st">    </span><span class="kw">collect</span>(<span class="dt">n =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># ---- pull data here ---- #</span></a>
<a class="sourceLine" id="cb244-4" data-line-number="4"><span class="st">    </span><span class="kw">names</span>()</a>
<a class="sourceLine" id="cb244-5" data-line-number="5">}</a></code></pre></div>
<p>Verify the names selected:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb245-1" data-line-number="1"><span class="kw">getnames</span>(sales_order_header)</a></code></pre></div>
<pre><code>## [1] &quot;orderdate&quot;     &quot;salespersonid&quot; &quot;subtotal&quot;</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb247-1" data-line-number="1"><span class="kw">getnames</span>(sales_territory)</a></code></pre></div>
<pre><code>## [1] &quot;territoryid&quot;    &quot;territory_name&quot;</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb249-1" data-line-number="1"><span class="kw">getnames</span>(sales_person)</a></code></pre></div>
<pre><code>## [1] &quot;businessentityid&quot; &quot;territoryid&quot;</code></pre>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" data-line-number="1"><span class="kw">getnames</span>(employee)</a></code></pre></div>
<pre><code>## [1] &quot;businessentityid&quot; &quot;jobtitle&quot;</code></pre>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" data-line-number="1"><span class="kw">getnames</span>(person)</a></code></pre></div>
<pre><code>## [1] &quot;businessentityid&quot; &quot;full_name&quot;</code></pre>
</div>
<div id="join-the-tables-together" class="section level3">
<h3><span class="header-section-number">11.3.5</span> Join the tables together</h3>
<p>First, join and download all of the data pertaining to a person. Notice that since each of these 4 tables contain <code>businessentityid</code>, dplyr will join them all on that common column automatically. And since we know that all of these tables are small, we don’t mind a query that joins and downloads all the data.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" data-line-number="1">salesperson_info &lt;-<span class="st"> </span>sales_person <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb255-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(employee) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb255-3" data-line-number="3"><span class="st">  </span><span class="kw">left_join</span>(person) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb255-4" data-line-number="4"><span class="st">  </span><span class="kw">left_join</span>(sales_territory) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb255-5" data-line-number="5"><span class="st">  </span><span class="kw">collect</span>()</a></code></pre></div>
<pre><code>## Joining, by = &quot;businessentityid&quot;
## Joining, by = &quot;businessentityid&quot;</code></pre>
<pre><code>## Joining, by = &quot;territoryid&quot;</code></pre>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb258-1" data-line-number="1"><span class="kw">str</span>(salesperson_info)</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    17 obs. of  5 variables:
##  $ businessentityid: int  274 275 276 277 278 279 280 281 282 283 ...
##  $ territoryid     : int  NA 2 4 3 6 5 1 4 6 1 ...
##  $ jobtitle        : chr  &quot;North American Sales Manager&quot; &quot;Sales Representative&quot; &quot;Sales Representative&quot; &quot;Sales Representative&quot; ...
##  $ full_name       : chr  &quot;Stephen Y Jiang&quot; &quot;Michael G Blythe&quot; &quot;Linda C Mitchell&quot; &quot;Jillian Carson&quot; ...
##  $ territory_name  : chr  NA &quot;Northeast&quot; &quot;Southwest&quot; &quot;Central&quot; ...</code></pre>
<p>The one part of the view that we haven’t replicated is:</p>
<p><code>date_part('year'::text, soh.orderdate</code>
<code>+ '6 mons'::interval) AS fiscalyear</code></p>
<p>The <code>lubridate</code> package makes it very easy to convert <code>orderdate</code> to <code>fiscal_year</code>. Doing that same conversion without lubridate (e.g., only dplyr and <strong>ANSI-STANDARD</strong> SQL) is harder. Therefore we just pull the data from the server after the <code>left_join</code> and do the rest of the job on the R side. Note that this query doesn’t correct the problematic entry dates that we explored in the chapter on <a href="chapter-exploring-a-single-table.html#chapter_exploring-a-single-table">Asking Business Questions From a Single Table</a>. That will collapse many rows into a much smaller table. We know from our previous investigation that Sales Rep into sales are recorded more or less once a month. Therefore most of the crunching in this query happens on the database server side.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" data-line-number="1">sales_data_fiscal_year &lt;-<span class="st"> </span>sales_person <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb260-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(sales_order_header, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;businessentityid&quot;</span> =<span class="st"> &quot;salespersonid&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb260-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(businessentityid, orderdate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb260-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">sales_total =</span> <span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb260-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb260-6" data-line-number="6">    <span class="dt">orderdate =</span> <span class="kw">as.Date</span>(orderdate),</a>
<a class="sourceLine" id="cb260-7" data-line-number="7">    <span class="dt">day =</span> <span class="kw">day</span>(orderdate)</a>
<a class="sourceLine" id="cb260-8" data-line-number="8">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb260-9" data-line-number="9"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># ---- pull data here ---- #</span></a>
<a class="sourceLine" id="cb260-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb260-11" data-line-number="11">    <span class="dt">fiscal_year =</span> <span class="kw">year</span>(orderdate <span class="op">%m+%</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">6</span>))</a>
<a class="sourceLine" id="cb260-12" data-line-number="12">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb260-13" data-line-number="13"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb260-14" data-line-number="14"><span class="st">  </span><span class="kw">group_by</span>(businessentityid, fiscal_year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb260-15" data-line-number="15"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">sales_total =</span> <span class="kw">sum</span>(sales_total, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb260-16" data-line-number="16"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<p>Put the two parts together: <code>sales_data_fiscal_year</code> and <code>person_info</code> to yield the final query.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" data-line-number="1">salesperson_sales_by_fiscal_years_dplyr &lt;-<span class="st"> </span>sales_data_fiscal_year <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(salesperson_info) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(territoryid))</a></code></pre></div>
<pre><code>## Joining, by = &quot;businessentityid&quot;</code></pre>
<p>Notice that we’re dropping the Sales Managers who appear in the <code>salesperson_info</code> data frame because they don’t have a <code>territoryid</code>.</p>
</div>
</div>
<div id="compare-the-official-view-and-the-dplyr-output" class="section level2">
<h2><span class="header-section-number">11.4</span> Compare the official view and the dplyr output</h2>
<p>Use <code>pivot_wider</code> to make it easier to compare the native <code>view</code> to our dplyr replicate.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" data-line-number="1">salesperson_sales_by_fiscal_years_dplyr <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb263-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>jobtitle, <span class="op">-</span>businessentityid, <span class="op">-</span>territoryid) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb263-3" data-line-number="3"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> fiscal_year, <span class="dt">values_from =</span> sales_total,</a>
<a class="sourceLine" id="cb263-4" data-line-number="4">              <span class="dt">values_fill =</span> <span class="kw">list</span>(<span class="dt">sales_total =</span> <span class="dv">0</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb263-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(territory_name, full_name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb263-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(territory_name <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   full_name            territory_name  `2011`   `2012`   `2013`   `2014`
##   &lt;chr&gt;                &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 Garrett R Vargas     Canada           9109. 1254087. 1179531. 1166720.
## 2 José Edvaldo Saraiva Canada         106252. 2171995. 1388793. 2259378.</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" data-line-number="1">v_salesperson_sales_by_fiscal_years_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb265-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>jobtitle, <span class="op">-</span>salespersonid) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb265-3" data-line-number="3"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> fiscalyear, <span class="dt">values_from =</span> salestotal,</a>
<a class="sourceLine" id="cb265-4" data-line-number="4">              <span class="dt">values_fill =</span> <span class="kw">list</span>(<span class="dt">salestotal =</span> <span class="dv">0</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb265-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(salesterritory, fullname) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb265-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(salesterritory <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   fullname             salesterritory  `2011`   `2012`   `2013`   `2014`
##   &lt;chr&gt;                &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 Garrett R Vargas     Canada           9109. 1254087. 1179531. 1166720.
## 2 José Edvaldo Saraiva Canada         106252. 2171995. 1388793. 2259378.</code></pre>
<p>The yearly totals match exactly. The column names don’t match up, because we are using snake case convention for derived elements.</p>
</div>
<div id="revise-the-view-to-summarize-by-quarter-not-fiscal-year" class="section level2">
<h2><span class="header-section-number">11.5</span> Revise the view to summarize by quarter not fiscal year</h2>
<p>To summarize sales data by SAles Rep and quarter requires the <code>%m+%</code> infix operator from lubridate. The interleaved comments in the query below has hints that explain it. The totals in this revised query are off by a rounding error from the totals shown above in the fiscal year summaries.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" data-line-number="1"><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb267-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(salespersonid, orderdate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb267-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">subtotal =</span> <span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">digits =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb267-4" data-line-number="4"><span class="st">  </span></a>
<a class="sourceLine" id="cb267-5" data-line-number="5"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># ---- pull data here ---- #</span></a>
<a class="sourceLine" id="cb267-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb267-7" data-line-number="7"><span class="st">  </span><span class="co"># Adding 6 months to orderdate requires a lubridate function</span></a>
<a class="sourceLine" id="cb267-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">orderdate =</span> <span class="kw">as.Date</span>(orderdate) <span class="op">%m+%</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">6</span>), </a>
<a class="sourceLine" id="cb267-9" data-line-number="9">         <span class="dt">year =</span> <span class="kw">year</span>(orderdate),</a>
<a class="sourceLine" id="cb267-10" data-line-number="10">         <span class="dt">quarter =</span> <span class="kw">quarter</span>(orderdate)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb267-11" data-line-number="11"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb267-12" data-line-number="12"><span class="st">  </span><span class="kw">group_by</span>(salespersonid, year, quarter) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb267-13" data-line-number="13"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">subtotal =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">digits =</span> <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb267-14" data-line-number="14"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb267-15" data-line-number="15"><span class="st">  </span></a>
<a class="sourceLine" id="cb267-16" data-line-number="16"><span class="st">  </span><span class="co"># Join with the person information previously gathered</span></a>
<a class="sourceLine" id="cb267-17" data-line-number="17"><span class="st">  </span><span class="kw">left_join</span>(salesperson_info, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;salespersonid&quot;</span> =<span class="st"> &quot;businessentityid&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb267-18" data-line-number="18"><span class="st">  </span><span class="kw">filter</span>(territory_name <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb267-19" data-line-number="19"><span class="st">  </span></a>
<a class="sourceLine" id="cb267-20" data-line-number="20"><span class="st">  </span><span class="co"># Pivot to make it easier to see what&#39;s going on</span></a>
<a class="sourceLine" id="cb267-21" data-line-number="21"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> quarter, <span class="dt">values_from =</span> subtotal,</a>
<a class="sourceLine" id="cb267-22" data-line-number="22">              <span class="dt">values_fill =</span> <span class="kw">list</span>(<span class="dt">Q1 =</span> <span class="dv">0</span>, <span class="dt">Q2 =</span> <span class="dv">0</span>, <span class="dt">Q3 =</span> <span class="dv">0</span>, <span class="dt">Q4 =</span> <span class="dv">0</span>), <span class="dt">names_prefix =</span> <span class="st">&quot;Q&quot;</span>, <span class="dt">id_cols =</span> full_name<span class="op">:</span>year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb267-23" data-line-number="23"><span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">Name</span><span class="st">`</span> =<span class="st"> </span>full_name, year, Q1, Q2, Q3, Q4) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb267-24" data-line-number="24"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Year Total</span><span class="st">`</span> =<span class="st"> </span>Q1 <span class="op">+</span><span class="st"> </span>Q2 <span class="op">+</span><span class="st"> </span>Q3 <span class="op">+</span><span class="st"> </span>Q4) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb267-25" data-line-number="25"><span class="st">  </span><span class="kw">head</span>(., <span class="dt">n =</span> <span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb267-26" data-line-number="26"><span class="st">  </span><span class="kw">gt</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb267-27" data-line-number="27"><span class="st">  </span><span class="kw">fmt_number</span>(<span class="dt">use_seps =</span> <span class="ot">TRUE</span>, <span class="dt">decimals =</span> <span class="dv">0</span>, <span class="dt">columns =</span> <span class="kw">vars</span>(Q1,Q2, Q3, Q4, <span class="st">`</span><span class="dt">Year Total</span><span class="st">`</span>))</a></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#pzveloiefp .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  /* table.margin.left */
  margin-right: auto;
  /* table.margin.right */
  color: #333333;
  font-size: 16px;
  /* table.font.size */
  background-color: #FFFFFF;
  /* table.background.color */
  width: auto;
  /* table.width */
  border-top-style: solid;
  /* table.border.top.style */
  border-top-width: 2px;
  /* table.border.top.width */
  border-top-color: #A8A8A8;
  /* table.border.top.color */
  border-bottom-style: solid;
  /* table.border.bottom.style */
  border-bottom-width: 2px;
  /* table.border.bottom.width */
  border-bottom-color: #A8A8A8;
  /* table.border.bottom.color */
}

#pzveloiefp .gt_heading {
  background-color: #FFFFFF;
  /* heading.background.color */
  border-bottom-color: #FFFFFF;
  /* table.background.color */
  border-left-style: hidden;
  /* heading.border.lr.style */
  border-left-width: 1px;
  /* heading.border.lr.width */
  border-left-color: #D3D3D3;
  /* heading.border.lr.color */
  border-right-style: hidden;
  /* heading.border.lr.style */
  border-right-width: 1px;
  /* heading.border.lr.width */
  border-right-color: #D3D3D3;
  /* heading.border.lr.color */
}

#pzveloiefp .gt_title {
  color: #333333;
  font-size: 125%;
  /* heading.title.font.size */
  font-weight: initial;
  /* heading.title.font.weight */
  padding-top: 4px;
  /* heading.top.padding - not yet used */
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  /* table.background.color */
  border-bottom-width: 0;
}

#pzveloiefp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  /* heading.subtitle.font.size */
  font-weight: initial;
  /* heading.subtitle.font.weight */
  padding-top: 0;
  padding-bottom: 4px;
  /* heading.bottom.padding - not yet used */
  border-top-color: #FFFFFF;
  /* table.background.color */
  border-top-width: 0;
}

#pzveloiefp .gt_bottom_border {
  border-bottom-style: solid;
  /* heading.border.bottom.style */
  border-bottom-width: 2px;
  /* heading.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* heading.border.bottom.color */
}

#pzveloiefp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  padding-top: 4px;
  padding-bottom: 4px;
}

#pzveloiefp .gt_col_headings {
  border-top-style: solid;
  /* column_labels.border.top.style */
  border-top-width: 2px;
  /* column_labels.border.top.width */
  border-top-color: #D3D3D3;
  /* column_labels.border.top.color */
  border-bottom-style: solid;
  /* column_labels.border.bottom.style */
  border-bottom-width: 2px;
  /* column_labels.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* column_labels.border.bottom.color */
  border-left-style: none;
  /* column_labels.border.lr.style */
  border-left-width: 1px;
  /* column_labels.border.lr.width */
  border-left-color: #D3D3D3;
  /* column_labels.border.lr.color */
  border-right-style: none;
  /* column_labels.border.lr.style */
  border-right-width: 1px;
  /* column_labels.border.lr.width */
  border-right-color: #D3D3D3;
  /* column_labels.border.lr.color */
}

#pzveloiefp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  /* column_labels.background.color */
  font-size: 100%;
  /* column_labels.font.size */
  font-weight: initial;
  /* column_labels.font.weight */
  text-transform: inherit;
  /* column_labels.text_transform */
  vertical-align: middle;
  padding: 5px;
  margin: 10px;
  overflow-x: hidden;
}

#pzveloiefp .gt_sep_right {
  border-right: 5px solid #FFFFFF;
}

#pzveloiefp .gt_group_heading {
  padding: 8px;
  /* row_group.padding */
  color: #333333;
  background-color: #FFFFFF;
  /* row_group.background.color */
  font-size: 100%;
  /* row_group.font.size */
  font-weight: initial;
  /* row_group.font.weight */
  text-transform: inherit;
  /* row_group.text_transform */
  border-top-style: solid;
  /* row_group.border.top.style */
  border-top-width: 2px;
  /* row_group.border.top.width */
  border-top-color: #D3D3D3;
  /* row_group.border.top.color */
  border-bottom-style: solid;
  /* row_group.border.bottom.style */
  border-bottom-width: 2px;
  /* row_group.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* row_group.border.bottom.color */
  border-left-style: none;
  /* row_group.border.left.style */
  border-left-width: 1px;
  /* row_group.border.left.width */
  border-left-color: #D3D3D3;
  /* row_group.border.left.color */
  border-right-style: none;
  /* row_group.border.right.style */
  border-right-width: 1px;
  /* row_group.border.right.width */
  border-right-color: #D3D3D3;
  /* row_group.border.right.color */
  vertical-align: middle;
}

#pzveloiefp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  /* row_group.background.color */
  font-size: 100%;
  /* row_group.font.size */
  font-weight: initial;
  /* row_group.font.weight */
  border-top-style: solid;
  /* row_group.border.top.style */
  border-top-width: 2px;
  /* row_group.border.top.width */
  border-top-color: #D3D3D3;
  /* row_group.border.top.color */
  border-bottom-style: solid;
  /* row_group.border.bottom.style */
  border-bottom-width: 2px;
  /* row_group.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* row_group.border.bottom.color */
  vertical-align: middle;
}

#pzveloiefp .gt_striped {
  background-color: #8080800D;
  /* row.striping.background_color */
}

#pzveloiefp .gt_from_md > :first-child {
  margin-top: 0;
}

#pzveloiefp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pzveloiefp .gt_row {
  padding-top: 8px;
  /* data_row.padding */
  padding-bottom: 8px;
  /* data_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  /* table_body.hlines.style */
  border-top-width: 1px;
  /* table_body.hlines.width */
  border-top-color: #D3D3D3;
  /* table_body.hlines.color */
  border-left-style: none;
  /* table_body.vlines.style */
  border-left-width: 1px;
  /* table_body.vlines.width */
  border-left-color: #D3D3D3;
  /* table_body.vlines.color */
  border-right-style: none;
  /* table_body.vlines.style */
  border-right-width: 1px;
  /* table_body.vlines.width */
  border-right-color: #D3D3D3;
  /* table_body.vlines.color */
  vertical-align: middle;
  overflow-x: hidden;
}

#pzveloiefp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  /* stub.background.color */
  font-weight: initial;
  /* stub.font.weight */
  text-transform: inherit;
  /* stub.text_transform */
  border-right-style: solid;
  /* stub.border.style */
  border-right-width: 2px;
  /* stub.border.width */
  border-right-color: #D3D3D3;
  /* stub.border.color */
  padding-left: 12px;
}

#pzveloiefp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  /* summary_row.background.color */
  text-transform: inherit;
  /* summary_row.text_transform */
  padding-top: 8px;
  /* summary_row.padding */
  padding-bottom: 8px;
  /* summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
}

#pzveloiefp .gt_first_summary_row {
  padding-top: 8px;
  /* summary_row.padding */
  padding-bottom: 8px;
  /* summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  /* summary_row.border.style */
  border-top-width: 2px;
  /* summary_row.border.width */
  border-top-color: #D3D3D3;
  /* summary_row.border.color */
}

#pzveloiefp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  /* grand_summary_row.background.color */
  text-transform: inherit;
  /* grand_summary_row.text_transform */
  padding-top: 8px;
  /* grand_summary_row.padding */
  padding-bottom: 8px;
  /* grand_summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
}

#pzveloiefp .gt_first_grand_summary_row {
  padding-top: 8px;
  /* grand_summary_row.padding */
  padding-bottom: 8px;
  /* grand_summary_row.padding */
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  /* grand_summary_row.border.style */
  border-top-width: 6px;
  /* grand_summary_row.border.width */
  border-top-color: #D3D3D3;
  /* grand_summary_row.border.color */
}

#pzveloiefp .gt_table_body {
  border-top-style: solid;
  /* table_body.border.top.style */
  border-top-width: 2px;
  /* table_body.border.top.width */
  border-top-color: #D3D3D3;
  /* table_body.border.top.color */
  border-bottom-style: solid;
  /* table_body.border.bottom.style */
  border-bottom-width: 2px;
  /* table_body.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* table_body.border.bottom.color */
}

#pzveloiefp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  /* footnotes.background.color */
  border-bottom-style: none;
  /* footnotes.border.bottom.style */
  border-bottom-width: 2px;
  /* footnotes.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* footnotes.border.bottom.color */
  border-left-style: none;
  /* footnotes.border.lr.color */
  border-left-width: 2px;
  /* footnotes.border.lr.color */
  border-left-color: #D3D3D3;
  /* footnotes.border.lr.color */
  border-right-style: none;
  /* footnotes.border.lr.color */
  border-right-width: 2px;
  /* footnotes.border.lr.color */
  border-right-color: #D3D3D3;
  /* footnotes.border.lr.color */
}

#pzveloiefp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  /* footnotes.font.size */
  padding: 4px;
  /* footnotes.padding */
}

#pzveloiefp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  /* source_notes.background.color */
  border-bottom-style: none;
  /* source_notes.border.bottom.style */
  border-bottom-width: 2px;
  /* source_notes.border.bottom.width */
  border-bottom-color: #D3D3D3;
  /* source_notes.border.bottom.color */
  border-left-style: none;
  /* source_notes.border.lr.style */
  border-left-width: 2px;
  /* source_notes.border.lr.style */
  border-left-color: #D3D3D3;
  /* source_notes.border.lr.style */
  border-right-style: none;
  /* source_notes.border.lr.style */
  border-right-width: 2px;
  /* source_notes.border.lr.style */
  border-right-color: #D3D3D3;
  /* source_notes.border.lr.style */
}

#pzveloiefp .gt_sourcenote {
  font-size: 90%;
  /* source_notes.font.size */
  padding: 4px;
  /* source_notes.padding */
}

#pzveloiefp .gt_left {
  text-align: left;
}

#pzveloiefp .gt_center {
  text-align: center;
}

#pzveloiefp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pzveloiefp .gt_font_normal {
  font-weight: normal;
}

#pzveloiefp .gt_font_bold {
  font-weight: bold;
}

#pzveloiefp .gt_font_italic {
  font-style: italic;
}

#pzveloiefp .gt_super {
  font-size: 65%;
}

#pzveloiefp .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="pzveloiefp" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">year</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Q1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Q2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Q3</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Q4</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Year Total</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Garrett R Vargas</td>
      <td class="gt_row gt_right">2011</td>
      <td class="gt_row gt_right">NA</td>
      <td class="gt_row gt_right">NA</td>
      <td class="gt_row gt_right">NA</td>
      <td class="gt_row gt_right">9,109</td>
      <td class="gt_row gt_right">NA</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Garrett R Vargas</td>
      <td class="gt_row gt_right gt_striped">2012</td>
      <td class="gt_row gt_right gt_striped">233,696</td>
      <td class="gt_row gt_right gt_striped">257,287</td>
      <td class="gt_row gt_right gt_striped">410,518</td>
      <td class="gt_row gt_right gt_striped">352,587</td>
      <td class="gt_row gt_right gt_striped">1,254,088</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Garrett R Vargas</td>
      <td class="gt_row gt_right">2013</td>
      <td class="gt_row gt_right">316,818</td>
      <td class="gt_row gt_right">203,647</td>
      <td class="gt_row gt_right">291,333</td>
      <td class="gt_row gt_right">367,732</td>
      <td class="gt_row gt_right">1,179,530</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">Garrett R Vargas</td>
      <td class="gt_row gt_right gt_striped">2014</td>
      <td class="gt_row gt_right gt_striped">393,788</td>
      <td class="gt_row gt_right gt_striped">336,984</td>
      <td class="gt_row gt_right gt_striped">290,536</td>
      <td class="gt_row gt_right gt_striped">145,413</td>
      <td class="gt_row gt_right gt_striped">1,166,721</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">José Edvaldo Saraiva</td>
      <td class="gt_row gt_right">2011</td>
      <td class="gt_row gt_right">NA</td>
      <td class="gt_row gt_right">NA</td>
      <td class="gt_row gt_right">NA</td>
      <td class="gt_row gt_right">106,252</td>
      <td class="gt_row gt_right">NA</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">José Edvaldo Saraiva</td>
      <td class="gt_row gt_right gt_striped">2012</td>
      <td class="gt_row gt_right gt_striped">521,794</td>
      <td class="gt_row gt_right gt_striped">546,962</td>
      <td class="gt_row gt_right gt_striped">795,861</td>
      <td class="gt_row gt_right gt_striped">307,379</td>
      <td class="gt_row gt_right gt_striped">2,171,996</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">José Edvaldo Saraiva</td>
      <td class="gt_row gt_right">2013</td>
      <td class="gt_row gt_right">408,415</td>
      <td class="gt_row gt_right">324,062</td>
      <td class="gt_row gt_right">231,991</td>
      <td class="gt_row gt_right">424,326</td>
      <td class="gt_row gt_right">1,388,794</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">José Edvaldo Saraiva</td>
      <td class="gt_row gt_right gt_striped">2014</td>
      <td class="gt_row gt_right gt_striped">748,430</td>
      <td class="gt_row gt_right gt_striped">466,137</td>
      <td class="gt_row gt_right gt_striped">618,832</td>
      <td class="gt_row gt_right gt_striped">425,979</td>
      <td class="gt_row gt_right gt_striped">2,259,378</td>
    </tr>
  </tbody>
  
  
</table></div>
</div>
<div id="clean-up-and-close-down" class="section level2">
<h2><span class="header-section-number">11.6</span> Clean up and close down</h2>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" data-line-number="1"><span class="kw">connection_close</span>(con) <span class="co"># Use in an interactive setting</span></a>
<a class="sourceLine" id="cb268-2" data-line-number="2"><span class="co"># dbDisconnect(con)     # Use in non-interactive setting</span></a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-lazy-evaluation-and-timing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-postgresql-metadata.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/smithjd/sql-pet/edit/master/098-leveraging-database-views.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
