<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Exploring a Single Table (with a Business Perspective) | r-database-docker.utf8</title>
  <meta name="description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Exploring a Single Table (with a Business Perspective) | r-database-docker.utf8" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Exploring a Single Table (with a Business Perspective) | r-database-docker.utf8" />
  
  <meta name="twitter:description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  

<meta name="author" content="John David Smith, Sophie Yang, M. Edward (Ed) Borasky, Jim Tyhurst, Scott Came, Mary Anne Thygesen, and Ian Frantz" />


<meta name="date" content="2019-09-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-dbms-queries-intro.html">
<link rel="next" href="close-and-clean-up.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.8/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R, Databases and Docker</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#using-r-to-query-a-dbms-in-your-organization"><i class="fa fa-check"></i><b>1.1</b> Using R to query a DBMS in your organization</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#docker-as-a-tool-for-users"><i class="fa fa-check"></i><b>1.2</b> Docker as a tool for UseRs</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#alternatives-to-docker"><i class="fa fa-check"></i><b>1.3</b> Alternatives to Docker</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#packages-used-in-this-book"><i class="fa fa-check"></i><b>1.4</b> Packages used in this book</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#who-are-we"><i class="fa fa-check"></i><b>1.5</b> Who are we?</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#how-did-this-project-come-about"><i class="fa fa-check"></i><b>1.6</b> How did this project come about?</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#navigation"><i class="fa fa-check"></i><b>1.7</b> Navigation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html"><i class="fa fa-check"></i><b>2</b> How to use this book</a><ul>
<li class="chapter" data-level="2.1" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#retrieve-the-code-from-github"><i class="fa fa-check"></i><b>2.1</b> Retrieve the code from GitHub</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#read-along-experiment-as-you-go"><i class="fa fa-check"></i><b>2.2</b> Read along, experiment as you go</a></li>
<li class="chapter" data-level="2.3" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#participating"><i class="fa fa-check"></i><b>2.3</b> Participating</a><ul>
<li class="chapter" data-level="2.3.1" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#browsing-the-book"><i class="fa fa-check"></i><b>2.3.1</b> Browsing the book</a></li>
<li class="chapter" data-level="2.3.2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#diving-in"><i class="fa fa-check"></i><b>2.3.2</b> Diving in</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html"><i class="fa fa-check"></i><b>3</b> Learning Goals and Use Cases</a><ul>
<li class="chapter" data-level="3.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#challenge-goals-context-and-expectations"><i class="fa fa-check"></i><b>3.1</b> Challenge: goals, context and expectations</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#the-challenge-investigating-a-question-using-an-organizations-database"><i class="fa fa-check"></i><b>3.2</b> The Challenge: Investigating a question using an organization’s database</a><ul>
<li class="chapter" data-level="3.2.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#problems-that-we-address-in-the-book"><i class="fa fa-check"></i><b>3.2.1</b> Problems that we address in the book</a></li>
<li class="chapter" data-level="3.2.2" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#book-structure"><i class="fa fa-check"></i><b>3.2.2</b> Book structure</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#making-your-way-through-the-book"><i class="fa fa-check"></i><b>3.3</b> Making your way through the book</a><ul>
<li class="chapter" data-level="3.3.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#r-packages"><i class="fa fa-check"></i><b>3.3.1</b> R Packages</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#adventure-works"><i class="fa fa-check"></i><b>3.4</b> Adventure Works</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html"><i class="fa fa-check"></i><b>4</b> Create and connect to the adventureworks database in PostgreSQL</a><ul>
<li class="chapter" data-level="4.1" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#verify-that-docker-is-up-running-and-clean-up-if-necessary"><i class="fa fa-check"></i><b>4.2</b> Verify that Docker is up, running, and clean up if necessary</a></li>
<li class="chapter" data-level="4.3" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#clean-up-if-appropriate"><i class="fa fa-check"></i><b>4.3</b> Clean up if appropriate</a></li>
<li class="chapter" data-level="4.4" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#build-the-adventureworks-docker-image"><i class="fa fa-check"></i><b>4.4</b> Build the adventureworks Docker image</a></li>
<li class="chapter" data-level="4.5" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#run-the-adventureworks-docker-image"><i class="fa fa-check"></i><b>4.5</b> Run the adventureworks Docker Image</a></li>
<li class="chapter" data-level="4.6" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#connect-to-postgresql"><i class="fa fa-check"></i><b>4.6</b> Connect to PostgreSQL</a></li>
<li class="chapter" data-level="4.7" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#adventureworks-schemas"><i class="fa fa-check"></i><b>4.7</b> Adventureworks Schemas</a></li>
<li class="chapter" data-level="4.8" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#investigate-the-database-using-rstudio"><i class="fa fa-check"></i><b>4.8</b> Investigate the database using Rstudio</a></li>
<li class="chapter" data-level="4.9" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#cleaning-up"><i class="fa fa-check"></i><b>4.9</b> Cleaning up</a></li>
<li class="chapter" data-level="4.10" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#using-the-adventureworks-container-in-the-rest-of-the-book"><i class="fa fa-check"></i><b>4.10</b> Using the <code>adventureworks</code> container in the rest of the book</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html"><i class="fa fa-check"></i><b>5</b> Securing and using your dbms log-in credentials</a><ul>
<li class="chapter" data-level="5.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#set-up-the-adventureworks-docker-container"><i class="fa fa-check"></i><b>5.1</b> Set up the adventureworks Docker container</a><ul>
<li class="chapter" data-level="5.1.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#verify-that-docker-is-running"><i class="fa fa-check"></i><b>5.1.1</b> Verify that Docker is running</a></li>
<li class="chapter" data-level="5.1.2" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#start-the-docker-container"><i class="fa fa-check"></i><b>5.1.2</b> Start the Docker container:</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#storing-your-dbms-credentials"><i class="fa fa-check"></i><b>5.2</b> Storing your dbms credentials</a><ul>
<li class="chapter" data-level="5.2.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#connect-with-postgres-using-the-sys.getenv-function"><i class="fa fa-check"></i><b>5.2.1</b> Connect with Postgres using the Sys.getenv function</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#clean-up"><i class="fa fa-check"></i><b>5.3</b> Clean up</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter-connect-to-adventureworks-db.html"><a href="chapter-connect-to-adventureworks-db.html"><i class="fa fa-check"></i><b>6</b> Connect to the adventureworks database in PostgreSQL</a><ul>
<li class="chapter" data-level="6.1" data-path="chapter-connect-to-adventureworks-db.html"><a href="chapter-connect-to-adventureworks-db.html#overview-1"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-connect-to-adventureworks-db.html"><a href="chapter-connect-to-adventureworks-db.html#verify-that-docker-is-up-running-and-clean-up-if-necessary-1"><i class="fa fa-check"></i><b>6.2</b> Verify that Docker is up, running, and clean up if necessary</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-connect-to-adventureworks-db.html"><a href="chapter-connect-to-adventureworks-db.html#connect-to-postgresql-again"><i class="fa fa-check"></i><b>6.3</b> Connect to PostgreSQL again</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-connect-to-adventureworks-db.html"><a href="chapter-connect-to-adventureworks-db.html#dplyr-connection-objects"><i class="fa fa-check"></i><b>6.4</b> <code>dplyr</code> connection objects</a></li>
<li class="chapter" data-level="6.5" data-path="chapter-connect-to-adventureworks-db.html"><a href="chapter-connect-to-adventureworks-db.html#cleaning-up-1"><i class="fa fa-check"></i><b>6.5</b> Cleaning up</a></li>
<li class="chapter" data-level="6.6" data-path="chapter-connect-to-adventureworks-db.html"><a href="chapter-connect-to-adventureworks-db.html#using-the-adventureworks-container-in-the-rest-of-the-book-1"><i class="fa fa-check"></i><b>6.6</b> Using the <code>adventureworks</code> container in the rest of the book</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-database-exploration.html"><a href="chapter-database-exploration.html"><i class="fa fa-check"></i><b>7</b> Exploring a database</a><ul>
<li class="chapter" data-level="7.1" data-path="chapter-database-exploration.html"><a href="chapter-database-exploration.html#setup"><i class="fa fa-check"></i><b>7.1</b> Setup</a></li>
<li class="chapter" data-level="7.2" data-path="chapter-database-exploration.html"><a href="chapter-database-exploration.html#getting-data-from-the-database"><i class="fa fa-check"></i><b>7.2</b> Getting data from the database</a><ul>
<li class="chapter" data-level="7.2.1" data-path="chapter-database-exploration.html"><a href="chapter-database-exploration.html#finding-out-whats-there"><i class="fa fa-check"></i><b>7.2.1</b> Finding out what’s there</a></li>
<li class="chapter" data-level="7.2.2" data-path="chapter-database-exploration.html"><a href="chapter-database-exploration.html#listing-all-the-fields-for-all-the-tables"><i class="fa fa-check"></i><b>7.2.2</b> Listing all the fields for all the tables</a></li>
<li class="chapter" data-level="7.2.3" data-path="chapter-database-exploration.html"><a href="chapter-database-exploration.html#a-table-object-that-can-be-reused"><i class="fa fa-check"></i><b>7.2.3</b> A table object that can be reused</a></li>
<li class="chapter" data-level="7.2.4" data-path="chapter-database-exploration.html"><a href="chapter-database-exploration.html#table-links-for-queries"><i class="fa fa-check"></i><b>7.2.4</b> Table links for queries</a></li>
<li class="chapter" data-level="7.2.5" data-path="chapter-database-exploration.html"><a href="chapter-database-exploration.html#close-the-connection-and-shut-down-adventureworks"><i class="fa fa-check"></i><b>7.2.5</b> Close the connection and shut down adventureworks</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chapter-database-exploration.html"><a href="chapter-database-exploration.html#additional-reading"><i class="fa fa-check"></i><b>7.3</b> Additional reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html"><i class="fa fa-check"></i><b>8</b> Introduction to DBMS queries</a><ul>
<li class="chapter" data-level="8.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#setup-1"><i class="fa fa-check"></i><b>8.1</b> Setup</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#downloading-a-single-table"><i class="fa fa-check"></i><b>8.2</b> Downloading a single table</a><ul>
<li class="chapter" data-level="8.2.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#downloading-the-entire-table"><i class="fa fa-check"></i><b>8.2.1</b> Downloading the entire table</a></li>
<li class="chapter" data-level="8.2.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#a-table-object-that-can-be-reused-1"><i class="fa fa-check"></i><b>8.2.2</b> A table <em>object</em> that can be reused</a></li>
<li class="chapter" data-level="8.2.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#controlling-the-number-of-rows-returned"><i class="fa fa-check"></i><b>8.2.3</b> Controlling the number of rows returned</a></li>
<li class="chapter" data-level="8.2.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#random-rows-from-the-dbms"><i class="fa fa-check"></i><b>8.2.4</b> Random rows from the dbms</a></li>
<li class="chapter" data-level="8.2.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#sub-setting-variables"><i class="fa fa-check"></i><b>8.2.5</b> Sub-setting variables</a></li>
<li class="chapter" data-level="8.2.6" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#translating-dplyr-code-to-sql-queries"><i class="fa fa-check"></i><b>8.2.6</b> Translating <code>dplyr</code> code to <code>SQL</code> queries</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#mixing-dplyr-and-sql"><i class="fa fa-check"></i><b>8.3</b> Mixing dplyr and SQL</a></li>
<li class="chapter" data-level="8.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#examining-a-single-table-with-r"><i class="fa fa-check"></i><b>8.4</b> Examining a single table with R</a><ul>
<li class="chapter" data-level="8.4.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#str---a-base-package-workhorse"><i class="fa fa-check"></i><b>8.4.1</b> <code>str</code> - a base package workhorse</a></li>
<li class="chapter" data-level="8.4.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#always-look-at-your-data-with-head-view-or-kable"><i class="fa fa-check"></i><b>8.4.2</b> Always <strong>look</strong> at your data with <code>head</code>, <code>View</code>, or <code>kable</code></a></li>
<li class="chapter" data-level="8.4.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-summary-function-in-base"><i class="fa fa-check"></i><b>8.4.3</b> The <code>summary</code> function in <code>base</code></a></li>
<li class="chapter" data-level="8.4.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-glimpse-function-in-the-tibble-package"><i class="fa fa-check"></i><b>8.4.4</b> The <code>glimpse</code> function in the <code>tibble</code> package</a></li>
<li class="chapter" data-level="8.4.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-skim-function-in-the-skimr-package"><i class="fa fa-check"></i><b>8.4.5</b> The <code>skim</code> function in the <code>skimr</code> package</a></li>
<li class="chapter" data-level="8.4.6" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#close-the-connection-and-shut-down-adventureworks-1"><i class="fa fa-check"></i><b>8.4.6</b> Close the connection and shut down adventureworks</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#additional-reading-1"><i class="fa fa-check"></i><b>8.5</b> Additional reading</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html"><i class="fa fa-check"></i><b>9</b> Exploring a Single Table (with a Business Perspective)</a><ul>
<li class="chapter" data-level="9.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#sales-orders-and-dollars"><i class="fa fa-check"></i><b>9.1</b> Sales Orders and Dollars</a></li>
<li class="chapter" data-level="9.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#adventure-works-monthly-sales."><i class="fa fa-check"></i><b>9.2</b> Adventure Works Monthly Sales.</a></li>
<li class="chapter" data-level="9.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#monthly-sales-rep-performance-analysis"><i class="fa fa-check"></i><b>9.3</b> Monthly Sales Rep Performance Analysis</a></li>
<li class="chapter" data-level="9.4" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#adventure-works-monthly-sales"><i class="fa fa-check"></i><b>9.4</b> Adventure Works Monthly Sales</a></li>
<li class="chapter" data-level="9.5" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#views"><i class="fa fa-check"></i><b>9.5</b> Views</a><ul>
<li class="chapter" data-level="9.5.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#explore-the-vsalelsperson-and-vsalespersonsalesbyfiscalyearsdata-views"><i class="fa fa-check"></i><b>9.5.1</b> Explore the vsalelsperson and vsalespersonsalesbyfiscalyearsdata views</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="close-and-clean-up.html"><a href="close-and-clean-up.html"><i class="fa fa-check"></i><b>10</b> Close and clean up</a></li>
<li class="chapter" data-level="11" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html"><i class="fa fa-check"></i><b>11</b> Lazy Evaluation and Lazy Queries</a><ul>
<li class="chapter" data-level="11.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#setup-2"><i class="fa fa-check"></i><b>11.1</b> Setup</a></li>
<li class="chapter" data-level="11.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#r-is-lazy-and-comes-with-guardrails"><i class="fa fa-check"></i><b>11.2</b> R is lazy and comes with guardrails</a><ul>
<li class="chapter" data-level="11.2.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-loading"><i class="fa fa-check"></i><b>11.2.1</b> Lazy loading</a></li>
<li class="chapter" data-level="11.2.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-evaluation"><i class="fa fa-check"></i><b>11.2.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="11.2.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-queries"><i class="fa fa-check"></i><b>11.2.3</b> Lazy Queries</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-evaluation-and-lazy-queries"><i class="fa fa-check"></i><b>11.3</b> Lazy evaluation and lazy queries</a><ul>
<li class="chapter" data-level="11.3.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#create-a-black-box-query-for-experimentation"><i class="fa fa-check"></i><b>11.3.1</b> Create a black box query for experimentation</a></li>
<li class="chapter" data-level="11.3.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#experiment-overview"><i class="fa fa-check"></i><b>11.3.2</b> Experiment overview</a></li>
<li class="chapter" data-level="11.3.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_print"><i class="fa fa-check"></i><b>11.3.3</b> Q %&gt;% print()</a></li>
<li class="chapter" data-level="11.3.4" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_as-tibble"><i class="fa fa-check"></i><b>11.3.4</b> Q %&gt;% dplyr::as_tibble()</a></li>
<li class="chapter" data-level="11.3.5" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_head"><i class="fa fa-check"></i><b>11.3.5</b> Q %&gt;% head()</a></li>
<li class="chapter" data-level="11.3.6" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_tail"><i class="fa fa-check"></i><b>11.3.6</b> Q %&gt;% tail()</a></li>
<li class="chapter" data-level="11.3.7" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_length"><i class="fa fa-check"></i><b>11.3.7</b> Q %&gt;% length()</a></li>
<li class="chapter" data-level="11.3.8" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_str"><i class="fa fa-check"></i><b>11.3.8</b> Q %&gt;% str()</a></li>
<li class="chapter" data-level="11.3.9" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_nrow"><i class="fa fa-check"></i><b>11.3.9</b> Q %&gt;% nrow()</a></li>
<li class="chapter" data-level="11.3.10" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_tally"><i class="fa fa-check"></i><b>11.3.10</b> Q %&gt;% dplyr::tally()</a></li>
<li class="chapter" data-level="11.3.11" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_collect"><i class="fa fa-check"></i><b>11.3.11</b> Q %&gt;% dplyr::collect()</a></li>
<li class="chapter" data-level="11.3.12" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_plot-categories"><i class="fa fa-check"></i><b>11.3.12</b> Q %&gt;% ggplot</a></li>
<li class="chapter" data-level="11.3.13" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_show-query"><i class="fa fa-check"></i><b>11.3.13</b> Q %&gt;% dplyr::show_query()</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#other-resources"><i class="fa fa-check"></i><b>11.4</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html"><i class="fa fa-check"></i><b>12</b> Lazy Evaluation and Execution Environment</a><ul>
<li class="chapter" data-level="12.1" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#setup-3"><i class="fa fa-check"></i><b>12.1</b> Setup</a><ul>
<li class="chapter" data-level="12.1.1" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#experiment-overview-1"><i class="fa fa-check"></i><b>12.1.1</b> Experiment overview</a></li>
<li class="chapter" data-level="12.1.2" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#time-based-execution-environment-issues"><i class="fa fa-check"></i><b>12.1.2</b> Time-based, execution environment issues</a></li>
<li class="chapter" data-level="12.1.3" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#lazy_q_build"><i class="fa fa-check"></i><b>12.1.3</b> Q %&gt;% <code>more dplyr</code></a></li>
<li class="chapter" data-level="12.1.4" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#many-handy-r-functions-cant-be-translated-to-sql"><i class="fa fa-check"></i><b>12.1.4</b> Many handy R functions can’t be translated to SQL</a></li>
<li class="chapter" data-level="12.1.5" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#further-lazy-execution-examples"><i class="fa fa-check"></i><b>12.1.5</b> Further lazy execution examples</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#other-resources-1"><i class="fa fa-check"></i><b>12.2</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html"><i class="fa fa-check"></i><b>13</b> Getting metadata about and from PostgreSQL</a><ul>
<li class="chapter" data-level="13.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-contents-and-structure"><i class="fa fa-check"></i><b>13.1</b> Database contents and structure</a><ul>
<li class="chapter" data-level="13.1.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-structure"><i class="fa fa-check"></i><b>13.1.1</b> Database structure</a></li>
<li class="chapter" data-level="13.1.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#contents-of-the-information_schema"><i class="fa fa-check"></i><b>13.1.2</b> Contents of the <code>information_schema</code></a></li>
<li class="chapter" data-level="13.1.3" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-tables-are-in-the-database"><i class="fa fa-check"></i><b>13.1.3</b> What tables are in the database?</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-columns-do-those-tables-contain"><i class="fa fa-check"></i><b>13.2</b> What columns do those tables contain?</a><ul>
<li class="chapter" data-level="13.2.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-is-the-difference-between-a-view-and-a-base-table"><i class="fa fa-check"></i><b>13.2.1</b> What is the difference between a <code>VIEW</code> and a <code>BASE TABLE</code>?</a></li>
<li class="chapter" data-level="13.2.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-data-types-are-found-in-the-database"><i class="fa fa-check"></i><b>13.2.2</b> What data types are found in the database?</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#characterizing-how-things-are-named"><i class="fa fa-check"></i><b>13.3</b> Characterizing how things are named</a><ul>
<li class="chapter" data-level="13.3.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#counting-columns-and-name-reuse"><i class="fa fa-check"></i><b>13.3.1</b> Counting columns and name reuse</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-keys"><i class="fa fa-check"></i><b>13.4</b> Database keys</a><ul>
<li class="chapter" data-level="13.4.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#direct-sql"><i class="fa fa-check"></i><b>13.4.1</b> Direct SQL</a></li>
<li class="chapter" data-level="13.4.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-keys-with-dplyr"><i class="fa fa-check"></i><b>13.4.2</b> Database keys with dplyr</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#creating-your-own-data-dictionary"><i class="fa fa-check"></i><b>13.5</b> Creating your own data dictionary</a></li>
<li class="chapter" data-level="13.6" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#save-your-work"><i class="fa fa-check"></i><b>13.6</b> Save your work!</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html"><i class="fa fa-check"></i><b>A</b> Background and Basic Concepts</a><ul>
<li class="chapter" data-level="A.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#the-big-picture-r-and-the-docker-postgresql-playground-on-your-machine"><i class="fa fa-check"></i><b>A.1</b> The big picture: R and the Docker / PostgreSQL playground on your machine</a></li>
<li class="chapter" data-level="A.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#your-computer-and-its-operating-system"><i class="fa fa-check"></i><b>A.2</b> Your computer and its operating system</a></li>
<li class="chapter" data-level="A.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#r"><i class="fa fa-check"></i><b>A.3</b> R</a></li>
<li class="chapter" data-level="A.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#our-sqlpetr-package"><i class="fa fa-check"></i><b>A.4</b> Our <code>sqlpetr</code> package</a></li>
<li class="chapter" data-level="A.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker"><i class="fa fa-check"></i><b>A.5</b> Docker</a><ul>
<li class="chapter" data-level="A.5.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#virtual-machines-and-hypervisors"><i class="fa fa-check"></i><b>A.5.1</b> Virtual machines and hypervisors</a></li>
<li class="chapter" data-level="A.5.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#containers"><i class="fa fa-check"></i><b>A.5.2</b> Containers</a></li>
<li class="chapter" data-level="A.5.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker-itself"><i class="fa fa-check"></i><b>A.5.3</b> Docker itself</a></li>
<li class="chapter" data-level="A.5.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker-objects"><i class="fa fa-check"></i><b>A.5.4</b> Docker objects</a></li>
<li class="chapter" data-level="A.5.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-windows-machines"><i class="fa fa-check"></i><b>A.5.5</b> Hosting Docker on Windows machines</a></li>
<li class="chapter" data-level="A.5.6" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-macos-machines"><i class="fa fa-check"></i><b>A.5.6</b> Hosting Docker on macOS machines</a></li>
<li class="chapter" data-level="A.5.7" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-unix-machines"><i class="fa fa-check"></i><b>A.5.7</b> Hosting Docker on UNIX machines</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#normal-and-normalized-data"><i class="fa fa-check"></i><b>A.6</b> ‘Normal’ and ‘normalized’ data</a><ul>
<li class="chapter" data-level="A.6.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#tidy-data"><i class="fa fa-check"></i><b>A.6.1</b> Tidy data</a></li>
<li class="chapter" data-level="A.6.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#design-of-normal-data"><i class="fa fa-check"></i><b>A.6.2</b> Design of “normal data”</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#sql-language"><i class="fa fa-check"></i><b>A.7</b> SQL Language</a><ul>
<li class="chapter" data-level="A.7.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-manipulation-langauge-dml"><i class="fa fa-check"></i><b>A.7.1</b> Data Manipulation Langauge (DML)</a></li>
<li class="chapter" data-level="A.7.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-definition-langauge-ddl"><i class="fa fa-check"></i><b>A.7.2</b> Data Definition Langauge (DDL)</a></li>
<li class="chapter" data-level="A.7.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-control-language-dcl"><i class="fa fa-check"></i><b>A.7.3</b> Data Control Language (DCL)</a></li>
<li class="chapter" data-level="A.7.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#transaction-control-language-tcl"><i class="fa fa-check"></i><b>A.7.4</b> Transaction Control Language (TCL)</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#enterprise-dbms"><i class="fa fa-check"></i><b>A.8</b> Enterprise DBMS</a><ul>
<li class="chapter" data-level="A.8.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#sql-databases"><i class="fa fa-check"></i><b>A.8.1</b> SQL databases</a></li>
<li class="chapter" data-level="A.8.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-mapping-between-r-vs-sql-data-types"><i class="fa fa-check"></i><b>A.8.2</b> Data mapping between R vs SQL data types</a></li>
<li class="chapter" data-level="A.8.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#postgresql-and-connection-parameters"><i class="fa fa-check"></i><b>A.8.3</b> PostgreSQL and connection parameters</a></li>
<li class="chapter" data-level="A.8.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#connecting-the-r-and-dbms-environments"><i class="fa fa-check"></i><b>A.8.4</b> Connecting the R and DBMS environments</a></li>
<li class="chapter" data-level="A.8.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#using-sqlite-to-simulate-an-enterprise-dbms"><i class="fa fa-check"></i><b>A.8.5</b> Using SQLite to simulate an enterprise DBMS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html"><i class="fa fa-check"></i><b>B</b> - Setup instructions</a><ul>
<li class="chapter" data-level="B.1" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#sandbox-prerequisites"><i class="fa fa-check"></i><b>B.1</b> Sandbox prerequisites</a></li>
<li class="chapter" data-level="B.2" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#r-rstudio-and-git"><i class="fa fa-check"></i><b>B.2</b> R, RStudio and Git</a></li>
<li class="chapter" data-level="B.3" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#install-docker"><i class="fa fa-check"></i><b>B.3</b> Install Docker</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html"><i class="fa fa-check"></i><b>C</b> Appendix E - Install <code>adventureworks</code> on your own machine</a><ul>
<li class="chapter" data-level="C.1" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#overview-2"><i class="fa fa-check"></i><b>C.1</b> Overview</a><ul>
<li class="chapter" data-level="C.1.1" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#download-the-adventureworks-database"><i class="fa fa-check"></i><b>C.1.1</b> Download the <code>adventureworks</code> database</a></li>
<li class="chapter" data-level="C.1.2" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#restore-the-dvdrental-database-at-the-command-line"><i class="fa fa-check"></i><b>C.1.2</b> Restore the <code>dvdrental</code> database at the command line</a></li>
<li class="chapter" data-level="C.1.3" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#restore-the-adventureworks-database-using-pgadmin"><i class="fa fa-check"></i><b>C.1.3</b> Restore the <code>adventureworks</code> database using pgAdmin</a></li>
</ul></li>
<li class="chapter" data-level="C.2" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#resources"><i class="fa fa-check"></i><b>C.2</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html"><i class="fa fa-check"></i><b>D</b> Appendix B - Additional technical details for Windows users</a><ul>
<li class="chapter" data-level="D.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#hardware-requirements"><i class="fa fa-check"></i><b>D.1</b> Hardware requirements</a></li>
<li class="chapter" data-level="D.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#software-requirements"><i class="fa fa-check"></i><b>D.2</b> Software requirements</a><ul>
<li class="chapter" data-level="D.2.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#windows-7-8-8.1-and-windows-10-home-64-bit"><i class="fa fa-check"></i><b>D.2.1</b> Windows 7, 8, 8.1 and Windows 10 Home (64 bit)</a></li>
<li class="chapter" data-level="D.2.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#windows-10-pro"><i class="fa fa-check"></i><b>D.2.2</b> Windows 10 Pro</a></li>
</ul></li>
<li class="chapter" data-level="D.3" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#docker-for-windows-settings"><i class="fa fa-check"></i><b>D.3</b> Docker for Windows settings</a><ul>
<li class="chapter" data-level="D.3.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#shared-drives"><i class="fa fa-check"></i><b>D.3.1</b> Shared drives</a></li>
<li class="chapter" data-level="D.3.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#kubernetes"><i class="fa fa-check"></i><b>D.3.2</b> Kubernetes</a></li>
</ul></li>
<li class="chapter" data-level="D.4" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#git-github-and-line-endings"><i class="fa fa-check"></i><b>D.4</b> Git, GitHub and line endings</a></li>
</ul></li>
<li class="chapter" data-level="E" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html"><i class="fa fa-check"></i><b>E</b> Appendix C - PostgreSQL Authentication</a><ul>
<li class="chapter" data-level="E.1" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#introduction"><i class="fa fa-check"></i><b>E.1</b> Introduction</a></li>
<li class="chapter" data-level="E.2" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#password-authentication-on-the-postgresql-docker-image"><i class="fa fa-check"></i><b>E.2</b> Password authentication on the PostgreSQL Docker image</a></li>
<li class="chapter" data-level="E.3" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#adding-roles"><i class="fa fa-check"></i><b>E.3</b> Adding roles</a><ul>
<li class="chapter" data-level="E.3.1" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#setting-up-docker"><i class="fa fa-check"></i><b>E.3.1</b> Setting up Docker</a></li>
<li class="chapter" data-level="E.3.2" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#creating-a-new-container"><i class="fa fa-check"></i><b>E.3.2</b> Creating a new container</a></li>
<li class="chapter" data-level="E.3.3" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#adding-a-role"><i class="fa fa-check"></i><b>E.3.3</b> Adding a role</a></li>
<li class="chapter" data-level="E.3.4" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#did-it-work"><i class="fa fa-check"></i><b>E.3.4</b> Did it work?</a></li>
<li class="chapter" data-level="E.3.5" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#remove-the-container"><i class="fa fa-check"></i><b>E.3.5</b> Remove the container</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="F" data-path="chapter-appendix-dplyr-functions.html"><a href="chapter-appendix-dplyr-functions.html"><i class="fa fa-check"></i><b>F</b> Dplyr functions and SQL cross-walk</a></li>
<li class="chapter" data-level="G" data-path="chapter-appendix-dbi-index.html"><a href="chapter-appendix-dbi-index.html"><i class="fa fa-check"></i><b>G</b> DBI package functions - INDEX</a></li>
<li class="chapter" data-level="H" data-path="chapter-appendix-dplyr-to-postres-translation.html"><a href="chapter-appendix-dplyr-to-postres-translation.html"><i class="fa fa-check"></i><b>H</b> Appendix _ Dplyr to SQL translations</a><ul>
<li class="chapter" data-level="H.1" data-path="chapter-appendix-dplyr-to-postres-translation.html"><a href="chapter-appendix-dplyr-to-postres-translation.html#overview-3"><i class="fa fa-check"></i><b>H.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="I" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html"><i class="fa fa-check"></i><b>I</b> Appendix Additional resources</a><ul>
<li class="chapter" data-level="I.1" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#editing-this-book"><i class="fa fa-check"></i><b>I.1</b> Editing this book</a></li>
<li class="chapter" data-level="I.2" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#docker-alternatives"><i class="fa fa-check"></i><b>I.2</b> Docker alternatives</a></li>
<li class="chapter" data-level="I.3" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#docker-and-r"><i class="fa fa-check"></i><b>I.3</b> Docker and R</a></li>
<li class="chapter" data-level="I.4" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#documentation-for-docker-and-postgresql"><i class="fa fa-check"></i><b>I.4</b> Documentation for Docker and PostgreSQL</a></li>
<li class="chapter" data-level="I.5" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#sql-and-dplyr"><i class="fa fa-check"></i><b>I.5</b> SQL and dplyr</a></li>
<li class="chapter" data-level="I.6" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#more-resources"><i class="fa fa-check"></i><b>I.6</b> More Resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><div class="line-block">Exploring Enterprise Databases with R<br />
A Tidyverse Approach</div></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter_exploring-a-single-table" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> Exploring a Single Table (with a Business Perspective)</h1>
<blockquote>
<p>This chapter demonstrates how to:</p>
<ul>
<li>Dig into a single Adventureworks table containing sales data</li>
<li>Investigate the ddata from a business value perspective</li>
</ul>
</blockquote>
<p>This chapter explores one table, illustrating the kind of detective work that’s needed to understand one table. We’ll investigate the <code>salesorderheader</code> table in the <code>sales</code> schema.</p>
<p>This code currently uses the new <code>pivot_longer</code> function. You may need to install</p>
<p><code>devtools::install_github(&quot;tidyverse/tidyr&quot;)</code></p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" data-line-number="1"><span class="kw">sp_docker_start</span>(<span class="st">&quot;adventureworks&quot;</span>)</a>
<a class="sourceLine" id="cb149-2" data-line-number="2"><span class="kw">Sys.sleep</span>(sleep_default)</a>
<a class="sourceLine" id="cb149-3" data-line-number="3">con &lt;-<span class="st"> </span><span class="kw">sp_get_postgres_connection</span>(</a>
<a class="sourceLine" id="cb149-4" data-line-number="4">  <span class="dt">host =</span> <span class="st">&quot;localhost&quot;</span>,</a>
<a class="sourceLine" id="cb149-5" data-line-number="5">  <span class="dt">port =</span> <span class="dv">5432</span>,</a>
<a class="sourceLine" id="cb149-6" data-line-number="6">  <span class="dt">user =</span> <span class="st">&quot;postgres&quot;</span>,</a>
<a class="sourceLine" id="cb149-7" data-line-number="7">  <span class="dt">password =</span> <span class="st">&quot;postgres&quot;</span>,</a>
<a class="sourceLine" id="cb149-8" data-line-number="8">  <span class="dt">dbname =</span> <span class="st">&quot;adventureworks&quot;</span>,</a>
<a class="sourceLine" id="cb149-9" data-line-number="9">  <span class="dt">seconds_to_test =</span> sleep_default, <span class="dt">connection_tab =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb149-10" data-line-number="10">)</a></code></pre></div>
<pre><code>## &lt;PqConnection&gt; adventureworks@localhost:5432</code></pre>
<p><a href="https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf" class="uri">https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf</a></p>
<p>(moved a big chunk about schemas to 050 - setup adventureworks and connect with rstudio)</p>
<p>The previous chapter has demonstrated some of the automated techniques for showing what’s in the table using specific functions and packages.</p>
<p>The first item we examine is Adventure Works’ sales dollars over the span of data available at different levels of detail. On an annual basis, are sales dollars trending up, down or flat?</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1">annual_sales &lt;-<span class="st">  </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb151-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">substr</span>(<span class="kw">as.character</span>(orderdate), <span class="dv">1</span>, <span class="dv">4</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb151-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb151-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb151-5" data-line-number="5">    <span class="dt">min_orderdate =</span> <span class="kw">min</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb151-6" data-line-number="6">    <span class="dt">max_orderdate =</span> <span class="kw">max</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb151-7" data-line-number="7">    <span class="dt">so_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb151-8" data-line-number="8">    <span class="dt">avg_so_dollars =</span> <span class="kw">round</span>(<span class="kw">mean</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb151-9" data-line-number="9">    <span class="dt">so_cnt =</span> <span class="kw">n</span>()</a>
<a class="sourceLine" id="cb151-10" data-line-number="10">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb151-11" data-line-number="11"><span class="st">  </span><span class="kw">arrange</span>(year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb151-12" data-line-number="12"><span class="st">  </span><span class="kw">select</span>(year, min_orderdate, max_orderdate, so_dollars, avg_so_dollars, so_cnt) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb151-13" data-line-number="13"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb151-14" data-line-number="14"><span class="st">  </span><span class="kw">as.data.frame</span>()</a>
<a class="sourceLine" id="cb151-15" data-line-number="15">annual_sales</a></code></pre></div>
<pre><code>##   year min_orderdate max_orderdate  so_dollars avg_so_dollars so_cnt
## 1 2011    2011-05-31    2011-12-31 12641672.21        7866.63   1607
## 2 2012    2012-01-01    2012-12-31 33524301.33        8563.04   3915
## 3 2013    2013-01-01    2013-12-31 43622479.05        3075.90  14182
## 4 2014    2014-01-01    2014-06-30 20057928.81        1705.46  11761</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1">min_dt &lt;-<span class="st"> </span><span class="kw">min</span>(annual_sales<span class="op">$</span>min_orderdate)</a>
<a class="sourceLine" id="cb153-2" data-line-number="2">max_dt &lt;-<span class="st"> </span><span class="kw">max</span>(annual_sales<span class="op">$</span>max_orderdate)</a>
<a class="sourceLine" id="cb153-3" data-line-number="3"></a>
<a class="sourceLine" id="cb153-4" data-line-number="4"><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> so_dollars)) <span class="op">+</span></a>
<a class="sourceLine" id="cb153-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb153-6" data-line-number="6"><span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb153-7" data-line-number="7">    <span class="st">&quot;avg $ &quot;</span>, avg_so_dollars</a>
<a class="sourceLine" id="cb153-8" data-line-number="8">  )), <span class="dt">vjust =</span> <span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span><span class="co"># orders inside each bar at top</span></a>
<a class="sourceLine" id="cb153-9" data-line-number="9"></a>
<a class="sourceLine" id="cb153-10" data-line-number="10"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb153-11" data-line-number="11"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sales $&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb153-12" data-line-number="12"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Adventure Works Sales Dollars by Year</span><span class="ch">\n</span><span class="st">  &quot;</span>, min_dt, <span class="st">&quot; - &quot;</span>, max_dt))</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/Calculate%20time%20period%20and%20annual%20sales%20dollars%20-%202-1.png" width="672" /></p>
<p>From the title we see that the available data covers the last seven months of 2011 through the first six months of 2014. From 2011 through 2013, sales are trending up and the growth between years is slowing down. 2014 sales dollars look a little behind 2013. Are sales dollars for 2014 really down or are sales dollars seasonal? To see if the sales dollars are sesonal, we will drill in and look at the monthly sales. Let’s first clean up the y-axis labels and include the number of sales orders and the average sales order dollars associated with the annual dollars?</p>
<div id="sales-orders-and-dollars" class="section level2">
<h2><span class="header-section-number">9.1</span> Sales Orders and Dollars</h2>
<p>How are the sales dollars related to the number of orders and what is the average order amount? In the next plot, the title is centered, the y-axis is rescaled, and number of orders and average order dollar amount is added to the top of each bar.</p>
<p>The following 3 plots show how odd the sales data is:</p>
<p>Look at average dollars per sale sale:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> avg_so_dollars)) <span class="op">+</span></a>
<a class="sourceLine" id="cb154-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb154-3" data-line-number="3">    <span class="st">&quot;orders&quot;</span>, so_cnt, <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb154-4" data-line-number="4"><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb154-5" data-line-number="5">    <span class="st">&quot;avg $ &quot;</span>, avg_so_dollars</a>
<a class="sourceLine" id="cb154-6" data-line-number="6">  )), <span class="dt">vjust =</span> <span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span><span class="co"># orders inside each bar at top</span></a>
<a class="sourceLine" id="cb154-7" data-line-number="7"></a>
<a class="sourceLine" id="cb154-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb154-9" data-line-number="9"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb154-10" data-line-number="10"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Average sale amount&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb154-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span><span class="st"> </span><span class="co"># clean up y-axis</span></a>
<a class="sourceLine" id="cb154-12" data-line-number="12"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Average Dollars per Sale</span><span class="ch">\n</span><span class="st">&quot;</span>, min_dt, <span class="st">&quot; - &quot;</span>, max_dt))</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/average%20dollars%20per%20sale-1.png" width="672" /></p>
<p>Look at number of orders per year:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> <span class="kw">as.numeric</span>(so_cnt))) <span class="op">+</span></a>
<a class="sourceLine" id="cb155-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb155-3" data-line-number="3">    <span class="st">&quot;orders&quot;</span>, so_cnt), <span class="dt">vjust =</span> <span class="fl">1.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># orders inside each bar at top</span></a>
<a class="sourceLine" id="cb155-4" data-line-number="4"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb155-5" data-line-number="5"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total number of orders&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb155-6" data-line-number="6"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Number of Orders per Year</span><span class="ch">\n</span><span class="st">&quot;</span>, min_dt, <span class="st">&quot; - &quot;</span>, max_dt))</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/average%20dollars%20per%20sale%20-%20v2-1.png" width="672" /></p>
<p>Look at number of orders by the the average sales per order for the four years:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1">annual_sales <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(min_orderdate) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> avg_so_dollars, <span class="dt">y =</span> <span class="kw">as.numeric</span>(so_cnt))) <span class="op">+</span></a>
<a class="sourceLine" id="cb156-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb156-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> year, <span class="dt">hjust =</span> <span class="fl">.5</span>, <span class="dt">vjust =</span> <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb156-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_path</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb156-6" data-line-number="6"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Average dollars per order&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb156-7" data-line-number="7"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total number of orders&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb156-8" data-line-number="8"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Number of Orders by Average Order Amount</span><span class="ch">\n</span><span class="st">&quot;</span>, min_dt, <span class="st">&quot; - &quot;</span>, max_dt))</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/number%20of%20orders%20by%20the%20the%20average%20sales%20per%20order-1.png" width="672" /></p>
<p>The orders in 2012 are about 30% of the 2013 sales, but the 2012 average sales order dollars are 2.75 larger than the 2013 average sales order.</p>
<p><strong>Why are the number of orders increasing, but the average order dollar amount dropping? </strong></p>
</div>
<div id="adventure-works-monthly-sales." class="section level2">
<h2><span class="header-section-number">9.2</span> Adventure Works Monthly Sales.</h2>
<p>The next code block drills down from annual sales dollars to monthly sales dollars.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1">monthly_sales &lt;-<span class="st">  </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">yr =</span> <span class="kw">year</span>(orderdate), <span class="dt">mo =</span> <span class="kw">month</span>(orderdate)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(yr, mo) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb157-5" data-line-number="5">    <span class="dt">min_orderdate =</span> <span class="kw">min</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb157-6" data-line-number="6">    <span class="dt">max_orderdate =</span> <span class="kw">max</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb157-7" data-line-number="7">    <span class="dt">so_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb157-8" data-line-number="8">    <span class="dt">avg_so_dollars =</span> <span class="kw">round</span>(<span class="kw">mean</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb157-9" data-line-number="9">    <span class="dt">so_cnt =</span> <span class="kw">n</span>()</a>
<a class="sourceLine" id="cb157-10" data-line-number="10">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-11" data-line-number="11"><span class="st">  </span><span class="kw">arrange</span>(yr, mo) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">so_date =</span> <span class="kw">as.Date</span>(min_orderdate)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb157-13" data-line-number="13"><span class="st">  </span><span class="kw">select</span>(yr, mo, so_date, min_orderdate, max_orderdate, so_dollars, avg_so_dollars, so_cnt) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-14" data-line-number="14"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-15" data-line-number="15"><span class="st">  </span><span class="kw">as.data.frame</span>()</a>
<a class="sourceLine" id="cb157-16" data-line-number="16"><span class="kw">sp_print_df</span>(monthly_sales)</a></code></pre></div>
<div id="htmlwidget-1b4ff99564eb6e8884a5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1b4ff99564eb6e8884a5">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38"],[2011,2011,2011,2011,2011,2011,2011,2011,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2012,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2013,2014,2014,2014,2014,2014,2014],[5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6],["2011-05-31","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01"],["2011-05-31T07:00:00Z","2011-06-01T07:00:00Z","2011-07-01T07:00:00Z","2011-08-01T07:00:00Z","2011-09-01T07:00:00Z","2011-10-01T07:00:00Z","2011-11-01T07:00:00Z","2011-12-01T08:00:00Z","2012-01-01T08:00:00Z","2012-02-01T08:00:00Z","2012-03-01T08:00:00Z","2012-04-01T07:00:00Z","2012-05-01T07:00:00Z","2012-06-01T07:00:00Z","2012-07-01T07:00:00Z","2012-08-01T07:00:00Z","2012-09-01T07:00:00Z","2012-10-01T07:00:00Z","2012-11-01T07:00:00Z","2012-12-01T08:00:00Z","2013-01-01T08:00:00Z","2013-02-01T08:00:00Z","2013-03-01T08:00:00Z","2013-04-01T07:00:00Z","2013-05-01T07:00:00Z","2013-06-01T07:00:00Z","2013-07-01T07:00:00Z","2013-08-01T07:00:00Z","2013-09-01T07:00:00Z","2013-10-01T07:00:00Z","2013-11-01T07:00:00Z","2013-12-01T08:00:00Z","2014-01-01T08:00:00Z","2014-02-01T08:00:00Z","2014-03-01T08:00:00Z","2014-04-01T07:00:00Z","2014-05-01T07:00:00Z","2014-06-01T07:00:00Z"],["2011-05-31T07:00:00Z","2011-06-30T07:00:00Z","2011-07-31T07:00:00Z","2011-08-31T07:00:00Z","2011-09-30T07:00:00Z","2011-10-31T07:00:00Z","2011-11-30T08:00:00Z","2011-12-31T08:00:00Z","2012-01-31T08:00:00Z","2012-02-29T08:00:00Z","2012-03-31T07:00:00Z","2012-04-30T07:00:00Z","2012-05-31T07:00:00Z","2012-06-30T07:00:00Z","2012-07-31T07:00:00Z","2012-08-31T07:00:00Z","2012-09-30T07:00:00Z","2012-10-31T07:00:00Z","2012-11-30T08:00:00Z","2012-12-31T08:00:00Z","2013-01-31T08:00:00Z","2013-02-28T08:00:00Z","2013-03-31T07:00:00Z","2013-04-30T07:00:00Z","2013-05-31T07:00:00Z","2013-06-30T07:00:00Z","2013-07-31T07:00:00Z","2013-08-31T07:00:00Z","2013-09-30T07:00:00Z","2013-10-31T07:00:00Z","2013-11-30T08:00:00Z","2013-12-31T08:00:00Z","2014-01-31T08:00:00Z","2014-02-28T08:00:00Z","2014-03-31T07:00:00Z","2014-04-30T07:00:00Z","2014-05-31T07:00:00Z","2014-06-30T07:00:00Z"],[503805.92,458910.82,2044600,2495816.73,502073.85,4588761.82,737839.82,1309863.25,3970627.28,1475426.91,2975748.24,1634600.8,3074602.81,4099354.36,3417953.87,2175637.22,3454151.94,2544091.11,1872701.98,2829404.82,2087872.46,2316922.15,3412068.97,2532265.91,3245623.76,5081069.13,4896353.74,3333964.07,4532908.71,4795813.29,3312130.25,4075486.63,4289817.95,1337725.04,7217531.09,1797173.92,5366674.97,49005.84],[11716.42,3254.69,8851.08,9983.27,3197.92,14032.91,3208,5745.01,11817.34,6737.11,9788.65,6076.58,10493.52,10511.17,8877.8,7633.81,9812.93,7925.52,4889.56,7485.2,5219.68,7128.99,7737.12,5916.51,7583.23,7066.86,2814,1863.59,2530.94,2436.9,1574.95,1988.04,2003.65,761.8,3008.56,849.73,2225.91,52.19],[43,141,231,250,157,327,230,228,336,219,304,269,293,390,385,285,352,321,383,378,400,325,441,428,428,719,1740,1789,1791,1968,2103,2050,2141,1756,2399,2115,2411,939]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>yr<\/th>\n      <th>mo<\/th>\n      <th>so_date<\/th>\n      <th>min_orderdate<\/th>\n      <th>max_orderdate<\/th>\n      <th>so_dollars<\/th>\n      <th>avg_so_dollars<\/th>\n      <th>so_cnt<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1">min_dt &lt;-<span class="st"> </span><span class="kw">min</span>(monthly_sales<span class="op">$</span>min_orderdate)</a>
<a class="sourceLine" id="cb158-2" data-line-number="2">max_dt &lt;-<span class="st"> </span><span class="kw">max</span>(monthly_sales<span class="op">$</span>max_orderdate)</a>
<a class="sourceLine" id="cb158-3" data-line-number="3"></a>
<a class="sourceLine" id="cb158-4" data-line-number="4"><span class="kw">ggplot</span>(<span class="dt">data =</span> monthly_sales, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> so_dollars, <span class="dt">fill =</span> yr)) <span class="op">+</span></a>
<a class="sourceLine" id="cb158-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb158-6" data-line-number="6"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb158-7" data-line-number="7"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sales Dollars&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb158-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span></a>
<a class="sourceLine" id="cb158-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> so_cnt), <span class="dt">vjust =</span> <span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span><span class="co"># Add nbr of orders</span></a>
<a class="sourceLine" id="cb158-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb158-11" data-line-number="11"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Sales by Month</span><span class="ch">\n</span><span class="st">&quot;</span>, min_dt, <span class="st">&quot; - &quot;</span>, max_dt))</a></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type integer64. Defaulting to continuous.</code></pre>
<p><img src="083-exploring-a-single-table_files/figure-html/monthly_sales%20graphs-1.png" width="672" /></p>
<p>That is one ugly and useless graph. It is hard to read/interpret
* the dollar amounts associated with each color/year in each bar
* the number of orders/month for each year,
* the x-axis labels and associated months.</p>
<p>SQL does not have a factor data type. The ‘mo’ and ‘yr’ INT data types are converted to factors. This changes the yr legend on the right from the default black to blue to the default factor colors. The bar text positioned based on cum_so_dollars and adjusted down 1.5 units.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1">monthly_sales<span class="op">$</span>mo &lt;-<span class="st"> </span><span class="kw">as.factor</span>(monthly_sales<span class="op">$</span>mo)</a>
<a class="sourceLine" id="cb160-2" data-line-number="2">monthly_sales<span class="op">$</span>yr &lt;-<span class="st"> </span><span class="kw">as.factor</span>(monthly_sales<span class="op">$</span>yr) <span class="co"># changes color scale from continuous blue to distinct colors</span></a>
<a class="sourceLine" id="cb160-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="dt">data =</span> monthly_sales, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> so_dollars, <span class="dt">fill =</span> yr)) <span class="op">+</span></a>
<a class="sourceLine" id="cb160-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="kw">position_stack</span>(<span class="dt">reverse =</span> <span class="ot">TRUE</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># reverse stacked bars 2011 bottom 2014 top</span></a>
<a class="sourceLine" id="cb160-5" data-line-number="5"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">TRUE</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># reverse bar/legend fill</span></a>
<a class="sourceLine" id="cb160-6" data-line-number="6"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb160-7" data-line-number="7"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sales Dollars&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb160-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span></a>
<a class="sourceLine" id="cb160-9" data-line-number="9"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb160-10" data-line-number="10"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Sales by Month by Year</span><span class="ch">\n</span><span class="st">With Number of Sales Orders</span><span class="ch">\n</span><span class="st">&quot;</span>, min_dt, <span class="st">&quot; - &quot;</span>, max_dt))</a></code></pre></div>
<p>This plot is better. The colors associated with each year and the number of orders by year are much easier to read and the x-axis now reflect the months.</p>
<p>Having stacked bars, it is difficult to compare the monthly dollar amounts between the different years. The next plot fixes some of these short comings. Instead of stacking the bars vertically, the next plot shows the bars horizontally in ascending year order for each month and the plot width is increased from the default 7 to 16. Note that the first four months only have three years and that the bars are wider than those with four bars. The overall width of for each month is same.</p>
<p><font color='red'></p>
<pre><code>    # The next two statements were done in the previous code block
    # Why do the need to be done again in this code block
    
    monthly_sales$mo &lt;- as.factor(monthly_sales$mo)
    
    monthly_sales$yr &lt;- as.factor(monthly_sales$yr)</code></pre>
<p></font></p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1">min_dt &lt;-<span class="st"> </span><span class="kw">min</span>(monthly_sales<span class="op">$</span>min_orderdate)</a>
<a class="sourceLine" id="cb162-2" data-line-number="2">max_dt &lt;-<span class="st"> </span><span class="kw">max</span>(monthly_sales<span class="op">$</span>max_orderdate)</a>
<a class="sourceLine" id="cb162-3" data-line-number="3"></a>
<a class="sourceLine" id="cb162-4" data-line-number="4">start_year &lt;-<span class="st"> </span>monthly_sales <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb162-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(yr)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb162-6" data-line-number="6"><span class="st">  </span><span class="kw">group_by</span>(yr) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb162-7" data-line-number="7"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">so_dollars =</span> <span class="kw">sum</span>(so_dollars), </a>
<a class="sourceLine" id="cb162-8" data-line-number="8">            <span class="dt">so_cnt =</span> <span class="kw">sum</span>(so_cnt), </a>
<a class="sourceLine" id="cb162-9" data-line-number="9">            <span class="dt">n_months =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb162-10" data-line-number="10">            <span class="dt">avg_dollars =</span> so_dollars <span class="op">/</span><span class="st"> </span>n_months,</a>
<a class="sourceLine" id="cb162-11" data-line-number="11">            <span class="dt">avg_cnt =</span> so_cnt <span class="op">/</span><span class="st"> </span>n_months)</a>
<a class="sourceLine" id="cb162-12" data-line-number="12">start_year</a></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##      yr so_dollars so_cnt  n_months avg_dollars avg_cnt
##   &lt;dbl&gt;      &lt;dbl&gt; &lt;int64&gt;    &lt;int&gt;       &lt;dbl&gt;   &lt;dbl&gt;
## 1  2011  12641672. 1607           8    1580209.    201.</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1">normalized_monthly_sales &lt;-<span class="st">  </span>monthly_sales <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb164-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dollars =</span> (<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>so_dollars) <span class="op">/</span><span class="st"> </span>start_year<span class="op">$</span>avg_dollars,</a>
<a class="sourceLine" id="cb164-3" data-line-number="3">         <span class="dt">number_of_orders =</span> (<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>so_cnt) <span class="op">/</span><span class="st"> </span>start_year<span class="op">$</span>avg_cnt)</a>
<a class="sourceLine" id="cb164-4" data-line-number="4"></a>
<a class="sourceLine" id="cb164-5" data-line-number="5">normalized_monthly_sales &lt;-<span class="st"> </span>normalized_monthly_sales <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb164-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">as.Date</span>(min_orderdate)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb164-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(date, dollars, number_of_orders) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb164-8" data-line-number="8"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>date, <span class="dt">names_to =</span> <span class="st">&quot;relative_to_2011_average&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;amount&quot;</span> )</a>
<a class="sourceLine" id="cb164-9" data-line-number="9"></a>
<a class="sourceLine" id="cb164-10" data-line-number="10">normalized_monthly_sales <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb164-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, amount, <span class="dt">color =</span> relative_to_<span class="dv">2011</span>_average)) <span class="op">+</span></a>
<a class="sourceLine" id="cb164-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb164-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">100</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb164-14" data-line-number="14"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Date&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb164-15" data-line-number="15"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb164-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_labels =</span> <span class="st">&quot;%Y-%m&quot;</span>, <span class="dt">date_breaks =</span> <span class="st">&quot;6 months&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb164-17" data-line-number="17"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Adventureworks Normalized Monthly Sales</span><span class="ch">\n</span><span class="st">Number of Sales Orders and Dollar Totals</span><span class="ch">\n</span><span class="st">&quot;</span>, min_dt, <span class="st">&quot; to &quot;</span>, max_dt))</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> monthly_sales, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> so_dollars, <span class="dt">fill =</span> yr)) <span class="op">+</span></a>
<a class="sourceLine" id="cb165-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="kw">position_stack</span>(<span class="dt">reverse =</span> <span class="ot">TRUE</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># reverse stacked bars 2011 bottom 2014 top</span></a>
<a class="sourceLine" id="cb165-3" data-line-number="3"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">TRUE</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># reverse bar/legend fill</span></a>
<a class="sourceLine" id="cb165-4" data-line-number="4"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb165-5" data-line-number="5"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sales Dollars&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb165-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span></a>
<a class="sourceLine" id="cb165-7" data-line-number="7"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb165-8" data-line-number="8"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Sales by Month by Year</span><span class="ch">\n</span><span class="st">With Number of Sales Orders</span><span class="ch">\n</span><span class="st">&quot;</span>, min_dt, <span class="st">&quot; - &quot;</span>, max_dt))</a></code></pre></div>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1"><span class="co"># The next two statements were done in the previous code block</span></a>
<a class="sourceLine" id="cb166-2" data-line-number="2"><span class="co"># Why do the need to be done again in this code block</span></a>
<a class="sourceLine" id="cb166-3" data-line-number="3">monthly_sales<span class="op">$</span>mo &lt;-<span class="st"> </span><span class="kw">as.factor</span>(monthly_sales<span class="op">$</span>mo)</a>
<a class="sourceLine" id="cb166-4" data-line-number="4">monthly_sales<span class="op">$</span>yr &lt;-<span class="st"> </span><span class="kw">as.factor</span>(monthly_sales<span class="op">$</span>yr)</a>
<a class="sourceLine" id="cb166-5" data-line-number="5"></a>
<a class="sourceLine" id="cb166-6" data-line-number="6"><span class="co"># ggplot(data=monthly_sales,aes(x=mo,y=so_dollars,fill=yr)) +</span></a>
<a class="sourceLine" id="cb166-7" data-line-number="7"><span class="kw">ggplot</span>(<span class="dt">data =</span> monthly_sales, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> so_dollars, <span class="dt">fill =</span> yr)) <span class="op">+</span></a>
<a class="sourceLine" id="cb166-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># unstack columns and outline in black</span></a>
<a class="sourceLine" id="cb166-9" data-line-number="9"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb166-10" data-line-number="10"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sales Dollars&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb166-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span></a>
<a class="sourceLine" id="cb166-12" data-line-number="12"><span class="co">#   geom_text(aes(label = paste(so_cnt, &quot;</span></a>
<a class="sourceLine" id="cb166-13" data-line-number="13"><span class="co"># &quot;, avg_so_dollars)),</span></a>
<a class="sourceLine" id="cb166-14" data-line-number="14"><span class="co">#     size = 2.5,</span></a>
<a class="sourceLine" id="cb166-15" data-line-number="15"><span class="co">#     color = &quot;black&quot;,</span></a>
<a class="sourceLine" id="cb166-16" data-line-number="16"><span class="co">#     vjust = 1.5,</span></a>
<a class="sourceLine" id="cb166-17" data-line-number="17"><span class="co">#     position = position_dodge(.9)</span></a>
<a class="sourceLine" id="cb166-18" data-line-number="18"><span class="co">#   ) +</span></a>
<a class="sourceLine" id="cb166-19" data-line-number="19"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb166-20" data-line-number="20"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Sales by Month by Year</span><span class="ch">\n</span><span class="st">With Number of Sales Orders</span><span class="ch">\n</span><span class="st">And Average SO $ Amount</span><span class="ch">\n</span><span class="st">&quot;</span>, min_dt, <span class="st">&quot; - &quot;</span>, max_dt))</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/dodge%20column%20plot-1.png" width="1536" /></p>
<p>The next plot shows the same data as a line graph.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1"><span class="co"># sp_print_df(monthly_sales)</span></a>
<a class="sourceLine" id="cb167-2" data-line-number="2"></a>
<a class="sourceLine" id="cb167-3" data-line-number="3"><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb167-4" data-line-number="4">  <span class="dt">data =</span> monthly_sales,</a>
<a class="sourceLine" id="cb167-5" data-line-number="5">  <span class="kw">aes</span>(</a>
<a class="sourceLine" id="cb167-6" data-line-number="6">    <span class="dt">x =</span> mo, <span class="dt">y =</span> so_dollars, <span class="dt">color =</span> <span class="kw">as.factor</span>(yr),</a>
<a class="sourceLine" id="cb167-7" data-line-number="7">    <span class="dt">group =</span> <span class="kw">as.factor</span>(yr)</a>
<a class="sourceLine" id="cb167-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb167-9" data-line-number="9">) <span class="op">+</span><span class="st"> </span><span class="co"># Removes msg: Each group consists of only one observation. Do you need to adjust the group aesthetic?</span></a>
<a class="sourceLine" id="cb167-10" data-line-number="10"></a>
<a class="sourceLine" id="cb167-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb167-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb167-13" data-line-number="13"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb167-14" data-line-number="14"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sales Dollars&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb167-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span></a>
<a class="sourceLine" id="cb167-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">paste</span>(so_cnt, <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb167-17" data-line-number="17"><span class="st">&quot;</span>, avg_so_dollars)),</a>
<a class="sourceLine" id="cb167-18" data-line-number="18">    <span class="dt">size =</span> <span class="fl">2.5</span>,</a>
<a class="sourceLine" id="cb167-19" data-line-number="19">    <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>,</a>
<a class="sourceLine" id="cb167-20" data-line-number="20">    <span class="dt">vjust =</span> <span class="fl">1.5</span>,</a>
<a class="sourceLine" id="cb167-21" data-line-number="21">    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb167-22" data-line-number="22">  ) <span class="op">+</span><span class="st"> </span><span class="co"># orders =&gt; avg so $ amt</span></a>
<a class="sourceLine" id="cb167-23" data-line-number="23"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb167-24" data-line-number="24"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Sales by Month by Year</span><span class="ch">\n</span><span class="st">With Number of Sales Orders</span><span class="ch">\n</span><span class="st">And Average SO $ Amount</span><span class="ch">\n</span><span class="st">&quot;</span>, min_dt, <span class="st">&quot; - &quot;</span>, max_dt))</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-4"></span>
<img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-4-1.png" alt="SO, SO Dollars, and Average SO Dollars" width="1536" />
<p class="caption">
Figure 9.1: SO, SO Dollars, and Average SO Dollars
</p>
</div>
<p>A couple of things jump out from the graph.</p>
<ol style="list-style-type: decimal">
<li>2012 and 2013 have similar sales dollar plots and peak every three months. This may reflect the closing as many sales orders as possible to make the quarterly sales numbers look good.</li>
<li>2011 has more variation than 2012 and 2013 and peaks every two months.</li>
<li>2014 has the most variation and also peaks every two months. Both the number of sales, 939, and the average sales order size, $52.19 plumet in June 2014.</li>
</ol>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1"><span class="co"># sp_print_df(monthly_sales)</span></a>
<a class="sourceLine" id="cb168-2" data-line-number="2"></a>
<a class="sourceLine" id="cb168-3" data-line-number="3"><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb168-4" data-line-number="4">  <span class="dt">data =</span> monthly_sales,</a>
<a class="sourceLine" id="cb168-5" data-line-number="5">  <span class="kw">aes</span>(</a>
<a class="sourceLine" id="cb168-6" data-line-number="6">    <span class="dt">x =</span> so_date, <span class="dt">y =</span> so_dollars)</a>
<a class="sourceLine" id="cb168-7" data-line-number="7">  <span class="co"># , color = as.factor(yr),</span></a>
<a class="sourceLine" id="cb168-8" data-line-number="8">  <span class="co">#   group = as.factor(yr)</span></a>
<a class="sourceLine" id="cb168-9" data-line-number="9">  <span class="co"># )</span></a>
<a class="sourceLine" id="cb168-10" data-line-number="10">) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb168-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-13" data-line-number="13"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-14" data-line-number="14"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sales Dollars&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-15" data-line-number="15"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>, <span class="dt">date_minor_breaks =</span> <span class="st">&quot;3 months&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb168-17" data-line-number="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb168-18" data-line-number="18"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Sales by Month by Year</span><span class="ch">\n</span><span class="st">With Number of Sales Orders</span><span class="ch">\n</span><span class="st">And Average SO $ Amount</span><span class="ch">\n</span><span class="st">&quot;</span>, min_dt, <span class="st">&quot; - &quot;</span>, max_dt))</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-5"></span>
<img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-5-1.png" alt="SO, SO Dollars, and Average SO Dollars-b " width="1536" />
<p class="caption">
Figure 9.2: SO, SO Dollars, and Average SO Dollars-b
</p>
</div>
<p>A couple of things jump out from the graph.</p>
<ol style="list-style-type: decimal">
<li>2012 and 2013 have similar sales dollar plots and peak every three months. This may reflect the closing as many sales orders as possible to make the quarterly sales numbers look good.</li>
<li>2011 has more variation than 2012 and 2013 and peaks every two months.</li>
<li>2014 has the most variation and also peaks every two months. Both the number of sales, 939, and the average sales order size, $52.19 plumet in June 2014.</li>
</ol>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" data-line-number="1"><span class="co"># so_cnt_2011 &lt;- monthly_sales %&gt;%</span></a>
<a class="sourceLine" id="cb170-2" data-line-number="2"><span class="co">#   filter(yr == 2011) %&gt;%</span></a>
<a class="sourceLine" id="cb170-3" data-line-number="3"><span class="co">#   select(so_cnt, min_orderdate, mo)</span></a>
<a class="sourceLine" id="cb170-4" data-line-number="4"><span class="co"># so_cnt_2012_5_12 &lt;- monthly_sales %&gt;%</span></a>
<a class="sourceLine" id="cb170-5" data-line-number="5"><span class="co">#   filter(yr == 2012 &amp; mo %in% c(5, 6, 7, 8, 9, 10, 11, 12)) %&gt;%</span></a>
<a class="sourceLine" id="cb170-6" data-line-number="6"><span class="co">#   select(so_cnt, min_orderdate, mo)</span></a>
<a class="sourceLine" id="cb170-7" data-line-number="7"><span class="co"># so_cnt_2012 &lt;- monthly_sales %&gt;%</span></a>
<a class="sourceLine" id="cb170-8" data-line-number="8"><span class="co">#   filter(yr == 2012) %&gt;%</span></a>
<a class="sourceLine" id="cb170-9" data-line-number="9"><span class="co">#   select(so_cnt, min_orderdate, mo)</span></a>
<a class="sourceLine" id="cb170-10" data-line-number="10"><span class="co"># so_cnt_2013 &lt;- monthly_sales %&gt;%</span></a>
<a class="sourceLine" id="cb170-11" data-line-number="11"><span class="co">#   filter(yr == 2013) %&gt;%</span></a>
<a class="sourceLine" id="cb170-12" data-line-number="12"><span class="co">#   select(so_cnt, min_orderdate, mo)</span></a>
<a class="sourceLine" id="cb170-13" data-line-number="13"><span class="co"># so_cnt_2013_1_6 &lt;- monthly_sales %&gt;%</span></a>
<a class="sourceLine" id="cb170-14" data-line-number="14"><span class="co">#   filter(yr == 2013 &amp; mo %in% c(1, 2, 3, 4, 5, 6)) %&gt;%</span></a>
<a class="sourceLine" id="cb170-15" data-line-number="15"><span class="co">#   select(so_cnt, min_oderdate, mo)</span></a>
<a class="sourceLine" id="cb170-16" data-line-number="16"><span class="co"># so_cnt_2014 &lt;- monthly_sales %&gt;%</span></a>
<a class="sourceLine" id="cb170-17" data-line-number="17"><span class="co">#   filter(yr == 2014) %&gt;%</span></a>
<a class="sourceLine" id="cb170-18" data-line-number="18"><span class="co">#   select(so_cnt, min_oderdate, mo)</span></a>
<a class="sourceLine" id="cb170-19" data-line-number="19"></a>
<a class="sourceLine" id="cb170-20" data-line-number="20"><span class="co"># STOPPED HERE.  need to join the data frames and plot the lags.</span></a>
<a class="sourceLine" id="cb170-21" data-line-number="21"><span class="co"># so_cnt_2012_2011 &lt;- so_cnt_2012_5_12 / so_cnt_2011</span></a>
<a class="sourceLine" id="cb170-22" data-line-number="22"><span class="co"># so_cnt_2013_2012 &lt;- so_cnt_2013 / so_cnt_2012</span></a>
<a class="sourceLine" id="cb170-23" data-line-number="23"><span class="co"># so_cnt_2014_2013 &lt;- so_cnt_2014 / so_cnt_2013_1_6</span></a>
<a class="sourceLine" id="cb170-24" data-line-number="24"><span class="co"># </span></a>
<a class="sourceLine" id="cb170-25" data-line-number="25"><span class="co"># cat(&quot;2012 vs 2011 sales order ratios for May - December</span></a>
<a class="sourceLine" id="cb170-26" data-line-number="26"><span class="co"># &quot;, unlist(so_cnt_2012_2011))</span></a>
<a class="sourceLine" id="cb170-27" data-line-number="27"><span class="co"># </span></a>
<a class="sourceLine" id="cb170-28" data-line-number="28"><span class="co"># cat(&quot;2013 vs 2012 sales order ratios</span></a>
<a class="sourceLine" id="cb170-29" data-line-number="29"><span class="co"># &quot;, unlist(so_cnt_2013_2012))</span></a>
<a class="sourceLine" id="cb170-30" data-line-number="30"><span class="co"># </span></a>
<a class="sourceLine" id="cb170-31" data-line-number="31"><span class="co"># cat(&quot;2014 vs 2013 sales order ratios for January - June</span></a>
<a class="sourceLine" id="cb170-32" data-line-number="32"><span class="co"># &quot;, unlist(so_cnt_2014_2013))</span></a></code></pre></div>
<p>Comparing the number of sales orders year over year by month for 2013 and 2012, one can see that the 2013 sales are between 1.2 and 1.8 times larger than the corresponding month of 2012 from January through June. In July the 2013 sales are 5 to 6 times the 2012 sales orders.</p>
<p>This trend continues into 2014 before the number of sales plumet to just 1.3 time in June.</p>
<p><strong>What happened in July 2013?</strong></p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" data-line-number="1">mo_onl_pct &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb171-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb171-3" data-line-number="3">  <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb171-4" data-line-number="4"><span class="st">SELECT *</span></a>
<a class="sourceLine" id="cb171-5" data-line-number="5"><span class="st">      ,round(orders/mo_orders * 100.0,2) mo_pct</span></a>
<a class="sourceLine" id="cb171-6" data-line-number="6"><span class="st">      ,round(sales_dollars/mo_sales * 100.0,2) mo_dlr_pct</span></a>
<a class="sourceLine" id="cb171-7" data-line-number="7"><span class="st">  FROM (SELECT EXTRACT(MONTH FROM orderdate) mo, EXTRACT(YEAR FROM orderdate) yr</span></a>
<a class="sourceLine" id="cb171-8" data-line-number="8"><span class="st">             , min(orderdate)::DATE min_orderdate, max(orderdate)::DATE max_orderdate</span></a>
<a class="sourceLine" id="cb171-9" data-line-number="9"><span class="st">             , round(sum(subtotal), 2) sales_dollars</span></a>
<a class="sourceLine" id="cb171-10" data-line-number="10"><span class="st">             , round(sum(sum(subtotal)) over (partition by EXTRACT(MONTH FROM orderdate),EXTRACT(YEAR FROM orderdate)</span></a>
<a class="sourceLine" id="cb171-11" data-line-number="11"><span class="st">                             order by EXTRACT(YEAR FROM orderdate)),2) mo_sales</span></a>
<a class="sourceLine" id="cb171-12" data-line-number="12"><span class="st">             , count(*) * 1.0 orders</span></a>
<a class="sourceLine" id="cb171-13" data-line-number="13"><span class="st">             , sum(count(*)) over (partition by EXTRACT(MONTH FROM orderdate),EXTRACT(YEAR FROM orderdate)</span></a>
<a class="sourceLine" id="cb171-14" data-line-number="14"><span class="st">                             order by EXTRACT(YEAR FROM orderdate)) mo_orders</span></a>
<a class="sourceLine" id="cb171-15" data-line-number="15"><span class="st">             , case when sh.onlineorderflag then &#39;online&#39; else &#39;sales rep&#39; end sales_type</span></a>
<a class="sourceLine" id="cb171-16" data-line-number="16"><span class="st">        FROM sales.salesorderheader sh</span></a>
<a class="sourceLine" id="cb171-17" data-line-number="17"><span class="st">        GROUP BY EXTRACT(MONTH FROM orderdate), EXTRACT(YEAR FROM orderdate), </span></a>
<a class="sourceLine" id="cb171-18" data-line-number="18"><span class="st">                 case when sh.onlineorderflag then &#39;online&#39; else &#39;sales rep&#39; end</span></a>
<a class="sourceLine" id="cb171-19" data-line-number="19"><span class="st">       ) as src</span></a>
<a class="sourceLine" id="cb171-20" data-line-number="20"><span class="st">ORDER BY mo, yr, sales_type</span></a>
<a class="sourceLine" id="cb171-21" data-line-number="21"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb171-22" data-line-number="22">)</a>
<a class="sourceLine" id="cb171-23" data-line-number="23"></a>
<a class="sourceLine" id="cb171-24" data-line-number="24"><span class="kw">sp_print_df</span>(mo_onl_pct)</a></code></pre></div>
<div id="htmlwidget-8f836166d559454ecd73" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8f836166d559454ecd73">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72"],[1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,12],[2012,2012,2013,2013,2014,2014,2012,2012,2013,2013,2014,2014,2012,2012,2013,2013,2014,2014,2012,2012,2013,2013,2014,2014,2011,2011,2012,2012,2013,2013,2014,2014,2011,2012,2012,2013,2013,2014,2011,2011,2012,2012,2013,2013,2011,2011,2012,2012,2013,2013,2011,2012,2012,2013,2013,2011,2011,2012,2012,2013,2013,2011,2012,2012,2013,2013,2011,2011,2012,2012,2013,2013],["2012-01-01","2012-01-01","2013-01-01","2013-01-28","2014-01-01","2014-01-28","2012-02-01","2012-02-29","2013-02-01","2013-02-28","2014-02-01","2014-02-28","2012-03-01","2012-03-30","2013-03-01","2013-03-30","2014-03-01","2014-03-01","2012-04-01","2012-04-30","2013-04-01","2013-04-30","2014-04-01","2014-04-30","2011-05-31","2011-05-31","2012-05-01","2012-05-30","2013-05-01","2013-05-30","2014-05-01","2014-05-01","2011-06-01","2012-06-01","2012-06-30","2013-06-01","2013-06-30","2014-06-01","2011-07-01","2011-07-01","2012-07-01","2012-07-31","2013-07-01","2013-07-31","2011-08-01","2011-08-01","2012-08-01","2012-08-30","2013-08-01","2013-08-30","2011-09-01","2012-09-01","2012-09-30","2013-09-01","2013-09-30","2011-10-01","2011-10-01","2012-10-01","2012-10-30","2013-10-01","2013-10-30","2011-11-01","2012-11-01","2012-11-30","2013-11-01","2013-11-30","2011-12-01","2011-12-01","2012-12-01","2012-12-31","2013-12-01","2013-12-31"],["2012-01-31","2012-01-29","2013-01-31","2013-01-28","2014-01-31","2014-01-29","2012-02-29","2012-02-29","2013-02-28","2013-02-28","2014-02-28","2014-02-28","2012-03-31","2012-03-30","2013-03-31","2013-03-30","2014-03-31","2014-03-31","2012-04-30","2012-04-30","2013-04-30","2013-04-30","2014-04-30","2014-04-30","2011-05-31","2011-05-31","2012-05-31","2012-05-30","2013-05-31","2013-05-30","2014-05-31","2014-05-01","2011-06-30","2012-06-30","2012-06-30","2013-06-30","2013-06-30","2014-06-30","2011-07-31","2011-07-01","2012-07-31","2012-07-31","2013-07-31","2013-07-31","2011-08-31","2011-08-31","2012-08-31","2012-08-30","2013-08-31","2013-08-30","2011-09-30","2012-09-30","2012-09-30","2013-09-30","2013-09-30","2011-10-31","2011-10-31","2012-10-31","2012-10-30","2013-10-31","2013-10-30","2011-11-30","2012-11-30","2012-11-30","2013-11-30","2013-11-30","2011-12-31","2011-12-01","2012-12-31","2012-12-31","2013-12-31","2013-12-31"],[614557.94,3356069.34,523917.38,1563955.08,1551065.56,2738752.39,592526.97,882899.94,451643.72,1865278.43,1334494.39,3230.65,706631.53,2269116.71,531316.29,2880752.68,1691178.91,5526352.18,632797.03,1001803.77,544393.21,1987872.71,1795889.13,1284.79,14477.34,489328.58,680913.29,2393689.52,578200.28,2667423.48,1951195.9,3415479.07,458910.82,498163.64,3601190.71,860141.13,4220928,49005.84,506191.69,1538408.31,532594.67,2885359.2,847138.65,4049215.09,485198.66,2010618.07,373483.01,1802154.21,1049907.39,2284056.68,502073.85,400335.61,3053816.33,1046022.77,3486885.94,561681.48,4027080.34,358877.89,2185213.21,1284592.93,3511220.36,737839.82,555160.14,1317541.83,1643177.78,1668952.47,596746.56,713116.69,444558.23,2384846.59,1371675.81,2703810.82],[3970627.28,3970627.28,2087872.46,2087872.46,4289817.95,4289817.95,1475426.91,1475426.91,2316922.15,2316922.15,1337725.04,1337725.04,2975748.24,2975748.24,3412068.97,3412068.97,7217531.09,7217531.09,1634600.8,1634600.8,2532265.91,2532265.91,1797173.92,1797173.92,503805.92,503805.92,3074602.81,3074602.81,3245623.76,3245623.76,5366674.97,5366674.97,458910.82,4099354.36,4099354.36,5081069.13,5081069.13,49005.84,2044600,2044600,3417953.87,3417953.87,4896353.74,4896353.74,2495816.73,2495816.73,2175637.22,2175637.22,3333964.07,3333964.07,502073.85,3454151.94,3454151.94,4532908.71,4532908.71,4588761.82,4588761.82,2544091.11,2544091.11,4795813.29,4795813.29,737839.82,1872701.98,1872701.98,3312130.25,3312130.25,1309863.25,1309863.25,2829404.82,2829404.82,4075486.63,4075486.63],[193,143,294,106,1966,175,182,37,251,74,1753,3,219,85,307,134,2128,271,201,68,326,102,2113,2,5,38,221,72,333,95,2232,179,141,251,139,533,186,939,156,75,274,111,1564,176,150,100,212,73,1690,99,157,219,133,1612,179,174,153,207,114,1792,176,230,318,65,2007,96,188,40,246,132,1875,175],[336,336,400,400,2141,2141,219,219,325,325,1756,1756,304,304,441,441,2399,2399,269,269,428,428,2115,2115,43,43,293,293,428,428,2411,2411,141,390,390,719,719,939,231,231,385,385,1740,1740,250,250,285,285,1789,1789,157,352,352,1791,1791,327,327,321,321,1968,1968,230,383,383,2103,2103,228,228,378,378,2050,2050],["online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","online","sales rep","online","sales rep","online","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep"],[57.44,42.56,73.5,26.5,91.83,8.17,83.11,16.89,77.23,22.77,99.83,0.17,72.04,27.96,69.61,30.39,88.7,11.3,74.72,25.28,76.17,23.83,99.91,0.09,11.63,88.37,75.43,24.57,77.8,22.2,92.58,7.42,100,64.36,35.64,74.13,25.87,100,67.53,32.47,71.17,28.83,89.89,10.11,60,40,74.39,25.61,94.47,5.53,100,62.22,37.78,90.01,9.99,53.21,46.79,64.49,35.51,91.06,8.94,100,83.03,16.97,95.44,4.56,82.46,17.54,65.08,34.92,91.46,8.54],[15.48,84.52,25.09,74.91,36.16,63.84,40.16,59.84,19.49,80.51,99.76,0.24,23.75,76.25,15.57,84.43,23.43,76.57,38.71,61.29,21.5,78.5,99.93,0.07,2.87,97.13,22.15,77.85,17.81,82.19,36.36,63.64,100,12.15,87.85,16.93,83.07,100,24.76,75.24,15.58,84.42,17.3,82.7,19.44,80.56,17.17,82.83,31.49,68.51,100,11.59,88.41,23.08,76.92,12.24,87.76,14.11,85.89,26.79,73.21,100,29.64,70.36,49.61,50.39,45.56,54.44,15.71,84.29,33.66,66.34]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mo<\/th>\n      <th>yr<\/th>\n      <th>min_orderdate<\/th>\n      <th>max_orderdate<\/th>\n      <th>sales_dollars<\/th>\n      <th>mo_sales<\/th>\n      <th>orders<\/th>\n      <th>mo_orders<\/th>\n      <th>sales_type<\/th>\n      <th>mo_pct<\/th>\n      <th>mo_dlr_pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,5,6,7,8,10,11]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" data-line-number="1">min_dt &lt;-<span class="st"> </span><span class="kw">min</span>(monthly_sales<span class="op">$</span>min_orderdate)</a>
<a class="sourceLine" id="cb172-2" data-line-number="2">max_dt &lt;-<span class="st"> </span><span class="kw">max</span>(monthly_sales<span class="op">$</span>max_orderdate)</a>
<a class="sourceLine" id="cb172-3" data-line-number="3">mo_onl_pct<span class="op">$</span>mo &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mo_onl_pct<span class="op">$</span>mo)</a>
<a class="sourceLine" id="cb172-4" data-line-number="4">mo_onl_pct<span class="op">$</span>yr &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mo_onl_pct<span class="op">$</span>yr)</a>
<a class="sourceLine" id="cb172-5" data-line-number="5">mo_onl_pct<span class="op">$</span>sales_type &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mo_onl_pct<span class="op">$</span>sales_type)</a>
<a class="sourceLine" id="cb172-6" data-line-number="6">mo_<span class="dv">2011</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2011</span>)</a>
<a class="sourceLine" id="cb172-7" data-line-number="7">mo_<span class="dv">2012</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2012</span>)</a>
<a class="sourceLine" id="cb172-8" data-line-number="8">mo_<span class="dv">2013</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2013</span>)</a>
<a class="sourceLine" id="cb172-9" data-line-number="9">mo_<span class="dv">2014</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2014</span>)</a>
<a class="sourceLine" id="cb172-10" data-line-number="10"></a>
<a class="sourceLine" id="cb172-11" data-line-number="11"></a>
<a class="sourceLine" id="cb172-12" data-line-number="12"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-13" data-line-number="13"><span class="st">  </span><span class="co"># data=mo_2011 first results in the x axis months out of order.</span></a>
<a class="sourceLine" id="cb172-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2012</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2011</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2013</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2014</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-18" data-line-number="18"></a>
<a class="sourceLine" id="cb172-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2011</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2012</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2013</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-22" data-line-number="22"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2014</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-23" data-line-number="23"></a>
<a class="sourceLine" id="cb172-24" data-line-number="24"><span class="st">  </span><span class="kw">geom_text</span>(</a>
<a class="sourceLine" id="cb172-25" data-line-number="25">    <span class="dt">data =</span> mo_<span class="dv">2011</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)),</a>
<a class="sourceLine" id="cb172-26" data-line-number="26">    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">hjust =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb172-27" data-line-number="27">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-28" data-line-number="28"><span class="st">  </span><span class="kw">geom_text</span>(</a>
<a class="sourceLine" id="cb172-29" data-line-number="29">    <span class="dt">data =</span> mo_<span class="dv">2012</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)),</a>
<a class="sourceLine" id="cb172-30" data-line-number="30">    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">hjust =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb172-31" data-line-number="31">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-32" data-line-number="32"><span class="st">  </span><span class="kw">geom_text</span>(</a>
<a class="sourceLine" id="cb172-33" data-line-number="33">    <span class="dt">data =</span> mo_<span class="dv">2013</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)),</a>
<a class="sourceLine" id="cb172-34" data-line-number="34">    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">hjust =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb172-35" data-line-number="35">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-36" data-line-number="36"><span class="st">  </span><span class="kw">geom_text</span>(</a>
<a class="sourceLine" id="cb172-37" data-line-number="37">    <span class="dt">data =</span> mo_<span class="dv">2014</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>,</a>
<a class="sourceLine" id="cb172-38" data-line-number="38">    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">vjust =</span> <span class="fl">1.5</span></a>
<a class="sourceLine" id="cb172-39" data-line-number="39">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-40" data-line-number="40"></a>
<a class="sourceLine" id="cb172-41" data-line-number="41"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-42" data-line-number="42"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;% Online Sales</span><span class="ch">\n</span><span class="st">vs</span><span class="ch">\n</span><span class="st">%Rep Sales&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-43" data-line-number="43"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.50</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb172-44" data-line-number="44"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb172-45" data-line-number="45">    <span class="st">&quot;Sales by Month</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb172-46" data-line-number="46">    <span class="st">&quot;Online Orders Versus Rep Orders</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb172-47" data-line-number="47">    min_dt, <span class="st">&quot; - &quot;</span>, max_dt, <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb172-48" data-line-number="48"><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb172-49" data-line-number="49">    <span class="st">&quot;Each Point shows Number of Orders: $ Amount: % of Total $ For the Month&quot;</span></a>
<a class="sourceLine" id="cb172-50" data-line-number="50">  ))</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/On-Line%20Orders%20Versus%20Sales%20Rep%20Orders-2.png" width="1536" />
The sales rep orders brought in over half the monthly sales dollars for every month except three, February, Arpil, and June of 2014. The monthly sales rep orders for those months are 3, 2, and 0 respectively.</p>
</div>
<div id="monthly-sales-rep-performance-analysis" class="section level2">
<h2><span class="header-section-number">9.3</span> Monthly Sales Rep Performance Analysis</h2>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" data-line-number="1">mo_so_sreps &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb173-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb173-3" data-line-number="3">  <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb173-4" data-line-number="4"><span class="st">SELECT *</span></a>
<a class="sourceLine" id="cb173-5" data-line-number="5"><span class="st">      ,round(orders/mo_orders * 100.0,2) mo_pct</span></a>
<a class="sourceLine" id="cb173-6" data-line-number="6"><span class="st">      ,round(sales_dollars/mo_sales * 100.0,2) mo_dlr_pct</span></a>
<a class="sourceLine" id="cb173-7" data-line-number="7"><span class="st">  FROM (SELECT EXTRACT(MONTH FROM orderdate) mo, EXTRACT(YEAR FROM orderdate) yr</span></a>
<a class="sourceLine" id="cb173-8" data-line-number="8"><span class="st">             , min(orderdate)::DATE min_orderdate, max(orderdate)::DATE max_orderdate</span></a>
<a class="sourceLine" id="cb173-9" data-line-number="9"><span class="st">             , round(sum(subtotal), 2) sales_dollars</span></a>
<a class="sourceLine" id="cb173-10" data-line-number="10"><span class="st">             , round(sum(sum(subtotal)) over (partition by EXTRACT(MONTH FROM orderdate),EXTRACT(YEAR FROM orderdate)</span></a>
<a class="sourceLine" id="cb173-11" data-line-number="11"><span class="st">                             order by EXTRACT(YEAR FROM orderdate)),2) mo_sales</span></a>
<a class="sourceLine" id="cb173-12" data-line-number="12"><span class="st">             , count(*) * 1.0 orders</span></a>
<a class="sourceLine" id="cb173-13" data-line-number="13"><span class="st">             , sum(count(*)) over (partition by EXTRACT(MONTH FROM orderdate),EXTRACT(YEAR FROM orderdate)</span></a>
<a class="sourceLine" id="cb173-14" data-line-number="14"><span class="st">                             order by EXTRACT(YEAR FROM orderdate)) mo_orders</span></a>
<a class="sourceLine" id="cb173-15" data-line-number="15"><span class="st">             , case when sh.onlineorderflag then &#39;online&#39; else &#39;sales rep&#39; end sales_type</span></a>
<a class="sourceLine" id="cb173-16" data-line-number="16"><span class="st">        FROM sales.salesorderheader sh</span></a>
<a class="sourceLine" id="cb173-17" data-line-number="17"><span class="st">             INNER JOIN sales.salesorderdetail sd</span></a>
<a class="sourceLine" id="cb173-18" data-line-number="18"><span class="st">                ON sh.salesorderid = sd.salesorderid</span></a>
<a class="sourceLine" id="cb173-19" data-line-number="19"><span class="st">       WHERE not sh.onlineorderflag</span></a>
<a class="sourceLine" id="cb173-20" data-line-number="20"><span class="st">        GROUP BY EXTRACT(MONTH FROM orderdate), EXTRACT(YEAR FROM orderdate), </span></a>
<a class="sourceLine" id="cb173-21" data-line-number="21"><span class="st">                 case when sh.onlineorderflag then &#39;online&#39; else &#39;sales rep&#39; end</span></a>
<a class="sourceLine" id="cb173-22" data-line-number="22"><span class="st">       ) as src</span></a>
<a class="sourceLine" id="cb173-23" data-line-number="23"><span class="st">ORDER BY mo, yr, sales_type</span></a>
<a class="sourceLine" id="cb173-24" data-line-number="24"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb173-25" data-line-number="25">)</a>
<a class="sourceLine" id="cb173-26" data-line-number="26"></a>
<a class="sourceLine" id="cb173-27" data-line-number="27"><span class="kw">sp_print_df</span>(mo_so_sreps)</a></code></pre></div>
<div id="htmlwidget-0d7db73d03839427d3b7" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0d7db73d03839427d3b7">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34"],[1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,5,6,6,7,7,7,8,8,8,9,9,10,10,10,11,11,12,12,12],[2012,2013,2014,2012,2013,2014,2012,2013,2014,2012,2013,2014,2011,2012,2013,2014,2012,2013,2011,2012,2013,2011,2012,2013,2012,2013,2011,2012,2013,2012,2013,2011,2012,2013],["2012-01-01","2013-01-28","2014-01-28","2012-02-29","2013-02-28","2014-02-28","2012-03-30","2013-03-30","2014-03-01","2012-04-30","2013-04-30","2014-04-30","2011-05-31","2012-05-30","2013-05-30","2014-05-01","2012-06-30","2013-06-30","2011-07-01","2012-07-31","2013-07-31","2011-08-01","2012-08-30","2013-08-30","2012-09-30","2013-09-30","2011-10-01","2012-10-30","2013-10-30","2012-11-30","2013-11-30","2011-12-01","2012-12-31","2013-12-31"],["2012-01-29","2013-01-28","2014-01-29","2012-02-29","2013-02-28","2014-02-28","2012-03-30","2013-03-30","2014-03-31","2012-04-30","2013-04-30","2014-04-30","2011-05-31","2012-05-30","2013-05-30","2014-05-01","2012-06-30","2013-06-30","2011-07-01","2012-07-31","2013-07-31","2011-08-31","2012-08-30","2013-08-30","2012-09-30","2013-09-30","2011-10-31","2012-10-30","2013-10-30","2012-11-30","2013-11-30","2011-12-01","2012-12-31","2013-12-31"],[50403482.88,40081731.5,66924961.04,15335522.48,71803004.54,11658.08,43058301.41,104511185.26,186277902.38,21890294.9,72159451.26,4941.62,7174123.22,105012806.67,112718974.22,114624079.99,149177897.11,171233641.32,22655820.8,124954864.42,167739700.18,33272164.17,66745681.72,80194321.92,108204546.77,116019864.91,75576022.46,78671739.6,118198139.39,34775957.79,43717807.86,9164880.69,58164639.46,66783163.73],[50403482.88,40081731.5,66924961.04,15335522.48,71803004.54,11658.08,43058301.41,104511185.26,186277902.38,21890294.9,72159451.26,4941.62,7174123.22,105012806.67,112718974.22,114624079.99,149177897.11,171233641.32,22655820.8,124954864.42,167739700.18,33272164.17,66745681.72,80194321.92,108204546.77,116019864.91,75576022.46,78671739.6,118198139.39,34775957.79,43717807.86,9164880.69,58164639.46,66783163.73],[1519,1215,2180,494,1449,8,1112,2306,4647,819,1698,7,352,1723,2189,3002,2964,3766,785,2185,3768,1092,1406,1813,2345,2911,1909,1732,3032,983,1385,377,1664,2082],[1519,1215,2180,494,1449,8,1112,2306,4647,819,1698,7,352,1723,2189,3002,2964,3766,785,2185,3768,1092,1406,1813,2345,2911,1909,1732,3032,983,1385,377,1664,2082],["sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep","sales rep"],[100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100],[100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mo<\/th>\n      <th>yr<\/th>\n      <th>min_orderdate<\/th>\n      <th>max_orderdate<\/th>\n      <th>sales_dollars<\/th>\n      <th>mo_sales<\/th>\n      <th>orders<\/th>\n      <th>mo_orders<\/th>\n      <th>sales_type<\/th>\n      <th>mo_pct<\/th>\n      <th>mo_dlr_pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,5,6,7,8,10,11]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" data-line-number="1">monthly_sales_online &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb174-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb174-3" data-line-number="3">  <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb174-4" data-line-number="4"><span class="st">SELECT EXTRACT(MONTH FROM orderdate) mo, EXTRACT(YEAR FROM orderdate) yr</span></a>
<a class="sourceLine" id="cb174-5" data-line-number="5"><span class="st">     , min(orderdate)::DATE min_orderdate, max(orderdate)::DATE max_orderdate</span></a>
<a class="sourceLine" id="cb174-6" data-line-number="6"><span class="st">     , so.category</span></a>
<a class="sourceLine" id="cb174-7" data-line-number="7"><span class="st">     , round(sum(subtotal), 2) sales_dollars</span></a>
<a class="sourceLine" id="cb174-8" data-line-number="8"><span class="st">     , count(*) * 1.0 orders</span></a>
<a class="sourceLine" id="cb174-9" data-line-number="9"><span class="st"> FROM sales.salesorderheader sh</span></a>
<a class="sourceLine" id="cb174-10" data-line-number="10"><span class="st">      JOIN sales.salesorderdetail sd ON SH.salesorderid = sd.salesorderid</span></a>
<a class="sourceLine" id="cb174-11" data-line-number="11"><span class="st">      JOIN sales.specialoffer so ON Sd.specialofferid = so.specialofferid</span></a>
<a class="sourceLine" id="cb174-12" data-line-number="12"><span class="st">GROUP BY EXTRACT(MONTH FROM orderdate), EXTRACT(YEAR FROM orderdate), so.category</span></a>
<a class="sourceLine" id="cb174-13" data-line-number="13"><span class="st">ORDER BY mo, yr</span></a>
<a class="sourceLine" id="cb174-14" data-line-number="14"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb174-15" data-line-number="15">)</a>
<a class="sourceLine" id="cb174-16" data-line-number="16"></a>
<a class="sourceLine" id="cb174-17" data-line-number="17"><span class="kw">sp_print_df</span>(monthly_sales_online)</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-8"></span>
<div id="htmlwidget-c2e3fede5c798441fdae" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c2e3fede5c798441fdae">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71"],[1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,12],[2012,2012,2013,2013,2014,2014,2012,2012,2013,2013,2014,2014,2012,2012,2013,2013,2014,2014,2012,2012,2013,2013,2014,2014,2011,2012,2012,2013,2013,2014,2014,2011,2012,2012,2013,2013,2014,2011,2011,2012,2012,2013,2013,2011,2011,2012,2012,2013,2013,2011,2012,2012,2013,2013,2011,2011,2012,2012,2013,2013,2011,2012,2012,2013,2013,2011,2011,2012,2012,2013,2013],["2012-01-01","2012-01-01","2013-01-01","2013-01-01","2014-01-01","2014-01-01","2012-02-29","2012-02-01","2013-02-01","2013-02-01","2014-02-01","2014-02-01","2012-03-01","2012-03-30","2013-03-03","2013-03-01","2014-03-01","2014-03-01","2012-04-01","2012-04-30","2013-04-02","2013-04-01","2014-04-01","2014-04-01","2011-05-31","2012-05-30","2012-05-01","2013-05-01","2013-05-03","2014-05-01","2014-05-01","2011-06-01","2012-06-01","2012-06-01","2013-06-01","2013-06-01","2014-06-01","2011-07-01","2011-07-01","2012-07-01","2012-07-01","2013-07-01","2013-07-01","2011-08-01","2011-08-01","2012-08-01","2012-08-02","2013-08-01","2013-08-01","2011-09-01","2012-09-01","2012-09-01","2013-09-01","2013-09-01","2011-10-01","2011-10-01","2012-10-01","2012-10-01","2013-10-01","2013-10-01","2011-11-01","2012-11-01","2012-11-02","2013-11-01","2013-11-01","2011-12-01","2011-12-01","2012-12-01","2012-12-01","2013-12-01","2013-12-01"],["2012-01-31","2012-01-29","2013-01-31","2013-01-29","2014-01-31","2014-01-31","2012-02-29","2012-02-29","2013-02-28","2013-02-28","2014-02-28","2014-02-28","2012-03-31","2012-03-30","2013-03-31","2013-03-31","2014-03-31","2014-03-31","2012-04-30","2012-04-30","2013-04-30","2013-04-30","2014-04-30","2014-04-30","2011-05-31","2012-05-30","2012-05-31","2013-05-31","2013-05-31","2014-05-30","2014-05-31","2011-06-30","2012-06-30","2012-06-30","2013-06-30","2013-06-30","2014-06-30","2011-07-31","2011-07-01","2012-07-31","2012-07-31","2013-07-31","2013-07-31","2011-08-31","2011-08-31","2012-08-31","2012-08-31","2013-08-31","2013-08-31","2011-09-30","2012-09-30","2012-09-30","2013-09-30","2013-09-30","2011-10-31","2011-10-31","2012-10-31","2012-10-31","2013-10-31","2013-10-31","2011-11-30","2012-11-30","2012-11-30","2013-11-30","2013-11-30","2011-12-01","2011-12-31","2012-12-31","2012-12-31","2013-12-31","2013-12-31"],["No Discount","Reseller","No Discount","Reseller","No Discount","Reseller","Reseller","No Discount","Reseller","No Discount","Reseller","No Discount","No Discount","Reseller","Reseller","No Discount","No Discount","Reseller","No Discount","Reseller","Reseller","No Discount","No Discount","Reseller","No Discount","Reseller","No Discount","No Discount","Reseller","Reseller","No Discount","No Discount","No Discount","Reseller","Reseller","No Discount","No Discount","No Discount","Reseller","No Discount","Reseller","Reseller","No Discount","Reseller","No Discount","No Discount","Reseller","Reseller","No Discount","No Discount","No Discount","Reseller","Reseller","No Discount","Reseller","No Discount","Reseller","No Discount","No Discount","Reseller","No Discount","No Discount","Reseller","No Discount","Reseller","Reseller","No Discount","No Discount","Reseller","Reseller","No Discount"],[50814178.74,203862.08,40032506.6,573142.28,69742390.8,1582808.9,135602.36,15792447.09,2431525.1,69823123.17,140504.74,3564639.51,43269899.65,495033.29,2058467.73,102984033.81,175580040.56,15311788.24,20066327.48,2456764.46,3403198.67,69300645.79,4868938.43,169884.72,7188600.56,13222330.92,92471389.04,90801676.88,22589476.76,8776700.95,111385241.78,458910.82,142674141.64,7001919.11,25496946.18,148114982.82,132262.27,22607387.56,554624.94,115318277.98,10169181.11,27791752.83,142366262.77,388930.53,33368432.3,64698983.5,2420181.23,6707055.72,76411822.26,502073.85,107124609.23,1480273.15,5496530.81,113534809.59,1262024.59,74875679.34,3430213.31,75600404.19,116470799.53,5284860.77,737839.82,34859214.28,471903.66,47215501.22,1135975.6,39547.85,9722079.4,57673867.81,935329.88,1459131.36,69238560.79],[1708,4,1455,54,6867,178,3,673,70,1630,144,4137,1323,8,67,2546,9443,512,880,140,89,1935,5126,176,357,219,1725,2143,429,372,8254,141,3058,157,509,4701,2130,933,8,2311,148,697,6864,8,1234,1554,64,269,5631,157,2509,55,241,6649,17,2066,73,1866,7179,252,230,1257,44,6222,188,1,564,1858,52,185,6568]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mo<\/th>\n      <th>yr<\/th>\n      <th>min_orderdate<\/th>\n      <th>max_orderdate<\/th>\n      <th>category<\/th>\n      <th>sales_dollars<\/th>\n      <th>orders<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 9.3: caption goes here
</p>
</div>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> monthly_sales_online, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(mo), <span class="dt">y =</span> sales_dollars, <span class="dt">fill =</span> <span class="kw">factor</span>(yr))) <span class="op">+</span></a>
<a class="sourceLine" id="cb175-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># unstack columns and outline in black</span></a>
<a class="sourceLine" id="cb175-3" data-line-number="3"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb175-4" data-line-number="4"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sales Dollars&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb175-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span></a>
<a class="sourceLine" id="cb175-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> category),</a>
<a class="sourceLine" id="cb175-7" data-line-number="7">    <span class="dt">size =</span> <span class="fl">2.5</span></a>
<a class="sourceLine" id="cb175-8" data-line-number="8">    <span class="co">#           ,color = &#39;black&#39;</span></a>
<a class="sourceLine" id="cb175-9" data-line-number="9">    , <span class="dt">vjust =</span> <span class="fl">1.5</span>,</a>
<a class="sourceLine" id="cb175-10" data-line-number="10">    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">9</span>)</a>
<a class="sourceLine" id="cb175-11" data-line-number="11">  ) <span class="op">+</span><span class="st"> </span><span class="co"># orders =&gt; avg so $ amt</span></a>
<a class="sourceLine" id="cb175-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.50</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb175-13" data-line-number="13"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Sales by Month</span><span class="ch">\n</span><span class="st">By Online Flag&quot;</span>))</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-8"></span>
<img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-8-2.png" alt="caption goes here" width="1536" />
<p class="caption">
Figure 9.3: caption goes here
</p>
</div>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" data-line-number="1">monthly_sales_onl_pct &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb176-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb176-3" data-line-number="3">  <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb176-4" data-line-number="4"><span class="st">select EXTRACT(MONTH FROM orderdate) mo</span></a>
<a class="sourceLine" id="cb176-5" data-line-number="5"><span class="st">      ,EXTRACT(YEAR FROM orderdate) yr</span></a>
<a class="sourceLine" id="cb176-6" data-line-number="6"><span class="st">      ,sum(ORDERQTY)</span></a>
<a class="sourceLine" id="cb176-7" data-line-number="7"><span class="st">      ,sum(case when salespersonid is null and onlineorderflag then 1 else 0 end) onl</span></a>
<a class="sourceLine" id="cb176-8" data-line-number="8"><span class="st">      ,sum(case when salespersonid is not null and not onlineorderflag then 1 else 0 end) sp</span></a>
<a class="sourceLine" id="cb176-9" data-line-number="9"><span class="st">      ,round(sum(case when onlineorderflag then 1 else 0 end )*1.0/count(*) * 100.0,2) onl_pct</span></a>
<a class="sourceLine" id="cb176-10" data-line-number="10"><span class="st">      ,round(sum(case when not onlineorderflag then 1 else 0 end )*1.0/count(*) * 100.0,2) sp_pct</span></a>
<a class="sourceLine" id="cb176-11" data-line-number="11"><span class="st">      ,onlineorderflag</span></a>
<a class="sourceLine" id="cb176-12" data-line-number="12"><span class="st">      ,count(*)</span></a>
<a class="sourceLine" id="cb176-13" data-line-number="13"><span class="st">  FROM sales.salesorderheader sh</span></a>
<a class="sourceLine" id="cb176-14" data-line-number="14"><span class="st">  INNER JOIN sales.salesorderdetail sd</span></a>
<a class="sourceLine" id="cb176-15" data-line-number="15"><span class="st">          ON sh.salesorderid = sd.salesorderid</span></a>
<a class="sourceLine" id="cb176-16" data-line-number="16"><span class="st">  INNER JOIN production.product p</span></a>
<a class="sourceLine" id="cb176-17" data-line-number="17"><span class="st">          ON sd.productid = p.productid</span></a>
<a class="sourceLine" id="cb176-18" data-line-number="18"><span class="st">  INNER JOIN sales.specialoffer so</span></a>
<a class="sourceLine" id="cb176-19" data-line-number="19"><span class="st">          ON sd.specialofferid = so.specialofferid</span></a>
<a class="sourceLine" id="cb176-20" data-line-number="20"><span class="st">  LEFT OUTER JOIN sales.specialofferproduct sop</span></a>
<a class="sourceLine" id="cb176-21" data-line-number="21"><span class="st">          ON sd.specialofferid = sop.specialofferid</span></a>
<a class="sourceLine" id="cb176-22" data-line-number="22"><span class="st">         and sd.productid = sop.productid</span></a>
<a class="sourceLine" id="cb176-23" data-line-number="23"><span class="st"> WHERE sop.productid is not null</span></a>
<a class="sourceLine" id="cb176-24" data-line-number="24"><span class="st">group by EXTRACT(MONTH FROM orderdate) </span></a>
<a class="sourceLine" id="cb176-25" data-line-number="25"><span class="st">        ,EXTRACT(YEAR FROM orderdate) </span></a>
<a class="sourceLine" id="cb176-26" data-line-number="26"><span class="st">        ,onlineorderflag</span></a>
<a class="sourceLine" id="cb176-27" data-line-number="27"><span class="st">order by mo,yr</span></a>
<a class="sourceLine" id="cb176-28" data-line-number="28"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb176-29" data-line-number="29">)</a>
<a class="sourceLine" id="cb176-30" data-line-number="30"></a>
<a class="sourceLine" id="cb176-31" data-line-number="31"><span class="kw">sp_print_df</span>(monthly_sales_onl_pct)</a></code></pre></div>
<div id="htmlwidget-a77ad32f6b82562872f5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a77ad32f6b82562872f5">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72"],[1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,12],[2012,2012,2013,2013,2014,2014,2012,2012,2013,2013,2014,2014,2012,2012,2013,2013,2014,2014,2012,2012,2013,2013,2014,2014,2011,2011,2012,2012,2013,2013,2014,2014,2011,2012,2012,2013,2013,2014,2011,2011,2012,2012,2013,2013,2011,2011,2012,2012,2013,2013,2011,2012,2012,2013,2013,2011,2011,2012,2012,2013,2013,2011,2012,2012,2013,2013,2011,2011,2012,2012,2013,2013],[193,3774,294,3860,6598,4865,182,1260,5400,251,14,4273,2965,219,307,7943,17274,5308,201,2204,326,6123,18,5295,5,820,7502,221,383,9877,5624,10260,141,11044,251,1444,15167,2130,2053,156,274,8868,14796,3793,150,2754,5355,212,7461,4087,157,8075,219,10597,3979,5208,174,6342,207,10585,4399,230,318,3288,5025,4642,852,188,5159,246,4671,6378],[193,0,294,0,0,4865,182,0,0,251,0,4273,0,219,307,0,0,5308,201,0,326,0,0,5295,5,0,0,221,383,0,5624,0,141,0,251,1444,0,2130,0,156,274,0,0,3793,150,0,0,212,0,4087,157,0,219,0,3979,0,174,0,207,0,4399,230,318,0,5025,0,0,188,0,246,4671,0],[0,1519,0,1215,2180,0,0,494,1449,0,8,0,1112,0,0,2306,4647,0,0,819,0,1698,7,0,0,352,1723,0,0,2189,0,3002,0,2964,0,0,3766,0,785,0,0,2185,3768,0,0,1092,1406,0,1813,0,0,2345,0,2911,0,1909,0,1732,0,3032,0,0,0,983,0,1385,377,0,1664,0,0,2082],[100,0,100,0,0,100,100,0,0,100,0,100,0,100,100,0,0,100,100,0,100,0,0,100,100,0,0,100,100,0,100,0,100,0,100,100,0,100,0,100,100,0,0,100,100,0,0,100,0,100,100,0,100,0,100,0,100,0,100,0,100,100,100,0,100,0,0,100,0,100,100,0],[0,100,0,100,100,0,0,100,100,0,100,0,100,0,0,100,100,0,0,100,0,100,100,0,0,100,100,0,0,100,0,100,0,100,0,0,100,0,100,0,0,100,100,0,0,100,100,0,100,0,0,100,0,100,0,100,0,100,0,100,0,0,0,100,0,100,100,0,100,0,0,100],[true,false,true,false,false,true,true,false,false,true,false,true,false,true,true,false,false,true,true,false,true,false,false,true,true,false,false,true,true,false,true,false,true,false,true,true,false,true,false,true,true,false,false,true,true,false,false,true,false,true,true,false,true,false,true,false,true,false,true,false,true,true,true,false,true,false,false,true,false,true,true,false],[193,1519,294,1215,2180,4865,182,494,1449,251,8,4273,1112,219,307,2306,4647,5308,201,819,326,1698,7,5295,5,352,1723,221,383,2189,5624,3002,141,2964,251,1444,3766,2130,785,156,274,2185,3768,3793,150,1092,1406,212,1813,4087,157,2345,219,2911,3979,1909,174,1732,207,3032,4399,230,318,983,5025,1385,377,188,1664,246,4671,2082]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mo<\/th>\n      <th>yr<\/th>\n      <th>sum<\/th>\n      <th>onl<\/th>\n      <th>sp<\/th>\n      <th>onl_pct<\/th>\n      <th>sp_pct<\/th>\n      <th>onlineorderflag<\/th>\n      <th>count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,9]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" data-line-number="1">mo_onl_pct &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb177-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb177-3" data-line-number="3">  <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb177-4" data-line-number="4"><span class="st">SELECT *</span></a>
<a class="sourceLine" id="cb177-5" data-line-number="5"><span class="st">      ,round(orders/mo_orders * 100.0,2) mo_pct</span></a>
<a class="sourceLine" id="cb177-6" data-line-number="6"><span class="st">      ,round(sales_dollars/mo_sales * 100.0,2) mo_dlr_pct</span></a>
<a class="sourceLine" id="cb177-7" data-line-number="7"><span class="st">  FROM (SELECT EXTRACT(MONTH FROM orderdate) mo, EXTRACT(YEAR FROM orderdate) yr</span></a>
<a class="sourceLine" id="cb177-8" data-line-number="8"><span class="st">             , min(orderdate)::DATE min_orderdate, max(orderdate)::DATE max_orderdate</span></a>
<a class="sourceLine" id="cb177-9" data-line-number="9"><span class="st">             , round(sum(subtotal), 2) sales_dollars</span></a>
<a class="sourceLine" id="cb177-10" data-line-number="10"><span class="st">             , round(sum(sum(subtotal)) over (partition by EXTRACT(MONTH FROM orderdate),EXTRACT(YEAR FROM orderdate)</span></a>
<a class="sourceLine" id="cb177-11" data-line-number="11"><span class="st">                             order by EXTRACT(YEAR FROM orderdate)),2) mo_sales</span></a>
<a class="sourceLine" id="cb177-12" data-line-number="12"><span class="st">             , count(*) * 1.0 orders</span></a>
<a class="sourceLine" id="cb177-13" data-line-number="13"><span class="st">             , sum(count(*)) over (partition by EXTRACT(MONTH FROM orderdate),EXTRACT(YEAR FROM orderdate)</span></a>
<a class="sourceLine" id="cb177-14" data-line-number="14"><span class="st">                             order by EXTRACT(YEAR FROM orderdate)) mo_orders</span></a>
<a class="sourceLine" id="cb177-15" data-line-number="15"><span class="st">             , case when sh.onlineorderflag then &#39;online&#39; else &#39;sales rep&#39; end sales_type</span></a>
<a class="sourceLine" id="cb177-16" data-line-number="16"><span class="st">        FROM sales.salesorderheader sh</span></a>
<a class="sourceLine" id="cb177-17" data-line-number="17"><span class="st">        GROUP BY EXTRACT(MONTH FROM orderdate), EXTRACT(YEAR FROM orderdate), </span></a>
<a class="sourceLine" id="cb177-18" data-line-number="18"><span class="st">                 case when sh.onlineorderflag then &#39;online&#39; else &#39;sales rep&#39; end</span></a>
<a class="sourceLine" id="cb177-19" data-line-number="19"><span class="st">       ) as src</span></a>
<a class="sourceLine" id="cb177-20" data-line-number="20"><span class="st">ORDER BY mo, yr, sales_type</span></a>
<a class="sourceLine" id="cb177-21" data-line-number="21"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb177-22" data-line-number="22">)</a>
<a class="sourceLine" id="cb177-23" data-line-number="23"></a>
<a class="sourceLine" id="cb177-24" data-line-number="24"><span class="kw">sp_print_df</span>(mo_onl_pct)</a></code></pre></div>
<div id="htmlwidget-e3479f292a01744eb530" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e3479f292a01744eb530">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72"],[1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,11,12,12,12,12,12,12],[2012,2012,2013,2013,2014,2014,2012,2012,2013,2013,2014,2014,2012,2012,2013,2013,2014,2014,2012,2012,2013,2013,2014,2014,2011,2011,2012,2012,2013,2013,2014,2014,2011,2012,2012,2013,2013,2014,2011,2011,2012,2012,2013,2013,2011,2011,2012,2012,2013,2013,2011,2012,2012,2013,2013,2011,2011,2012,2012,2013,2013,2011,2012,2012,2013,2013,2011,2011,2012,2012,2013,2013],["2012-01-01","2012-01-01","2013-01-01","2013-01-28","2014-01-01","2014-01-28","2012-02-01","2012-02-29","2013-02-01","2013-02-28","2014-02-01","2014-02-28","2012-03-01","2012-03-30","2013-03-01","2013-03-30","2014-03-01","2014-03-01","2012-04-01","2012-04-30","2013-04-01","2013-04-30","2014-04-01","2014-04-30","2011-05-31","2011-05-31","2012-05-01","2012-05-30","2013-05-01","2013-05-30","2014-05-01","2014-05-01","2011-06-01","2012-06-01","2012-06-30","2013-06-01","2013-06-30","2014-06-01","2011-07-01","2011-07-01","2012-07-01","2012-07-31","2013-07-01","2013-07-31","2011-08-01","2011-08-01","2012-08-01","2012-08-30","2013-08-01","2013-08-30","2011-09-01","2012-09-01","2012-09-30","2013-09-01","2013-09-30","2011-10-01","2011-10-01","2012-10-01","2012-10-30","2013-10-01","2013-10-30","2011-11-01","2012-11-01","2012-11-30","2013-11-01","2013-11-30","2011-12-01","2011-12-01","2012-12-01","2012-12-31","2013-12-01","2013-12-31"],["2012-01-31","2012-01-29","2013-01-31","2013-01-28","2014-01-31","2014-01-29","2012-02-29","2012-02-29","2013-02-28","2013-02-28","2014-02-28","2014-02-28","2012-03-31","2012-03-30","2013-03-31","2013-03-30","2014-03-31","2014-03-31","2012-04-30","2012-04-30","2013-04-30","2013-04-30","2014-04-30","2014-04-30","2011-05-31","2011-05-31","2012-05-31","2012-05-30","2013-05-31","2013-05-30","2014-05-31","2014-05-01","2011-06-30","2012-06-30","2012-06-30","2013-06-30","2013-06-30","2014-06-30","2011-07-31","2011-07-01","2012-07-31","2012-07-31","2013-07-31","2013-07-31","2011-08-31","2011-08-31","2012-08-31","2012-08-30","2013-08-31","2013-08-30","2011-09-30","2012-09-30","2012-09-30","2013-09-30","2013-09-30","2011-10-31","2011-10-31","2012-10-31","2012-10-30","2013-10-31","2013-10-30","2011-11-30","2012-11-30","2012-11-30","2013-11-30","2013-11-30","2011-12-31","2011-12-01","2012-12-31","2012-12-31","2013-12-31","2013-12-31"],[614557.94,3356069.34,523917.38,1563955.08,1551065.56,2738752.39,592526.97,882899.94,451643.72,1865278.43,1334494.39,3230.65,706631.53,2269116.71,531316.29,2880752.68,1691178.91,5526352.18,632797.03,1001803.77,544393.21,1987872.71,1795889.13,1284.79,14477.34,489328.58,680913.29,2393689.52,578200.28,2667423.48,1951195.9,3415479.07,458910.82,498163.64,3601190.71,860141.13,4220928,49005.84,506191.69,1538408.31,532594.67,2885359.2,847138.65,4049215.09,485198.66,2010618.07,373483.01,1802154.21,1049907.39,2284056.68,502073.85,400335.61,3053816.33,1046022.77,3486885.94,561681.48,4027080.34,358877.89,2185213.21,1284592.93,3511220.36,737839.82,555160.14,1317541.83,1643177.78,1668952.47,596746.56,713116.69,444558.23,2384846.59,1371675.81,2703810.82],[3970627.28,3970627.28,2087872.46,2087872.46,4289817.95,4289817.95,1475426.91,1475426.91,2316922.15,2316922.15,1337725.04,1337725.04,2975748.24,2975748.24,3412068.97,3412068.97,7217531.09,7217531.09,1634600.8,1634600.8,2532265.91,2532265.91,1797173.92,1797173.92,503805.92,503805.92,3074602.81,3074602.81,3245623.76,3245623.76,5366674.97,5366674.97,458910.82,4099354.36,4099354.36,5081069.13,5081069.13,49005.84,2044600,2044600,3417953.87,3417953.87,4896353.74,4896353.74,2495816.73,2495816.73,2175637.22,2175637.22,3333964.07,3333964.07,502073.85,3454151.94,3454151.94,4532908.71,4532908.71,4588761.82,4588761.82,2544091.11,2544091.11,4795813.29,4795813.29,737839.82,1872701.98,1872701.98,3312130.25,3312130.25,1309863.25,1309863.25,2829404.82,2829404.82,4075486.63,4075486.63],[193,143,294,106,1966,175,182,37,251,74,1753,3,219,85,307,134,2128,271,201,68,326,102,2113,2,5,38,221,72,333,95,2232,179,141,251,139,533,186,939,156,75,274,111,1564,176,150,100,212,73,1690,99,157,219,133,1612,179,174,153,207,114,1792,176,230,318,65,2007,96,188,40,246,132,1875,175],[336,336,400,400,2141,2141,219,219,325,325,1756,1756,304,304,441,441,2399,2399,269,269,428,428,2115,2115,43,43,293,293,428,428,2411,2411,141,390,390,719,719,939,231,231,385,385,1740,1740,250,250,285,285,1789,1789,157,352,352,1791,1791,327,327,321,321,1968,1968,230,383,383,2103,2103,228,228,378,378,2050,2050],["online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","online","sales rep","online","sales rep","online","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","online","sales rep","online","sales rep","online","sales rep","online","sales rep","online","sales rep"],[57.44,42.56,73.5,26.5,91.83,8.17,83.11,16.89,77.23,22.77,99.83,0.17,72.04,27.96,69.61,30.39,88.7,11.3,74.72,25.28,76.17,23.83,99.91,0.09,11.63,88.37,75.43,24.57,77.8,22.2,92.58,7.42,100,64.36,35.64,74.13,25.87,100,67.53,32.47,71.17,28.83,89.89,10.11,60,40,74.39,25.61,94.47,5.53,100,62.22,37.78,90.01,9.99,53.21,46.79,64.49,35.51,91.06,8.94,100,83.03,16.97,95.44,4.56,82.46,17.54,65.08,34.92,91.46,8.54],[15.48,84.52,25.09,74.91,36.16,63.84,40.16,59.84,19.49,80.51,99.76,0.24,23.75,76.25,15.57,84.43,23.43,76.57,38.71,61.29,21.5,78.5,99.93,0.07,2.87,97.13,22.15,77.85,17.81,82.19,36.36,63.64,100,12.15,87.85,16.93,83.07,100,24.76,75.24,15.58,84.42,17.3,82.7,19.44,80.56,17.17,82.83,31.49,68.51,100,11.59,88.41,23.08,76.92,12.24,87.76,14.11,85.89,26.79,73.21,100,29.64,70.36,49.61,50.39,45.56,54.44,15.71,84.29,33.66,66.34]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mo<\/th>\n      <th>yr<\/th>\n      <th>min_orderdate<\/th>\n      <th>max_orderdate<\/th>\n      <th>sales_dollars<\/th>\n      <th>mo_sales<\/th>\n      <th>orders<\/th>\n      <th>mo_orders<\/th>\n      <th>sales_type<\/th>\n      <th>mo_pct<\/th>\n      <th>mo_dlr_pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,5,6,7,8,10,11]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1">min_dt &lt;-<span class="st"> </span><span class="kw">min</span>(monthly_sales<span class="op">$</span>min_orderdate)</a>
<a class="sourceLine" id="cb178-2" data-line-number="2">max_dt &lt;-<span class="st"> </span><span class="kw">max</span>(monthly_sales<span class="op">$</span>max_orderdate)</a>
<a class="sourceLine" id="cb178-3" data-line-number="3">mo_onl_pct<span class="op">$</span>mo &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mo_onl_pct<span class="op">$</span>mo)</a>
<a class="sourceLine" id="cb178-4" data-line-number="4">mo_onl_pct<span class="op">$</span>yr &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mo_onl_pct<span class="op">$</span>yr)</a>
<a class="sourceLine" id="cb178-5" data-line-number="5">mo_onl_pct<span class="op">$</span>sales_type &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mo_onl_pct<span class="op">$</span>sales_type)</a>
<a class="sourceLine" id="cb178-6" data-line-number="6">mo_<span class="dv">2011</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2011</span>)</a>
<a class="sourceLine" id="cb178-7" data-line-number="7">mo_<span class="dv">2012</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2012</span>)</a>
<a class="sourceLine" id="cb178-8" data-line-number="8">mo_<span class="dv">2013</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2013</span>)</a>
<a class="sourceLine" id="cb178-9" data-line-number="9">mo_<span class="dv">2014</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2014</span>)</a>
<a class="sourceLine" id="cb178-10" data-line-number="10"></a>
<a class="sourceLine" id="cb178-11" data-line-number="11"></a>
<a class="sourceLine" id="cb178-12" data-line-number="12"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-13" data-line-number="13"><span class="st">  </span><span class="co"># data=mo_2011 first results in the x axis months out of order.</span></a>
<a class="sourceLine" id="cb178-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2012</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2011</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2013</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2014</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-18" data-line-number="18"></a>
<a class="sourceLine" id="cb178-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2011</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2012</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2013</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-22" data-line-number="22"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2014</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-23" data-line-number="23"></a>
<a class="sourceLine" id="cb178-24" data-line-number="24"><span class="st">  </span><span class="kw">geom_text</span>(</a>
<a class="sourceLine" id="cb178-25" data-line-number="25">    <span class="dt">data =</span> mo_<span class="dv">2011</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)),</a>
<a class="sourceLine" id="cb178-26" data-line-number="26">    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.25</span>, <span class="dt">hjust =</span> <span class="fl">1.0</span></a>
<a class="sourceLine" id="cb178-27" data-line-number="27">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-28" data-line-number="28"><span class="st">  </span><span class="kw">geom_text</span>(</a>
<a class="sourceLine" id="cb178-29" data-line-number="29">    <span class="dt">data =</span> mo_<span class="dv">2012</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)),</a>
<a class="sourceLine" id="cb178-30" data-line-number="30">    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.25</span>, <span class="dt">hjust =</span> <span class="fl">1.0</span></a>
<a class="sourceLine" id="cb178-31" data-line-number="31">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-32" data-line-number="32"><span class="st">  </span><span class="kw">geom_text</span>(</a>
<a class="sourceLine" id="cb178-33" data-line-number="33">    <span class="dt">data =</span> mo_<span class="dv">2013</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)),</a>
<a class="sourceLine" id="cb178-34" data-line-number="34">    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.25</span>, <span class="dt">hjust =</span> <span class="fl">1.0</span></a>
<a class="sourceLine" id="cb178-35" data-line-number="35">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-36" data-line-number="36"><span class="st">  </span><span class="kw">geom_text</span>(</a>
<a class="sourceLine" id="cb178-37" data-line-number="37">    <span class="dt">data =</span> mo_<span class="dv">2014</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>,</a>
<a class="sourceLine" id="cb178-38" data-line-number="38">    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.25</span>, <span class="dt">hjust =</span> <span class="fl">1.0</span>, <span class="dt">vjust =</span> <span class="fl">1.5</span></a>
<a class="sourceLine" id="cb178-39" data-line-number="39">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-40" data-line-number="40"></a>
<a class="sourceLine" id="cb178-41" data-line-number="41"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-42" data-line-number="42"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;% Online Sales</span><span class="ch">\n</span><span class="st">vs</span><span class="ch">\n</span><span class="st">%Rep Sales&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-43" data-line-number="43"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.50</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb178-44" data-line-number="44"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb178-45" data-line-number="45">    <span class="st">&quot;Sales by Month</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb178-46" data-line-number="46">    <span class="st">&quot;Online Orders Versus Rep Orders</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb178-47" data-line-number="47">    min_dt, <span class="st">&quot; - &quot;</span>, max_dt, <span class="st">&quot;</span></a>
<a class="sourceLine" id="cb178-48" data-line-number="48"><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb178-49" data-line-number="49">    <span class="st">&quot;Each Point shows Number of Orders: $ Amount: % of Total $ For the Month&quot;</span></a>
<a class="sourceLine" id="cb178-50" data-line-number="50">  ))</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-10-2.png" width="1536" /></p>
<p>This plot is much easier to read, but the sales orders =&gt; avg_s
From the tidyR overview, <a href="https://tidyr.tidyverse.org/" class="uri">https://tidyr.tidyverse.org/</a>:</p>
<p>Tidy data is data where:</p>
<ul>
<li>Each variable is in a column.</li>
<li>Each observation is a row.</li>
<li>Each value is a cell.</li>
</ul>
<p>The gather command throws the following warning:</p>
<pre><code>attributes are not identical across measure variables;
they will be dropped</code></pre>
</div>
<div id="adventure-works-monthly-sales" class="section level2">
<h2><span class="header-section-number">9.4</span> Adventure Works Monthly Sales</h2>
<p>Instead of annual sales, we drill into the monthly sales to see how sales dollars are generated over the year. We also clean up our next graph a bit. The y-axis is rescaled to make it easier to read and center the title.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" data-line-number="1">monthly_sales &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</a>
<a class="sourceLine" id="cb180-2" data-line-number="2">  con,</a>
<a class="sourceLine" id="cb180-3" data-line-number="3">  <span class="st">&quot;SELECT to_char(orderdate,&#39;YYMM&#39;) yymm</span></a>
<a class="sourceLine" id="cb180-4" data-line-number="4"><span class="st">    ,min(orderdate)::date min_orderdate</span></a>
<a class="sourceLine" id="cb180-5" data-line-number="5"><span class="st">    ,max(orderdate)::date max_orderdate</span></a>
<a class="sourceLine" id="cb180-6" data-line-number="6"><span class="st">    ,count(*) nbr_of_orders</span></a>
<a class="sourceLine" id="cb180-7" data-line-number="7"><span class="st">    ,round(sum(subtotal),2) subtotal</span></a>
<a class="sourceLine" id="cb180-8" data-line-number="8"><span class="st">FROM sales.salesorderheader sh</span></a>
<a class="sourceLine" id="cb180-9" data-line-number="9"><span class="st">GROUP BY to_char(orderdate,&#39;YYMM&#39;) </span></a>
<a class="sourceLine" id="cb180-10" data-line-number="10"><span class="st">ORDER BY to_char(orderdate,&#39;YYMM&#39;)</span></a>
<a class="sourceLine" id="cb180-11" data-line-number="11"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb180-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb180-13" data-line-number="13"></a>
<a class="sourceLine" id="cb180-14" data-line-number="14">monthly_sales</a></code></pre></div>
<pre><code>##    yymm min_orderdate max_orderdate nbr_of_orders   subtotal
## 1  1105    2011-05-31    2011-05-31            43  503805.92
## 2  1106    2011-06-01    2011-06-30           141  458910.82
## 3  1107    2011-07-01    2011-07-31           231 2044600.00
## 4  1108    2011-08-01    2011-08-31           250 2495816.73
## 5  1109    2011-09-01    2011-09-30           157  502073.85
## 6  1110    2011-10-01    2011-10-31           327 4588761.82
## 7  1111    2011-11-01    2011-11-30           230  737839.82
## 8  1112    2011-12-01    2011-12-31           228 1309863.25
## 9  1201    2012-01-01    2012-01-31           336 3970627.28
## 10 1202    2012-02-01    2012-02-29           219 1475426.91
## 11 1203    2012-03-01    2012-03-31           304 2975748.24
## 12 1204    2012-04-01    2012-04-30           269 1634600.80
## 13 1205    2012-05-01    2012-05-31           293 3074602.81
## 14 1206    2012-06-01    2012-06-30           390 4099354.36
## 15 1207    2012-07-01    2012-07-31           385 3417953.87
## 16 1208    2012-08-01    2012-08-31           285 2175637.22
## 17 1209    2012-09-01    2012-09-30           352 3454151.94
## 18 1210    2012-10-01    2012-10-31           321 2544091.11
## 19 1211    2012-11-01    2012-11-30           383 1872701.98
## 20 1212    2012-12-01    2012-12-31           378 2829404.82
## 21 1301    2013-01-01    2013-01-31           400 2087872.46
## 22 1302    2013-02-01    2013-02-28           325 2316922.15
## 23 1303    2013-03-01    2013-03-31           441 3412068.97
## 24 1304    2013-04-01    2013-04-30           428 2532265.91
## 25 1305    2013-05-01    2013-05-31           428 3245623.76
## 26 1306    2013-06-01    2013-06-30           719 5081069.13
## 27 1307    2013-07-01    2013-07-31          1740 4896353.74
## 28 1308    2013-08-01    2013-08-31          1789 3333964.07
## 29 1309    2013-09-01    2013-09-30          1791 4532908.71
## 30 1310    2013-10-01    2013-10-31          1968 4795813.29
## 31 1311    2013-11-01    2013-11-30          2103 3312130.25
## 32 1312    2013-12-01    2013-12-31          2050 4075486.63
## 33 1401    2014-01-01    2014-01-31          2141 4289817.95
## 34 1402    2014-02-01    2014-02-28          1756 1337725.04
## 35 1403    2014-03-01    2014-03-31          2399 7217531.09
## 36 1404    2014-04-01    2014-04-30          2115 1797173.92
## 37 1405    2014-05-01    2014-05-31          2411 5366674.97
## 38 1406    2014-06-01    2014-06-30           939   49005.84</code></pre>
<p>translate previous query with dplyr</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" data-line-number="1">monthly_sales &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb182-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">order_date =</span> <span class="kw">substr</span>(<span class="kw">as.character</span>(orderdate), <span class="dv">1</span>, <span class="dv">7</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb182-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(order_date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb182-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb182-5" data-line-number="5">    <span class="dt">min_orderdate =</span> <span class="kw">min</span>(orderdate),</a>
<a class="sourceLine" id="cb182-6" data-line-number="6">    <span class="dt">max_orderdate =</span> <span class="kw">max</span>(orderdate),</a>
<a class="sourceLine" id="cb182-7" data-line-number="7">    <span class="dt">nbr_of_orders =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb182-8" data-line-number="8">    <span class="dt">so_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb182-9" data-line-number="9">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb182-10" data-line-number="10"><span class="st">  </span><span class="kw">arrange</span>(order_date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb182-11" data-line-number="11"><span class="st">  </span><span class="kw">select</span>(order_date, min_orderdate, max_orderdate, nbr_of_orders, so_dollars) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb182-12" data-line-number="12"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb182-13" data-line-number="13"><span class="st">  </span><span class="kw">as.data.frame</span>()</a></code></pre></div>
<pre><code>## Warning: Missing values are always removed in SQL.
## Use `MIN(x, na.rm = TRUE)` to silence this warning
## This warning is displayed only once per session.</code></pre>
<pre><code>## Warning: Missing values are always removed in SQL.
## Use `MAX(x, na.rm = TRUE)` to silence this warning
## This warning is displayed only once per session.</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" data-line-number="1">monthly_sales</a></code></pre></div>
<pre><code>##    order_date min_orderdate max_orderdate nbr_of_orders so_dollars
## 1     2011-05    2011-05-31    2011-05-31            43  503805.92
## 2     2011-06    2011-06-01    2011-06-30           141  458910.82
## 3     2011-07    2011-07-01    2011-07-31           231 2044600.00
## 4     2011-08    2011-08-01    2011-08-31           250 2495816.73
## 5     2011-09    2011-09-01    2011-09-30           157  502073.85
## 6     2011-10    2011-10-01    2011-10-31           327 4588761.82
## 7     2011-11    2011-11-01    2011-11-30           230  737839.82
## 8     2011-12    2011-12-01    2011-12-31           228 1309863.25
## 9     2012-01    2012-01-01    2012-01-31           336 3970627.28
## 10    2012-02    2012-02-01    2012-02-29           219 1475426.91
## 11    2012-03    2012-03-01    2012-03-31           304 2975748.24
## 12    2012-04    2012-04-01    2012-04-30           269 1634600.80
## 13    2012-05    2012-05-01    2012-05-31           293 3074602.81
## 14    2012-06    2012-06-01    2012-06-30           390 4099354.36
## 15    2012-07    2012-07-01    2012-07-31           385 3417953.87
## 16    2012-08    2012-08-01    2012-08-31           285 2175637.22
## 17    2012-09    2012-09-01    2012-09-30           352 3454151.94
## 18    2012-10    2012-10-01    2012-10-31           321 2544091.11
## 19    2012-11    2012-11-01    2012-11-30           383 1872701.98
## 20    2012-12    2012-12-01    2012-12-31           378 2829404.82
## 21    2013-01    2013-01-01    2013-01-31           400 2087872.46
## 22    2013-02    2013-02-01    2013-02-28           325 2316922.15
## 23    2013-03    2013-03-01    2013-03-31           441 3412068.97
## 24    2013-04    2013-04-01    2013-04-30           428 2532265.91
## 25    2013-05    2013-05-01    2013-05-31           428 3245623.76
## 26    2013-06    2013-06-01    2013-06-30           719 5081069.13
## 27    2013-07    2013-07-01    2013-07-31          1740 4896353.74
## 28    2013-08    2013-08-01    2013-08-31          1789 3333964.07
## 29    2013-09    2013-09-01    2013-09-30          1791 4532908.71
## 30    2013-10    2013-10-01    2013-10-31          1968 4795813.29
## 31    2013-11    2013-11-01    2013-11-30          2103 3312130.25
## 32    2013-12    2013-12-01    2013-12-31          2050 4075486.63
## 33    2014-01    2014-01-01    2014-01-31          2141 4289817.95
## 34    2014-02    2014-02-01    2014-02-28          1756 1337725.04
## 35    2014-03    2014-03-01    2014-03-31          2399 7217531.09
## 36    2014-04    2014-04-01    2014-04-30          2115 1797173.92
## 37    2014-05    2014-05-01    2014-05-31          2411 5366674.97
## 38    2014-06    2014-06-01    2014-06-30           939   49005.84</code></pre>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1"><span class="kw">sp_print_df</span>(monthly_sales)</a></code></pre></div>
<div id="htmlwidget-65b7328530dcdf303887" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-65b7328530dcdf303887">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38"],["2011-05","2011-06","2011-07","2011-08","2011-09","2011-10","2011-11","2011-12","2012-01","2012-02","2012-03","2012-04","2012-05","2012-06","2012-07","2012-08","2012-09","2012-10","2012-11","2012-12","2013-01","2013-02","2013-03","2013-04","2013-05","2013-06","2013-07","2013-08","2013-09","2013-10","2013-11","2013-12","2014-01","2014-02","2014-03","2014-04","2014-05","2014-06"],["2011-05-31T07:00:00Z","2011-06-01T07:00:00Z","2011-07-01T07:00:00Z","2011-08-01T07:00:00Z","2011-09-01T07:00:00Z","2011-10-01T07:00:00Z","2011-11-01T07:00:00Z","2011-12-01T08:00:00Z","2012-01-01T08:00:00Z","2012-02-01T08:00:00Z","2012-03-01T08:00:00Z","2012-04-01T07:00:00Z","2012-05-01T07:00:00Z","2012-06-01T07:00:00Z","2012-07-01T07:00:00Z","2012-08-01T07:00:00Z","2012-09-01T07:00:00Z","2012-10-01T07:00:00Z","2012-11-01T07:00:00Z","2012-12-01T08:00:00Z","2013-01-01T08:00:00Z","2013-02-01T08:00:00Z","2013-03-01T08:00:00Z","2013-04-01T07:00:00Z","2013-05-01T07:00:00Z","2013-06-01T07:00:00Z","2013-07-01T07:00:00Z","2013-08-01T07:00:00Z","2013-09-01T07:00:00Z","2013-10-01T07:00:00Z","2013-11-01T07:00:00Z","2013-12-01T08:00:00Z","2014-01-01T08:00:00Z","2014-02-01T08:00:00Z","2014-03-01T08:00:00Z","2014-04-01T07:00:00Z","2014-05-01T07:00:00Z","2014-06-01T07:00:00Z"],["2011-05-31T07:00:00Z","2011-06-30T07:00:00Z","2011-07-31T07:00:00Z","2011-08-31T07:00:00Z","2011-09-30T07:00:00Z","2011-10-31T07:00:00Z","2011-11-30T08:00:00Z","2011-12-31T08:00:00Z","2012-01-31T08:00:00Z","2012-02-29T08:00:00Z","2012-03-31T07:00:00Z","2012-04-30T07:00:00Z","2012-05-31T07:00:00Z","2012-06-30T07:00:00Z","2012-07-31T07:00:00Z","2012-08-31T07:00:00Z","2012-09-30T07:00:00Z","2012-10-31T07:00:00Z","2012-11-30T08:00:00Z","2012-12-31T08:00:00Z","2013-01-31T08:00:00Z","2013-02-28T08:00:00Z","2013-03-31T07:00:00Z","2013-04-30T07:00:00Z","2013-05-31T07:00:00Z","2013-06-30T07:00:00Z","2013-07-31T07:00:00Z","2013-08-31T07:00:00Z","2013-09-30T07:00:00Z","2013-10-31T07:00:00Z","2013-11-30T08:00:00Z","2013-12-31T08:00:00Z","2014-01-31T08:00:00Z","2014-02-28T08:00:00Z","2014-03-31T07:00:00Z","2014-04-30T07:00:00Z","2014-05-31T07:00:00Z","2014-06-30T07:00:00Z"],[43,141,231,250,157,327,230,228,336,219,304,269,293,390,385,285,352,321,383,378,400,325,441,428,428,719,1740,1789,1791,1968,2103,2050,2141,1756,2399,2115,2411,939],[503805.92,458910.82,2044600,2495816.73,502073.85,4588761.82,737839.82,1309863.25,3970627.28,1475426.91,2975748.24,1634600.8,3074602.81,4099354.36,3417953.87,2175637.22,3454151.94,2544091.11,1872701.98,2829404.82,2087872.46,2316922.15,3412068.97,2532265.91,3245623.76,5081069.13,4896353.74,3333964.07,4532908.71,4795813.29,3312130.25,4075486.63,4289817.95,1337725.04,7217531.09,1797173.92,5366674.97,49005.84]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>order_date<\/th>\n      <th>min_orderdate<\/th>\n      <th>max_orderdate<\/th>\n      <th>nbr_of_orders<\/th>\n      <th>so_dollars<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> monthly_sales, <span class="kw">aes</span>(<span class="dt">x =</span> min_orderdate, <span class="dt">y =</span> so_dollars)) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="co"># fill = &#39;green&#39;, color = &#39;blue&#39;) +</span></a>
<a class="sourceLine" id="cb188-3" data-line-number="3"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-4" data-line-number="4"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sales&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span><span class="st"> </span><span class="co"># see scales library</span></a>
<a class="sourceLine" id="cb188-6" data-line-number="6"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Sales by Month</span><span class="ch">\n</span><span class="st">&quot;</span>, min_dt, <span class="st">&quot; - &quot;</span>, max_dt)) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-7" data-line-number="7"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></a>
<a class="sourceLine" id="cb188-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">60</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</a></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-13-2.png" width="1440" /></p>
</div>
<div id="views" class="section level2">
<h2><span class="header-section-number">9.5</span> Views</h2>
<div id="explore-the-vsalelsperson-and-vsalespersonsalesbyfiscalyearsdata-views" class="section level3">
<h3><span class="header-section-number">9.5.1</span> Explore the vsalelsperson and vsalespersonsalesbyfiscalyearsdata views</h3>
<p>The following trick goes later in the book, where it’s used to prove the finding that to make sense of othe data you need to</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">unlist</span>(<span class="kw">dbGetQuery</span>(con, <span class="st">&quot;select pg_get_viewdef(&#39;sales.vsalesperson&#39;, true)&quot;</span>)))</a></code></pre></div>
<pre><code>##  SELECT s.businessentityid,
##     p.title,
##     p.firstname,
##     p.middlename,
##     p.lastname,
##     p.suffix,
##     e.jobtitle,
##     pp.phonenumber,
##     pnt.name AS phonenumbertype,
##     ea.emailaddress,
##     p.emailpromotion,
##     a.addressline1,
##     a.addressline2,
##     a.city,
##     sp.name AS stateprovincename,
##     a.postalcode,
##     cr.name AS countryregionname,
##     st.name AS territoryname,
##     st.&quot;group&quot; AS territorygroup,
##     s.salesquota,
##     s.salesytd,
##     s.saleslastyear
##    FROM sales.salesperson s
##      JOIN humanresources.employee e ON e.businessentityid = s.businessentityid
##      JOIN person.person p ON p.businessentityid = s.businessentityid
##      JOIN person.businessentityaddress bea ON bea.businessentityid = s.businessentityid
##      JOIN person.address a ON a.addressid = bea.addressid
##      JOIN person.stateprovince sp ON sp.stateprovinceid = a.stateprovinceid
##      JOIN person.countryregion cr ON cr.countryregioncode::text = sp.countryregioncode::text
##      LEFT JOIN sales.salesterritory st ON st.territoryid = s.territoryid
##      LEFT JOIN person.emailaddress ea ON ea.businessentityid = p.businessentityid
##      LEFT JOIN person.personphone pp ON pp.businessentityid = p.businessentityid
##      LEFT JOIN person.phonenumbertype pnt ON pnt.phonenumbertypeid = pp.phonenumbertypeid;</code></pre>
<pre><code>##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           pg_get_viewdef
## 1  SELECT granular.salespersonid,\n    granular.fullname,\n    granular.jobtitle,\n    granular.salesterritory,\n    sum(granular.subtotal) AS salestotal,\n    granular.fiscalyear\n   FROM ( SELECT soh.salespersonid,\n            ((p.firstname::text || &#39; &#39;::text) || COALESCE(p.middlename::text || &#39; &#39;::text, &#39;&#39;::text)) || p.lastname::text AS fullname,\n            e.jobtitle,\n            st.name AS salesterritory,\n            soh.subtotal,\n            date_part(&#39;year&#39;::text, soh.orderdate + &#39;6 mons&#39;::interval) AS fiscalyear\n           FROM sales.salesperson sp\n             JOIN sales.salesorderheader soh ON sp.businessentityid = soh.salespersonid\n             JOIN sales.salesterritory st ON sp.territoryid = st.territoryid\n             JOIN humanresources.employee e ON soh.salespersonid = e.businessentityid\n             JOIN person.person p ON p.businessentityid = sp.businessentityid) granular\n  GROUP BY granular.salespersonid, granular.fullname, granular.jobtitle, granular.salesterritory, granular.fiscalyear;</code></pre>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-dbms-queries-intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="close-and-clean-up.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/smithjd/sql-pet/edit/master/083-exploring-a-single-table.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
