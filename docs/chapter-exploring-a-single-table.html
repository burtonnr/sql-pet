<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Exploring a Single Table (asking Business Questions) | Exploring Enterprise Databases with R: A Tidyverse Approach</title>
  <meta name="description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Exploring a Single Table (asking Business Questions) | Exploring Enterprise Databases with R: A Tidyverse Approach" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Exploring a Single Table (asking Business Questions) | Exploring Enterprise Databases with R: A Tidyverse Approach" />
  
  <meta name="twitter:description" content="An introduction to Docker and PostgreSQL for R users to simulate use cases behind corporate walls." />
  

<meta name="author" content="John David Smith, Sophie Yang, M. Edward (Ed) Borasky, Jim Tyhurst, Scott Came, Mary Anne Thygesen, and Ian Frantz" />


<meta name="date" content="2019-10-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-dbms-queries-intro.html"/>
<link rel="next" href="chapter-sales-forecasting.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.9/datatables.js"></script>
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.19/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R, Databases and Docker</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#using-r-to-query-a-dbms-in-your-organization"><i class="fa fa-check"></i><b>1.1</b> Using R to query a DBMS in your organization</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#docker-as-a-tool-for-users"><i class="fa fa-check"></i><b>1.2</b> Docker as a tool for UseRs</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#alternatives-to-docker"><i class="fa fa-check"></i><b>1.3</b> Alternatives to Docker</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#packages-used-in-this-book"><i class="fa fa-check"></i><b>1.4</b> Packages used in this book</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#who-are-we"><i class="fa fa-check"></i><b>1.5</b> Who are we?</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#how-did-this-project-come-about"><i class="fa fa-check"></i><b>1.6</b> How did this project come about?</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#navigation"><i class="fa fa-check"></i><b>1.7</b> Navigation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html"><i class="fa fa-check"></i><b>2</b> How to use this book</a><ul>
<li class="chapter" data-level="2.1" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#retrieve-the-code-from-github"><i class="fa fa-check"></i><b>2.1</b> Retrieve the code from GitHub</a></li>
<li class="chapter" data-level="2.2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#read-along-experiment-as-you-go"><i class="fa fa-check"></i><b>2.2</b> Read along, experiment as you go</a></li>
<li class="chapter" data-level="2.3" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#participating"><i class="fa fa-check"></i><b>2.3</b> Participating</a><ul>
<li class="chapter" data-level="2.3.1" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#browsing-the-book"><i class="fa fa-check"></i><b>2.3.1</b> Browsing the book</a></li>
<li class="chapter" data-level="2.3.2" data-path="chapter-how-to-use-this-book.html"><a href="chapter-how-to-use-this-book.html#diving-in"><i class="fa fa-check"></i><b>2.3.2</b> Diving in</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html"><i class="fa fa-check"></i><b>3</b> Learning Goals and Use Cases</a><ul>
<li class="chapter" data-level="3.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#challenge-goals-context-and-expectations"><i class="fa fa-check"></i><b>3.1</b> Challenge: goals, context and expectations</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#the-challenge-investigating-a-question-using-an-organizations-database"><i class="fa fa-check"></i><b>3.2</b> The Challenge: Investigating a question using an organization’s database</a><ul>
<li class="chapter" data-level="3.2.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#problems-that-we-address-in-the-book"><i class="fa fa-check"></i><b>3.2.1</b> Problems that we address in the book</a></li>
<li class="chapter" data-level="3.2.2" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#book-structure"><i class="fa fa-check"></i><b>3.2.2</b> Book structure</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#making-your-way-through-the-book"><i class="fa fa-check"></i><b>3.3</b> Making your way through the book</a><ul>
<li class="chapter" data-level="3.3.1" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#r-packages"><i class="fa fa-check"></i><b>3.3.1</b> R Packages</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="chapter-learning-goals.html"><a href="chapter-learning-goals.html#adventure-works"><i class="fa fa-check"></i><b>3.4</b> Adventure Works</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html"><i class="fa fa-check"></i><b>4</b> Create and connect to the adventureworks database in PostgreSQL</a><ul>
<li class="chapter" data-level="4.1" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#overview"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#verify-that-docker-is-up-running-and-clean-up-if-necessary"><i class="fa fa-check"></i><b>4.2</b> Verify that Docker is up, running, and clean up if necessary</a></li>
<li class="chapter" data-level="4.3" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#clean-up-if-appropriate"><i class="fa fa-check"></i><b>4.3</b> Clean up if appropriate</a></li>
<li class="chapter" data-level="4.4" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#build-the-adventureworks-docker-image"><i class="fa fa-check"></i><b>4.4</b> Build the adventureworks Docker image</a></li>
<li class="chapter" data-level="4.5" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#run-the-adventureworks-docker-image"><i class="fa fa-check"></i><b>4.5</b> Run the adventureworks Docker Image</a></li>
<li class="chapter" data-level="4.6" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#connect-to-postgresql"><i class="fa fa-check"></i><b>4.6</b> Connect to PostgreSQL</a></li>
<li class="chapter" data-level="4.7" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#adventureworks-schemas"><i class="fa fa-check"></i><b>4.7</b> Adventureworks Schemas</a></li>
<li class="chapter" data-level="4.8" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#investigate-the-database-using-rstudio"><i class="fa fa-check"></i><b>4.8</b> Investigate the database using Rstudio</a></li>
<li class="chapter" data-level="4.9" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#cleaning-up"><i class="fa fa-check"></i><b>4.9</b> Cleaning up</a></li>
<li class="chapter" data-level="4.10" data-path="chapter-setup-adventureworks-db.html"><a href="chapter-setup-adventureworks-db.html#using-the-adventureworks-container-in-the-rest-of-the-book"><i class="fa fa-check"></i><b>4.10</b> Using the <code>adventureworks</code> container in the rest of the book</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html"><i class="fa fa-check"></i><b>5</b> Securing and using your dbms log-in credentials</a><ul>
<li class="chapter" data-level="5.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#set-up-the-adventureworks-docker-container"><i class="fa fa-check"></i><b>5.1</b> Set up the adventureworks Docker container</a><ul>
<li class="chapter" data-level="5.1.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#verify-that-docker-is-running"><i class="fa fa-check"></i><b>5.1.1</b> Verify that Docker is running</a></li>
<li class="chapter" data-level="5.1.2" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#start-the-docker-container"><i class="fa fa-check"></i><b>5.1.2</b> Start the Docker container:</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#storing-your-dbms-credentials"><i class="fa fa-check"></i><b>5.2</b> Storing your dbms credentials</a><ul>
<li class="chapter" data-level="5.2.1" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#connect-with-postgres-using-the-sys.getenv-function"><i class="fa fa-check"></i><b>5.2.1</b> Connect with Postgres using the Sys.getenv function</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="chapter-dbms-login-credentials.html"><a href="chapter-dbms-login-credentials.html#clean-up"><i class="fa fa-check"></i><b>5.3</b> Clean up</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html"><i class="fa fa-check"></i><b>6</b> Connecting to the database with R code</a><ul>
<li class="chapter" data-level="6.1" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#verify-that-docker-is-up-and-running-and-start-the-database"><i class="fa fa-check"></i><b>6.1</b> Verify that Docker is up and running, and start the database</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#connect-to-postgresql-1"><i class="fa fa-check"></i><b>6.2</b> Connect to PostgreSQL</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#set-schema-search-path-and-list-its-contents"><i class="fa fa-check"></i><b>6.3</b> Set schema search path and list its contents</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#anatomy-of-a-dplyr-connection-object"><i class="fa fa-check"></i><b>6.4</b> Anatomy of a <code>dplyr</code> connection object</a></li>
<li class="chapter" data-level="6.5" data-path="chapter-connect-to-db-with-r-code.html"><a href="chapter-connect-to-db-with-r-code.html#cleaning-up-1"><i class="fa fa-check"></i><b>6.5</b> Cleaning up</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html"><i class="fa fa-check"></i><b>7</b> Introduction to DBMS queries</a><ul>
<li class="chapter" data-level="7.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#setup"><i class="fa fa-check"></i><b>7.1</b> Setup</a></li>
<li class="chapter" data-level="7.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#methods-for-downloading-a-single-table"><i class="fa fa-check"></i><b>7.2</b> Methods for downloading a single table</a><ul>
<li class="chapter" data-level="7.2.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#read-the-entire-table"><i class="fa fa-check"></i><b>7.2.1</b> Read the entire table</a></li>
<li class="chapter" data-level="7.2.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#create-a-pointer-to-a-table-that-can-be-reused"><i class="fa fa-check"></i><b>7.2.2</b> Create a pointer to a table that can be reused</a></li>
<li class="chapter" data-level="7.2.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#controlling-the-number-of-rows-returned-with-collect"><i class="fa fa-check"></i><b>7.2.3</b> Controlling the number of rows returned with <code>collect()</code></a></li>
<li class="chapter" data-level="7.2.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#retrieving-random-rows-from-the-dbms"><i class="fa fa-check"></i><b>7.2.4</b> Retrieving random rows from the DBMS</a></li>
<li class="chapter" data-level="7.2.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#sub-setting-variables"><i class="fa fa-check"></i><b>7.2.5</b> Sub-setting variables</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#translating-dplyr-code-to-sql-queries"><i class="fa fa-check"></i><b>7.3</b> Translating <code>dplyr</code> code to <code>SQL</code> queries</a></li>
<li class="chapter" data-level="7.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#mixing-dplyr-and-sql"><i class="fa fa-check"></i><b>7.4</b> Mixing dplyr and SQL</a></li>
<li class="chapter" data-level="7.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#examining-a-single-table-with-r"><i class="fa fa-check"></i><b>7.5</b> Examining a single table with R</a><ul>
<li class="chapter" data-level="7.5.1" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#str---a-base-package-workhorse"><i class="fa fa-check"></i><b>7.5.1</b> <code>str</code> - a base package workhorse</a></li>
<li class="chapter" data-level="7.5.2" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#always-look-at-your-data-with-head-view-or-kable"><i class="fa fa-check"></i><b>7.5.2</b> Always <strong>look</strong> at your data with <code>head</code>, <code>View</code>, or <code>kable</code></a></li>
<li class="chapter" data-level="7.5.3" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-summary-function-in-base"><i class="fa fa-check"></i><b>7.5.3</b> The <code>summary</code> function in <code>base</code></a></li>
<li class="chapter" data-level="7.5.4" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-glimpse-function-in-the-tibble-package"><i class="fa fa-check"></i><b>7.5.4</b> The <code>glimpse</code> function in the <code>tibble</code> package</a></li>
<li class="chapter" data-level="7.5.5" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#the-skim-function-in-the-skimr-package"><i class="fa fa-check"></i><b>7.5.5</b> The <code>skim</code> function in the <code>skimr</code> package</a></li>
<li class="chapter" data-level="7.5.6" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#close-the-connection-and-shut-down-adventureworks"><i class="fa fa-check"></i><b>7.5.6</b> Close the connection and shut down adventureworks</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="chapter-dbms-queries-intro.html"><a href="chapter-dbms-queries-intro.html#additional-reading"><i class="fa fa-check"></i><b>7.6</b> Additional reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html"><i class="fa fa-check"></i><b>8</b> Exploring a Single Table (asking Business Questions)</a><ul>
<li class="chapter" data-level="8.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#setup-our-standard-working-environment"><i class="fa fa-check"></i><b>8.1</b> Setup our standard working environment</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#the-overall-adventureworks-sales-picture"><i class="fa fa-check"></i><b>8.2</b> The overall AdventureWorks sales picture</a></li>
<li class="chapter" data-level="8.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#annual-sales"><i class="fa fa-check"></i><b>8.3</b> Annual sales</a><ul>
<li class="chapter" data-level="8.3.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#total-sales-by-year"><i class="fa fa-check"></i><b>8.3.1</b> Total sales by year</a></li>
<li class="chapter" data-level="8.3.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#total-order-volume"><i class="fa fa-check"></i><b>8.3.2</b> Total order volume</a></li>
<li class="chapter" data-level="8.3.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#average-dollars-per-sale"><i class="fa fa-check"></i><b>8.3.3</b> Average dollars per sale</a></li>
<li class="chapter" data-level="8.3.4" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#order-volume-and-average-sale-together"><i class="fa fa-check"></i><b>8.3.4</b> Order volume and average sale together</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#monthly-sales"><i class="fa fa-check"></i><b>8.4</b> Monthly Sales</a><ul>
<li class="chapter" data-level="8.4.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#comparing-dollars-and-orders-to-a-baseline"><i class="fa fa-check"></i><b>8.4.1</b> Comparing dollars and orders to a baseline</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#the-effect-of-online-sales"><i class="fa fa-check"></i><b>8.5</b> The effect of online sales</a><ul>
<li class="chapter" data-level="8.5.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#add-onlineorderflag-to-our-query"><i class="fa fa-check"></i><b>8.5.1</b> Add <code>onlineorderflag</code> to our query</a></li>
<li class="chapter" data-level="8.5.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#annual-sales-comparison"><i class="fa fa-check"></i><b>8.5.2</b> Annual Sales comparison</a></li>
<li class="chapter" data-level="8.5.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#order-volume-comparison"><i class="fa fa-check"></i><b>8.5.3</b> Order volume comparison</a></li>
<li class="chapter" data-level="8.5.4" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#average-sale-comparison"><i class="fa fa-check"></i><b>8.5.4</b> Average sale comparison</a></li>
<li class="chapter" data-level="8.5.5" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#comparing-order-volume-and-average-sale-together"><i class="fa fa-check"></i><b>8.5.5</b> Comparing order volume and average sale together</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#impact-of-order-type-on-monthly-sales"><i class="fa fa-check"></i><b>8.6</b> Impact of order type on monthly sales</a><ul>
<li class="chapter" data-level="8.6.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#retrieve-monthly-sales-with-the-onlineorderflag"><i class="fa fa-check"></i><b>8.6.1</b> Retrieve monthly sales with the <code>onlineorderflag</code></a></li>
<li class="chapter" data-level="8.6.2" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#monthly-variation-compared-to-a-trend-line"><i class="fa fa-check"></i><b>8.6.2</b> Monthly variation compared to a trend line</a></li>
<li class="chapter" data-level="8.6.3" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#looking-at-lagged-data"><i class="fa fa-check"></i><b>8.6.3</b> Looking at lagged data</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#variation-over-time"><i class="fa fa-check"></i><b>8.7</b> Variation over time</a></li>
<li class="chapter" data-level="8.8" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#these-queries-and-graphs-may-be-redundant"><i class="fa fa-check"></i><b>8.8</b> These queries and graphs may be redundant</a></li>
<li class="chapter" data-level="8.9" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#monthly-sales-rep-performance-analysis"><i class="fa fa-check"></i><b>8.9</b> Monthly Sales Rep Performance Analysis</a><ul>
<li class="chapter" data-level="8.9.1" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#effect-of-late-entries-on-sales-rep-data"><i class="fa fa-check"></i><b>8.9.1</b> Effect of Late Entries on Sales Rep data</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="chapter-exploring-a-single-table.html"><a href="chapter-exploring-a-single-table.html#close-and-clean-up"><i class="fa fa-check"></i><b>8.10</b> Close and clean up</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html"><i class="fa fa-check"></i><b>9</b> Sales Forecasting</a><ul>
<li class="chapter" data-level="9.1" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#setup-1"><i class="fa fa-check"></i><b>9.1</b> Setup</a></li>
<li class="chapter" data-level="9.2" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#exploring-the-sales-data"><i class="fa fa-check"></i><b>9.2</b> Exploring the sales data</a><ul>
<li class="chapter" data-level="9.2.1" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#creating-a-tsibble"><i class="fa fa-check"></i><b>9.2.1</b> Creating a tsibble</a></li>
<li class="chapter" data-level="9.2.2" data-path="chapter-sales-forecasting.html"><a href="chapter-sales-forecasting.html#exploring-the-data"><i class="fa fa-check"></i><b>9.2.2</b> Exploring the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html"><i class="fa fa-check"></i><b>10</b> Lazy Evaluation and Lazy Queries</a><ul>
<li class="chapter" data-level="10.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#setup-2"><i class="fa fa-check"></i><b>10.1</b> Setup</a></li>
<li class="chapter" data-level="10.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#r-is-lazy-and-comes-with-guardrails"><i class="fa fa-check"></i><b>10.2</b> R is lazy and comes with guardrails</a><ul>
<li class="chapter" data-level="10.2.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-loading"><i class="fa fa-check"></i><b>10.2.1</b> Lazy loading</a></li>
<li class="chapter" data-level="10.2.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-evaluation"><i class="fa fa-check"></i><b>10.2.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="10.2.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-queries"><i class="fa fa-check"></i><b>10.2.3</b> Lazy Queries</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy-evaluation-and-lazy-queries"><i class="fa fa-check"></i><b>10.3</b> Lazy evaluation and lazy queries</a><ul>
<li class="chapter" data-level="10.3.1" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#create-a-black-box-query-for-experimentation"><i class="fa fa-check"></i><b>10.3.1</b> Create a black box query for experimentation</a></li>
<li class="chapter" data-level="10.3.2" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#experiment-overview"><i class="fa fa-check"></i><b>10.3.2</b> Experiment overview</a></li>
<li class="chapter" data-level="10.3.3" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_print"><i class="fa fa-check"></i><b>10.3.3</b> Q %&gt;% print()</a></li>
<li class="chapter" data-level="10.3.4" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_as-tibble"><i class="fa fa-check"></i><b>10.3.4</b> Q %&gt;% dplyr::as_tibble()</a></li>
<li class="chapter" data-level="10.3.5" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_head"><i class="fa fa-check"></i><b>10.3.5</b> Q %&gt;% head()</a></li>
<li class="chapter" data-level="10.3.6" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_tail"><i class="fa fa-check"></i><b>10.3.6</b> Q %&gt;% tail()</a></li>
<li class="chapter" data-level="10.3.7" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_length"><i class="fa fa-check"></i><b>10.3.7</b> Q %&gt;% length()</a></li>
<li class="chapter" data-level="10.3.8" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_str"><i class="fa fa-check"></i><b>10.3.8</b> Q %&gt;% str()</a></li>
<li class="chapter" data-level="10.3.9" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_nrow"><i class="fa fa-check"></i><b>10.3.9</b> Q %&gt;% nrow()</a></li>
<li class="chapter" data-level="10.3.10" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_tally"><i class="fa fa-check"></i><b>10.3.10</b> Q %&gt;% dplyr::tally()</a></li>
<li class="chapter" data-level="10.3.11" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_collect"><i class="fa fa-check"></i><b>10.3.11</b> Q %&gt;% dplyr::collect()</a></li>
<li class="chapter" data-level="10.3.12" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_plot-categories"><i class="fa fa-check"></i><b>10.3.12</b> Q %&gt;% ggplot</a></li>
<li class="chapter" data-level="10.3.13" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#lazy_q_show-query"><i class="fa fa-check"></i><b>10.3.13</b> Q %&gt;% dplyr::show_query()</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="chapter-lazy-evaluation-queries.html"><a href="chapter-lazy-evaluation-queries.html#other-resources"><i class="fa fa-check"></i><b>10.4</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html"><i class="fa fa-check"></i><b>11</b> Lazy Evaluation and Execution Environment</a><ul>
<li class="chapter" data-level="11.1" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#setup-3"><i class="fa fa-check"></i><b>11.1</b> Setup</a><ul>
<li class="chapter" data-level="11.1.1" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#experiment-overview-1"><i class="fa fa-check"></i><b>11.1.1</b> Experiment overview</a></li>
<li class="chapter" data-level="11.1.2" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#time-based-execution-environment-issues"><i class="fa fa-check"></i><b>11.1.2</b> Time-based, execution environment issues</a></li>
<li class="chapter" data-level="11.1.3" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#lazy_q_build"><i class="fa fa-check"></i><b>11.1.3</b> Q %&gt;% <code>more dplyr</code></a></li>
<li class="chapter" data-level="11.1.4" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#many-handy-r-functions-cant-be-translated-to-sql"><i class="fa fa-check"></i><b>11.1.4</b> Many handy R functions can’t be translated to SQL</a></li>
<li class="chapter" data-level="11.1.5" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#further-lazy-execution-examples"><i class="fa fa-check"></i><b>11.1.5</b> Further lazy execution examples</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="chapter-lazy-evaluation-and-timing.html"><a href="chapter-lazy-evaluation-and-timing.html#other-resources-1"><i class="fa fa-check"></i><b>11.2</b> Other resources</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html"><i class="fa fa-check"></i><b>12</b> Getting metadata about and from PostgreSQL</a><ul>
<li class="chapter" data-level="12.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#views-trick-parked-here-for-the-time-being"><i class="fa fa-check"></i><b>12.1</b> Views trick parked here for the time being</a><ul>
<li class="chapter" data-level="12.1.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#explore-the-vsalelsperson-and-vsalespersonsalesbyfiscalyearsdata-views"><i class="fa fa-check"></i><b>12.1.1</b> Explore the vsalelsperson and vsalespersonsalesbyfiscalyearsdata views</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-contents-and-structure"><i class="fa fa-check"></i><b>12.2</b> Database contents and structure</a><ul>
<li class="chapter" data-level="12.2.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-structure"><i class="fa fa-check"></i><b>12.2.1</b> Database structure</a></li>
<li class="chapter" data-level="12.2.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#contents-of-the-information_schema"><i class="fa fa-check"></i><b>12.2.2</b> Contents of the <code>information_schema</code></a></li>
<li class="chapter" data-level="12.2.3" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-tables-are-in-the-database"><i class="fa fa-check"></i><b>12.2.3</b> What tables are in the database?</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-columns-do-those-tables-contain"><i class="fa fa-check"></i><b>12.3</b> What columns do those tables contain?</a><ul>
<li class="chapter" data-level="12.3.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-is-the-difference-between-a-view-and-a-base-table"><i class="fa fa-check"></i><b>12.3.1</b> What is the difference between a <code>VIEW</code> and a <code>BASE TABLE</code>?</a></li>
<li class="chapter" data-level="12.3.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#what-data-types-are-found-in-the-database"><i class="fa fa-check"></i><b>12.3.2</b> What data types are found in the database?</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#characterizing-how-things-are-named"><i class="fa fa-check"></i><b>12.4</b> Characterizing how things are named</a><ul>
<li class="chapter" data-level="12.4.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#counting-columns-and-name-reuse"><i class="fa fa-check"></i><b>12.4.1</b> Counting columns and name reuse</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-keys"><i class="fa fa-check"></i><b>12.5</b> Database keys</a><ul>
<li class="chapter" data-level="12.5.1" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#direct-sql"><i class="fa fa-check"></i><b>12.5.1</b> Direct SQL</a></li>
<li class="chapter" data-level="12.5.2" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#database-keys-with-dplyr"><i class="fa fa-check"></i><b>12.5.2</b> Database keys with dplyr</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#creating-your-own-data-dictionary"><i class="fa fa-check"></i><b>12.6</b> Creating your own data dictionary</a></li>
<li class="chapter" data-level="12.7" data-path="chapter-postgresql-metadata.html"><a href="chapter-postgresql-metadata.html#save-your-work"><i class="fa fa-check"></i><b>12.7</b> Save your work!</a></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html"><i class="fa fa-check"></i><b>A</b> Background and Basic Concepts</a><ul>
<li class="chapter" data-level="A.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#the-big-picture-r-and-the-docker-postgresql-playground-on-your-machine"><i class="fa fa-check"></i><b>A.1</b> The big picture: R and the Docker / PostgreSQL playground on your machine</a></li>
<li class="chapter" data-level="A.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#your-computer-and-its-operating-system"><i class="fa fa-check"></i><b>A.2</b> Your computer and its operating system</a></li>
<li class="chapter" data-level="A.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#r"><i class="fa fa-check"></i><b>A.3</b> R</a></li>
<li class="chapter" data-level="A.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#our-sqlpetr-package"><i class="fa fa-check"></i><b>A.4</b> Our <code>sqlpetr</code> package</a></li>
<li class="chapter" data-level="A.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker"><i class="fa fa-check"></i><b>A.5</b> Docker</a><ul>
<li class="chapter" data-level="A.5.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#virtual-machines-and-hypervisors"><i class="fa fa-check"></i><b>A.5.1</b> Virtual machines and hypervisors</a></li>
<li class="chapter" data-level="A.5.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#containers"><i class="fa fa-check"></i><b>A.5.2</b> Containers</a></li>
<li class="chapter" data-level="A.5.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker-itself"><i class="fa fa-check"></i><b>A.5.3</b> Docker itself</a></li>
<li class="chapter" data-level="A.5.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#docker-objects"><i class="fa fa-check"></i><b>A.5.4</b> Docker objects</a></li>
<li class="chapter" data-level="A.5.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-windows-machines"><i class="fa fa-check"></i><b>A.5.5</b> Hosting Docker on Windows machines</a></li>
<li class="chapter" data-level="A.5.6" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-macos-machines"><i class="fa fa-check"></i><b>A.5.6</b> Hosting Docker on macOS machines</a></li>
<li class="chapter" data-level="A.5.7" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#hosting-docker-on-unix-machines"><i class="fa fa-check"></i><b>A.5.7</b> Hosting Docker on UNIX machines</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#normal-and-normalized-data"><i class="fa fa-check"></i><b>A.6</b> ‘Normal’ and ‘normalized’ data</a><ul>
<li class="chapter" data-level="A.6.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#tidy-data"><i class="fa fa-check"></i><b>A.6.1</b> Tidy data</a></li>
<li class="chapter" data-level="A.6.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#design-of-normal-data"><i class="fa fa-check"></i><b>A.6.2</b> Design of “normal data”</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#sql-language"><i class="fa fa-check"></i><b>A.7</b> SQL Language</a><ul>
<li class="chapter" data-level="A.7.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-manipulation-langauge-dml"><i class="fa fa-check"></i><b>A.7.1</b> Data Manipulation Langauge (DML)</a></li>
<li class="chapter" data-level="A.7.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-definition-langauge-ddl"><i class="fa fa-check"></i><b>A.7.2</b> Data Definition Langauge (DDL)</a></li>
<li class="chapter" data-level="A.7.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-control-language-dcl"><i class="fa fa-check"></i><b>A.7.3</b> Data Control Language (DCL)</a></li>
<li class="chapter" data-level="A.7.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#transaction-control-language-tcl"><i class="fa fa-check"></i><b>A.7.4</b> Transaction Control Language (TCL)</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#enterprise-dbms"><i class="fa fa-check"></i><b>A.8</b> Enterprise DBMS</a><ul>
<li class="chapter" data-level="A.8.1" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#sql-databases"><i class="fa fa-check"></i><b>A.8.1</b> SQL databases</a></li>
<li class="chapter" data-level="A.8.2" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#data-mapping-between-r-vs-sql-data-types"><i class="fa fa-check"></i><b>A.8.2</b> Data mapping between R vs SQL data types</a></li>
<li class="chapter" data-level="A.8.3" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#postgresql-and-connection-parameters"><i class="fa fa-check"></i><b>A.8.3</b> PostgreSQL and connection parameters</a></li>
<li class="chapter" data-level="A.8.4" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#connecting-the-r-and-dbms-environments"><i class="fa fa-check"></i><b>A.8.4</b> Connecting the R and DBMS environments</a></li>
<li class="chapter" data-level="A.8.5" data-path="appendix-background-basic-concepts.html"><a href="appendix-background-basic-concepts.html#using-sqlite-to-simulate-an-enterprise-dbms"><i class="fa fa-check"></i><b>A.8.5</b> Using SQLite to simulate an enterprise DBMS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html"><i class="fa fa-check"></i><b>B</b> - Setup instructions</a><ul>
<li class="chapter" data-level="B.1" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#sandbox-prerequisites"><i class="fa fa-check"></i><b>B.1</b> Sandbox prerequisites</a></li>
<li class="chapter" data-level="B.2" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#r-rstudio-and-git"><i class="fa fa-check"></i><b>B.2</b> R, RStudio and Git</a></li>
<li class="chapter" data-level="B.3" data-path="chapter-appendix-setup-instructions.html"><a href="chapter-appendix-setup-instructions.html#install-docker"><i class="fa fa-check"></i><b>B.3</b> Install Docker</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html"><i class="fa fa-check"></i><b>C</b> Appendix E - Install <code>adventureworks</code> on your own machine</a><ul>
<li class="chapter" data-level="C.1" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#overview-1"><i class="fa fa-check"></i><b>C.1</b> Overview</a><ul>
<li class="chapter" data-level="C.1.1" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#download-the-adventureworks-database"><i class="fa fa-check"></i><b>C.1.1</b> Download the <code>adventureworks</code> database</a></li>
<li class="chapter" data-level="C.1.2" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#restore-the-dvdrental-database-at-the-command-line"><i class="fa fa-check"></i><b>C.1.2</b> Restore the <code>dvdrental</code> database at the command line</a></li>
<li class="chapter" data-level="C.1.3" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#restore-the-adventureworks-database-using-pgadmin"><i class="fa fa-check"></i><b>C.1.3</b> Restore the <code>adventureworks</code> database using pgAdmin</a></li>
</ul></li>
<li class="chapter" data-level="C.2" data-path="chapter-appendix-postgres-local-db-installation.html"><a href="chapter-appendix-postgres-local-db-installation.html#resources"><i class="fa fa-check"></i><b>C.2</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html"><i class="fa fa-check"></i><b>D</b> Appendix B - Additional technical details for Windows users</a><ul>
<li class="chapter" data-level="D.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#hardware-requirements"><i class="fa fa-check"></i><b>D.1</b> Hardware requirements</a></li>
<li class="chapter" data-level="D.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#software-requirements"><i class="fa fa-check"></i><b>D.2</b> Software requirements</a><ul>
<li class="chapter" data-level="D.2.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#windows-7-8-8.1-and-windows-10-home-64-bit"><i class="fa fa-check"></i><b>D.2.1</b> Windows 7, 8, 8.1 and Windows 10 Home (64 bit)</a></li>
<li class="chapter" data-level="D.2.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#windows-10-pro"><i class="fa fa-check"></i><b>D.2.2</b> Windows 10 Pro</a></li>
</ul></li>
<li class="chapter" data-level="D.3" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#docker-for-windows-settings"><i class="fa fa-check"></i><b>D.3</b> Docker for Windows settings</a><ul>
<li class="chapter" data-level="D.3.1" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#shared-drives"><i class="fa fa-check"></i><b>D.3.1</b> Shared drives</a></li>
<li class="chapter" data-level="D.3.2" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#kubernetes"><i class="fa fa-check"></i><b>D.3.2</b> Kubernetes</a></li>
</ul></li>
<li class="chapter" data-level="D.4" data-path="chapter-windows-tech-details.html"><a href="chapter-windows-tech-details.html#git-github-and-line-endings"><i class="fa fa-check"></i><b>D.4</b> Git, GitHub and line endings</a></li>
</ul></li>
<li class="chapter" data-level="E" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html"><i class="fa fa-check"></i><b>E</b> Appendix C - PostgreSQL Authentication</a><ul>
<li class="chapter" data-level="E.1" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#introduction"><i class="fa fa-check"></i><b>E.1</b> Introduction</a></li>
<li class="chapter" data-level="E.2" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#password-authentication-on-the-postgresql-docker-image"><i class="fa fa-check"></i><b>E.2</b> Password authentication on the PostgreSQL Docker image</a></li>
<li class="chapter" data-level="E.3" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#adding-roles"><i class="fa fa-check"></i><b>E.3</b> Adding roles</a><ul>
<li class="chapter" data-level="E.3.1" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#setting-up-docker"><i class="fa fa-check"></i><b>E.3.1</b> Setting up Docker</a></li>
<li class="chapter" data-level="E.3.2" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#creating-a-new-container"><i class="fa fa-check"></i><b>E.3.2</b> Creating a new container</a></li>
<li class="chapter" data-level="E.3.3" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#adding-a-role"><i class="fa fa-check"></i><b>E.3.3</b> Adding a role</a></li>
<li class="chapter" data-level="E.3.4" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#did-it-work"><i class="fa fa-check"></i><b>E.3.4</b> Did it work?</a></li>
<li class="chapter" data-level="E.3.5" data-path="chapter-appendix-postresql-authentication.html"><a href="chapter-appendix-postresql-authentication.html#remove-the-container"><i class="fa fa-check"></i><b>E.3.5</b> Remove the container</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="F" data-path="chapter-appendix-dplyr-functions.html"><a href="chapter-appendix-dplyr-functions.html"><i class="fa fa-check"></i><b>F</b> Dplyr functions and SQL cross-walk</a></li>
<li class="chapter" data-level="G" data-path="chapter-appendix-dbi-index.html"><a href="chapter-appendix-dbi-index.html"><i class="fa fa-check"></i><b>G</b> DBI package functions - INDEX</a></li>
<li class="chapter" data-level="H" data-path="chapter-appendix-dplyr-to-postres-translation.html"><a href="chapter-appendix-dplyr-to-postres-translation.html"><i class="fa fa-check"></i><b>H</b> Appendix _ Dplyr to SQL translations</a><ul>
<li class="chapter" data-level="H.1" data-path="chapter-appendix-dplyr-to-postres-translation.html"><a href="chapter-appendix-dplyr-to-postres-translation.html#overview-2"><i class="fa fa-check"></i><b>H.1</b> Overview</a></li>
</ul></li>
<li class="chapter" data-level="I" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html"><i class="fa fa-check"></i><b>I</b> Appendix Additional resources</a><ul>
<li class="chapter" data-level="I.1" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#editing-this-book"><i class="fa fa-check"></i><b>I.1</b> Editing this book</a></li>
<li class="chapter" data-level="I.2" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#docker-alternatives"><i class="fa fa-check"></i><b>I.2</b> Docker alternatives</a></li>
<li class="chapter" data-level="I.3" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#docker-and-r"><i class="fa fa-check"></i><b>I.3</b> Docker and R</a></li>
<li class="chapter" data-level="I.4" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#documentation-for-docker-and-postgresql"><i class="fa fa-check"></i><b>I.4</b> Documentation for Docker and PostgreSQL</a></li>
<li class="chapter" data-level="I.5" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#sql-and-dplyr"><i class="fa fa-check"></i><b>I.5</b> SQL and dplyr</a></li>
<li class="chapter" data-level="I.6" data-path="chapter-appendix-additional-resources.html"><a href="chapter-appendix-additional-resources.html#more-resources"><i class="fa fa-check"></i><b>I.6</b> More Resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Exploring Enterprise Databases with R: A Tidyverse Approach</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter_exploring-a-single-table" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Exploring a Single Table (asking Business Questions)</h1>
<blockquote>
<p>This chapter demonstrates how to:</p>
<ul>
<li>Begin the process of investigating a database from a business perspective</li>
<li>Dig into a single Adventureworks table containing sales data</li>
<li>Investigate the data from a business value perspective</li>
</ul>
</blockquote>
<p>The previous chapter has demonstrated some of the automated techniques for showing what’s in the table using specific R functions and packages. Now we demonstrate a step-by-step process of making sense of what’s in a table from a business perspective. We explore one table, illustrating the kind of detective work that’s often involved in understand the meaning of the data in a single table. We’ll investigate the <code>salesorderheader</code> table in the <code>sales</code> schema in this example with an eye on the AdventureWorks busieness’ sales.</p>
<p>For this kind of detective work we are seeking to undertand the following elements separately and as they interact with each other (and they all do):</p>
<ul>
<li>The data that’s stored in the database</li>
<li>The overall structure of the data (how different tables connect with each other and affect how to interpet each other)</li>
<li>How the data is entered at a day-to-day level to represent business activities</li>
<li>How the business itself is changing</li>
</ul>
<div id="setup-our-standard-working-environment" class="section level2">
<h2><span class="header-section-number">8.1</span> Setup our standard working environment</h2>
<p>Use these libraries:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="chapter-exploring-a-single-table.html#cb118-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb118-2"><a href="chapter-exploring-a-single-table.html#cb118-2"></a><span class="kw">library</span>(DBI)</span>
<span id="cb118-3"><a href="chapter-exploring-a-single-table.html#cb118-3"></a><span class="kw">library</span>(RPostgres)</span>
<span id="cb118-4"><a href="chapter-exploring-a-single-table.html#cb118-4"></a><span class="kw">library</span>(glue)</span>
<span id="cb118-5"><a href="chapter-exploring-a-single-table.html#cb118-5"></a><span class="kw">require</span>(knitr)</span>
<span id="cb118-6"><a href="chapter-exploring-a-single-table.html#cb118-6"></a><span class="kw">library</span>(dbplyr)</span>
<span id="cb118-7"><a href="chapter-exploring-a-single-table.html#cb118-7"></a><span class="kw">library</span>(sqlpetr)</span>
<span id="cb118-8"><a href="chapter-exploring-a-single-table.html#cb118-8"></a><span class="kw">library</span>(bookdown)</span>
<span id="cb118-9"><a href="chapter-exploring-a-single-table.html#cb118-9"></a><span class="kw">library</span>(here)</span>
<span id="cb118-10"><a href="chapter-exploring-a-single-table.html#cb118-10"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb118-11"><a href="chapter-exploring-a-single-table.html#cb118-11"></a></span>
<span id="cb118-12"><a href="chapter-exploring-a-single-table.html#cb118-12"></a><span class="kw">library</span>(scales) <span class="co"># ggplot xy scales</span></span>
<span id="cb118-13"><a href="chapter-exploring-a-single-table.html#cb118-13"></a><span class="kw">theme_set</span>(<span class="kw">theme_light</span>())</span></code></pre></div>
<p>Connect to <code>adventureworks</code>:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="chapter-exploring-a-single-table.html#cb119-1"></a><span class="kw">sp_docker_start</span>(<span class="st">&quot;adventureworks&quot;</span>)</span>
<span id="cb119-2"><a href="chapter-exploring-a-single-table.html#cb119-2"></a><span class="kw">Sys.sleep</span>(sleep_default)</span>
<span id="cb119-3"><a href="chapter-exploring-a-single-table.html#cb119-3"></a>con &lt;-<span class="st"> </span><span class="kw">sp_get_postgres_connection</span>(</span>
<span id="cb119-4"><a href="chapter-exploring-a-single-table.html#cb119-4"></a>  <span class="dt">host =</span> <span class="st">&quot;localhost&quot;</span>,</span>
<span id="cb119-5"><a href="chapter-exploring-a-single-table.html#cb119-5"></a>  <span class="dt">port =</span> <span class="dv">5432</span>,</span>
<span id="cb119-6"><a href="chapter-exploring-a-single-table.html#cb119-6"></a>  <span class="dt">user =</span> <span class="st">&quot;postgres&quot;</span>,</span>
<span id="cb119-7"><a href="chapter-exploring-a-single-table.html#cb119-7"></a>  <span class="dt">password =</span> <span class="st">&quot;postgres&quot;</span>,</span>
<span id="cb119-8"><a href="chapter-exploring-a-single-table.html#cb119-8"></a>  <span class="dt">dbname =</span> <span class="st">&quot;adventureworks&quot;</span>,</span>
<span id="cb119-9"><a href="chapter-exploring-a-single-table.html#cb119-9"></a>  <span class="dt">seconds_to_test =</span> sleep_default, <span class="dt">connection_tab =</span> <span class="ot">TRUE</span></span>
<span id="cb119-10"><a href="chapter-exploring-a-single-table.html#cb119-10"></a>)</span></code></pre></div>
</div>
<div id="the-overall-adventureworks-sales-picture" class="section level2">
<h2><span class="header-section-number">8.2</span> The overall AdventureWorks sales picture</h2>
<p>On an annual basis, are sales dollars trending up, down or flat? We begin with total revenue and number of orders at different levels of detail.</p>
<blockquote>
<p>You will find that many columns have the same name in an enterprise database. For example, in the adventureworks database, almost all tables have columns named <code>rowguid</code> and <code>modifieddate</code>.</p>
<p>Naming columns carefully (whether retrieved from the database or calculated) will pay off as our queries become more complex. Using <code>soh</code> to tag statistics that are derived from the <code>salesorderheader</code> table is one example of careful naming. A naming convention that reminds you of the original source of a column is a matter of applying some logic to how things are named; you, future you, and your collaborators will appreciate it although different naming conventions are completely valid.</p>
<p>In the following example <code>soh</code> appears in different positions in the column name but it is easy to guess at a glance that the data comes from the <code>salesorderheader</code> table.</p>
</blockquote>
</div>
<div id="annual-sales" class="section level2">
<h2><span class="header-section-number">8.3</span> Annual sales</h2>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="chapter-exploring-a-single-table.html#cb120-1"></a>annual_sales &lt;-<span class="st">  </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb120-2"><a href="chapter-exploring-a-single-table.html#cb120-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">substr</span>(<span class="kw">as.character</span>(orderdate), <span class="dv">1</span>, <span class="dv">4</span>)) <span class="op">%&gt;%</span></span>
<span id="cb120-3"><a href="chapter-exploring-a-single-table.html#cb120-3"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span></span>
<span id="cb120-4"><a href="chapter-exploring-a-single-table.html#cb120-4"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb120-5"><a href="chapter-exploring-a-single-table.html#cb120-5"></a>    <span class="dt">min_soh_orderdate =</span> <span class="kw">min</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb120-6"><a href="chapter-exploring-a-single-table.html#cb120-6"></a>    <span class="dt">max_soh_orderdate =</span> <span class="kw">max</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb120-7"><a href="chapter-exploring-a-single-table.html#cb120-7"></a>    <span class="dt">total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb120-8"><a href="chapter-exploring-a-single-table.html#cb120-8"></a>    <span class="dt">avg_total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">mean</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),<span class="dv">2</span>),</span>
<span id="cb120-9"><a href="chapter-exploring-a-single-table.html#cb120-9"></a>    <span class="dt">soh_count =</span> <span class="kw">n</span>()</span>
<span id="cb120-10"><a href="chapter-exploring-a-single-table.html#cb120-10"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb120-11"><a href="chapter-exploring-a-single-table.html#cb120-11"></a><span class="st">  </span><span class="kw">arrange</span>(year) <span class="op">%&gt;%</span></span>
<span id="cb120-12"><a href="chapter-exploring-a-single-table.html#cb120-12"></a><span class="st">  </span><span class="kw">select</span>(year, min_soh_orderdate, max_soh_orderdate, total_soh_dollars, </span>
<span id="cb120-13"><a href="chapter-exploring-a-single-table.html#cb120-13"></a>         avg_total_soh_dollars, soh_count) <span class="op">%&gt;%</span><span class="st"> </span>show_query <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb120-14"><a href="chapter-exploring-a-single-table.html#cb120-14"></a><span class="st">  </span><span class="kw">collect</span>() </span></code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT &quot;year&quot;, &quot;min_soh_orderdate&quot;, &quot;max_soh_orderdate&quot;, &quot;total_soh_dollars&quot;, &quot;avg_total_soh_dollars&quot;, &quot;soh_count&quot;
## FROM (SELECT *
## FROM (SELECT &quot;year&quot;, MIN(&quot;orderdate&quot;) AS &quot;min_soh_orderdate&quot;, MAX(&quot;orderdate&quot;) AS &quot;max_soh_orderdate&quot;, ROUND((SUM(&quot;subtotal&quot;)) :: numeric, 2) AS &quot;total_soh_dollars&quot;, ROUND((AVG(&quot;subtotal&quot;)) :: numeric, 2) AS &quot;avg_total_soh_dollars&quot;, COUNT(*) AS &quot;soh_count&quot;
## FROM (SELECT &quot;salesorderid&quot;, &quot;revisionnumber&quot;, &quot;orderdate&quot;, &quot;duedate&quot;, &quot;shipdate&quot;, &quot;status&quot;, &quot;onlineorderflag&quot;, &quot;purchaseordernumber&quot;, &quot;accountnumber&quot;, &quot;customerid&quot;, &quot;salespersonid&quot;, &quot;territoryid&quot;, &quot;billtoaddressid&quot;, &quot;shiptoaddressid&quot;, &quot;shipmethodid&quot;, &quot;creditcardid&quot;, &quot;creditcardapprovalcode&quot;, &quot;currencyrateid&quot;, &quot;subtotal&quot;, &quot;taxamt&quot;, &quot;freight&quot;, &quot;totaldue&quot;, &quot;comment&quot;, &quot;rowguid&quot;, &quot;modifieddate&quot;, SUBSTR(CAST(&quot;orderdate&quot; AS TEXT), 1, 4) AS &quot;year&quot;
## FROM sales.salesorderheader) &quot;dbplyr_001&quot;
## GROUP BY &quot;year&quot;) &quot;dbplyr_002&quot;
## ORDER BY &quot;year&quot;) &quot;dbplyr_003&quot;</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="chapter-exploring-a-single-table.html#cb122-1"></a>annual_sales</span></code></pre></div>
<pre><code>## # A tibble: 4 x 6
##   year  min_soh_orderdate   max_soh_orderdate   total_soh_dolla…
##   &lt;chr&gt; &lt;dttm&gt;              &lt;dttm&gt;                         &lt;dbl&gt;
## 1 2011  2011-05-31 00:00:00 2011-12-31 00:00:00        12641672.
## 2 2012  2012-01-01 00:00:00 2012-12-31 00:00:00        33524301.
## 3 2013  2013-01-01 00:00:00 2013-12-31 00:00:00        43622479.
## 4 2014  2014-01-01 00:00:00 2014-06-30 00:00:00        20057929.
## # … with 2 more variables: avg_total_soh_dollars &lt;dbl&gt;, soh_count &lt;int64&gt;</code></pre>
<p>Both 2011 and 2014 are shorter time spans than the other two years, making comparison across the years more difficult. We might normalize the totals based on the number of months in each year, but we first graph total dollars:</p>
<div id="total-sales-by-year" class="section level3">
<h3><span class="header-section-number">8.3.1</span> Total sales by year</h3>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="chapter-exploring-a-single-table.html#cb124-1"></a>min_soh_dt &lt;-<span class="st"> </span><span class="kw">min</span>(annual_sales<span class="op">$</span>min_soh_orderdate)</span>
<span id="cb124-2"><a href="chapter-exploring-a-single-table.html#cb124-2"></a>max_soh_dt &lt;-<span class="st"> </span><span class="kw">max</span>(annual_sales<span class="op">$</span>max_soh_orderdate)</span>
<span id="cb124-3"><a href="chapter-exploring-a-single-table.html#cb124-3"></a></span>
<span id="cb124-4"><a href="chapter-exploring-a-single-table.html#cb124-4"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> total_soh_dollars)) <span class="op">+</span></span>
<span id="cb124-5"><a href="chapter-exploring-a-single-table.html#cb124-5"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb124-6"><a href="chapter-exploring-a-single-table.html#cb124-6"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span></span>
<span id="cb124-7"><a href="chapter-exploring-a-single-table.html#cb124-7"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sales $&quot;</span>) <span class="op">+</span></span>
<span id="cb124-8"><a href="chapter-exploring-a-single-table.html#cb124-8"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">dollar_format</span>()) <span class="op">+</span><span class="st"> </span></span>
<span id="cb124-9"><a href="chapter-exploring-a-single-table.html#cb124-9"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Adventure Works Sales Dollars by Year</span><span class="ch">\n</span><span class="st">  &quot;</span>, </span>
<span id="cb124-10"><a href="chapter-exploring-a-single-table.html#cb124-10"></a>                min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt))</span></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/Calculate%20time%20period%20and%20annual%20sales%20dollars%20-%202-1.png" width="672" /></p>
<p>From 2011 through 2013, sales are trending up. Are sales dollars for 2014 really down, is it a shorter year (are sales seasonal)? To see if the sales dollars are seasonal, we will drill in and look at the monthly sales. But first, let’s look at the number of orders and whether there’s a pattern in the sales data.</p>
</div>
<div id="total-order-volume" class="section level3">
<h3><span class="header-section-number">8.3.2</span> Total order volume</h3>
<p>Look at number of orders per year:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="chapter-exploring-a-single-table.html#cb125-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> <span class="kw">as.numeric</span>(soh_count))) <span class="op">+</span></span>
<span id="cb125-2"><a href="chapter-exploring-a-single-table.html#cb125-2"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st">  </span></span>
<span id="cb125-3"><a href="chapter-exploring-a-single-table.html#cb125-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span></span>
<span id="cb125-4"><a href="chapter-exploring-a-single-table.html#cb125-4"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total number of orders&quot;</span>) <span class="op">+</span></span>
<span id="cb125-5"><a href="chapter-exploring-a-single-table.html#cb125-5"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Number of Orders per Year</span><span class="ch">\n</span><span class="st">&quot;</span>, </span>
<span id="cb125-6"><a href="chapter-exploring-a-single-table.html#cb125-6"></a>                min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt))</span></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/average%20dollars%20per%20sale%20-%20v2-1.png" width="672" /></p>
<p>That’s a huge jump in the number of orders between 2012 and 2013. Given the total annual dollars, we ask whether the size of a sale has changed.</p>
</div>
<div id="average-dollars-per-sale" class="section level3">
<h3><span class="header-section-number">8.3.3</span> Average dollars per sale</h3>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="chapter-exploring-a-single-table.html#cb126-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> avg_total_soh_dollars)) <span class="op">+</span></span>
<span id="cb126-2"><a href="chapter-exploring-a-single-table.html#cb126-2"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb126-3"><a href="chapter-exploring-a-single-table.html#cb126-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span></span>
<span id="cb126-4"><a href="chapter-exploring-a-single-table.html#cb126-4"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Average sale amount&quot;</span>) <span class="op">+</span></span>
<span id="cb126-5"><a href="chapter-exploring-a-single-table.html#cb126-5"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">dollar_format</span>()) <span class="op">+</span><span class="st"> </span></span>
<span id="cb126-6"><a href="chapter-exploring-a-single-table.html#cb126-6"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Average Dollars per Sale</span><span class="ch">\n</span><span class="st">&quot;</span>, </span>
<span id="cb126-7"><a href="chapter-exploring-a-single-table.html#cb126-7"></a>                min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt))</span></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/average%20dollars%20per%20sale%20--1.png" width="672" /></p>
<p>That’s a remarkable drop between average sale of more than $7,000 to less than $3,000.</p>
</div>
<div id="order-volume-and-average-sale-together" class="section level3">
<h3><span class="header-section-number">8.3.4</span> Order volume and average sale together</h3>
<p>Looking at order volume and average sales size together suggests that indeed something big happened between 2012 and 2013.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="chapter-exploring-a-single-table.html#cb127-1"></a>annual_sales <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(min_soh_orderdate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb127-2"><a href="chapter-exploring-a-single-table.html#cb127-2"></a><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> avg_total_soh_dollars, <span class="dt">y =</span> <span class="kw">as.numeric</span>(soh_count))) <span class="op">+</span></span>
<span id="cb127-3"><a href="chapter-exploring-a-single-table.html#cb127-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb127-4"><a href="chapter-exploring-a-single-table.html#cb127-4"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> year, <span class="dt">hjust =</span> <span class="fl">.5</span>, <span class="dt">vjust =</span> <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb127-5"><a href="chapter-exploring-a-single-table.html#cb127-5"></a><span class="st">  </span><span class="kw">geom_path</span>() <span class="op">+</span></span>
<span id="cb127-6"><a href="chapter-exploring-a-single-table.html#cb127-6"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Average dollars per order&quot;</span>) <span class="op">+</span></span>
<span id="cb127-7"><a href="chapter-exploring-a-single-table.html#cb127-7"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total number of orders&quot;</span>) <span class="op">+</span></span>
<span id="cb127-8"><a href="chapter-exploring-a-single-table.html#cb127-8"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">dollar_format</span>()) <span class="op">+</span><span class="st"> </span></span>
<span id="cb127-9"><a href="chapter-exploring-a-single-table.html#cb127-9"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">dollar_format</span>()) <span class="op">+</span><span class="st"> </span></span>
<span id="cb127-10"><a href="chapter-exploring-a-single-table.html#cb127-10"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Number of Orders by Average Order Amount</span><span class="ch">\n</span><span class="st">&quot;</span>, </span>
<span id="cb127-11"><a href="chapter-exploring-a-single-table.html#cb127-11"></a>                min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt))</span></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/number%20of%20orders%20by%20the%20the%20average%20sales%20per%20order%201-1.png" width="672" /></p>
<p>From 2012 to 2013 the average dollars per order dropped from more than $8,500 to nearly $3,000 while the total number of order shot up from less than 4,000 to more than 14,000. <strong>Why are the number of orders increasing, but the average dollar amount of a sale is dropping? </strong></p>
<p>We need to drill down to look at monthly sales, adapting the first query to group by month and year.</p>
</div>
</div>
<div id="monthly-sales" class="section level2">
<h2><span class="header-section-number">8.4</span> Monthly Sales</h2>
<p>The next code block drills down from annual sales dollars to monthly sales dollars. We adopt a more R-like strategy; rather than <code>yr</code> as a character variable, we just download the orderdate. R handles the coversion from the postgres date-time to an R date-time. We then convert it to a simple date with a <code>lubridate</code> function.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="chapter-exploring-a-single-table.html#cb128-1"></a>monthly_sales &lt;-<span class="st">  </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb128-2"><a href="chapter-exploring-a-single-table.html#cb128-2"></a><span class="st">  </span><span class="kw">select</span>(orderdate, subtotal) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb128-3"><a href="chapter-exploring-a-single-table.html#cb128-3"></a><span class="st">  </span></span>
<span id="cb128-4"><a href="chapter-exploring-a-single-table.html#cb128-4"></a><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># From here on we&#39;re in R</span></span>
<span id="cb128-5"><a href="chapter-exploring-a-single-table.html#cb128-5"></a><span class="st">  </span></span>
<span id="cb128-6"><a href="chapter-exploring-a-single-table.html#cb128-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">orderdate =</span> <span class="kw">date</span>(orderdate), </span>
<span id="cb128-7"><a href="chapter-exploring-a-single-table.html#cb128-7"></a>         <span class="dt">orderdate =</span> <span class="kw">round_date</span>(orderdate, <span class="st">&quot;month&quot;</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># </span></span>
<span id="cb128-8"><a href="chapter-exploring-a-single-table.html#cb128-8"></a><span class="st">  </span><span class="kw">group_by</span>( orderdate) <span class="op">%&gt;%</span></span>
<span id="cb128-9"><a href="chapter-exploring-a-single-table.html#cb128-9"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb128-10"><a href="chapter-exploring-a-single-table.html#cb128-10"></a>    <span class="dt">min_soh_orderdate =</span> <span class="kw">min</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb128-11"><a href="chapter-exploring-a-single-table.html#cb128-11"></a>    <span class="dt">max_soh_orderdate =</span> <span class="kw">max</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb128-12"><a href="chapter-exploring-a-single-table.html#cb128-12"></a>    <span class="dt">total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb128-13"><a href="chapter-exploring-a-single-table.html#cb128-13"></a>    <span class="dt">avg_total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">mean</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb128-14"><a href="chapter-exploring-a-single-table.html#cb128-14"></a>    <span class="dt">soh_count =</span> <span class="kw">n</span>()</span>
<span id="cb128-15"><a href="chapter-exploring-a-single-table.html#cb128-15"></a>  ) </span></code></pre></div>
<p>Plotting the monthly sales data:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="chapter-exploring-a-single-table.html#cb129-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> monthly_sales, <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> total_soh_dollars)) <span class="op">+</span></span>
<span id="cb129-2"><a href="chapter-exploring-a-single-table.html#cb129-2"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb129-3"><a href="chapter-exploring-a-single-table.html#cb129-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></span>
<span id="cb129-4"><a href="chapter-exploring-a-single-table.html#cb129-4"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sales Dollars&quot;</span>) <span class="op">+</span></span>
<span id="cb129-5"><a href="chapter-exploring-a-single-table.html#cb129-5"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span></span>
<span id="cb129-6"><a href="chapter-exploring-a-single-table.html#cb129-6"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center the title</span></span>
<span id="cb129-7"><a href="chapter-exploring-a-single-table.html#cb129-7"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Sales by Month</span><span class="ch">\n</span><span class="st">&quot;</span>, min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt))</span></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/Total%20monthly%20sales%20bar%20chart-1.png" width="672" /></p>
<p>The total sales are trending up but suspiciously uneven. Looking at lags might confirm just how much month-to-month difference there is:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="chapter-exploring-a-single-table.html#cb130-1"></a>lagged_monthly_sales &lt;-<span class="st"> </span>monthly_sales <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb130-2"><a href="chapter-exploring-a-single-table.html#cb130-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">monthly_sales_change =</span> (<span class="kw">lag</span>(total_soh_dollars, <span class="dv">1</span>)) <span class="op">-</span></span>
<span id="cb130-3"><a href="chapter-exploring-a-single-table.html#cb130-3"></a><span class="st">           </span>total_soh_dollars)</span>
<span id="cb130-4"><a href="chapter-exploring-a-single-table.html#cb130-4"></a></span>
<span id="cb130-5"><a href="chapter-exploring-a-single-table.html#cb130-5"></a><span class="kw">summary</span>(lagged_monthly_sales<span class="op">$</span>monthly_sales_change)</span></code></pre></div>
<pre><code>##        Min.     1st Qu.      Median        Mean     3rd Qu.        Max. 
## -1667368.56 -1082792.47    52892.65    18287.07   816048.02  4399378.90 
##        NA&#39;s 
##           1</code></pre>
<p>Although median monthly sales rise by about $53 thousand, it’s curious that in one fourth of the months the drop between one month and the next is between fifteen hundred and a million dollars. AventureWorks sales are <em>very</em> uneven.</p>
<div id="comparing-dollars-and-orders-to-a-baseline" class="section level3">
<h3><span class="header-section-number">8.4.1</span> Comparing dollars and orders to a baseline</h3>
<p>To look at dollars and the number of orders together, we compare the monthly data to the yearly average for 2011.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="chapter-exploring-a-single-table.html#cb132-1"></a>start_year &lt;-<span class="st"> </span>monthly_sales <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb132-2"><a href="chapter-exploring-a-single-table.html#cb132-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">yr =</span> <span class="kw">year</span>(orderdate)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb132-3"><a href="chapter-exploring-a-single-table.html#cb132-3"></a><span class="st">  </span><span class="kw">group_by</span>(yr) <span class="op">%&gt;%</span></span>
<span id="cb132-4"><a href="chapter-exploring-a-single-table.html#cb132-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total_soh_dollars =</span> <span class="kw">sum</span>(total_soh_dollars), </span>
<span id="cb132-5"><a href="chapter-exploring-a-single-table.html#cb132-5"></a>            <span class="dt">soh_count =</span> <span class="kw">sum</span>(soh_count), </span>
<span id="cb132-6"><a href="chapter-exploring-a-single-table.html#cb132-6"></a>            <span class="dt">n_months =</span> <span class="kw">n</span>(),</span>
<span id="cb132-7"><a href="chapter-exploring-a-single-table.html#cb132-7"></a>            <span class="dt">avg_dollars =</span> total_soh_dollars <span class="op">/</span><span class="st"> </span>n_months,</span>
<span id="cb132-8"><a href="chapter-exploring-a-single-table.html#cb132-8"></a>            <span class="dt">avg_count =</span> soh_count <span class="op">/</span><span class="st"> </span>n_months) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb132-9"><a href="chapter-exploring-a-single-table.html#cb132-9"></a><span class="st">    </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(yr))</span></code></pre></div>
<p>Use 2011 as a baseline:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="chapter-exploring-a-single-table.html#cb133-1"></a>start_year</span></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##      yr total_soh_dollars soh_count n_months avg_dollars avg_count
##   &lt;dbl&gt;             &lt;dbl&gt;     &lt;int&gt;    &lt;int&gt;       &lt;dbl&gt;     &lt;dbl&gt;
## 1  2011         12354206.      1513        7    1764887.      216.</code></pre>
<p>Re express monthly data in terms of the baseline and plot:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="chapter-exploring-a-single-table.html#cb135-1"></a>normalized_monthly_sales &lt;-<span class="st">  </span>monthly_sales <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-2"><a href="chapter-exploring-a-single-table.html#cb135-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dollars =</span> (<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>total_soh_dollars) <span class="op">/</span><span class="st"> </span>start_year<span class="op">$</span>avg_dollars,</span>
<span id="cb135-3"><a href="chapter-exploring-a-single-table.html#cb135-3"></a>         <span class="dt">number_of_orders =</span> (<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>soh_count) <span class="op">/</span><span class="st"> </span>start_year<span class="op">$</span>avg_count) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-4"><a href="chapter-exploring-a-single-table.html#cb135-4"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb135-5"><a href="chapter-exploring-a-single-table.html#cb135-5"></a></span>
<span id="cb135-6"><a href="chapter-exploring-a-single-table.html#cb135-6"></a>normalized_monthly_sales &lt;-<span class="st"> </span>normalized_monthly_sales <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-7"><a href="chapter-exploring-a-single-table.html#cb135-7"></a><span class="st">  </span><span class="kw">select</span>(orderdate, dollars, number_of_orders) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-8"><a href="chapter-exploring-a-single-table.html#cb135-8"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>orderdate, <span class="dt">names_to =</span> <span class="st">&quot;relative_to_2011_average&quot;</span>, </span>
<span id="cb135-9"><a href="chapter-exploring-a-single-table.html#cb135-9"></a>               <span class="dt">values_to =</span> <span class="st">&quot;amount&quot;</span> )</span>
<span id="cb135-10"><a href="chapter-exploring-a-single-table.html#cb135-10"></a></span>
<span id="cb135-11"><a href="chapter-exploring-a-single-table.html#cb135-11"></a>normalized_monthly_sales <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-12"><a href="chapter-exploring-a-single-table.html#cb135-12"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(orderdate, amount, <span class="dt">color =</span> relative_to_<span class="dv">2011</span>_average)) <span class="op">+</span></span>
<span id="cb135-13"><a href="chapter-exploring-a-single-table.html#cb135-13"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb135-14"><a href="chapter-exploring-a-single-table.html#cb135-14"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">100</span>) <span class="op">+</span></span>
<span id="cb135-15"><a href="chapter-exploring-a-single-table.html#cb135-15"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Date&quot;</span>) <span class="op">+</span></span>
<span id="cb135-16"><a href="chapter-exploring-a-single-table.html#cb135-16"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span></span>
<span id="cb135-17"><a href="chapter-exploring-a-single-table.html#cb135-17"></a><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_labels =</span> <span class="st">&quot;%Y-%m&quot;</span>, <span class="dt">date_breaks =</span> <span class="st">&quot;6 months&quot;</span>) <span class="op">+</span></span>
<span id="cb135-18"><a href="chapter-exploring-a-single-table.html#cb135-18"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Adventureworks Normalized Monthly Sales</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb135-19"><a href="chapter-exploring-a-single-table.html#cb135-19"></a>                <span class="st">&quot;Number of Sales Orders and Dollar Totals</span><span class="ch">\n</span><span class="st">&quot;</span>, </span>
<span id="cb135-20"><a href="chapter-exploring-a-single-table.html#cb135-20"></a>                min_soh_dt, <span class="st">&quot; to &quot;</span>, max_soh_dt))</span></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
</div>
<div id="the-effect-of-online-sales" class="section level2">
<h2><span class="header-section-number">8.5</span> The effect of online sales</h2>
<p>We have suspected that the business has changed a lot with the advent of online orders so we check the impact of <code>onlineorderflag</code> on annual sales.</p>
<div id="add-onlineorderflag-to-our-query" class="section level3">
<h3><span class="header-section-number">8.5.1</span> Add <code>onlineorderflag</code> to our query</h3>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="chapter-exploring-a-single-table.html#cb136-1"></a>annual_sales &lt;-<span class="st">  </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb136-2"><a href="chapter-exploring-a-single-table.html#cb136-2"></a><span class="st">   </span><span class="kw">select</span>(orderdate, subtotal, onlineorderflag) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb136-3"><a href="chapter-exploring-a-single-table.html#cb136-3"></a><span class="st">   </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb136-4"><a href="chapter-exploring-a-single-table.html#cb136-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">orderdate =</span> <span class="kw">date</span>(orderdate), </span>
<span id="cb136-5"><a href="chapter-exploring-a-single-table.html#cb136-5"></a>         <span class="dt">orderdate =</span> <span class="kw">round_date</span>(orderdate, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb136-6"><a href="chapter-exploring-a-single-table.html#cb136-6"></a>         <span class="dt">onlineorderflag =</span> <span class="kw">if_else</span>(onlineorderflag <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>, </span>
<span id="cb136-7"><a href="chapter-exploring-a-single-table.html#cb136-7"></a>                                   <span class="st">&quot;Sales Rep&quot;</span>, <span class="st">&quot;Online&quot;</span>),</span>
<span id="cb136-8"><a href="chapter-exploring-a-single-table.html#cb136-8"></a>         <span class="dt">onlineorderflag =</span> <span class="kw">as.factor</span>(onlineorderflag)) <span class="op">%&gt;%</span></span>
<span id="cb136-9"><a href="chapter-exploring-a-single-table.html#cb136-9"></a><span class="st">  </span><span class="kw">group_by</span>(orderdate, onlineorderflag) <span class="op">%&gt;%</span></span>
<span id="cb136-10"><a href="chapter-exploring-a-single-table.html#cb136-10"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb136-11"><a href="chapter-exploring-a-single-table.html#cb136-11"></a>    <span class="dt">min_soh_orderdate =</span> <span class="kw">min</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb136-12"><a href="chapter-exploring-a-single-table.html#cb136-12"></a>    <span class="dt">max_soh_orderdate =</span> <span class="kw">max</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb136-13"><a href="chapter-exploring-a-single-table.html#cb136-13"></a>    <span class="dt">total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb136-14"><a href="chapter-exploring-a-single-table.html#cb136-14"></a>    <span class="dt">avg_total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">mean</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),<span class="dv">2</span>),</span>
<span id="cb136-15"><a href="chapter-exploring-a-single-table.html#cb136-15"></a>    <span class="dt">soh_count =</span> <span class="kw">n</span>()</span>
<span id="cb136-16"><a href="chapter-exploring-a-single-table.html#cb136-16"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb136-17"><a href="chapter-exploring-a-single-table.html#cb136-17"></a><span class="st">  </span><span class="kw">select</span>(orderdate, onlineorderflag, min_soh_orderdate, </span>
<span id="cb136-18"><a href="chapter-exploring-a-single-table.html#cb136-18"></a>         max_soh_orderdate, total_soh_dollars, avg_total_soh_dollars, soh_count)</span></code></pre></div>
</div>
<div id="annual-sales-comparison" class="section level3">
<h3><span class="header-section-number">8.5.2</span> Annual Sales comparison</h3>
<p>Start by looking at total sales.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="chapter-exploring-a-single-table.html#cb137-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales, <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> total_soh_dollars)) <span class="op">+</span></span>
<span id="cb137-2"><a href="chapter-exploring-a-single-table.html#cb137-2"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb137-3"><a href="chapter-exploring-a-single-table.html#cb137-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span></span>
<span id="cb137-4"><a href="chapter-exploring-a-single-table.html#cb137-4"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sales $&quot;</span>) <span class="op">+</span></span>
<span id="cb137-5"><a href="chapter-exploring-a-single-table.html#cb137-5"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">dollar_format</span>()) <span class="op">+</span><span class="st"> </span></span>
<span id="cb137-6"><a href="chapter-exploring-a-single-table.html#cb137-6"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;onlineorderflag&quot;</span>) <span class="op">+</span></span>
<span id="cb137-7"><a href="chapter-exploring-a-single-table.html#cb137-7"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Adventure Works Sales Dollars by Year</span><span class="ch">\n</span><span class="st">  &quot;</span>, </span>
<span id="cb137-8"><a href="chapter-exploring-a-single-table.html#cb137-8"></a>                min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt))</span></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/Calculate%20time%20period%20and%20annual%20sales%20dollars%20-%205-1.png" width="672" /></p>
<p>Indeed the total sales are quite different as are the number of orders and the average order size!</p>
</div>
<div id="order-volume-comparison" class="section level3">
<h3><span class="header-section-number">8.5.3</span> Order volume comparison</h3>
<p>Look at number of orders per year:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="chapter-exploring-a-single-table.html#cb138-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales, <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> <span class="kw">as.numeric</span>(soh_count))) <span class="op">+</span></span>
<span id="cb138-2"><a href="chapter-exploring-a-single-table.html#cb138-2"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st">  </span></span>
<span id="cb138-3"><a href="chapter-exploring-a-single-table.html#cb138-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span></span>
<span id="cb138-4"><a href="chapter-exploring-a-single-table.html#cb138-4"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;onlineorderflag&quot;</span>) <span class="op">+</span></span>
<span id="cb138-5"><a href="chapter-exploring-a-single-table.html#cb138-5"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total number of orders&quot;</span>) <span class="op">+</span></span>
<span id="cb138-6"><a href="chapter-exploring-a-single-table.html#cb138-6"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Number of Orders per Year</span><span class="ch">\n</span><span class="st">&quot;</span>, </span>
<span id="cb138-7"><a href="chapter-exploring-a-single-table.html#cb138-7"></a>                min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt))</span></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/average%20dollars%20per%20sale%20-%20v4-1.png" width="672" /></p>
</div>
<div id="average-sale-comparison" class="section level3">
<h3><span class="header-section-number">8.5.4</span> Average sale comparison</h3>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="chapter-exploring-a-single-table.html#cb139-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> annual_sales, <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> avg_total_soh_dollars)) <span class="op">+</span></span>
<span id="cb139-2"><a href="chapter-exploring-a-single-table.html#cb139-2"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb139-3"><a href="chapter-exploring-a-single-table.html#cb139-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="op">+</span></span>
<span id="cb139-4"><a href="chapter-exploring-a-single-table.html#cb139-4"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Average sale amount&quot;</span>) <span class="op">+</span></span>
<span id="cb139-5"><a href="chapter-exploring-a-single-table.html#cb139-5"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;onlineorderflag&quot;</span>) <span class="op">+</span></span>
<span id="cb139-6"><a href="chapter-exploring-a-single-table.html#cb139-6"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">dollar_format</span>()) <span class="op">+</span><span class="st"> </span></span>
<span id="cb139-7"><a href="chapter-exploring-a-single-table.html#cb139-7"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Average Dollars per Sale</span><span class="ch">\n</span><span class="st">&quot;</span>, </span>
<span id="cb139-8"><a href="chapter-exploring-a-single-table.html#cb139-8"></a>                min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt))</span></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/average%20dollars%20per%20sale%203-1.png" width="672" /></p>
</div>
<div id="comparing-order-volume-and-average-sale-together" class="section level3">
<h3><span class="header-section-number">8.5.5</span> Comparing order volume and average sale together</h3>
<p>Look at number of orders by the the average sales per order for the four years:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="chapter-exploring-a-single-table.html#cb140-1"></a>annual_sales <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(orderdate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb140-2"><a href="chapter-exploring-a-single-table.html#cb140-2"></a><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> avg_total_soh_dollars, <span class="dt">y =</span> <span class="kw">as.numeric</span>(soh_count))) <span class="op">+</span></span>
<span id="cb140-3"><a href="chapter-exploring-a-single-table.html#cb140-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb140-4"><a href="chapter-exploring-a-single-table.html#cb140-4"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> orderdate, <span class="dt">hjust =</span> <span class="fl">.5</span>, <span class="dt">vjust =</span> <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb140-5"><a href="chapter-exploring-a-single-table.html#cb140-5"></a><span class="st">  </span><span class="kw">geom_path</span>() <span class="op">+</span></span>
<span id="cb140-6"><a href="chapter-exploring-a-single-table.html#cb140-6"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Average dollars per order&quot;</span>) <span class="op">+</span></span>
<span id="cb140-7"><a href="chapter-exploring-a-single-table.html#cb140-7"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total number of orders&quot;</span>) <span class="op">+</span></span>
<span id="cb140-8"><a href="chapter-exploring-a-single-table.html#cb140-8"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="st">&quot;onlineorderflag&quot;</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></span>
<span id="cb140-9"><a href="chapter-exploring-a-single-table.html#cb140-9"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">dollar_format</span>()) <span class="op">+</span><span class="st"> </span></span>
<span id="cb140-10"><a href="chapter-exploring-a-single-table.html#cb140-10"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">dollar_format</span>()) <span class="op">+</span><span class="st"> </span></span>
<span id="cb140-11"><a href="chapter-exploring-a-single-table.html#cb140-11"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Number of Orders by Average Order Amount</span><span class="ch">\n</span><span class="st">&quot;</span>, </span>
<span id="cb140-12"><a href="chapter-exploring-a-single-table.html#cb140-12"></a>                min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt))</span></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/number%20of%20orders%20by%20the%20the%20average%20sales%20per%20order%202-1.png" width="672" /></p>
<p>From 2012 to 2013 the average dollars per order dropped from more than $8,500 to nearly $3,000 while the total number of order shot up from less than 4,000 to more than 14,000. <strong>Why are the number of orders increasing, but the average order dollar amount dropping? </strong></p>
</div>
</div>
<div id="impact-of-order-type-on-monthly-sales" class="section level2">
<h2><span class="header-section-number">8.6</span> Impact of order type on monthly sales</h2>
<p>Digging into the difference between <em>Sales Rep</em> and <em>Online</em> sales.</p>
<div id="retrieve-monthly-sales-with-the-onlineorderflag" class="section level3">
<h3><span class="header-section-number">8.6.1</span> Retrieve monthly sales with the <code>onlineorderflag</code></h3>
<p>This query puts the <code>collect</code> statement earlier than the previous queries.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="chapter-exploring-a-single-table.html#cb141-1"></a>monthly_sales &lt;-<span class="st">  </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb141-2"><a href="chapter-exploring-a-single-table.html#cb141-2"></a><span class="st">  </span><span class="kw">select</span>(orderdate, subtotal, onlineorderflag) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb141-3"><a href="chapter-exploring-a-single-table.html#cb141-3"></a><span class="st">  </span></span>
<span id="cb141-4"><a href="chapter-exploring-a-single-table.html#cb141-4"></a><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># From here on we&#39;re in R</span></span>
<span id="cb141-5"><a href="chapter-exploring-a-single-table.html#cb141-5"></a><span class="st">  </span></span>
<span id="cb141-6"><a href="chapter-exploring-a-single-table.html#cb141-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">orderdate =</span> <span class="kw">date</span>(orderdate), </span>
<span id="cb141-7"><a href="chapter-exploring-a-single-table.html#cb141-7"></a>         <span class="dt">orderdate =</span> <span class="kw">round_date</span>(orderdate, <span class="st">&quot;month&quot;</span>),</span>
<span id="cb141-8"><a href="chapter-exploring-a-single-table.html#cb141-8"></a>          <span class="dt">onlineorderflag =</span> <span class="kw">if_else</span>(onlineorderflag <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>, </span>
<span id="cb141-9"><a href="chapter-exploring-a-single-table.html#cb141-9"></a>                                   <span class="st">&quot;Sales Rep&quot;</span>, <span class="st">&quot;Online&quot;</span>),) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># </span></span>
<span id="cb141-10"><a href="chapter-exploring-a-single-table.html#cb141-10"></a><span class="st">  </span><span class="kw">group_by</span>(orderdate, onlineorderflag) <span class="op">%&gt;%</span></span>
<span id="cb141-11"><a href="chapter-exploring-a-single-table.html#cb141-11"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb141-12"><a href="chapter-exploring-a-single-table.html#cb141-12"></a>    <span class="dt">min_soh_orderdate =</span> <span class="kw">min</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb141-13"><a href="chapter-exploring-a-single-table.html#cb141-13"></a>    <span class="dt">max_soh_orderdate =</span> <span class="kw">max</span>(orderdate, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</span>
<span id="cb141-14"><a href="chapter-exploring-a-single-table.html#cb141-14"></a>    <span class="dt">total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb141-15"><a href="chapter-exploring-a-single-table.html#cb141-15"></a>    <span class="dt">avg_total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">mean</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb141-16"><a href="chapter-exploring-a-single-table.html#cb141-16"></a>    <span class="dt">soh_count =</span> <span class="kw">n</span>()</span>
<span id="cb141-17"><a href="chapter-exploring-a-single-table.html#cb141-17"></a>  ) </span></code></pre></div>
</div>
<div id="monthly-variation-compared-to-a-trend-line" class="section level3">
<h3><span class="header-section-number">8.6.2</span> Monthly variation compared to a trend line</h3>
<p>Jumping to the trend line comparison, we see that the variation</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="chapter-exploring-a-single-table.html#cb142-1"></a><span class="co"># sp_print_df(monthly_sales)</span></span>
<span id="cb142-2"><a href="chapter-exploring-a-single-table.html#cb142-2"></a></span>
<span id="cb142-3"><a href="chapter-exploring-a-single-table.html#cb142-3"></a><span class="kw">ggplot</span>(</span>
<span id="cb142-4"><a href="chapter-exploring-a-single-table.html#cb142-4"></a>  <span class="dt">data =</span> monthly_sales,</span>
<span id="cb142-5"><a href="chapter-exploring-a-single-table.html#cb142-5"></a>  <span class="kw">aes</span>(</span>
<span id="cb142-6"><a href="chapter-exploring-a-single-table.html#cb142-6"></a>    <span class="dt">x =</span> orderdate, <span class="dt">y =</span> total_soh_dollars)) <span class="op">+</span></span>
<span id="cb142-7"><a href="chapter-exploring-a-single-table.html#cb142-7"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb142-8"><a href="chapter-exploring-a-single-table.html#cb142-8"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb142-9"><a href="chapter-exploring-a-single-table.html#cb142-9"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></span>
<span id="cb142-10"><a href="chapter-exploring-a-single-table.html#cb142-10"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sales Dollars&quot;</span>) <span class="op">+</span></span>
<span id="cb142-11"><a href="chapter-exploring-a-single-table.html#cb142-11"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;onlineorderflag&quot;</span>) <span class="op">+</span></span>
<span id="cb142-12"><a href="chapter-exploring-a-single-table.html#cb142-12"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span></span>
<span id="cb142-13"><a href="chapter-exploring-a-single-table.html#cb142-13"></a><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>, <span class="dt">date_minor_breaks =</span> <span class="st">&quot;3 months&quot;</span>) <span class="op">+</span></span>
<span id="cb142-14"><a href="chapter-exploring-a-single-table.html#cb142-14"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></span>
<span id="cb142-15"><a href="chapter-exploring-a-single-table.html#cb142-15"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Sales by Month by Year</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb142-16"><a href="chapter-exploring-a-single-table.html#cb142-16"></a>                <span class="st">&quot;With Number of Sales Orders</span><span class="ch">\n</span><span class="st">And Average SO $ Amount</span><span class="ch">\n</span><span class="st">&quot;</span>, </span>
<span id="cb142-17"><a href="chapter-exploring-a-single-table.html#cb142-17"></a>                min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt))</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-6"></span>
<img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-6-1.png" alt="SO, SO Dollars, and Average SO Dollars-b " width="1536" />
<p class="caption">
Figure 8.1: SO, SO Dollars, and Average SO Dollars-b
</p>
</div>
<p>A couple of things jump out from the graph.</p>
<ol style="list-style-type: decimal">
<li>2012 and 2013 have similar sales dollar plots and peak every three months. This may reflect the closing as many sales orders as possible to make the quarterly sales numbers look good.</li>
<li>2011 has more variation than 2012 and 2013 and peaks every two months.</li>
<li>2014 has the most variation and also peaks every two months. Both the number of sales, 939, and the average sales order size, $52.19 plummet in June 2014.</li>
</ol>
</div>
<div id="looking-at-lagged-data" class="section level3">
<h3><span class="header-section-number">8.6.3</span> Looking at lagged data</h3>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="chapter-exploring-a-single-table.html#cb144-1"></a>lagged &lt;-<span class="st"> </span>monthly_sales <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb144-2"><a href="chapter-exploring-a-single-table.html#cb144-2"></a><span class="st">  </span><span class="kw">group_by</span>(onlineorderflag) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb144-3"><a href="chapter-exploring-a-single-table.html#cb144-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct_yearly_soh_dollar_change =</span> </span>
<span id="cb144-4"><a href="chapter-exploring-a-single-table.html#cb144-4"></a>           total_soh_dollars <span class="op">/</span><span class="st"> </span>(<span class="kw">lag</span>(total_soh_dollars, <span class="dv">12</span>)) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>,</span>
<span id="cb144-5"><a href="chapter-exploring-a-single-table.html#cb144-5"></a>         <span class="dt">pct_yearly_soh_count_change =</span> </span>
<span id="cb144-6"><a href="chapter-exploring-a-single-table.html#cb144-6"></a>           soh_count <span class="op">/</span><span class="st"> </span>(<span class="kw">lag</span>(soh_count, <span class="dv">12</span>)) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>) </span>
<span id="cb144-7"><a href="chapter-exploring-a-single-table.html#cb144-7"></a> </span>
<span id="cb144-8"><a href="chapter-exploring-a-single-table.html#cb144-8"></a><span class="kw">ggplot</span>(lagged, <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> pct_yearly_soh_dollar_change)) <span class="op">+</span></span>
<span id="cb144-9"><a href="chapter-exploring-a-single-table.html#cb144-9"></a><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>, <span class="dt">date_minor_breaks =</span> <span class="st">&quot;3 months&quot;</span>) <span class="op">+</span></span>
<span id="cb144-10"><a href="chapter-exploring-a-single-table.html#cb144-10"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;onlineorderflag&quot;</span>) <span class="op">+</span></span>
<span id="cb144-11"><a href="chapter-exploring-a-single-table.html#cb144-11"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb144-12"><a href="chapter-exploring-a-single-table.html#cb144-12"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></span>
<span id="cb144-13"><a href="chapter-exploring-a-single-table.html#cb144-13"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;% Dollar Change&quot;</span>) <span class="op">+</span></span>
<span id="cb144-14"><a href="chapter-exploring-a-single-table.html#cb144-14"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></span>
<span id="cb144-15"><a href="chapter-exploring-a-single-table.html#cb144-15"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Year on Year Total Monthly Sales Change </span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb144-16"><a href="chapter-exploring-a-single-table.html#cb144-16"></a>                <span class="st">&quot;Comparing Online to Sales Rep Sales</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb144-17"><a href="chapter-exploring-a-single-table.html#cb144-17"></a>                min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt))</span></code></pre></div>
<pre><code>## Warning: Removed 12 rows containing missing values (geom_path).</code></pre>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="chapter-exploring-a-single-table.html#cb146-1"></a><span class="kw">ggplot</span>(lagged, <span class="kw">aes</span>(<span class="dt">x =</span> orderdate, <span class="dt">y =</span> pct_yearly_soh_count_change)) <span class="op">+</span></span>
<span id="cb146-2"><a href="chapter-exploring-a-single-table.html#cb146-2"></a><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>, <span class="dt">date_minor_breaks =</span> <span class="st">&quot;3 months&quot;</span>) <span class="op">+</span></span>
<span id="cb146-3"><a href="chapter-exploring-a-single-table.html#cb146-3"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;onlineorderflag&quot;</span>) <span class="op">+</span></span>
<span id="cb146-4"><a href="chapter-exploring-a-single-table.html#cb146-4"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb146-5"><a href="chapter-exploring-a-single-table.html#cb146-5"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></span>
<span id="cb146-6"><a href="chapter-exploring-a-single-table.html#cb146-6"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;% Dollar Change&quot;</span>) <span class="op">+</span></span>
<span id="cb146-7"><a href="chapter-exploring-a-single-table.html#cb146-7"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></span>
<span id="cb146-8"><a href="chapter-exploring-a-single-table.html#cb146-8"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Year on Year Monthly Order Volume Change </span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb146-9"><a href="chapter-exploring-a-single-table.html#cb146-9"></a>                <span class="st">&quot;Comparing Online to Sales Rep Sales</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb146-10"><a href="chapter-exploring-a-single-table.html#cb146-10"></a>                min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt))</span></code></pre></div>
<pre><code>## Warning: Removed 12 rows containing missing values (geom_path).</code></pre>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Comparing the number of sales orders year over year by month for 2013 and 2012, one can see that the 2013 sales are between 1.2 and 1.8 times larger than the corresponding month of 2012 from January through June. In July the 2013 sales are 5 to 6 times the 2012 sales orders.</p>
<p>This trend continues into 2014 before the number of sales plummet to just 1.3 time in June.</p>
<p>We suspect that the business has changed a lot with the adventn of online orders.</p>
</div>
</div>
<div id="variation-over-time" class="section level2">
<h2><span class="header-section-number">8.7</span> Variation over time</h2>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="chapter-exploring-a-single-table.html#cb148-1"></a>sales_by_day_of_month &lt;-<span class="st">  </span><span class="kw">tbl</span>(con, <span class="kw">in_schema</span>(<span class="st">&quot;sales&quot;</span>, <span class="st">&quot;salesorderheader&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb148-2"><a href="chapter-exploring-a-single-table.html#cb148-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">day_of_month =</span> <span class="kw">day</span>(orderdate)) <span class="op">%&gt;%</span></span>
<span id="cb148-3"><a href="chapter-exploring-a-single-table.html#cb148-3"></a><span class="st">  </span><span class="kw">group_by</span>(onlineorderflag, day_of_month) <span class="op">%&gt;%</span></span>
<span id="cb148-4"><a href="chapter-exploring-a-single-table.html#cb148-4"></a><span class="st">  </span><span class="kw">summarize</span>(</span>
<span id="cb148-5"><a href="chapter-exploring-a-single-table.html#cb148-5"></a>    <span class="dt">total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">sum</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb148-6"><a href="chapter-exploring-a-single-table.html#cb148-6"></a>    <span class="dt">avg_total_soh_dollars =</span> <span class="kw">round</span>(<span class="kw">mean</span>(subtotal, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),<span class="dv">2</span>),</span>
<span id="cb148-7"><a href="chapter-exploring-a-single-table.html#cb148-7"></a>    <span class="dt">soh_count =</span> <span class="kw">n</span>()</span>
<span id="cb148-8"><a href="chapter-exploring-a-single-table.html#cb148-8"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb148-9"><a href="chapter-exploring-a-single-table.html#cb148-9"></a><span class="st">  </span><span class="kw">arrange</span>(day_of_month) <span class="op">%&gt;%</span></span>
<span id="cb148-10"><a href="chapter-exploring-a-single-table.html#cb148-10"></a><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb148-11"><a href="chapter-exploring-a-single-table.html#cb148-11"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb148-12"><a href="chapter-exploring-a-single-table.html#cb148-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">onlineorderflag =</span> <span class="kw">if_else</span>(onlineorderflag <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>, </span>
<span id="cb148-13"><a href="chapter-exploring-a-single-table.html#cb148-13"></a>                                   <span class="st">&quot;Sales Rep&quot;</span>, <span class="st">&quot;Online&quot;</span>),</span>
<span id="cb148-14"><a href="chapter-exploring-a-single-table.html#cb148-14"></a>         <span class="dt">onlineorderflag =</span> <span class="kw">as.factor</span>(onlineorderflag),</span>
<span id="cb148-15"><a href="chapter-exploring-a-single-table.html#cb148-15"></a>         <span class="dt">day_of_month =</span> <span class="kw">as.numeric</span>(day_of_month),</span>
<span id="cb148-16"><a href="chapter-exploring-a-single-table.html#cb148-16"></a>         <span class="dt">soh_count =</span> <span class="kw">as.numeric</span>(soh_count)</span>
<span id="cb148-17"><a href="chapter-exploring-a-single-table.html#cb148-17"></a>         )</span></code></pre></div>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="chapter-exploring-a-single-table.html#cb149-1"></a><span class="kw">ggplot</span>(sales_by_day_of_month, <span class="kw">aes</span>(<span class="dt">x =</span> day_of_month, <span class="dt">y =</span> soh_count)) <span class="op">+</span></span>
<span id="cb149-2"><a href="chapter-exploring-a-single-table.html#cb149-2"></a><span class="st">  </span><span class="co"># scale_x_date(date_breaks = &quot;year&quot;, date_labels = &quot;%Y&quot;, date_minor_breaks = &quot;3 months&quot;) +</span></span>
<span id="cb149-3"><a href="chapter-exploring-a-single-table.html#cb149-3"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="st">&quot;onlineorderflag&quot;</span>) <span class="op">+</span></span>
<span id="cb149-4"><a href="chapter-exploring-a-single-table.html#cb149-4"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb149-5"><a href="chapter-exploring-a-single-table.html#cb149-5"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Day of the Month&quot;</span>) <span class="op">+</span></span>
<span id="cb149-6"><a href="chapter-exploring-a-single-table.html#cb149-6"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Recorded Sales&quot;</span>) <span class="op">+</span></span>
<span id="cb149-7"><a href="chapter-exploring-a-single-table.html#cb149-7"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.5</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></span>
<span id="cb149-8"><a href="chapter-exploring-a-single-table.html#cb149-8"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Transactions Entered by Day of Month </span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb149-9"><a href="chapter-exploring-a-single-table.html#cb149-9"></a>                <span class="st">&quot;Comparing Online to Sales Rep Sales</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb149-10"><a href="chapter-exploring-a-single-table.html#cb149-10"></a>                min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt))</span></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="these-queries-and-graphs-may-be-redundant" class="section level2">
<h2><span class="header-section-number">8.8</span> These queries and graphs may be redundant</h2>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="chapter-exploring-a-single-table.html#cb150-1"></a>mo_onl_pct &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</span>
<span id="cb150-2"><a href="chapter-exploring-a-single-table.html#cb150-2"></a>  con,</span>
<span id="cb150-3"><a href="chapter-exploring-a-single-table.html#cb150-3"></a>  <span class="st">&quot;</span></span>
<span id="cb150-4"><a href="chapter-exploring-a-single-table.html#cb150-4"></a><span class="st">SELECT *</span></span>
<span id="cb150-5"><a href="chapter-exploring-a-single-table.html#cb150-5"></a><span class="st">      ,round(orders/mo_orders * 100.0,2) mo_pct</span></span>
<span id="cb150-6"><a href="chapter-exploring-a-single-table.html#cb150-6"></a><span class="st">      ,round(sales_dollars/mo_sales * 100.0,2) mo_dlr_pct</span></span>
<span id="cb150-7"><a href="chapter-exploring-a-single-table.html#cb150-7"></a><span class="st">  FROM (SELECT EXTRACT(MONTH FROM orderdate) mo, EXTRACT(YEAR FROM orderdate) yr</span></span>
<span id="cb150-8"><a href="chapter-exploring-a-single-table.html#cb150-8"></a><span class="st">             , min(orderdate)::DATE min_soh_orderdate, max(orderdate)::DATE max_soh_orderdate</span></span>
<span id="cb150-9"><a href="chapter-exploring-a-single-table.html#cb150-9"></a><span class="st">             , round(sum(subtotal), 2) sales_dollars</span></span>
<span id="cb150-10"><a href="chapter-exploring-a-single-table.html#cb150-10"></a><span class="st">             , round(sum(sum(subtotal)) over (partition by EXTRACT(MONTH FROM orderdate),EXTRACT(YEAR FROM orderdate)</span></span>
<span id="cb150-11"><a href="chapter-exploring-a-single-table.html#cb150-11"></a><span class="st">                             order by EXTRACT(YEAR FROM orderdate)),2) mo_sales</span></span>
<span id="cb150-12"><a href="chapter-exploring-a-single-table.html#cb150-12"></a><span class="st">             , count(*) * 1.0 orders</span></span>
<span id="cb150-13"><a href="chapter-exploring-a-single-table.html#cb150-13"></a><span class="st">             , sum(count(*)) over (partition by EXTRACT(MONTH FROM orderdate),EXTRACT(YEAR FROM orderdate)</span></span>
<span id="cb150-14"><a href="chapter-exploring-a-single-table.html#cb150-14"></a><span class="st">                             order by EXTRACT(YEAR FROM orderdate)) mo_orders</span></span>
<span id="cb150-15"><a href="chapter-exploring-a-single-table.html#cb150-15"></a><span class="st">             , case when sh.onlineorderflag then &#39;online&#39; else &#39;sales rep&#39; end sales_type</span></span>
<span id="cb150-16"><a href="chapter-exploring-a-single-table.html#cb150-16"></a><span class="st">        FROM sales.salesorderheader sh</span></span>
<span id="cb150-17"><a href="chapter-exploring-a-single-table.html#cb150-17"></a><span class="st">        GROUP BY EXTRACT(MONTH FROM orderdate), EXTRACT(YEAR FROM orderdate), </span></span>
<span id="cb150-18"><a href="chapter-exploring-a-single-table.html#cb150-18"></a><span class="st">                 case when sh.onlineorderflag then &#39;online&#39; else &#39;sales rep&#39; end</span></span>
<span id="cb150-19"><a href="chapter-exploring-a-single-table.html#cb150-19"></a><span class="st">       ) as src</span></span>
<span id="cb150-20"><a href="chapter-exploring-a-single-table.html#cb150-20"></a><span class="st">ORDER BY mo, yr, sales_type</span></span>
<span id="cb150-21"><a href="chapter-exploring-a-single-table.html#cb150-21"></a><span class="st">&quot;</span></span>
<span id="cb150-22"><a href="chapter-exploring-a-single-table.html#cb150-22"></a>)</span>
<span id="cb150-23"><a href="chapter-exploring-a-single-table.html#cb150-23"></a></span>
<span id="cb150-24"><a href="chapter-exploring-a-single-table.html#cb150-24"></a><span class="kw">sp_print_df</span>(<span class="kw">head</span>(mo_onl_pct))</span></code></pre></div>
<div id="htmlwidget-170a8a8981f2e37f7978" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-170a8a8981f2e37f7978">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],[1,1,1,1,1,1],[2012,2012,2013,2013,2014,2014],["2012-01-01","2012-01-01","2013-01-01","2013-01-28","2014-01-01","2014-01-28"],["2012-01-31","2012-01-29","2013-01-31","2013-01-28","2014-01-31","2014-01-29"],[614557.94,3356069.34,523917.38,1563955.08,1551065.56,2738752.39],[3970627.28,3970627.28,2087872.46,2087872.46,4289817.95,4289817.95],[193,143,294,106,1966,175],[336,336,400,400,2141,2141],["online","sales rep","online","sales rep","online","sales rep"],[57.44,42.56,73.5,26.5,91.83,8.17],[15.48,84.52,25.09,74.91,36.16,63.84]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mo<\/th>\n      <th>yr<\/th>\n      <th>min_soh_orderdate<\/th>\n      <th>max_soh_orderdate<\/th>\n      <th>sales_dollars<\/th>\n      <th>mo_sales<\/th>\n      <th>orders<\/th>\n      <th>mo_orders<\/th>\n      <th>sales_type<\/th>\n      <th>mo_pct<\/th>\n      <th>mo_dlr_pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,5,6,7,8,10,11]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="chapter-exploring-a-single-table.html#cb151-1"></a>mo_onl_pct<span class="op">$</span>mo &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mo_onl_pct<span class="op">$</span>mo)</span>
<span id="cb151-2"><a href="chapter-exploring-a-single-table.html#cb151-2"></a>mo_onl_pct<span class="op">$</span>yr &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mo_onl_pct<span class="op">$</span>yr)</span>
<span id="cb151-3"><a href="chapter-exploring-a-single-table.html#cb151-3"></a>mo_onl_pct<span class="op">$</span>sales_type &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mo_onl_pct<span class="op">$</span>sales_type)</span>
<span id="cb151-4"><a href="chapter-exploring-a-single-table.html#cb151-4"></a>mo_<span class="dv">2011</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2011</span>)</span>
<span id="cb151-5"><a href="chapter-exploring-a-single-table.html#cb151-5"></a>mo_<span class="dv">2012</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2012</span>)</span>
<span id="cb151-6"><a href="chapter-exploring-a-single-table.html#cb151-6"></a>mo_<span class="dv">2013</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2013</span>)</span>
<span id="cb151-7"><a href="chapter-exploring-a-single-table.html#cb151-7"></a>mo_<span class="dv">2014</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2014</span>)</span>
<span id="cb151-8"><a href="chapter-exploring-a-single-table.html#cb151-8"></a></span>
<span id="cb151-9"><a href="chapter-exploring-a-single-table.html#cb151-9"></a></span>
<span id="cb151-10"><a href="chapter-exploring-a-single-table.html#cb151-10"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb151-11"><a href="chapter-exploring-a-single-table.html#cb151-11"></a><span class="st">  </span><span class="co"># data=mo_2011 first results in the x axis months out of order.</span></span>
<span id="cb151-12"><a href="chapter-exploring-a-single-table.html#cb151-12"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2012</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></span>
<span id="cb151-13"><a href="chapter-exploring-a-single-table.html#cb151-13"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2011</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></span>
<span id="cb151-14"><a href="chapter-exploring-a-single-table.html#cb151-14"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2013</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></span>
<span id="cb151-15"><a href="chapter-exploring-a-single-table.html#cb151-15"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2014</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></span>
<span id="cb151-16"><a href="chapter-exploring-a-single-table.html#cb151-16"></a></span>
<span id="cb151-17"><a href="chapter-exploring-a-single-table.html#cb151-17"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2011</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></span>
<span id="cb151-18"><a href="chapter-exploring-a-single-table.html#cb151-18"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2012</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></span>
<span id="cb151-19"><a href="chapter-exploring-a-single-table.html#cb151-19"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2013</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></span>
<span id="cb151-20"><a href="chapter-exploring-a-single-table.html#cb151-20"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2014</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></span>
<span id="cb151-21"><a href="chapter-exploring-a-single-table.html#cb151-21"></a></span>
<span id="cb151-22"><a href="chapter-exploring-a-single-table.html#cb151-22"></a><span class="st">  </span><span class="kw">geom_text</span>(</span>
<span id="cb151-23"><a href="chapter-exploring-a-single-table.html#cb151-23"></a>    <span class="dt">data =</span> mo_<span class="dv">2011</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)),</span>
<span id="cb151-24"><a href="chapter-exploring-a-single-table.html#cb151-24"></a>    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">hjust =</span> <span class="dv">0</span></span>
<span id="cb151-25"><a href="chapter-exploring-a-single-table.html#cb151-25"></a>  ) <span class="op">+</span></span>
<span id="cb151-26"><a href="chapter-exploring-a-single-table.html#cb151-26"></a><span class="st">  </span><span class="kw">geom_text</span>(</span>
<span id="cb151-27"><a href="chapter-exploring-a-single-table.html#cb151-27"></a>    <span class="dt">data =</span> mo_<span class="dv">2012</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)),</span>
<span id="cb151-28"><a href="chapter-exploring-a-single-table.html#cb151-28"></a>    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">hjust =</span> <span class="dv">0</span></span>
<span id="cb151-29"><a href="chapter-exploring-a-single-table.html#cb151-29"></a>  ) <span class="op">+</span></span>
<span id="cb151-30"><a href="chapter-exploring-a-single-table.html#cb151-30"></a><span class="st">  </span><span class="kw">geom_text</span>(</span>
<span id="cb151-31"><a href="chapter-exploring-a-single-table.html#cb151-31"></a>    <span class="dt">data =</span> mo_<span class="dv">2013</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)),</span>
<span id="cb151-32"><a href="chapter-exploring-a-single-table.html#cb151-32"></a>    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">hjust =</span> <span class="dv">0</span></span>
<span id="cb151-33"><a href="chapter-exploring-a-single-table.html#cb151-33"></a>  ) <span class="op">+</span></span>
<span id="cb151-34"><a href="chapter-exploring-a-single-table.html#cb151-34"></a><span class="st">  </span><span class="kw">geom_text</span>(</span>
<span id="cb151-35"><a href="chapter-exploring-a-single-table.html#cb151-35"></a>    <span class="dt">data =</span> mo_<span class="dv">2014</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)), <span class="dt">color =</span> <span class="st">&quot;lightblue&quot;</span>,</span>
<span id="cb151-36"><a href="chapter-exploring-a-single-table.html#cb151-36"></a>    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.5</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">vjust =</span> <span class="fl">1.5</span></span>
<span id="cb151-37"><a href="chapter-exploring-a-single-table.html#cb151-37"></a>  ) <span class="op">+</span></span>
<span id="cb151-38"><a href="chapter-exploring-a-single-table.html#cb151-38"></a></span>
<span id="cb151-39"><a href="chapter-exploring-a-single-table.html#cb151-39"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></span>
<span id="cb151-40"><a href="chapter-exploring-a-single-table.html#cb151-40"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;% Online Sales</span><span class="ch">\n</span><span class="st">vs</span><span class="ch">\n</span><span class="st">%Rep Sales&quot;</span>) <span class="op">+</span></span>
<span id="cb151-41"><a href="chapter-exploring-a-single-table.html#cb151-41"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.50</span>)) <span class="op">+</span></span>
<span id="cb151-42"><a href="chapter-exploring-a-single-table.html#cb151-42"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(</span>
<span id="cb151-43"><a href="chapter-exploring-a-single-table.html#cb151-43"></a>    <span class="st">&quot;Sales by Month</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb151-44"><a href="chapter-exploring-a-single-table.html#cb151-44"></a>    <span class="st">&quot;Online Orders Versus Rep Orders</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb151-45"><a href="chapter-exploring-a-single-table.html#cb151-45"></a>    min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt, <span class="st">&quot;</span></span>
<span id="cb151-46"><a href="chapter-exploring-a-single-table.html#cb151-46"></a><span class="st">&quot;</span>,</span>
<span id="cb151-47"><a href="chapter-exploring-a-single-table.html#cb151-47"></a>    <span class="st">&quot;Each Point shows Number of Orders: $ Amount: % of Total $ For the Month&quot;</span></span>
<span id="cb151-48"><a href="chapter-exploring-a-single-table.html#cb151-48"></a>  ))</span></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/On-Line%20Orders%20Versus%20Sales%20Rep%20Orders-2.png" width="1536" />
The sales rep orders brought in over half the monthly sales dollars for every month except three, February, April, and June of 2014. The monthly sales rep orders for those months are 3, 2, and 0 respectively.</p>
</div>
<div id="monthly-sales-rep-performance-analysis" class="section level2">
<h2><span class="header-section-number">8.9</span> Monthly Sales Rep Performance Analysis</h2>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="chapter-exploring-a-single-table.html#cb152-1"></a>mo_soh_sreps &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</span>
<span id="cb152-2"><a href="chapter-exploring-a-single-table.html#cb152-2"></a>  con,</span>
<span id="cb152-3"><a href="chapter-exploring-a-single-table.html#cb152-3"></a>  <span class="st">&quot;</span></span>
<span id="cb152-4"><a href="chapter-exploring-a-single-table.html#cb152-4"></a><span class="st">SELECT *</span></span>
<span id="cb152-5"><a href="chapter-exploring-a-single-table.html#cb152-5"></a><span class="st">      ,round(orders/mo_orders * 100.0,2) mo_pct</span></span>
<span id="cb152-6"><a href="chapter-exploring-a-single-table.html#cb152-6"></a><span class="st">      ,round(sales_dollars/mo_sales * 100.0,2) mo_dlr_pct</span></span>
<span id="cb152-7"><a href="chapter-exploring-a-single-table.html#cb152-7"></a><span class="st">  FROM (SELECT EXTRACT(MONTH FROM orderdate) mo, EXTRACT(YEAR FROM orderdate) yr</span></span>
<span id="cb152-8"><a href="chapter-exploring-a-single-table.html#cb152-8"></a><span class="st">             , min(orderdate)::DATE min_soh_orderdate, max(orderdate)::DATE max_soh_orderdate</span></span>
<span id="cb152-9"><a href="chapter-exploring-a-single-table.html#cb152-9"></a><span class="st">             , round(sum(subtotal), 2) sales_dollars</span></span>
<span id="cb152-10"><a href="chapter-exploring-a-single-table.html#cb152-10"></a><span class="st">             , round(sum(sum(subtotal)) over (partition by EXTRACT(MONTH FROM orderdate),EXTRACT(YEAR FROM orderdate)</span></span>
<span id="cb152-11"><a href="chapter-exploring-a-single-table.html#cb152-11"></a><span class="st">                             order by EXTRACT(YEAR FROM orderdate)),2) mo_sales</span></span>
<span id="cb152-12"><a href="chapter-exploring-a-single-table.html#cb152-12"></a><span class="st">             , count(*) * 1.0 orders</span></span>
<span id="cb152-13"><a href="chapter-exploring-a-single-table.html#cb152-13"></a><span class="st">             , sum(count(*)) over (partition by EXTRACT(MONTH FROM orderdate),EXTRACT(YEAR FROM orderdate)</span></span>
<span id="cb152-14"><a href="chapter-exploring-a-single-table.html#cb152-14"></a><span class="st">                             order by EXTRACT(YEAR FROM orderdate)) mo_orders</span></span>
<span id="cb152-15"><a href="chapter-exploring-a-single-table.html#cb152-15"></a><span class="st">             , case when sh.onlineorderflag then &#39;online&#39; else &#39;sales rep&#39; end sales_type</span></span>
<span id="cb152-16"><a href="chapter-exploring-a-single-table.html#cb152-16"></a><span class="st">        FROM sales.salesorderheader sh</span></span>
<span id="cb152-17"><a href="chapter-exploring-a-single-table.html#cb152-17"></a><span class="st">             INNER JOIN sales.salesorderdetail sd</span></span>
<span id="cb152-18"><a href="chapter-exploring-a-single-table.html#cb152-18"></a><span class="st">                ON sh.salesorderid = sd.salesorderid</span></span>
<span id="cb152-19"><a href="chapter-exploring-a-single-table.html#cb152-19"></a><span class="st">       WHERE not sh.onlineorderflag</span></span>
<span id="cb152-20"><a href="chapter-exploring-a-single-table.html#cb152-20"></a><span class="st">        GROUP BY EXTRACT(MONTH FROM orderdate), EXTRACT(YEAR FROM orderdate), </span></span>
<span id="cb152-21"><a href="chapter-exploring-a-single-table.html#cb152-21"></a><span class="st">                 case when sh.onlineorderflag then &#39;online&#39; else &#39;sales rep&#39; end</span></span>
<span id="cb152-22"><a href="chapter-exploring-a-single-table.html#cb152-22"></a><span class="st">       ) as src</span></span>
<span id="cb152-23"><a href="chapter-exploring-a-single-table.html#cb152-23"></a><span class="st">ORDER BY mo, yr, sales_type</span></span>
<span id="cb152-24"><a href="chapter-exploring-a-single-table.html#cb152-24"></a><span class="st">&quot;</span></span>
<span id="cb152-25"><a href="chapter-exploring-a-single-table.html#cb152-25"></a>)</span>
<span id="cb152-26"><a href="chapter-exploring-a-single-table.html#cb152-26"></a></span>
<span id="cb152-27"><a href="chapter-exploring-a-single-table.html#cb152-27"></a><span class="kw">sp_print_df</span>(<span class="kw">head</span>(mo_soh_sreps))</span></code></pre></div>
<div id="htmlwidget-696ddc5c8cc4f514f376" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-696ddc5c8cc4f514f376">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],[1,1,1,2,2,2],[2012,2013,2014,2012,2013,2014],["2012-01-01","2013-01-28","2014-01-28","2012-02-29","2013-02-28","2014-02-28"],["2012-01-29","2013-01-28","2014-01-29","2012-02-29","2013-02-28","2014-02-28"],[50403482.88,40081731.5,66924961.04,15335522.48,71803004.54,11658.08],[50403482.88,40081731.5,66924961.04,15335522.48,71803004.54,11658.08],[1519,1215,2180,494,1449,8],[1519,1215,2180,494,1449,8],["sales rep","sales rep","sales rep","sales rep","sales rep","sales rep"],[100,100,100,100,100,100],[100,100,100,100,100,100]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mo<\/th>\n      <th>yr<\/th>\n      <th>min_soh_orderdate<\/th>\n      <th>max_soh_orderdate<\/th>\n      <th>sales_dollars<\/th>\n      <th>mo_sales<\/th>\n      <th>orders<\/th>\n      <th>mo_orders<\/th>\n      <th>sales_type<\/th>\n      <th>mo_pct<\/th>\n      <th>mo_dlr_pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,5,6,7,8,10,11]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="chapter-exploring-a-single-table.html#cb153-1"></a>monthly_sales_online &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</span>
<span id="cb153-2"><a href="chapter-exploring-a-single-table.html#cb153-2"></a>  con,</span>
<span id="cb153-3"><a href="chapter-exploring-a-single-table.html#cb153-3"></a>  <span class="st">&quot;</span></span>
<span id="cb153-4"><a href="chapter-exploring-a-single-table.html#cb153-4"></a><span class="st">SELECT EXTRACT(MONTH FROM orderdate) mo, EXTRACT(YEAR FROM orderdate) yr</span></span>
<span id="cb153-5"><a href="chapter-exploring-a-single-table.html#cb153-5"></a><span class="st">     , min(orderdate)::DATE min_soh_orderdate, max(orderdate)::DATE max_soh_orderdate</span></span>
<span id="cb153-6"><a href="chapter-exploring-a-single-table.html#cb153-6"></a><span class="st">     , so.category</span></span>
<span id="cb153-7"><a href="chapter-exploring-a-single-table.html#cb153-7"></a><span class="st">     , round(sum(subtotal), 2) sales_dollars</span></span>
<span id="cb153-8"><a href="chapter-exploring-a-single-table.html#cb153-8"></a><span class="st">     , count(*) * 1.0 orders</span></span>
<span id="cb153-9"><a href="chapter-exploring-a-single-table.html#cb153-9"></a><span class="st"> FROM sales.salesorderheader sh</span></span>
<span id="cb153-10"><a href="chapter-exploring-a-single-table.html#cb153-10"></a><span class="st">      JOIN sales.salesorderdetail sd ON SH.salesorderid = sd.salesorderid</span></span>
<span id="cb153-11"><a href="chapter-exploring-a-single-table.html#cb153-11"></a><span class="st">      JOIN sales.specialoffer so ON Sd.specialofferid = so.specialofferid</span></span>
<span id="cb153-12"><a href="chapter-exploring-a-single-table.html#cb153-12"></a><span class="st">GROUP BY EXTRACT(MONTH FROM orderdate), EXTRACT(YEAR FROM orderdate), so.category</span></span>
<span id="cb153-13"><a href="chapter-exploring-a-single-table.html#cb153-13"></a><span class="st">ORDER BY mo, yr</span></span>
<span id="cb153-14"><a href="chapter-exploring-a-single-table.html#cb153-14"></a><span class="st">&quot;</span></span>
<span id="cb153-15"><a href="chapter-exploring-a-single-table.html#cb153-15"></a>)</span>
<span id="cb153-16"><a href="chapter-exploring-a-single-table.html#cb153-16"></a></span>
<span id="cb153-17"><a href="chapter-exploring-a-single-table.html#cb153-17"></a><span class="kw">sp_print_df</span>(<span class="kw">head</span>(monthly_sales_online))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-12"></span>
<div id="htmlwidget-b9c9581000df031ab913" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b9c9581000df031ab913">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],[1,1,1,1,1,1],[2012,2012,2013,2013,2014,2014],["2012-01-01","2012-01-01","2013-01-01","2013-01-01","2014-01-01","2014-01-01"],["2012-01-31","2012-01-29","2013-01-31","2013-01-29","2014-01-31","2014-01-31"],["No Discount","Reseller","No Discount","Reseller","No Discount","Reseller"],[50814178.74,203862.08,40032506.6,573142.28,69742390.8,1582808.9],[1708,4,1455,54,6867,178]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mo<\/th>\n      <th>yr<\/th>\n      <th>min_soh_orderdate<\/th>\n      <th>max_soh_orderdate<\/th>\n      <th>category<\/th>\n      <th>sales_dollars<\/th>\n      <th>orders<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 8.2: caption goes here
</p>
</div>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="chapter-exploring-a-single-table.html#cb154-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> monthly_sales_online, </span>
<span id="cb154-2"><a href="chapter-exploring-a-single-table.html#cb154-2"></a>       <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(mo), </span>
<span id="cb154-3"><a href="chapter-exploring-a-single-table.html#cb154-3"></a>           <span class="dt">y =</span> sales_dollars, <span class="dt">fill =</span> <span class="kw">factor</span>(yr))) <span class="op">+</span></span>
<span id="cb154-4"><a href="chapter-exploring-a-single-table.html#cb154-4"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># unstack columns and outline in black</span></span>
<span id="cb154-5"><a href="chapter-exploring-a-single-table.html#cb154-5"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></span>
<span id="cb154-6"><a href="chapter-exploring-a-single-table.html#cb154-6"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sales Dollars&quot;</span>) <span class="op">+</span></span>
<span id="cb154-7"><a href="chapter-exploring-a-single-table.html#cb154-7"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span></span>
<span id="cb154-8"><a href="chapter-exploring-a-single-table.html#cb154-8"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> category),</span>
<span id="cb154-9"><a href="chapter-exploring-a-single-table.html#cb154-9"></a>    <span class="dt">size =</span> <span class="fl">2.5</span></span>
<span id="cb154-10"><a href="chapter-exploring-a-single-table.html#cb154-10"></a>    <span class="co">#           ,color = &#39;black&#39;</span></span>
<span id="cb154-11"><a href="chapter-exploring-a-single-table.html#cb154-11"></a>    , <span class="dt">vjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb154-12"><a href="chapter-exploring-a-single-table.html#cb154-12"></a>    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">9</span>)</span>
<span id="cb154-13"><a href="chapter-exploring-a-single-table.html#cb154-13"></a>  ) <span class="op">+</span><span class="st"> </span><span class="co"># orders =&gt; avg so $ amt</span></span>
<span id="cb154-14"><a href="chapter-exploring-a-single-table.html#cb154-14"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.50</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Center ggplot title</span></span>
<span id="cb154-15"><a href="chapter-exploring-a-single-table.html#cb154-15"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Sales by Month</span><span class="ch">\n</span><span class="st">By Online Flag&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-12"></span>
<img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-12-2.png" alt="caption goes here" width="1536" />
<p class="caption">
Figure 8.2: caption goes here
</p>
</div>
<div id="effect-of-late-entries-on-sales-rep-data" class="section level3">
<h3><span class="header-section-number">8.9.1</span> Effect of Late Entries on Sales Rep data</h3>
<p>Correcting for the first of the month makes the Sales Rep data look more <strong>normal</strong>.</p>
<p>That could be the end of this chapter.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="chapter-exploring-a-single-table.html#cb155-1"></a>monthly_sales_onl_pct &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</span>
<span id="cb155-2"><a href="chapter-exploring-a-single-table.html#cb155-2"></a>  con,</span>
<span id="cb155-3"><a href="chapter-exploring-a-single-table.html#cb155-3"></a>  <span class="st">&quot;</span></span>
<span id="cb155-4"><a href="chapter-exploring-a-single-table.html#cb155-4"></a><span class="st">select EXTRACT(MONTH FROM orderdate) mo</span></span>
<span id="cb155-5"><a href="chapter-exploring-a-single-table.html#cb155-5"></a><span class="st">      ,EXTRACT(YEAR FROM orderdate) yr</span></span>
<span id="cb155-6"><a href="chapter-exploring-a-single-table.html#cb155-6"></a><span class="st">      ,sum(ORDERQTY)</span></span>
<span id="cb155-7"><a href="chapter-exploring-a-single-table.html#cb155-7"></a><span class="st">      ,sum(case when salespersonid is null and onlineorderflag then 1 else 0 end) onl</span></span>
<span id="cb155-8"><a href="chapter-exploring-a-single-table.html#cb155-8"></a><span class="st">      ,sum(case when salespersonid is not null and not onlineorderflag then 1 else 0 end) sp</span></span>
<span id="cb155-9"><a href="chapter-exploring-a-single-table.html#cb155-9"></a><span class="st">      ,round(sum(case when onlineorderflag then 1 else 0 end )*1.0/count(*) * 100.0,2) onl_pct</span></span>
<span id="cb155-10"><a href="chapter-exploring-a-single-table.html#cb155-10"></a><span class="st">      ,round(sum(case when not onlineorderflag then 1 else 0 end )*1.0/count(*) * 100.0,2) sp_pct</span></span>
<span id="cb155-11"><a href="chapter-exploring-a-single-table.html#cb155-11"></a><span class="st">      ,onlineorderflag</span></span>
<span id="cb155-12"><a href="chapter-exploring-a-single-table.html#cb155-12"></a><span class="st">      ,count(*)</span></span>
<span id="cb155-13"><a href="chapter-exploring-a-single-table.html#cb155-13"></a><span class="st">  FROM sales.salesorderheader sh</span></span>
<span id="cb155-14"><a href="chapter-exploring-a-single-table.html#cb155-14"></a><span class="st">  INNER JOIN sales.salesorderdetail sd</span></span>
<span id="cb155-15"><a href="chapter-exploring-a-single-table.html#cb155-15"></a><span class="st">          ON sh.salesorderid = sd.salesorderid</span></span>
<span id="cb155-16"><a href="chapter-exploring-a-single-table.html#cb155-16"></a><span class="st">  INNER JOIN production.product p</span></span>
<span id="cb155-17"><a href="chapter-exploring-a-single-table.html#cb155-17"></a><span class="st">          ON sd.productid = p.productid</span></span>
<span id="cb155-18"><a href="chapter-exploring-a-single-table.html#cb155-18"></a><span class="st">  INNER JOIN sales.specialoffer so</span></span>
<span id="cb155-19"><a href="chapter-exploring-a-single-table.html#cb155-19"></a><span class="st">          ON sd.specialofferid = so.specialofferid</span></span>
<span id="cb155-20"><a href="chapter-exploring-a-single-table.html#cb155-20"></a><span class="st">  LEFT OUTER JOIN sales.specialofferproduct sop</span></span>
<span id="cb155-21"><a href="chapter-exploring-a-single-table.html#cb155-21"></a><span class="st">          ON sd.specialofferid = sop.specialofferid</span></span>
<span id="cb155-22"><a href="chapter-exploring-a-single-table.html#cb155-22"></a><span class="st">         and sd.productid = sop.productid</span></span>
<span id="cb155-23"><a href="chapter-exploring-a-single-table.html#cb155-23"></a><span class="st"> WHERE sop.productid is not null</span></span>
<span id="cb155-24"><a href="chapter-exploring-a-single-table.html#cb155-24"></a><span class="st">group by EXTRACT(MONTH FROM orderdate) </span></span>
<span id="cb155-25"><a href="chapter-exploring-a-single-table.html#cb155-25"></a><span class="st">        ,EXTRACT(YEAR FROM orderdate) </span></span>
<span id="cb155-26"><a href="chapter-exploring-a-single-table.html#cb155-26"></a><span class="st">        ,onlineorderflag</span></span>
<span id="cb155-27"><a href="chapter-exploring-a-single-table.html#cb155-27"></a><span class="st">order by mo,yr</span></span>
<span id="cb155-28"><a href="chapter-exploring-a-single-table.html#cb155-28"></a><span class="st">&quot;</span></span>
<span id="cb155-29"><a href="chapter-exploring-a-single-table.html#cb155-29"></a>)</span>
<span id="cb155-30"><a href="chapter-exploring-a-single-table.html#cb155-30"></a></span>
<span id="cb155-31"><a href="chapter-exploring-a-single-table.html#cb155-31"></a><span class="kw">sp_print_df</span>(<span class="kw">head</span>(monthly_sales_onl_pct))</span></code></pre></div>
<div id="htmlwidget-06290dba2a01ad394207" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-06290dba2a01ad394207">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],[1,1,1,1,1,1],[2012,2012,2013,2013,2014,2014],[193,3774,294,3860,6598,4865],[193,0,294,0,0,4865],[0,1519,0,1215,2180,0],[100,0,100,0,0,100],[0,100,0,100,100,0],[true,false,true,false,false,true],[193,1519,294,1215,2180,4865]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mo<\/th>\n      <th>yr<\/th>\n      <th>sum<\/th>\n      <th>onl<\/th>\n      <th>sp<\/th>\n      <th>onl_pct<\/th>\n      <th>sp_pct<\/th>\n      <th>onlineorderflag<\/th>\n      <th>count<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,9]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="chapter-exploring-a-single-table.html#cb156-1"></a>mo_onl_pct &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(</span>
<span id="cb156-2"><a href="chapter-exploring-a-single-table.html#cb156-2"></a>  con,</span>
<span id="cb156-3"><a href="chapter-exploring-a-single-table.html#cb156-3"></a>  <span class="st">&quot;</span></span>
<span id="cb156-4"><a href="chapter-exploring-a-single-table.html#cb156-4"></a><span class="st">SELECT *</span></span>
<span id="cb156-5"><a href="chapter-exploring-a-single-table.html#cb156-5"></a><span class="st">      ,round(orders/mo_orders * 100.0,2) mo_pct</span></span>
<span id="cb156-6"><a href="chapter-exploring-a-single-table.html#cb156-6"></a><span class="st">      ,round(sales_dollars/mo_sales * 100.0,2) mo_dlr_pct</span></span>
<span id="cb156-7"><a href="chapter-exploring-a-single-table.html#cb156-7"></a><span class="st">  FROM (SELECT EXTRACT(MONTH FROM orderdate) mo, EXTRACT(YEAR FROM orderdate) yr</span></span>
<span id="cb156-8"><a href="chapter-exploring-a-single-table.html#cb156-8"></a><span class="st">             , min(orderdate)::DATE min_soh_orderdate, max(orderdate)::DATE max_soh_orderdate</span></span>
<span id="cb156-9"><a href="chapter-exploring-a-single-table.html#cb156-9"></a><span class="st">             , round(sum(subtotal), 2) sales_dollars</span></span>
<span id="cb156-10"><a href="chapter-exploring-a-single-table.html#cb156-10"></a><span class="st">             , round(sum(sum(subtotal)) over (partition by EXTRACT(MONTH FROM orderdate),EXTRACT(YEAR FROM orderdate)</span></span>
<span id="cb156-11"><a href="chapter-exploring-a-single-table.html#cb156-11"></a><span class="st">                             order by EXTRACT(YEAR FROM orderdate)),2) mo_sales</span></span>
<span id="cb156-12"><a href="chapter-exploring-a-single-table.html#cb156-12"></a><span class="st">             , count(*) * 1.0 orders</span></span>
<span id="cb156-13"><a href="chapter-exploring-a-single-table.html#cb156-13"></a><span class="st">             , sum(count(*)) over (partition by EXTRACT(MONTH FROM orderdate),EXTRACT(YEAR FROM orderdate)</span></span>
<span id="cb156-14"><a href="chapter-exploring-a-single-table.html#cb156-14"></a><span class="st">                             order by EXTRACT(YEAR FROM orderdate)) mo_orders</span></span>
<span id="cb156-15"><a href="chapter-exploring-a-single-table.html#cb156-15"></a><span class="st">             , case when sh.onlineorderflag then &#39;online&#39; else &#39;sales rep&#39; end sales_type</span></span>
<span id="cb156-16"><a href="chapter-exploring-a-single-table.html#cb156-16"></a><span class="st">        FROM sales.salesorderheader sh</span></span>
<span id="cb156-17"><a href="chapter-exploring-a-single-table.html#cb156-17"></a><span class="st">        GROUP BY EXTRACT(MONTH FROM orderdate), EXTRACT(YEAR FROM orderdate), </span></span>
<span id="cb156-18"><a href="chapter-exploring-a-single-table.html#cb156-18"></a><span class="st">                 case when sh.onlineorderflag then &#39;online&#39; else &#39;sales rep&#39; end</span></span>
<span id="cb156-19"><a href="chapter-exploring-a-single-table.html#cb156-19"></a><span class="st">       ) as src</span></span>
<span id="cb156-20"><a href="chapter-exploring-a-single-table.html#cb156-20"></a><span class="st">ORDER BY mo, yr, sales_type</span></span>
<span id="cb156-21"><a href="chapter-exploring-a-single-table.html#cb156-21"></a><span class="st">&quot;</span></span>
<span id="cb156-22"><a href="chapter-exploring-a-single-table.html#cb156-22"></a>)</span>
<span id="cb156-23"><a href="chapter-exploring-a-single-table.html#cb156-23"></a></span>
<span id="cb156-24"><a href="chapter-exploring-a-single-table.html#cb156-24"></a><span class="kw">sp_print_df</span>(<span class="kw">head</span>(mo_onl_pct))</span></code></pre></div>
<div id="htmlwidget-edb662ff7931dcb6630b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-edb662ff7931dcb6630b">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],[1,1,1,1,1,1],[2012,2012,2013,2013,2014,2014],["2012-01-01","2012-01-01","2013-01-01","2013-01-28","2014-01-01","2014-01-28"],["2012-01-31","2012-01-29","2013-01-31","2013-01-28","2014-01-31","2014-01-29"],[614557.94,3356069.34,523917.38,1563955.08,1551065.56,2738752.39],[3970627.28,3970627.28,2087872.46,2087872.46,4289817.95,4289817.95],[193,143,294,106,1966,175],[336,336,400,400,2141,2141],["online","sales rep","online","sales rep","online","sales rep"],[57.44,42.56,73.5,26.5,91.83,8.17],[15.48,84.52,25.09,74.91,36.16,63.84]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mo<\/th>\n      <th>yr<\/th>\n      <th>min_soh_orderdate<\/th>\n      <th>max_soh_orderdate<\/th>\n      <th>sales_dollars<\/th>\n      <th>mo_sales<\/th>\n      <th>orders<\/th>\n      <th>mo_orders<\/th>\n      <th>sales_type<\/th>\n      <th>mo_pct<\/th>\n      <th>mo_dlr_pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,5,6,7,8,10,11]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="chapter-exploring-a-single-table.html#cb157-1"></a>mo_onl_pct<span class="op">$</span>mo &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mo_onl_pct<span class="op">$</span>mo)</span>
<span id="cb157-2"><a href="chapter-exploring-a-single-table.html#cb157-2"></a>mo_onl_pct<span class="op">$</span>yr &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mo_onl_pct<span class="op">$</span>yr)</span>
<span id="cb157-3"><a href="chapter-exploring-a-single-table.html#cb157-3"></a>mo_onl_pct<span class="op">$</span>sales_type &lt;-<span class="st"> </span><span class="kw">as.factor</span>(mo_onl_pct<span class="op">$</span>sales_type)</span>
<span id="cb157-4"><a href="chapter-exploring-a-single-table.html#cb157-4"></a>mo_<span class="dv">2011</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2011</span>)</span>
<span id="cb157-5"><a href="chapter-exploring-a-single-table.html#cb157-5"></a>mo_<span class="dv">2012</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2012</span>)</span>
<span id="cb157-6"><a href="chapter-exploring-a-single-table.html#cb157-6"></a>mo_<span class="dv">2013</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2013</span>)</span>
<span id="cb157-7"><a href="chapter-exploring-a-single-table.html#cb157-7"></a>mo_<span class="dv">2014</span> &lt;-<span class="st"> </span>mo_onl_pct <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(yr <span class="op">==</span><span class="st"> </span><span class="dv">2014</span>)</span>
<span id="cb157-8"><a href="chapter-exploring-a-single-table.html#cb157-8"></a></span>
<span id="cb157-9"><a href="chapter-exploring-a-single-table.html#cb157-9"></a></span>
<span id="cb157-10"><a href="chapter-exploring-a-single-table.html#cb157-10"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="ot">NULL</span>) <span class="op">+</span></span>
<span id="cb157-11"><a href="chapter-exploring-a-single-table.html#cb157-11"></a><span class="st">  </span><span class="co"># data=mo_2011 first results in the x axis months out of order.</span></span>
<span id="cb157-12"><a href="chapter-exploring-a-single-table.html#cb157-12"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2012</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></span>
<span id="cb157-13"><a href="chapter-exploring-a-single-table.html#cb157-13"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2011</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></span>
<span id="cb157-14"><a href="chapter-exploring-a-single-table.html#cb157-14"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2013</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></span>
<span id="cb157-15"><a href="chapter-exploring-a-single-table.html#cb157-15"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> mo_<span class="dv">2014</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> yr, <span class="dt">group =</span> sales_type)) <span class="op">+</span></span>
<span id="cb157-16"><a href="chapter-exploring-a-single-table.html#cb157-16"></a></span>
<span id="cb157-17"><a href="chapter-exploring-a-single-table.html#cb157-17"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2011</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></span>
<span id="cb157-18"><a href="chapter-exploring-a-single-table.html#cb157-18"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2012</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></span>
<span id="cb157-19"><a href="chapter-exploring-a-single-table.html#cb157-19"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2013</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></span>
<span id="cb157-20"><a href="chapter-exploring-a-single-table.html#cb157-20"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mo_<span class="dv">2014</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">color =</span> sales_type)) <span class="op">+</span></span>
<span id="cb157-21"><a href="chapter-exploring-a-single-table.html#cb157-21"></a></span>
<span id="cb157-22"><a href="chapter-exploring-a-single-table.html#cb157-22"></a><span class="st">  </span><span class="kw">geom_text</span>(</span>
<span id="cb157-23"><a href="chapter-exploring-a-single-table.html#cb157-23"></a>    <span class="dt">data =</span> mo_<span class="dv">2011</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)),</span>
<span id="cb157-24"><a href="chapter-exploring-a-single-table.html#cb157-24"></a>    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.25</span>, <span class="dt">hjust =</span> <span class="fl">1.0</span></span>
<span id="cb157-25"><a href="chapter-exploring-a-single-table.html#cb157-25"></a>  ) <span class="op">+</span></span>
<span id="cb157-26"><a href="chapter-exploring-a-single-table.html#cb157-26"></a><span class="st">  </span><span class="kw">geom_text</span>(</span>
<span id="cb157-27"><a href="chapter-exploring-a-single-table.html#cb157-27"></a>    <span class="dt">data =</span> mo_<span class="dv">2012</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)),</span>
<span id="cb157-28"><a href="chapter-exploring-a-single-table.html#cb157-28"></a>    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.25</span>, <span class="dt">hjust =</span> <span class="fl">1.0</span></span>
<span id="cb157-29"><a href="chapter-exploring-a-single-table.html#cb157-29"></a>  ) <span class="op">+</span></span>
<span id="cb157-30"><a href="chapter-exploring-a-single-table.html#cb157-30"></a><span class="st">  </span><span class="kw">geom_text</span>(</span>
<span id="cb157-31"><a href="chapter-exploring-a-single-table.html#cb157-31"></a>    <span class="dt">data =</span> mo_<span class="dv">2013</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)),</span>
<span id="cb157-32"><a href="chapter-exploring-a-single-table.html#cb157-32"></a>    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.25</span>, <span class="dt">hjust =</span> <span class="fl">1.0</span></span>
<span id="cb157-33"><a href="chapter-exploring-a-single-table.html#cb157-33"></a>  ) <span class="op">+</span></span>
<span id="cb157-34"><a href="chapter-exploring-a-single-table.html#cb157-34"></a><span class="st">  </span><span class="kw">geom_text</span>(</span>
<span id="cb157-35"><a href="chapter-exploring-a-single-table.html#cb157-35"></a>    <span class="dt">data =</span> mo_<span class="dv">2014</span>, <span class="kw">aes</span>(<span class="dt">x =</span> mo, <span class="dt">y =</span> mo_pct, <span class="dt">label =</span> <span class="kw">paste</span>(orders, <span class="st">&quot;:$&quot;</span>, sales_dollars, <span class="st">&quot;:&quot;</span>, mo_dlr_pct, <span class="st">&quot;%&quot;</span>)), <span class="dt">color =</span> <span class="st">&quot;lightblue&quot;</span>,</span>
<span id="cb157-36"><a href="chapter-exploring-a-single-table.html#cb157-36"></a>    <span class="dt">position =</span> <span class="kw">position_dodge</span>(.<span class="dv">3</span>), <span class="dt">size =</span> <span class="fl">2.25</span>, <span class="dt">hjust =</span> <span class="fl">1.0</span>, <span class="dt">vjust =</span> <span class="fl">1.5</span></span>
<span id="cb157-37"><a href="chapter-exploring-a-single-table.html#cb157-37"></a>  ) <span class="op">+</span></span>
<span id="cb157-38"><a href="chapter-exploring-a-single-table.html#cb157-38"></a></span>
<span id="cb157-39"><a href="chapter-exploring-a-single-table.html#cb157-39"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month&quot;</span>) <span class="op">+</span></span>
<span id="cb157-40"><a href="chapter-exploring-a-single-table.html#cb157-40"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;% Online Sales</span><span class="ch">\n</span><span class="st">vs</span><span class="ch">\n</span><span class="st">%Rep Sales&quot;</span>) <span class="op">+</span></span>
<span id="cb157-41"><a href="chapter-exploring-a-single-table.html#cb157-41"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">.50</span>)) <span class="op">+</span></span>
<span id="cb157-42"><a href="chapter-exploring-a-single-table.html#cb157-42"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(</span>
<span id="cb157-43"><a href="chapter-exploring-a-single-table.html#cb157-43"></a>    <span class="st">&quot;Sales by Month</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb157-44"><a href="chapter-exploring-a-single-table.html#cb157-44"></a>    <span class="st">&quot;Online Orders Versus Rep Orders</span><span class="ch">\n</span><span class="st">&quot;</span>,</span>
<span id="cb157-45"><a href="chapter-exploring-a-single-table.html#cb157-45"></a>    min_soh_dt, <span class="st">&quot; - &quot;</span>, max_soh_dt, <span class="st">&quot;</span></span>
<span id="cb157-46"><a href="chapter-exploring-a-single-table.html#cb157-46"></a><span class="st">&quot;</span>,</span>
<span id="cb157-47"><a href="chapter-exploring-a-single-table.html#cb157-47"></a>    <span class="st">&quot;Each Point shows Number of Orders: $ Amount: % of Total $ For the Month&quot;</span></span>
<span id="cb157-48"><a href="chapter-exploring-a-single-table.html#cb157-48"></a>  ))</span></code></pre></div>
<p><img src="083-exploring-a-single-table_files/figure-html/unnamed-chunk-14-2.png" width="1536" /></p>
<p>This plot is much easier to read, but the sales orders =&gt; avg_s
From the tidy point of view overview, <a href="https://tidyr.tidyverse.org/" class="uri">https://tidyr.tidyverse.org/</a>:</p>
<p>Tidy data is data where:</p>
<ul>
<li>Each variable is in a column.</li>
<li>Each observation is a row.</li>
<li>Each value is a cell.</li>
</ul>
<p>The gather command throws the following warning:</p>
<pre><code>attributes are not identical across measure variables;
they will be dropped</code></pre>
</div>
</div>
<div id="close-and-clean-up" class="section level2">
<h2><span class="header-section-number">8.10</span> Close and clean up</h2>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="chapter-exploring-a-single-table.html#cb159-1"></a><span class="kw">dbDisconnect</span>(con)</span>
<span id="cb159-2"><a href="chapter-exploring-a-single-table.html#cb159-2"></a><span class="kw">sp_docker_stop</span>(<span class="st">&quot;adventureworks&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-dbms-queries-intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter-sales-forecasting.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/smithjd/sql-pet/edit/master/083-exploring-a-single-table.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
